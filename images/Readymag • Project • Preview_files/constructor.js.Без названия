import{a as mp}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-JJKDQOBA.js";import{a as dp,b as _i}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EHZQAJQP.js";import{$ as X2,$a as xd,$b as ub,A as bh,Aa as ar,Ab as Qf,B as sd,Ba as _f,Bb as b_,C as vh,Ca as r_,Cb as eb,D as kh,Da as Gl,Db as w_,E as D2,Ea as Cf,Eb as tb,F as _h,Fa as Vl,Fb as x_,G as Ch,Ga as Sf,Gb as ob,H as Sh,Ha as bd,Hb as v_,I as ad,Ia as ba,Ib as rb,J as Ph,Ja as Pf,Jb as k_,K as Th,Ka as Tf,Kb as ib,L as Mh,La as i_,Lb as y_,M as Rl,Ma as Bf,Mb as nb,N as rf,Na as If,Nb as __,O as nf,Oa as zf,Ob as sb,P as sf,Pa as n_,Pb as C_,Q as af,Qa as Ot,Qb as ab,R as lf,Ra as Mr,Rb as S_,S as kt,Sa as ki,Sb as lb,T as da,Ta as Xl,Tb as P_,U as Gt,Ua as Zl,Ub as pb,V as Ol,Va as Of,Vb as T_,W as pf,Wa as Nf,Wb as bn,X as Nl,Xa as c_,Xb as cb,Y as cf,Ya as Jl,Yb as db,Z as df,Za as Ff,Zb as ip,_ as ht,_a as ls,_b as mb,a as Lt,aa as Fl,ab as Vf,ac as M_,b as Jc,ba as K2,bb as u_,bc as fb,c as Mo,ca as mf,cb as jf,cc as z_,d as Sl,da as uf,db as g_,dc as bb,e as Qc,ea as _o,eb as vd,ec as E_,f as fi,fa as ma,fb as Yf,fc as Sb,g as oa,ga as Z2,gb as qf,gc as np,h as sa,ha as Wl,hb as h_,hc as Pb,i as S2,ia as gf,ib as yi,ic as ho,j as xi,ja as hf,jb as ep,jc as sp,k as Tl,ka as ff,kb as Co,kc as ap,l as Zg,la as ns,lb as fn,lc as lp,m as Jg,ma as cd,mb as Lo,mc as pp,n as Qg,na as bf,nb as tp,nc as Tb,o as kr,oa as J2,ob as Kt,oc as Mb,p as ch,pa as mt,pb as Zo,pc as Bb,q as dh,qa as Xo,qb as ps,qc as D_,r as dn,ra as md,rb as Kf,rc as _d,s as Bl,sa as e_,sb as f_,sc as Ib,t as Il,ta as ud,tb as op,tc as Jo,u as os,ua as t_,ub as Zf,uc as Cd,v as mh,va as gd,vb as rp,vc as Sd,w as uh,wa as ss,wb as Jf,wc as Eb,x as gh,xa as hd,xb as Je,y as zl,ya as st,yb as kd,z as El,za as yf,zb as to}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-UR5BJO7T.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PVKAHQAO.js";import{f as Df,g as a_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PAHCFG2S.js";import{b as eo,c as jr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZVTWH2QV.js";import{a as Ql,b as Xf}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4KALKUDQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PAAFKVWO.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-6S3VH7KA.js";import{a as Db}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SSC6L4AN.js";import{a as Pd}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-H2WCVDPM.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-D6PXHSPU.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-YSSTR5YG.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ANMJ5WL6.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XDJFTPLV.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ILSBLVOF.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OBE7LN4B.js";import{a as zb}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FWR4W4VX.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-6D26AD5H.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FSDT4OVT.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-YTFLTX7X.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-V2X4SRIN.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-M34L2HTZ.js";import{a as Tr,b as fa,d as Kl,e as Lf}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3ZZLL7J7.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PTTLGSID.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OT5QPA25.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MQWYJ74Q.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DXORC3AA.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ENZVPQSV.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FYWTBKR2.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-IR2SAVKR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-2WUM55FP.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-TQLDODJX.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-GUTTYZK5.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-WDYLGMWV.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-CAAW5PFE.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ARWZSLEO.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DQICXE7G.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SL3DWJT3.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ETYEFYMT.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-D4TX64V5.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-R7U6VT5D.js";import{d as wb,e as xb,f as vb,g as kb,h as yb}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-O6MKMYHM.js";import{a as hb,b as I_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-QSKMQCYR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-R3TLMTZH.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-2Y3ADRZI.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZFRYUSID.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SMFHXRWV.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MLZSNCNH.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-UNE4HMIN.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KZVIPRQW.js";import{A as vi,B as wf,C as Q2,H as hn,I as dd,a as an,b as ln,c as Gg,d as ts,e as Pl,f as td,g as Vg,h as od,i as jg,j as Yg,k as qg,l as Gr,m as Xg,n as je,o as bi,r as hh,s as yr,t as fh,u as R2,v as Fe,w as _r,x as mn,y as Vr,z as Cr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PHAE6EUK.js";import{a as yh,b as $2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZMWC6NWI.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-522PCZT6.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-VJCRUFTQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-UWEOZ7MT.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PECWKSPR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-6NLGYD2V.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-NQTRTYO2.js";import{a as Xt,b as Br}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XYVL7TCU.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZRNE7Y4B.js";import{a as Yt,b as tn}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-AAEOTDA7.js";import{a as $b}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ST7BIEMQ.js";import{a as Cl}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-YEVJ6WIB.js";import{A as Be,B as $g,D as Lg,E as kl,F as sn,G as $t,H as Qn,I as sr,J as Zc,K as Hg,L as Og,M as Ie,N as Ng,O as yl,P as jo,Q as _l,R as ct,a as Vc,b as Yc,c as sg,d as b2,e as Kn,f as bl,g as Cg,h as _2,i as Sg,j as Pg,k as Tg,l as Kc,m as Mg,n as Bg,o as Ig,p as zg,q as Eg,r as Rg,s as Ag,t as C2,u as ie,v as Jn,w as xl,x as Te,y as vl,z as Dg}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-5PTIIYJV.js";import{a as js,b as tg}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-2VJZ4PJG.js";import{b as rn}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-IHKRLU5D.js";import{a as va,b as cp,e as Ho}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-A2JMYJB2.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-NELFHC6J.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-S7GYGCE7.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-H2TOEPHE.js";import{c as nl,d as Qu,e as eg,f as sl}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FVPP7Y3O.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-JL7D2SWU.js";import{a as R_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KNILMO4W.js";import{a as Gf,b as m_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-UX2UH664.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-AL4P2LIB.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PVOHQJ2A.js";import{a as xa,b as Uf}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-NUR3ZDWW.js";import{a as Fg,b as Wg,c as Ug,d as es,e as ed}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-RYIQMV6Z.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZGEIJX4I.js";import{a as Wf,d as d_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZOWFHQWN.js";import{b as on,c as Xu,e as Wc}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-Q6EPMWNV.js";import{a as uo,b as fl}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-E7IZXHHJ.js";import{a as Ct,b as Fr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XO5ETF6H.js";import{Aa as gl,Ba as bg,Bb as hl,Da as wg,f as qc,ga as ml,na as gg,va as Xn,xa as ul,ya as hg,za as fg}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OPSRDLG4.js";import{a as qs,b as Xc}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EZPUI4NP.js";import{a as Yn,d as dl,e as qn,g as nn}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-BTO57T6V.js";import{b as Ab}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MTF3E4VV.js";import{a as Rb}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-HVERW2CO.js";import{a as E2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-UL6Z7RIO.js";import{a as ga,b as Ko,c as ha}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-GGDHYSND.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PAXTCZ3C.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-VADXOMYQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4QF7EQWH.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-JS5QQ77W.js";import{a as oh,b as T2,g as rh,i as ih,k as M2,l as nh,n as B2,t as sh,u as ah,v as I2,w as lh,y as ph,z as z2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-S2DXVR3U.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-GNGCZZMW.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XX445WZ6.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-J2XMCI2A.js";import{a as gb,c as B_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DHV4IOQN.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4Q3X7GFI.js";import{a as Ih,d as is,g as dt,h as ao}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PHSK33R2.js";import{a as Al,b as zh}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-HN5BSNCO.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FOC6RHXW.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-GIKDBGZ4.js";import{d as eh,e as P2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MG4ATUC3.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-Q5LWLIAT.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FELZSQW5.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-TVUNLYNS.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KECRLYPP.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-NM4KBT2Z.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3FDFBANI.js";import{a as Ge,b as go}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SVZVVKHJ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KYXJJQ4X.js";import{a as ra,b as ia,c as id,d as Kg,e as Ao,f as na}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-W76AAEYR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-J2PHXYJU.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KWWCLG4X.js";import{a as xt,b as wi}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-LUGY57UR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-QKABJ3FI.js";import{a as wa,b as p_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FARZI7Q3.js";import{l as Ef,m as Rf,n as s_,s as Af,t as Yl,u as wd}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DKETITUF.js";import{a as cn,b as nd}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SSL4ALEQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XHKDSGNF.js";import{b as xg,k as y2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-2ZXW5VTS.js";import{b as vg,i as wl,j as kg,k as yg,l as _g,p as Zn}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FSJO7VBD.js";import{H as dg,J as x2,a as Wr,b as og,k as Xs,l as Ks,n as Zs,o as Js,q as Qs,r as ea,u as cg}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-LZ3PKEI6.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-IYDYUS43.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-QFX4KIOQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-E6TEEDHK.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-U3AOABLE.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7NWI6CIK.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-H7NVKV5B.js";import{a as Ml,b as th}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DZKEZKK4.js";import{a as Lb}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-WDTKUPAP.js";import{a as Hf,b as l_}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4VJLLPCM.js";import{a as jn,b as Zu,d as Ju,h as Uc}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EBPACYHV.js";import{a as gt,b as Vn}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-A3HN4SJZ.js";import{a as il,b as Ku}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-LLSIVOMM.js";import{$a as pd,$b as Hl,Aa as Nh,Ba as N2,Hb as Do,Ib as pa,Jb as $o,K as Eh,Ka as $l,Kb as ca,La as Fh,N as Rh,P as Ah,R as Dh,S as aa,T as $h,Ua as Wh,Va as F2,Vb as Zh,Wb as Jh,Xb as Qh,Ya as la,Yb as ef,Za as Uh,Zb as tf,_a as un,_b as of,ab as Gh,ac as q2,bb as W2,cb as Ll,db as Vh,ea as Dl,eb as jh,fa as Lh,fb as U2,hc as gn,ia as Hh,ib as Yh,ic as xf,ja as H2,jb as G2,jc as as,kb as qh,kc as fd,lb as V2,lc as Ul,ma as Oh,mc as vf,na as O2,nc as kf,oc as o_,pc as wn,qb as Xh,qc as _b,rb as j2,rc as yd,sc as Cb,tc as A_,wb as Kh,xb as Y2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7OSLZCAS.js";import{a as Ht,b as Yr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-2PWBIDNE.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-LYLXTPUH.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OPZ2KG6Z.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7B7LFQUR.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-NZHF6VER.js";import{a as jl,b as Mf}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-QRKGHAAX.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-HORRKHSG.js";import{a as ql,b as $f}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KSY3VZXQ.js";import{a as Pr,b as ua}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-VQ4VGEHM.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4SAZI4VE.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EEBFO5X3.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZKEFQYNU.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-LR7QOOGY.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7I7NSKLU.js";import{c as Ye,d as Vo}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-BHJWLY4L.js";import{a as ye,b as yo}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-BL6MFZIJ.js";import{a as mo}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7KA66EKG.js";import{b as Bh,c as L2,d as rs,g as ld}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ZNVE23CI.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KWHB33KS.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-CVEBDQ6H.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-HXODDG5W.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-Y6SRPLGS.js";import{a as qt,b as qo,h as wh,i as xh,k as Sr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OMJ4JSLD.js";import{a as Yo}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-CU43CTV4.js";import{a as Ze,b as ne,c as Oe}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-M6PWSVKK.js";import{a as vt,b as A2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OXUF22KO.js";import{a as f,d as G}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-CLXQBR4X.js";import{a as Le,b as I,c as Re,d as ng,e as ve}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-Y3SQTCWW.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-I564VFZ5.js";import{n as pn,o as rd}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4TZ5MZ2R.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3J7DQQH4.js";import{d as ce,f as Gs,g as rl,i as Gu,j as ae,k as tt}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7YKBU3QS.js";import{a as Yu,b as qu,g as f2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-WDG66SQN.js";import{d as pg,e as w2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ADCFRXSS.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-GW3MPEWV.js";import{c as pl,d as lg}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7UPSZIWT.js";import{c as Ys,d as ag}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MDQBOFFQ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-RZYLNDKI.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-ITHTYBJX.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-I4OK56RI.js";import{b as ju,h as h2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-KEQU5PYG.js";import{b as tl,c as Wu,e as Uu,g as ol}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-QNEJC7KR.js";import{k as Ee,l as Pt,m as Me,o as Ur,p as ll,r as Y,s as Gc,v as re}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MEHIKFSE.js";import{a as cl}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-OZJ6BM56.js";import{a as vr,b as ta}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-O25CCBQ5.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-65W7PL4S.js";import{a as O,e as hi,h as Ue}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3BZKJAD7.js";import{a as nr}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7OOXBPEG.js";import{d as k2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-YWA53PQL.js";import{a as mg,b as v2}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FFLWSKSM.js";import{a as ug}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-SCKBLEKI.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EFXW3SYO.js";import{a as rg,c as te,d as al,e as ig}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-TZJEDBND.js";import{B as K,C as n,D as w,E as v}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3SMF7CXD.js";import{a as H}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PYGSL2T4.js";import{a as gi,b as jc}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-DUSQQUKM.js";import{A as Gn,g as Qt,k as Ou,v as Nu,x as Fc}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-XK2J2UDU.js";import{a as Fu,b as oe,c as pt}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-62KNIYAU.js";import{a as St}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-IEKYTMDV.js";import{b as et}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-AUISPXOE.js";import{a as Lu}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-4CDNSL2V.js";import{a as Dt,c as ui,e as Vs,g as Vu,n as Pe,o as ot}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FFESUMTM.js";import{b as wo}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-MWJ5V2WU.js";import{a as Un,b as Hu}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-K42E5IMZ.js";import"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7J4C536U.js";import{b as $u,d as T,f as E}from"https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PDO3EHLP.js";var iv=$u((dG,ac)=>{"use strict";var tv={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u1EA4:"A",\u1EAE:"A",\u1EB2:"A",\u1EB4:"A",\u1EB6:"A",\u00C6:"AE",\u1EA6:"A",\u1EB0:"A",\u0202:"A",\u1EA2:"A",\u1EA0:"A",\u1EA8:"A",\u1EAA:"A",\u1EAC:"A",\u00C7:"C",\u1E08:"C",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u1EBE:"E",\u1E16:"E",\u1EC0:"E",\u1E14:"E",\u1E1C:"E",\u0206:"E",\u1EBA:"E",\u1EBC:"E",\u1EB8:"E",\u1EC2:"E",\u1EC4:"E",\u1EC6:"E",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u1E2E:"I",\u020A:"I",\u1EC8:"I",\u1ECA:"I",\u00D0:"D",\u00D1:"N",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u1ED0:"O",\u1E4C:"O",\u1E52:"O",\u020E:"O",\u1ECE:"O",\u1ECC:"O",\u1ED4:"O",\u1ED6:"O",\u1ED8:"O",\u1EDC:"O",\u1EDE:"O",\u1EE0:"O",\u1EDA:"O",\u1EE2:"O",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u1EE6:"U",\u1EE4:"U",\u1EEC:"U",\u1EEE:"U",\u1EF0:"U",\u00DD:"Y",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u1EA5:"a",\u1EAF:"a",\u1EB3:"a",\u1EB5:"a",\u1EB7:"a",\u00E6:"ae",\u1EA7:"a",\u1EB1:"a",\u0203:"a",\u1EA3:"a",\u1EA1:"a",\u1EA9:"a",\u1EAB:"a",\u1EAD:"a",\u00E7:"c",\u1E09:"c",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u1EBF:"e",\u1E17:"e",\u1EC1:"e",\u1E15:"e",\u1E1D:"e",\u0207:"e",\u1EBB:"e",\u1EBD:"e",\u1EB9:"e",\u1EC3:"e",\u1EC5:"e",\u1EC7:"e",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u1E2F:"i",\u020B:"i",\u1EC9:"i",\u1ECB:"i",\u00F0:"d",\u00F1:"n",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u1ED1:"o",\u1E4D:"o",\u1E53:"o",\u020F:"o",\u1ECF:"o",\u1ECD:"o",\u1ED5:"o",\u1ED7:"o",\u1ED9:"o",\u1EDD:"o",\u1EDF:"o",\u1EE1:"o",\u1EDB:"o",\u1EE3:"o",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u1EE7:"u",\u1EE5:"u",\u1EED:"u",\u1EEF:"u",\u1EF1:"u",\u00FD:"y",\u00FF:"y",\u0100:"A",\u0101:"a",\u0102:"A",\u0103:"a",\u0104:"A",\u0105:"a",\u0106:"C",\u0107:"c",\u0108:"C",\u0109:"c",\u010A:"C",\u010B:"c",\u010C:"C",\u010D:"c",C\u0306:"C",c\u0306:"c",\u010E:"D",\u010F:"d",\u0110:"D",\u0111:"d",\u0112:"E",\u0113:"e",\u0114:"E",\u0115:"e",\u0116:"E",\u0117:"e",\u0118:"E",\u0119:"e",\u011A:"E",\u011B:"e",\u011C:"G",\u01F4:"G",\u011D:"g",\u01F5:"g",\u011E:"G",\u011F:"g",\u0120:"G",\u0121:"g",\u0122:"G",\u0123:"g",\u0124:"H",\u0125:"h",\u0126:"H",\u0127:"h",\u1E2A:"H",\u1E2B:"h",\u0128:"I",\u0129:"i",\u012A:"I",\u012B:"i",\u012C:"I",\u012D:"i",\u012E:"I",\u012F:"i",\u0130:"I",\u0131:"i",\u0132:"IJ",\u0133:"ij",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u1E30:"K",\u1E31:"k",K\u0306:"K",k\u0306:"k",\u0139:"L",\u013A:"l",\u013B:"L",\u013C:"l",\u013D:"L",\u013E:"l",\u013F:"L",\u0140:"l",\u0141:"l",\u0142:"l",\u1E3E:"M",\u1E3F:"m",M\u0306:"M",m\u0306:"m",\u0143:"N",\u0144:"n",\u0145:"N",\u0146:"n",\u0147:"N",\u0148:"n",\u0149:"n",N\u0306:"N",n\u0306:"n",\u014C:"O",\u014D:"o",\u014E:"O",\u014F:"o",\u0150:"O",\u0151:"o",\u0152:"OE",\u0153:"oe",P\u0306:"P",p\u0306:"p",\u0154:"R",\u0155:"r",\u0156:"R",\u0157:"r",\u0158:"R",\u0159:"r",R\u0306:"R",r\u0306:"r",\u0212:"R",\u0213:"r",\u015A:"S",\u015B:"s",\u015C:"S",\u015D:"s",\u015E:"S",\u0218:"S",\u0219:"s",\u015F:"s",\u0160:"S",\u0161:"s",\u0162:"T",\u0163:"t",\u021B:"t",\u021A:"T",\u0164:"T",\u0165:"t",\u0166:"T",\u0167:"t",T\u0306:"T",t\u0306:"t",\u0168:"U",\u0169:"u",\u016A:"U",\u016B:"u",\u016C:"U",\u016D:"u",\u016E:"U",\u016F:"u",\u0170:"U",\u0171:"u",\u0172:"U",\u0173:"u",\u0216:"U",\u0217:"u",V\u0306:"V",v\u0306:"v",\u0174:"W",\u0175:"w",\u1E82:"W",\u1E83:"w",X\u0306:"X",x\u0306:"x",\u0176:"Y",\u0177:"y",\u0178:"Y",Y\u0306:"Y",y\u0306:"y",\u0179:"Z",\u017A:"z",\u017B:"Z",\u017C:"z",\u017D:"Z",\u017E:"z",\u017F:"s",\u0192:"f",\u01A0:"O",\u01A1:"o",\u01AF:"U",\u01B0:"u",\u01CD:"A",\u01CE:"a",\u01CF:"I",\u01D0:"i",\u01D1:"O",\u01D2:"o",\u01D3:"U",\u01D4:"u",\u01D5:"U",\u01D6:"u",\u01D7:"U",\u01D8:"u",\u01D9:"U",\u01DA:"u",\u01DB:"U",\u01DC:"u",\u1EE8:"U",\u1EE9:"u",\u1E78:"U",\u1E79:"u",\u01FA:"A",\u01FB:"a",\u01FC:"AE",\u01FD:"ae",\u01FE:"O",\u01FF:"o",\u00DE:"TH",\u00FE:"th",\u1E54:"P",\u1E55:"p",\u1E64:"S",\u1E65:"s",X\u0301:"X",x\u0301:"x",\u0403:"\u0413",\u0453:"\u0433",\u040C:"\u041A",\u045C:"\u043A",A\u030B:"A",a\u030B:"a",E\u030B:"E",e\u030B:"e",I\u030B:"I",i\u030B:"i",\u01F8:"N",\u01F9:"n",\u1ED2:"O",\u1ED3:"o",\u1E50:"O",\u1E51:"o",\u1EEA:"U",\u1EEB:"u",\u1E80:"W",\u1E81:"w",\u1EF2:"Y",\u1EF3:"y",\u0200:"A",\u0201:"a",\u0204:"E",\u0205:"e",\u0208:"I",\u0209:"i",\u020C:"O",\u020D:"o",\u0210:"R",\u0211:"r",\u0214:"U",\u0215:"u",B\u030C:"B",b\u030C:"b",\u010C\u0323:"C",\u010D\u0323:"c",\u00CA\u030C:"E",\u00EA\u030C:"e",F\u030C:"F",f\u030C:"f",\u01E6:"G",\u01E7:"g",\u021E:"H",\u021F:"h",J\u030C:"J",\u01F0:"j",\u01E8:"K",\u01E9:"k",M\u030C:"M",m\u030C:"m",P\u030C:"P",p\u030C:"p",Q\u030C:"Q",q\u030C:"q",\u0158\u0329:"R",\u0159\u0329:"r",\u1E66:"S",\u1E67:"s",V\u030C:"V",v\u030C:"v",W\u030C:"W",w\u030C:"w",X\u030C:"X",x\u030C:"x",Y\u030C:"Y",y\u030C:"y",A\u0327:"A",a\u0327:"a",B\u0327:"B",b\u0327:"b",\u1E10:"D",\u1E11:"d",\u0228:"E",\u0229:"e",\u0190\u0327:"E",\u025B\u0327:"e",\u1E28:"H",\u1E29:"h",I\u0327:"I",i\u0327:"i",\u0197\u0327:"I",\u0268\u0327:"i",M\u0327:"M",m\u0327:"m",O\u0327:"O",o\u0327:"o",Q\u0327:"Q",q\u0327:"q",U\u0327:"U",u\u0327:"u",X\u0327:"X",x\u0327:"x",Z\u0327:"Z",z\u0327:"z",\u0439:"\u0438",\u0419:"\u0418",\u0451:"\u0435",\u0401:"\u0415"},ov=Object.keys(tv).join("|"),L4=new RegExp(ov,"g"),H4=new RegExp(ov,"");function O4(e){return tv[e]}var rv=function(e){return e.replace(L4,O4)},N4=function(e){return!!e.match(H4)};ac.exports=rv;ac.exports.has=N4;ac.exports.remove=rv});var lu=$u((Pie,Bc)=>{"use strict";(function(e){"use strict";typeof define=="function"&&define.amd?define(e):typeof Bc<"u"&&typeof Bc.exports<"u"?Bc.exports=e():typeof Package<"u"?Sortable=e():window.Sortable=e()})(function(){"use strict";var e,o,t,r,i,s,a,l,m,c,p,u,d,g,h,b,x={},y,S,k,P=/\s+/g,C="Sortable"+new Date().getTime(),B=window,$=B.document,A=B.parseInt,R="draggable"in $.createElement("div"),Z=function(M){return M=$.createElement("x"),M.style.cssText="pointer-events:auto",M.style.pointerEvents==="auto"}(),F=!1,V=Math.abs,W=[].slice,J=[],me=Ne(function(M,z,U){if(U&&z.scroll){var q,De,_e=z.scrollSensitivity,Se=z.scrollSpeed,bt=M.clientX,$e=M.clientY,wt=window.innerWidth,Qe=window.innerHeight,ut,lt;if(m!==U&&(l=z.scroll,m=U,l===!0)){l=U;do if(l.offsetWidth<l.scrollWidth||l.offsetHeight<l.scrollHeight)break;while(l=l.parentNode)}l&&(q=l,De=l.getBoundingClientRect(),ut=(V(De.right-bt)<=_e)-(V(De.left-bt)<=_e),lt=(V(De.bottom-$e)<=_e)-(V(De.top-$e)<=_e)),ut||lt||(ut=(wt-bt<=_e)-(bt<=_e),lt=(Qe-$e<=_e)-($e<=_e),(ut||lt)&&(q=B)),(x.vx!==ut||x.vy!==lt||x.el!==q)&&(x.el=q,x.vx=ut,x.vy=lt,clearInterval(x.pid),q&&(x.pid=setInterval(function(){q===B?B.scrollTo(B.pageXOffset+ut*Se,B.pageYOffset+lt*Se):(lt&&(q.scrollTop+=lt*Se),ut&&(q.scrollLeft+=ut*Se))},24)))}},30),se=function(M){var z=M.group;(!z||typeof z!="object")&&(z=M.group={name:z}),["pull","put"].forEach(function(U){U in z||(z[U]=!0)}),M.groups=" "+z.name+(z.put.join?" "+z.put.join(" "):"")+" "};function ee(M,z){if(!(M&&M.nodeType&&M.nodeType===1))throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(M);this.el=M,this.options=z=ft({},z),M[C]=this,M.sortable=this;var U={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,startTheresold:5,scrollSpeed:10,draggable:/[uo]l/i.test(M.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(_e,Se){_e.setData("Text",Se.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,moveByBlock:!1};for(var q in U)!(q in z)&&(z[q]=U[q]);se(z);for(var De in this)De.charAt(0)==="_"&&(this[De]=this[De].bind(this));this.nativeDraggable=z.forceFallback?!1:R,we(M,"mousedown",this._onTapStart),we(M,"touchstart",this._onTapStart),this.nativeDraggable&&(we(M,"dragover",this),we(M,"dragenter",this)),J.push(this._onDragOver),z.store&&this.sort(z.store.get(this))}ee.prototype={constructor:ee,dropIntoGroup:function(M){a=M},_onTapStart:function(M){var z=this,U=this.el,q=this.options,De=M.type,_e=M.touches&&M.touches[0],Se=(_e||M).target,bt=Se,$e=q.filter;if(!(De==="mousedown"&&M.button!==0||q.disabled)&&(Se=ke(Se,q.draggable,U),!!Se)){if(M.stopPropagation(),M.preventDefault(),d=Ae(Se),typeof $e=="function"){if($e.call(this,M,Se,this)){le(z,bt,"filter",Se,U,d),M.preventDefault();return}}else if($e&&($e=$e.split(",").some(function(wt){if(wt=ke(bt,wt.trim(),U),wt)return le(z,wt,"filter",Se,U,d),!0}),$e)){M.preventDefault();return}q.handle&&!ke(bt,q.handle,U)||this._prepareDragStart(M,_e,Se)}},_prepareDragStart:function(M,z,U){var q=this,De=q.el,_e=q.options,Se=De.ownerDocument,bt;if(U&&!e&&U.parentNode===De){y=M,i=De,e=U,o=e.parentNode,s=e.nextSibling,b=_e.group;var bt=function(){q._disableDelayedDrag(),j(e,q.options.chosenClass,!0),q._triggerDragStart(z)},$e=function(ut){var lt=Math.sqrt(Math.pow(y.screenX-ut.screenX,2)+Math.pow(y.screenY-ut.screenY,2));lt>=_e.startTheresold&&(wt(),bt())},wt=function(){L(Se,"mousemove",$e),L(Se,"mouseup",wt),L(Se,"touchend",wt),L(Se,"touchcancel",wt)};_e.ignore.split(",").forEach(function(ut){de(e,ut.trim(),he)}),we(Se,"mouseup",q._onDrop),we(Se,"touchend",q._onDrop),we(Se,"touchcancel",q._onDrop),_e.delay&&(we(Se,"mouseup",q._disableDelayedDrag),we(Se,"touchend",q._disableDelayedDrag),we(Se,"touchcancel",q._disableDelayedDrag),we(Se,"mousemove",q._disableDelayedDrag),we(Se,"touchmove",q._disableDelayedDrag),q._dragStartTimer=setTimeout(bt,_e.delay)),_e.startTheresold?(we(Se,"mousemove",$e),we(Se,"mouseup",wt),we(Se,"touchend",wt),we(Se,"touchcancel",wt),we(Se,"touchmove",wt)):bt()}},_disableDelayedDrag:function(){var M=this.el.ownerDocument;clearTimeout(this._dragStartTimer),L(M,"mouseup",this._disableDelayedDrag),L(M,"touchend",this._disableDelayedDrag),L(M,"touchcancel",this._disableDelayedDrag),L(M,"mousemove",this._disableDelayedDrag),L(M,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(M){M?(y={target:e,clientX:M.clientX,clientY:M.clientY},this._onDragStart(y,"touch")):this.nativeDraggable?(we(e,"dragend",this),we(i,"dragstart",this._onDragStart)):this._onDragStart(y,!0);try{$.selection?$.selection.empty():window.getSelection().removeAllRanges()}catch{}this.dx=0,this.dy=0},_dragStarted:function(){if(i&&e){j(e,this.options.ghostClass,!0),ee.active=this;var M=le(this,i,"start",e,i,d);M.groupdrag&&(h=M.groupdrag)}},_emulateDragOver:function(){if(S){if(this._lastX===S.clientX&&this._lastY===S.clientY)return;this._lastX=S.clientX,this._lastY=S.clientY,Z||N(t,"display","none");var M=$.elementFromPoint(S.clientX,S.clientY),z=M,U=" "+this.options.group.name,q=J.length;if(z)do{if(z[C]&&z[C].options.groups.indexOf(U)>-1){for(;q--;)J[q]({clientX:S.clientX,clientY:S.clientY,target:M,rootEl:z});break}M=z}while(z=z.parentNode);Z||N(t,"display","")}},_onTouchMove:function(M){if(y){this._appendGhost(),ee.active||this._dragStarted();var z=M.touches?M.touches[0]:M,U=this.options,q=U.denyX?0:z.clientX-y.clientX,De=U.denyY?0:z.clientY-y.clientY,_e=this.dx,Se=this.dy,bt=(this.dx||0)-q,$e=(this.dy||0)-De;if(this.options.onMoveGhost){var wt=this.options.onMoveGhost(t,bt,$e,e);q=q+wt.dx,De=De+wt.dy}this.dx=q,this.dy=De;var Qe=M.touches?"translate3d("+q+"px,"+De+"px,0)":"translate("+q+"px,"+De+"px)";k=!0,S=z,N(t,"webkitTransform",Qe),N(t,"mozTransform",Qe),N(t,"msTransform",Qe),N(t,"transform",Qe),e.cooldown=+new Date+400,M.preventDefault();var ut=le(this,i,"touchMove",t,null,null,null,{ghostOffsetX:q,ghostOffsetY:De,ghost:t,x:z.clientX,y:z.clientY,dx:bt,dy:$e,dragEl:e,next:e.nextElementSibling,prev:e.previousElementSibling});if(U.moveByBlock&&ut.result){var lt=ut.result.changeParent||e.parentNode||this.el,Ja=U.group,Qa=b===Ja,Qi=e.getBoundingClientRect();if(ut.result.toEmptyGroup){lt=ut.result.toEmptyGroup,We(i,lt,e,Qi,null,null)!==!1&&(e.contains(lt)||(lt.appendChild(e),o=lt),this._animate(Qi,e),so&&this._animate(Ro,so));return}var so=ut.result.target,Ro=so.getBoundingClientRect(),Nn=function(el){for(;el;){if(el.animated)return!0;el=el.parentNode}return!1};if(Nn(so))return;var Nr=We(i,lt,e,Qi,so,Ro),en=Nr===void 0?ut.result.direction:Nr,Fn=so.nextElementSibling,Mu=so.offsetWidth>e.offsetWidth,Bu=so.offsetHeight>e.offsetHeight,u2=Ro.right-Ro.left,g2=Ro.bottom-Ro.top,Iu=N(so),zu=N(so.parentNode),Eu=/left|right|inline/.test(Iu.cssFloat+Iu.display)||zu.display=="flex"&&zu["flex-direction"].indexOf("row")===0,Ru=(Eu?(M.clientX-Ro.left)/u2:(M.clientY-Ro.top)/g2)>.5,Wn;if(en!==!1){if(F=!0,setTimeout(fe,30),ue(Qa),en===1||en===-1)Wn=en===1;else if(Eu){var Au=e.offsetTop,Du=so.offsetTop;Au===Du?Wn=so.previousElementSibling===e&&!Mu||Ru&&Mu:Wn=Du>Au}else Wn=Fn!==e&&!Bu||Ru&&Bu;e.contains(lt)||(Wn&&!Fn?lt.appendChild(e):so.parentNode.insertBefore(e,Wn?Fn:so)),o=e.parentNode,this._animate(Qi,e),this._animate(Ro,so)}}}},_appendGhost:function(){if(!t){var M=e.getBoundingClientRect(),z=N(e),U=this.options,q=i,De;if(t=e.cloneNode(!0),j(t,U.ghostClass,!1),j(t,U.fallbackClass,!0),U.relParent){for(q=e;q&&q.className.indexOf(U.relParent)==-1;)q=q.parentNode;q=q||i}var _e=q.getBoundingClientRect();if(U.noFixedGhost){var Se=N(q);N(t,"top",M.top-A(z.marginTop,10)-_e.top-A(Se.marginTop,10)),N(t,"left",M.left-A(z.marginLeft,10)-_e.left-A(Se.marginLeft,10)),N(t,"position","absolute")}else N(t,"top",M.top-A(z.marginTop,10)),N(t,"left",_e.left),N(t,"position","fixed");N(t,"width",M.width),N(t,"height",M.height),N(t,"opacity","0.8"),N(t,"zIndex","100000"),N(t,"pointerEvents","none"),U.fallbackOnBody&&$.body.appendChild(t)||q.appendChild(t),De=t.getBoundingClientRect(),N(t,"width",M.width*2-De.width),N(t,"height",M.height*2-De.height)}},_onDragStart:function(M,z){var U=M.dataTransfer,q=this.options;this._offUpEvents(),b.pull=="clone"&&(r=e.cloneNode(!0),N(r,"display","none"),i.insertBefore(r,e)),z?(z==="touch"?(we($,"touchmove",this._onTouchMove),we($,"touchend",this._onDrop),we($,"touchcancel",this._onDrop)):(we($,"mousemove",this._onTouchMove),we($,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(U&&(U.effectAllowed="move",q.setData&&q.setData.call(this,U,e)),we($,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(M){var z=this.el,U,q,De,_e=this.options,Se=_e.group,bt=Se.put,$e=b===Se,wt=_e.sort;if(!_e.moveByBlock&&(M.preventDefault!==void 0&&(M.preventDefault(),!_e.dragoverBubble&&M.stopPropagation()),k=!0,b&&!_e.disabled&&($e?wt||(De=!i.contains(e)):b.pull&&bt&&(b.name===Se.name||bt.indexOf&&~bt.indexOf(b.name)))&&(M.rootEl===void 0||M.rootEl===this.el))){if(me(M,_e,this.el),F)return;if(U=ke(M.target,_e.draggable,z),q=e.getBoundingClientRect(),De){ue(!0),r||s?i.insertBefore(e,r||s):wt||i.appendChild(e);return}if(z.children.length===0||z.children[0]===t||z===M.target&&(U=pe(z,M))){if(U){if(U.animated)return;Qe=U.getBoundingClientRect()}ue($e),We(i,z,e,q,U,Qe)!==!1&&(e.contains(z)||(z.appendChild(e),o=z),this._animate(q,e),U&&this._animate(Qe,U))}else if(U&&!U.animated&&U!==e&&U.parentNode[C]!==void 0){c!==U&&(c=U,p=N(U),u=N(U.parentNode));var Qe=U.getBoundingClientRect(),ut=Qe.right-Qe.left,lt=Qe.bottom-Qe.top,Ja=/left|right|inline/.test(p.cssFloat+p.display)||u.display=="flex"&&u["flex-direction"].indexOf("row")===0,Qa=U.offsetWidth>e.offsetWidth,Qi=U.offsetHeight>e.offsetHeight,so=(Ja?(M.clientX-Qe.left)/ut:(M.clientY-Qe.top)/lt)>.5,Ro=U.nextElementSibling,Nn=We(i,z,e,q,U,Qe),Nr;if(Nn!==!1){if(F=!0,setTimeout(fe,30),ue($e),Nn===1||Nn===-1)Nr=Nn===1;else if(Ja){var en=e.offsetTop,Fn=U.offsetTop;en===Fn?Nr=U.previousElementSibling===e&&!Qa||so&&Qa:Nr=Fn>en}else Nr=Ro!==e&&!Qi||so&&Qi;e.contains(z)||(Nr&&!Ro?z.appendChild(e):U.parentNode.insertBefore(e,Nr?Ro:U)),o=e.parentNode,this._animate(q,e),this._animate(Qe,U)}}}},_animate:function(M,z){var U=this.options.animation;if(U){var q=z.getBoundingClientRect();N(z,"transition","none"),N(z,"transform","translate3d("+(M.left-q.left)+"px,"+(M.top-q.top)+"px,0)"),z.offsetWidth,N(z,"transition","all "+U+"ms"),N(z,"transform","translate3d(0,0,0)"),clearTimeout(z.animated),z.animated=setTimeout(function(){N(z,"transition",""),N(z,"transform",""),z.animated=!1},U)}},_offUpEvents:function(){var M=this.el.ownerDocument;L($,"touchmove",this._onTouchMove),L(M,"mouseup",this._onDrop),L(M,"touchend",this._onDrop),L(M,"touchcancel",this._onDrop)},forceDrop:function(M,z){var U=this.el,q=this.options;clearInterval(this._loopId),clearInterval(x.pid),clearTimeout(this._dragStartTimer),o=M,g=z,L($,"mousemove",this._onTouchMove),this.nativeDraggable&&(L($,"drop",this),L(U,"dragstart",this._onDragStart)),this._offUpEvents(),t&&t.parentNode&&t.parentNode.removeChild(t),e&&(this.nativeDraggable&&L(e,"dragend",this),he(e),j(e,this.options.ghostClass,!1),j(e,this.options.chosenClass,!1),i===o?r&&r.parentNode.removeChild(r):g>=0&&(le(null,o,"sort",e,i,d,g),le(this,i,"sort",e,i,d,g),le(null,o,"add",e,i,d,g),le(this,i,"remove",e,i,d,g))),i=e=o=t=s=r=l=m=y=S=k=g=a=c=p=b=ee.active=null},_onDrop:function(M){var z=this.el,U=this.options;if(clearInterval(this._loopId),clearInterval(x.pid),clearTimeout(this._dragStartTimer),L($,"mousemove",this._onTouchMove),this.nativeDraggable&&(L($,"drop",this),L(z,"dragstart",this._onDragStart)),this._offUpEvents(),M){if(k&&(M.preventDefault(),!U.dropBubble&&M.stopPropagation()),t&&t.parentNode&&t.parentNode.removeChild(t),e){if(this.nativeDraggable&&L(e,"dragend",this),he(e),j(e,this.options.ghostClass,!1),j(e,this.options.chosenClass,!1),!h)o=a||o,i!==o?(_e=Ae(e),_e>=0&&(le(null,o,"sort",e,i,d,_e,{draggedGroup:h}),le(this,i,"sort",e,i,d,_e,{draggedGroup:h}),le(null,o,"add",e,i,d,_e,{draggedGroup:h}),le(this,i,"remove",e,i,d,_e,{draggedGroup:h}))):(r&&r.parentNode.removeChild(r),e.nextSibling!==s&&(_e=Ae(e),_e>=0&&(le(this,i,"update",e,i,d,_e,{draggedGroup:h}),le(this,i,"sort",e,i,d,_e,{draggedGroup:h}))));else{var q=a||o||i,De=e.nextElementSibling,_e=Ae(e),Se,bt=!0;_.each(h,function($e,wt){var Qe=$e.el,ut=$e.oldParent,lt=null;e!==Qe?(lt={parent:Qe.parentNode,before:Qe.nextElementSibling},De?De.parentNode.insertBefore(Qe,bt?e:De):q.appendChild(Qe)):bt=!1,q==ut?(le(this,q,"update",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt}),le(this,q,"sort",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt})):(le(null,q,"sort",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt}),le(this,ut,"sort",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt}),le(null,q,"add",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt}),le(this,ut,"remove",Qe,q,$e.oldIndex,_e,{context:$e.context,prevContext:Se,camebackTo:lt})),Se=$e.context})}ee.active&&((_e===null||_e===-1)&&(_e=d),le(this,i,"end",e,i,d,_e),this.save())}i=e=o=t=s=r=l=m=h=a=y=S=k=_e=c=p=b=ee.active=null}},handleEvent:function(M){var z=M.type;z==="dragover"||z==="dragenter"?e&&(this._onDragOver(M),ge(M)):(z==="drop"||z==="dragend")&&this._onDrop(M)},toArray:function(){for(var M=[],z,U=this.el.children,q=0,De=U.length,_e=this.options;q<De;q++)z=U[q],ke(z,_e.draggable,this.el)&&M.push(z.getAttribute(_e.dataIdAttr)||ze(z));return M},sort:function(M){var z={},U=this.el;this.toArray().forEach(function(q,De){var _e=U.children[De];ke(_e,this.options.draggable,U)&&(z[q]=_e)},this),M.forEach(function(q){z[q]&&(U.removeChild(z[q]),U.appendChild(z[q]))})},save:function(){var M=this.options.store;M&&M.set(this)},closest:function(M,z){return ke(M,z||this.options.draggable,this.el)},option:function(M,z){var U=this.options;if(z===void 0)return U[M];U[M]=z,M==="group"&&se(U)},destroy:function(){var M=this.el;M[C]=null,L(M,"mousedown",this._onTapStart),L(M,"touchstart",this._onTapStart),this.nativeDraggable&&(L(M,"dragover",this),L(M,"dragenter",this)),Array.prototype.forEach.call(M.querySelectorAll("[draggable]"),function(z){z.removeAttribute("draggable")}),J.splice(J.indexOf(this._onDragOver),1),this._onDrop(),this.el=M=null}};function ue(M){r&&r.state!==M&&(N(r,"display",M?"none":""),!M&&r.state&&i.insertBefore(r,e),r.state=M)}function ke(M,z,U){if(M){U=U||$,z=z.split(".");var q=z.shift().toUpperCase(),De=new RegExp("\\s("+z.join("|")+")(?=\\s)","g");do if(q===">*"&&M.parentNode===U||(q===""||M.nodeName.toUpperCase()==q)&&(!z.length||((" "+M.className+" ").match(De)||[]).length==z.length))return M;while(M!==U&&(M=M.parentNode))}return null}function ge(M){M.dataTransfer&&(M.dataTransfer.dropEffect="move"),M.preventDefault()}function we(M,z,U){M.addEventListener(z,U,!1)}function L(M,z,U){M.removeEventListener(z,U,!1)}function j(M,z,U){if(M)if(M.classList)M.classList[U?"add":"remove"](z);else{var q=(" "+M.className+" ").replace(P," ").replace(" "+z+" "," ");M.className=(q+(U?" "+z:"")).replace(P," ")}}function N(M,z,U){var q=M&&M.style;if(q){if(U===void 0)return $.defaultView&&$.defaultView.getComputedStyle?U=$.defaultView.getComputedStyle(M,""):M.currentStyle&&(U=M.currentStyle),z===void 0?U:U[z];z in q||(z="-webkit-"+z),q[z]=U+(typeof U=="string"?"":"px")}}function de(M,z,U){if(M){var q=M.getElementsByTagName(z),De=0,_e=q.length;if(U)for(;De<_e;De++)U(q[De],De);return q}return[]}function le(M,z,U,q,De,_e,Se,bt){var $e=$.createEvent("Event"),wt=(M||z[C]).options,Qe="on"+U.charAt(0).toUpperCase()+U.substr(1);return $e.initEvent(U,!0,!0),$e.to=z,$e.from=De||z,$e.item=q||z,$e.clone=r,$e.oldIndex=_e,$e.newIndex=Se,$e.data=bt,$e.setDraggedGroup=function(ut){h=ut},$e.getGhost=function(){return t},z.dispatchEvent($e),wt[Qe]&&wt[Qe].call(M,$e),$e}function We(M,z,U,q,De,_e){var Se,bt=M[C],$e=bt.options.onMove,wt;return Se=$.createEvent("Event"),Se.initEvent("move",!0,!0),Se.to=z,Se.from=M,Se.dragged=U,Se.draggedRect=q,Se.ghost=t,Se.related=De||z,Se.relatedRect=_e||z.getBoundingClientRect(),M.dispatchEvent(Se),$e&&(wt=$e.call(bt,Se)),wt}function he(M){M.draggable=!1}function fe(){F=!1}function pe(M,z){var U=M.lastElementChild,q=U.getBoundingClientRect();return(z.clientY-(q.top+q.height)>5||z.clientX-(q.right+q.width)>5)&&U}function ze(M){for(var z=M.tagName+M.className+M.src+M.href+M.textContent,U=z.length,q=0;U--;)q+=z.charCodeAt(U);return q.toString(36)}function Ae(M){var z=0;if(!M||!M.parentNode)return-1;for(;M&&(M=M.previousElementSibling);)M.nodeName.toUpperCase()!=="TEMPLATE"&&z++;return z}function Ne(M,z){var U,q;return function(){U===void 0&&(U=arguments,q=this,setTimeout(function(){U.length===1?M.call(q,U[0]):M.apply(q,U),U=void 0},z))}}function ft(M,z){if(M&&z)for(var U in z)z.hasOwnProperty(U)&&(M[U]=z[U]);return M}return ee.utils={on:we,off:L,css:N,find:de,is:function(M,z){return!!ke(M,z,M)},extend:ft,throttle:Ne,closest:ke,toggleClass:j,index:Ae},ee.create=function(M,z){return new ee(M,z)},ee.version="1.4.2",ee})});var Tu=T(St()),d2=T(mo());tn();var Q=T(St()),Or=T(mo()),Ce=T(et());Gn();sl();Vo();pt();tg();ot();Jc();var Oo=T(St()),Ob=T(mo()),xe=T(et());Sl();yo();sl();Cd();fl();pp();D_();Kc();ot();wd();s_();var Nb=T(R_());ot();yo();ot();var X=T(et());Jc();var Td=["aboveAll","frontFixed","normal","backFixed"],Hb=(e,o)=>{let t=!0;return X.default.each(Pe.viewports,r=>{!!e[r.name]!=!!o[r.name]&&(t=!1)}),t&&(X.default.each(e,(r,i)=>{if(!o[i])t=!1;else{let s=o[i];X.default.each(r,(a,l)=>{let m=s[l];m.length!==a.length&&(t=!1);let c=X.default.flatten(a),p=X.default.flatten(m);X.default.each(c,(u,d)=>{p[d]!==u&&(t=!1)})})}}),t)},Md=class e{constructor(o,t){this.mag=t,this._order={},this._calculated={},ye.on("mag:loadfull:complete",()=>{this.mag.pages.each(r=>this._bindPageEvents(r)),this._updateCalculatedIndex(),this.mag.pages.on("add",r=>{this._fillInitialOrder(r),this._bindPageEvents(r),this._updateCalculatedIndex()}),this._snapshot=this._doSnapshop()})}_getModelFromMag(o){let t;return this.mag.pages.each(r=>{t||(t=r.widgets.get(o))}),t}static conditionalSet(o,t){o&&(Hb(o.get("order"),t)||o.set({order:JSON.parse(JSON.stringify(t))},{silent:!0,skipHistory:!0}))}static conditionalSave(o,t,r={}){o&&(!Hb(o.get("order"),t)||o.changed.order&&!o._saveInProgress?o.save({order:JSON.parse(JSON.stringify(t))},{silent:!0,parse:!1,skipHistory:!0,...r,patch:!0}):r.success&&r.success())}static getPartialOrder(o,t){let r={};return X.default.each(o,(i,s)=>{r[s]={},X.default.each(i,(a,l)=>{r[s][l]=X.default.reduce(a,(m,c)=>{if(c instanceof Array){let p=X.default.filter(c,u=>t.includes(u));return p.length&&m.push(p),m}return t.includes(c)&&m.push(c),m},[])})}),r}static extendOrder(o,t){X.default.each(o,(r,i)=>{X.default.each(r,(s,a)=>{s.unshift((t[i]||t.default)[a])})})}static getWidgetOrder(o=[],t={aboveAll:[],frontFixed:[],normal:[],backFixed:[]}){let r=o.map(u=>u.id),i=u=>{if(Array.isArray(u))return u.length>0?u.every(d=>r.includes(d)):!1;{let d=u;return r.includes(d)}},{aboveAll:s=[],frontFixed:a=[],normal:l=[],backFixed:m=[]}=t,c=X.default.flatten([...s,...a,...l,...m]);if(X.default.difference(r,c).length===0)return{aboveAll:s.filter(i),frontFixed:a.filter(i),normal:l.filter(i),backFixed:m.filter(i)};{let u=X.default.sortBy(o,b=>b.get("z")*-1),d=u.reduce((b,x)=>{let y=x.get("pack_id"),S=x.id;return y&&Array.isArray(b[y])?b[y].push(S):y&&(b[y]=[S]),b},{}),g=u.reduce((b,x)=>{let y=x.get("pack_id")||x.id;return x.get("is_above")?b.aboveAll.push(y):x.get("fixed_position")&&b.normal.length===0?b.frontFixed.push(y):x.get("fixed_position")?b.backFixed.push(y):b.normal.push(y),b},{aboveAll:[],frontFixed:[],normal:[],backFixed:[]}),h=b=>b in d?d[b]:b;return{aboveAll:X.default.unique(g.aboveAll).map(h),frontFixed:X.default.unique(g.frontFixed).map(h),normal:X.default.unique(g.normal).map(h),backFixed:X.default.unique(g.backFixed).map(h)}}}getFullOrder(){return this._order}_fillNewViewport(o,t){let r=o.get("_id"),i={};this._order[r][t]=i;let s={},a=this.mag.pages.find(m=>m!==o&&m.getViewportParam(t,"enabled")&&this._order[m.get("_id")]&&this._order[m.get("_id")][t]);X.default.each(this._order[r].default,(m,c)=>{if(c==="aboveAll"&&a){i[c]=X.default.clone(this._order[a.get("_id")][t].aboveAll);return}i[c]=[];let p=i[c];X.default.each(X.default.flatten(m),u=>{let d=this._getModelFromMag(u);if(!d)return;let g=this.getValueForViewport(d,t,"pack_id",!0),h=!!this.getValueForViewport(d,t,"fixed_position",!0);g?(s[g]||(s[g]=[],h&&c==="normal"?(i.frontFixed=i.frontFixed||[],i.frontFixed.push(s[g])):!h&&(c==="frontFixed"||c==="backFixed")?(i.normal=i.normal||[],i.normal.push(s[g])):p.push(s[g])),s[g].push(u)):h&&c==="normal"?(i.frontFixed=i.frontFixed||[],i.frontFixed.push(u)):!h&&(c==="frontFixed"||c==="backFixed")?(i.normal=i.normal||[],i.normal.push(u)):p.push(u)})});let l=m=>{X.default.each(m,c=>{X.default.each(c,p=>{p.widgetsOrder[r]&&(p.widgetsOrder[r][t]=JSON.parse(JSON.stringify(i)))})})};l(Lt.undoStacks),l(Lt.redoStacks)}_fillInitialOrder(o){let t=o.get("order"),r=X.default.flatten([].concat(t.default.aboveAll,t.default.frontFixed,t.default.normal,t.default.backFixed)),i={};this.mag.pages.each(c=>c.widgets.each(p=>{p.get("is_global")&&p.get("originId")&&(i[p.get("originId")]=p.get("_id"))})),X.default.each(t,c=>{X.default.each(c,p=>{X.default.each(p,(u,d)=>{u instanceof Array?p[d]=u.map(g=>i[g]||g):p[d]=i[u]||u})})});let s=X.default.filter(X.default.map(this.getGlobalWids(),c=>c.id),c=>!r.includes(c)),a=this.mag.pages.find(c=>c.get("num")===1),l=this.getOrder(a,"default");X.default.each(Td,c=>{l[c]=X.default.filter(l[c],p=>p instanceof Array?!!X.default.compact(X.default.map(p,u=>s.includes(u)?!0:null)).length:s.includes(p))}),X.default.each(t,c=>{X.default.each(c,(p,u)=>{p.splice.apply(p,[0,0].concat(l[u]))})}),e.conditionalSet(o,t),e.conditionalSave(o,t);let m=c=>{X.default.each(c,p=>{X.default.each(p,u=>{u.widgetsOrder[o.get("_id")]=JSON.parse(JSON.stringify(o.get("order")))})})};m(Lt.undoStacks),m(Lt.redoStacks)}_bindPageEvents(o){this._order[o.get("_id")]=JSON.parse(JSON.stringify(o.get("order"))),o.on("widget:remove",(r,i)=>{i.changeParentPage||(this.mag.pages.each(s=>{Pe.viewports.forEach(a=>{let l=a.name;this._order[s.get("_id")][l]&&this.removeWidsFromOrder(this._order[s.get("_id")][l],[r.id])})}),this.saveAffectedPages(),this._updateCalculatedIndex())}),o.on("widgets:remove",(r,i)=>{i.changeParentPage||(this.mag.pages.each(s=>{Pe.viewports.forEach(a=>{let l=a.name;this._order[s.get("_id")][l]&&this.removeWidsFromOrder(this._order[s.get("_id")][l],r)}),setTimeout(()=>{e.conditionalSave(s,this._order[s.get("_id")])},0)}),this._updateCalculatedIndex())});let t=r=>i=>{let s=i.previousAttributes();(!s["viewport_"+r]||!s["viewport_"+r].enabled)&&i.get("viewport_"+r).enabled&&(this._order[i.get("_id")][r]||this._fillNewViewport(i,r),this._updateCalculatedIndex())};o.on("change:viewport_phone_portrait",t("phone_portrait")),o.on("change:viewport_tablet_portrait",t("tablet_portrait"))}getGlobalWids(){return this.mag.globalWidgets.models}getWidsOrder(o,t={}){let r=o.get("order"),i=[];return X.default.each(Pe.viewports,s=>{let a=t.viewport&&t.viewport!==s.name?void 0:s.name;if(a&&r[a])for(let l of Object.keys(r[a])){let m=t.type&&t.type!==l?void 0:l;m&&r[a][m]&&(i=i.concat(X.default.flatten(r[a][m])))}}),i}restoreViewportToDefault(o,t){let r=o.get("_id");!this._order[r][t]||t==="default"||(this._fillNewViewport(o,t),e.conditionalSet(o,this._order[r]),this._updateCalculatedIndex())}_updateCalculatedIndex(o){for(let t in this._order)if(this._order.hasOwnProperty(t)){this._calculated[t]={};let r=this._calculated[t];Pe.viewports.forEach(i=>{let s=i.name;if(r[s]={},!this._order[t][s])return;let a=X.default.flatten(X.default.map(Td,m=>X.default.flatten(this._order[t][s][m]))),l=100+a.length;X.default.each(a,m=>{r[s][m]=l--})})}ye.trigger("index:changed",this._order,o)}updateFromSocket(o){Object.assign(this._order,o),this._updateCalculatedIndex(!0)}getZIndex(o,t,r){return!this._calculated[t]||!this._calculated[t][r]||!this._calculated[t][r][o]?100:this._calculated[t][r][o]}getOrder(o,t){return o?t?(this._order[o.get("_id")][t]||(this._order[o.get("_id")][t]=JSON.parse(JSON.stringify(this._order[o.get("_id")].default))),JSON.parse(JSON.stringify(this._order[o.get("_id")][t]))):this._order[o.get("_id")]:this._order}_doSnapshop(){return JSON.parse(JSON.stringify(this._order))}snapshot(){let o=this._snapshot;return this._snapshot=this._doSnapshop(),o}applySnapshot(o){let t=[];this.mag.pages.each(r=>{let i=r.get("wids");r.widgets.each(s=>{s.get("is_global")&&i.includes(s.get("_id"))&&t.push(s.get("_id"))})}),X.default.each(o,(r,i)=>{let s=this.mag.pages.get(i);s&&X.default.each(r,a=>{X.default.each(a,(l,m)=>{a[m]=X.default.compact(X.default.map(l,c=>c instanceof Array?X.default.compact(X.default.map(c,p=>!t.includes(p)&&!s.widgets.get(p)?null:p)):!t.includes(c)&&!s.widgets.get(c)?null:c))})})}),this._order=o,this.mag.pages.each(r=>{let i=this._order[r.get("_id")];i&&e.conditionalSet(r,i)}),setTimeout(()=>{let r=[];this.mag.pages.each(i=>{let s=i.get("wids");i.widgets.each(a=>{a.get("is_global")&&s.includes(a.get("_id"))&&r.push(a.get("_id"))})}),X.default.each(this._order,(i,s)=>{let a=this.mag.pages.get(s);a&&(X.default.each(i,(l,m)=>{X.default.each(l,(c,p)=>{l[p]=X.default.compact(X.default.map(c,g=>g instanceof Array?X.default.compact(X.default.map(g,h=>!r.includes(h)&&!a.widgets.get(h)?null:h)):!r.includes(g)&&!a.widgets.get(g)?null:g));let u=[],d=X.default.compact(X.default.map(r,g=>{let h=!1;return X.default.each(l,b=>{h||X.default.flatten(b).includes(g)&&(h=!0)}),h||X.default.each(this._order,(b,x)=>{if(x===s)return;let y=b[m]||b.default,S=!1;X.default.each(y,(k,P)=>{S||X.default.flatten(k).includes(g)&&(S=P)}),S&&X.default.each(y[S],(k,P)=>{if(k===g&&(h={idx:P,group:S,global:g}),k instanceof Array){if(u.includes(g))return;k.includes(g)&&(u=u.concat(k),h={idx:P,global:g,group:S,pack:k})}})}),h===!0?null:h}));X.default.each(X.default.sortBy(d,(g,h)=>g.idx<h.idx?1:-1),g=>{l[g.group].splice(g.idx,0,g.pack?g.pack:g.global)})})}),e.conditionalSave(a,i))}),this._updateCalculatedIndex()},0)}setOrderForPage(o,t,r,i){let s=this.getGlobalWids();this._order[t.id][r]=o,e.conditionalSet(t,this._order[t.id]);let a=(c,p)=>{let u=null;return X.default.each(c,d=>{X.default.each(d,g=>{if(g instanceof Array){let h=X.default.filter(s,b=>g.includes(b.id));!X.default.isEmpty(h)&&h[0].get("pack_id")===p&&(u=g)}})}),u},l=(c,p)=>{let u=!1;X.default.each(c,d=>{X.default.each(d,(g,h)=>{if(g instanceof Array&&!u){let b=g.indexOf(p);b!==-1&&(u=!0,g.length<=2?d.splice(h,1,g[0],g[1]):(g.splice(b,1),d.splice(h,0,p)))}})})},m=(c,p,u,d,g)=>{let h=d?a(c,u):null;d&&this.removeWidsFromOrder(c,d),g&&X.default.each(g,b=>{l(c,b)}),h&&Array.prototype.splice.apply(h,[0,h.length].concat(JSON.parse(JSON.stringify(p))))};if(i){X.default.each(this._order,(p,u)=>{X.default.each(p,(d,g)=>{u!==t.id&&r===g&&(m(d,i.pack,i.pack_id,i.added,i.removed,r),e.conditionalSet(this.mag.pages.get(u),this._order[u]))})});let c=p=>{X.default.each(p,u=>{X.default.each(u,d=>{X.default.each(d.widgetsOrder,(g,h)=>{h!==t.get("_id")&&Pe.viewports.forEach(b=>{let x=b.name;d.widgetsOrder[h][x]&&m(d.widgetsOrder[h][x],i.pack,i.pack_id,i.added,i.removed,x)})})})})};c(Lt.undoStacks),c(Lt.redoStacks)}this._syncAbovePages(t.id,r),this._updateCalculatedIndex()}getCurrentGroup(o,t){let r="";return X.default.each(o,(i,s)=>{if(i.indexOf(t)!==-1){r=s;return}let l=i.filter(m=>m instanceof Array);X.default.each(l,m=>{m.indexOf(t)!==-1&&(r=s)})}),r}removeWidsFromOrder(o,t){X.default.each(t,function(r){X.default.each(o,function(i){let s=i.indexOf(r);s!==-1&&i.splice(s,1);let a=null,l=i.filter(m=>m instanceof Array);if(X.default.each(l,m=>{let c=m.indexOf(r);c!==-1&&(m.splice(c,1),m.length===0&&(a=m))}),a){let m=i.indexOf(a);m!==-1&&i.splice(m,1)}})}.bind(this))}_moveWidsTo(o,t,r,i){let s=X.default.compact(t.map(function(a){if(X.default.flatten(r).includes(a))return null;let l=null;return X.default.each(o,m=>{m!==r&&(l||(l=X.default.find(m,c=>c instanceof Array&&c.includes(a))))}),l?JSON.parse(JSON.stringify(l)):a}));this.removeWidsFromOrder(o,X.default.flatten(s)),X.default.each(s,function(a){r.unshift(i||a)})}moveWidsToFix(o,t,r,i){this._moveWidsTo(o,t.filter(function(s){return!o.frontFixed.includes(s)&&!o.backFixed.includes(s)}.bind(this)),i?o.backFixed:o.frontFixed,r)}moveWidsToFrontFixed(o,t,r){this._moveWidsTo(o,t,o.frontFixed,r)}moveWidsToBackFixed(o,t,r){this._moveWidsTo(o,t,o.backFixed,r)}moveWidsToNormal(o,t,r){this._moveWidsTo(o,t,o.normal,r)}moveWidsToAbove(o,t,r){this._moveWidsTo(o,t,o.aboveAll,r)}_syncAbovePages(o,t){let r=this._order[o][t].aboveAll;X.default.each(this._order,(i,s)=>{s!==o&&i[t]&&i[t].aboveAll&&(i[t].aboveAll.splice.apply(i[t].aboveAll,[0,i[t].aboveAll.length,...r]),e.conditionalSet(this.mag.pages.get(s),i))})}moveWidget(o,t,r,i=o.getCurrentViewport()){let s=this._order[o.get("_id")][i];s===void 0&&(this._fillNewViewport(o,i),s=this._order[o.get("_id")][i]),X.default.each(Td,a=>{let l=s[a],m=l.map(c=>{if(c instanceof Array){let p=c.map(u=>t.find(d=>d.get("_id")===u)&&u);return p.length===0||p.filter(u=>!!u).length===0?null:p.filter(u=>!!u).length===c.length?c:p}else return t.find(p=>p.get("_id")===c)&&c}).reduce((c,p,u,d)=>{if(p instanceof Array){let g=p.reduce((h,b,x,y)=>(b&&!y[x-1]&&h.push([b]),b&&y[x-1]&&h[h.length-1].push(b),h),[]);if(g.length===0)return c;if(g.length!==1||g[0].length!==p.length)return[...c,...g]}return p&&!d[u-1]?c.push([p]):p&&d[u-1]instanceof Array&&d[u-1].filter(g=>!g).length>0?c.push([p]):p&&d[u-1]&&c[c.length-1].push(p),c},[]);X.default.each(m,c=>{let p=c[0],u=l.indexOf(p);if(u===-1){X.default.each(l,g=>{if(g instanceof Array&&g.includes(p)){let h=g.indexOf(p),b=h-r;g.splice(h,c.length),g.splice.apply(g,[b<0?0:b,0].concat(c))}});return}let d=u-r;if(a==="frontFixed"&&d>=l.length){l.splice(u,c.length),s.backFixed.splice.apply(s.backFixed,[0,0].concat(c));return}if(a==="backFixed"&&d<0){l.splice(u,c.length),s.frontFixed.splice.apply(s.frontFixed,[s.frontFixed.length,0].concat(c));return}l.splice(u,c.length),l.splice.apply(l,[d<0?0:d,0].concat(c))})}),this._syncAbovePages(o.get("_id"),i),e.conditionalSet(o,this._order[o.get("_id")]),this._updateCalculatedIndex()}getPagesToSave(){return this.mag.pages.map(o=>o)}saveAffectedPages(){if(this.saveInProgress)return this.saveRequired||(this.saveRequired=new Promise(o=>{this.saveResolve=o})),this.saveRequired;{let o;return this.saveRequired&&(o=this.saveResolve),this.saveRequired=null,this.saveInProgress=!0,new Promise(t=>{X.default.defer(()=>{let r=this._saveAffectedPages().then(()=>{if(this.saveInProgress=!1,this.saveRequired)return this.saveAffectedPages()});o&&o(r),t(r)})})}}_saveAffectedPages(){return Promise.all(X.default.map(this.getPagesToSave(),o=>new Promise(t=>{e.conditionalSave(o,this._order[o.get("_id")],{success:t,error:t})})))}packOrder(o,t,r){let i={},s=o.reduce((l,m)=>(m instanceof Array?l=[...l,...m.map(c=>t.find(p=>p.id===c))]:l.push(t.find(c=>c.id===m)),l),[]).filter(l=>!!l);if(!s.length)return;let a=o.filter(l=>l instanceof Array);X.default.each(s,l=>{let m=l.get("_id"),c=a.find(u=>u.includes(m));if(!o.includes(m)&&!c)return;let p=this.getValueForViewport(l,r,"pack_id");p&&(i[p]=i[p]||[],i[p].includes(m)||i[p].push(m),o.includes(i[p])||(c?o.splice(o.indexOf(c),0,i[p]):o[o.indexOf(m)]=i[p]),c?(c.splice(c.indexOf(m),1),c.length===0&&o.splice(o.indexOf(c),1)):o.includes(m)&&o.splice(o.indexOf(m),1))})}doPack(o,t,r,i){this.mag.pages.map(a=>{let l=this._order[a.get("_id")];X.default.each(l,(m,c)=>{this.getValueForViewport(o[0],c,"pack_id")===i&&X.default.each(m,p=>{this.packOrder(p,o,c)})}),e.conditionalSet(a,this._order[a.get("_id")])});let s=a=>{X.default.each(a,l=>{X.default.each(l,m=>{X.default.each(m.widgetsOrder,(c,p)=>{p!==t.get("_id")&&Pe.viewports.forEach(u=>{let d=u.name;m.widgetsOrder[p][d]&&this.getValueForViewport(o[0],d,"pack_id")===i&&X.default.each(m.widgetsOrder[p][d],g=>{this.packOrder(g,o,d)})})})})})};s(Lt.undoStacks),s(Lt.redoStacks),this._syncAbovePages(t.get("_id"),r),this._updateCalculatedIndex()}doUnpack(o,t,r){this.mag.pages.map(s=>{let l=this._order[s.get("_id")][r];X.default.each(l,m=>{let c=o[0].get("_id"),p=m.find(u=>u instanceof Array&&u.includes(c));if(p){let u=m.indexOf(p);m.splice.apply(m,[u,1].concat(p))}}),e.conditionalSet(s,this._order[s.get("_id")])});let i=s=>{X.default.each(s,a=>{X.default.each(a,l=>{X.default.each(l.widgetsOrder,(m,c)=>{c!==t.get("_id")&&Pe.viewports.forEach(p=>{let u=p.name;l.widgetsOrder[c][u]&&X.default.each(l.widgetsOrder[c][u],d=>{let g=o[0].get("_id"),h=d.find(b=>b instanceof Array&&b.includes(g));if(h){let b=d.indexOf(h);d.splice.apply(d,[b,1].concat(h))}})})})})})};this._syncAbovePages(t.get("_id"),r),i(Lt.undoStacks),i(Lt.redoStacks),this._updateCalculatedIndex()}getValueForViewport(o,t,r,i){if(i&&!X.default.isEmpty(o["viewport_"+t]))return o["viewport_"+t][r];let s=o.toJSON(),a=s[r];return Pe.widgetViewportFields(o.get("type")).includes(r)?t==="default"?a:s["viewport_"+t]?s["viewport_"+t][r]:a:a}updateOrder(o,t,r,i,s,a){let l={},m={},c=(d,g)=>{let h=!1;return X.default.each(this._order,b=>{b[g]&&X.default.flatten(b[g].backFixed).includes(d)&&(h=!0)}),h},p={},u={};X.default.each(t,d=>{let g=this.getValueForViewport(d,r,"pack_id");g&&(p[g]=p[g]||[],p[g].unshift(d.get("_id")))}),t.forEach(d=>{let h=this.getGlobalWids().concat(s?s.widgets.map($=>$):[]),b=d.get("is_global"),x=d.get("is_above"),y=d.get("_id"),S=this.getCurrentGroup(o,y),k=!!this.getValueForViewport(d,r,"fixed_position"),P=this.getValueForViewport(d,r,"pack_id"),C=null,B="";if(P&&(X.default.each(o,($,A)=>{X.default.each($,R=>{if(R instanceof Array){let Z=X.default.find(h,F=>F.id===R[0]);Z&&this.getValueForViewport(Z,r,"pack_id")===P&&(C=R,B=A)}})}),m[P]||X.default.each(i,$=>{let A=X.default.find($,R=>R instanceof Array&&R.includes(y));A&&(m[P]=JSON.parse(JSON.stringify(A)))})),x)B!=="aboveAll"&&(C=null),s!==a&&P?!C&&!l[P]&&m[P]?(this.moveWidsToAbove(o,[y],m[P]),l[P]=1):C&&!C.includes(y)?C.unshift(y):!C&&!u[P]&&!m[P]&&(this.moveWidsToAbove(o,[p[P]]),u[P]=1):!C&&P&&!u[P]&&!m[P]?(this.moveWidsToAbove(o,[p[P]]),u[P]=1):C&&!C.includes(y)?C.unshift(y):this.moveWidsToAbove(o,[y]);else if(k){B!=="frontFixed"&&B!=="backFixed"&&(C=null);let $=b&&c(y,r);b||s===a?S!=="frontFixed"&&S!=="backFixed"&&(s!==a&&P?!C&&!l[P]&&m[P]?(this.moveWidsToFix(o,[y],m[P],$),l[P]=1):C&&!C.includes(y)?C.unshift(y):!C&&!u[P]&&!m[P]&&(this.moveWidsToFix(o,[p[P]],void 0,$),u[P]=1):!C&&P&&!u[P]&&!m[P]?(this.moveWidsToFix(o,[p[P]],void 0,$),u[P]=1):C&&!C.includes(y)?C.unshift(y):this.moveWidsToFix(o,[y],void 0,$)):this.removeWidsFromOrder(o,[y])}else B!=="normal"&&(C=null),b||s===a?S!=="normal"&&(s!==a&&P?!C&&!l[P]&&m[P]?(this.moveWidsToNormal(o,[y],m[P]),l[P]=1):C&&!C.includes(y)?C.unshift(y):!C&&!u[P]&&!m[P]&&(this.moveWidsToNormal(o,[p[P]]),u[P]=1):!C&&P&&!u[P]&&!m[P]?(this.moveWidsToNormal(o,[p[P]]),u[P]=1):C&&!C.includes(y)?C.unshift(y):this.moveWidsToNormal(o,[y])):this.removeWidsFromOrder(o,[y])})}updateIndexAddFromTemplate(o,t,r=!0){this.mag.pages.each(s=>{let a=this._order[s.get("_id")];s!==o&&e.extendOrder(a,t),r?e.conditionalSave(s,this._order[s.get("_id")]):e.conditionalSet(s,this._order[s.get("_id")])});let i=s=>{X.default.each(s,(a,l)=>{X.default.each(a,m=>{X.default.each(m.widgetsOrder,(c,p)=>{p===o.get("_id")&&l===p||m.widgetsOrder[p]&&e.extendOrder(m.widgetsOrder[p],t)})})})};i(Lt.undoStacks),i(Lt.redoStacks),this._updateCalculatedIndex()}updateIndex(o,t,r=!0){let i=this._order[o.get("_id")],s={};this.mag.pages.each(l=>{s[l.id]={},Pe.viewports.forEach(m=>{let c=m.name;if(X.default.isEmpty(l.get("viewport_"+c))&&c!=="default")return;c&&!this._order[l.get("_id")][c]&&(this._order[l.get("_id")][c]=JSON.parse(JSON.stringify(this._order[l.get("_id")].default)));let p=X.default.sortBy(t,u=>this.getZIndex(u.id,o.id,c));s[l.id][c]=p,this.updateOrder(this._order[l.get("_id")][c],p,c,i[c],l,o)}),r?e.conditionalSave(l,this._order[l.get("_id")]):e.conditionalSet(l,this._order[l.get("_id")])});let a=l=>{X.default.each(l,(m,c)=>{X.default.each(m,p=>{X.default.each(p.widgetsOrder,(u,d)=>{d===o.get("_id")&&c===d||Pe.viewports.forEach(g=>{let h=g.name;p.widgetsOrder[d]&&p.widgetsOrder[d][h]&&s[d]&&this.updateOrder(p.widgetsOrder[d][h],s[d]&&s[d][h]||t,h,i[h],null,o.get("_id"))})})})})};this._syncAbovePages(o.get("_id"),o.getCurrentViewport()),a(Lt.undoStacks),a(Lt.redoStacks),this._updateCalculatedIndex()}},ka=Md;bi();tt();var Bd=Mo.prototype,$_=Mo.extend({idAttribute:"_id",urlRoot:"/api/mag/",PUBLISH_URL:"/api/publish/",UNPUBLISH_URL:"/api/unpublish/",CHECKDOMAIN_URL:"/api/checkdomain",SETDOMAIN_URL:"/api/mag/domain/",publish_attempts:0,user_templates:{},name:"Mag",undoKeys:[],initialize:function(){xe.default.bindAll(this),this.globalWidgets=new ap,_d&&(this.pages=new _d,this.trashPages=new Ib,this.pages.on("change:screenshot",e=>{this.trigger("change:page:screenshot",e.id,e.get("screenshot"),"default")}),this.pages.on("change:viewport_phone_portrait change:viewport_tablet_portrait",e=>{let o=Object.keys(e.changedAttributes())[0],t=e.previousAttributes()[o]?.screenshot,r=e.attributes[o]?.screenshot;t!==r&&this.trigger("change:page:screenshot",e.id,r,o==="viewport_tablet_portrait"?"tablet_portrait":"phone_portrait")})),this.on("mag_state_changed",function(e){e&&e.socketUpdate||this.triggerSocketUpdate()},this),this.on("change:updated",function(e,o,t){this.trigger("mag_state_changed",t)},this),this.on("change:changed",function(e,o,t){if(o){if(this.trigger("changed"),t&&t.socketUpdate)return;this.triggerSocketUpdate({changed:o})}},this),this.on("change:pids",function(e,o,t){xe.default.defer(xe.default.bind(function(){this.pages.each(function(r){r&&o.indexOf(r.id)===-1&&this.pages.remove(r.id)},this)},this)),(!t||!t.xhr&&!t.socketUpdate&&!t.success)&&this.triggerSocketUpdate(this.pick("pids"),{})},this),this.on("change:opts",function(e,o,t){(!t||!t.socketUpdate)&&this.triggerSocketUpdate(this.pick("opts"))}),this.on("error",function(){this._saveduser&&this.set("user",this._saveduser),delete this._saveduser},this),ye.on("global_appear:widget",function(e){this.globalWidgets.add(e)}.bind(this)),ye.on("global_disappear:widget",function(e){this.globalWidgets.remove(e)}.bind(this))},parse:function(e){return this.has("changed")&&delete e.changed,xe.default.isObject(this.get("user"))&&delete e.user,e.last_changed=e.last_changed&&new Date(e.last_changed),e.user&&(this.user=new nl(e.user,{parse:!0})),Bd.parse.apply(this,arguments)},save:function(){if(!this.get("user"))return Bd.save.apply(this,arguments);let e=Bd.save.apply(this,arguments);return this.set("changed",!0),e},getPage:function(e){return this.pages.get(e)},addPage:function(e,o,t,r=void 0){e=e||{},!this._addBlock&&(this._addBlock=!0,e.num=e.num||this.getMaxNum()+1,e.mid=this.id,e.order=this.hasGlobalWidgets()?{default:ka.getWidgetOrder(this.globalWidgets.models,r)}:void 0,Oo.default.ajax({url:"/api/page/",method:"POST",dataType:"json",data:e,success:function(i){this._addBlock=!1;let s=new Jo(i.page,{parse:!0});i.edit_params&&(window.RM.constructorRouter.mag.edit_params.set(i.edit_params),window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document));let a=i.textStyles,l=i.linkStyles,m=i.listStyles;if(i.edit_params){let c=Rf(i.edit_params.paragraph_styles||[]);c.length&&c.forEach(u=>{a.some(d=>d.name===u.name)||a.push(u)});let p=Ef(i.edit_params.link_styles||[]);p.length&&p.forEach(u=>{l.some(d=>d.name===u.name)||l.push(u)})}Yl({newTextStyles:a,newLinkStyles:l,newListStyles:m}),s.set("parentPage",null),t||this.onAdd(s),o&&o(s)},error:function(i){if(this._addBlock=!1,i.status===400)try{o(JSON.parse(i.responseText))}catch{alert("Seems there is a connection problem.")}else alert("Seems there is a connection problem.")},context:this}))},onAdd:function(e,o){this.pages.add(e);let t;t=xe.default.clone(this.get("pids")),t.push(e.id),t=(0,xe.default)(t).chain().uniq().compact().value(),this.set({pids:t},o)},getActivePages:function(){return this.pages.filter(function(e){return xe.default.include(this.get("pids"),e.id)},this)},getTitle:function(){return this.get("title")||"Project Title"},getMaxNum:function(){let e=xe.default.max(xe.default.map(this.getActivePages(),function(o){return o.get("num")}));return(!e||e<0)&&(e=0),e},loadFull:function(e){let o=e.success;e.success=xe.default.bind(function(t,r,i){let s=xe.default.clone(t);this.pages.reset(s.pages,{parse:xe.default.has(e,"parse")?e.parse:!0}),delete s.pages;let a=s.user.email===window.RM.constructorRouter.me?.get("email"),l=s.roleName;(a||l==="member")&&(l=je.getCurrentProjectRole(s.num_id)),this.roleName=l,this.rolePermissions=l==="editor"?s.editorPermissions:s.rolePermissions,this.teamRole=s.roleName,delete s.roleName,delete s.rolePermissions,delete s.editorPermissions,this.set(this.parse(s)),this.initGlobalWidgets(),ye.trigger("mag:loadfull:complete"),o&&o(t,r,i)},this),Oo.default.ajax(xe.default.extend(e,{url:"/api/magFullById/"+this.get("num_id"),dataType:"json"}))},setMag:function(e){let o=xe.default.clone(e);this.pages.reset(o.pages,{parse:!0}),delete o.pages,this.set(this.parse(o)),this.initGlobalWidgets()},fetchTrashPages:function(e={}){return Tb(this.get("num_id")).then(o=>{o&&this.trashPages.reset(o,{parse:!0});let t=!!(o&&o.length);return this.get("has_deleted_pages")!==t&&this.set({has_deleted_pages:t},e),o})},sendPagesToTrash:function(e=[]){return Mb(this.get("num_id"),e.map(o=>o.get("_id"))).then(()=>{e.map(o=>{this.trashPages.get(o.get("_id"))||this.trashPages.add(o)})})},restorePage:async function(e,o,t=!1){o=o||{},Oo.default.ajax({type:"POST",url:"/api/user/permissions/can_create_page",data:JSON.stringify({mag:this.toJSON()}),contentType:"application/json",context:this,success:function(){Oo.default.get("/api/pageFullById/"+e,xe.default.bind(function(r){r=new Jo(r,{parse:!0}),t||this.onAdd(r),this.trashPages.remove(r),this.set("has_deleted_pages",!!this.trashPages.length),t||this.save(),o.success&&o.success(r)},this)).fail(o.error)},error:o.error})},restoreMag:function(e){Oo.default.ajax({type:"POST",url:"/api/mag/"+this.get("num_id")+"/revert-version",success:function(){typeof e=="function"&&e()},error:function(){console.log("Error while restore :(")},context:this})},emptyTrash:function(){return this.deleteTrashPages().then(()=>{this.trashPages.reset(),this.trashPages.triggerSocketEmptyTrash(),this.set("has_deleted_pages",!1)})},deleteTrashPage:function(e,o){o=o||{};let t=this.trashPages.get(e)||this.pages.get(e);Oo.default.ajax({url:"/api/page/"+e+"/trash",type:"DELETE",success:function(){this.trashPages.get(e)&&(this.trashPages.remove(t),this.set("has_deleted_pages",!!this.trashPages.length)),o.success&&o.success()},error:o.error,context:this})},deleteTrashPages:function(e=[]){return Bb(this.get("num_id"),e).then(()=>{e.forEach(o=>{let t=this.trashPages.get(o);t&&this.trashPages.remove(t)}),this.set("has_deleted_pages",!!this.trashPages.length)})},getPageNumId:function(e,o){let r=(o&&o.onlyActive?(0,xe.default)(this.getActivePages()):this.pages).find(function(i){return i.get("num")===e});return r&&r.get("num_id")},getPageId:function(e,o){let r=(o&&o.onlyActive?(0,xe.default)(this.getActivePages()):this.pages).find(function(i){let s=i.get("num"),a=i.get("uri");return s&&e&&s.toString()===e.toString()||a&&e&&a.toString()===e.toString()});return r&&r.id},getPageUri:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&(o.get("uri")||o.get("num"))},getPageDataUri:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&o.get("uri")},getPageNum:function(e){let o=this.pages.find(function(t){return t.get("_id")==e});return o&&o.get("num")},getWidgetPage:function(e){return xe.default.find(this.pages.models,function(o){return xe.default.find(o.widgets.models,function(t){return t.get("_id")===e})})},getWidgetById:function(e){let o;return xe.default.find(this.pages.models,function(t){let r=xe.default.find(t.widgets.models,function(i){return i.get("_id")===e});return r&&(o=r),r}),o},deletePage:function(e,o){let t=xe.default.reject(this.get("pids"),function(l){return l===e.id},this),r,i,s,a;if(xe.default.isEmpty(t))return!1;this.get("master_share_pid")===e.get("_id")&&this.unset("master_share_pid"),r=e.getOwnGlobalWidgets(),xe.default.isEmpty(r)||(i=this.pages.get(t[0]),s=this.changeParentPage(r,i,{silent:!0}),a=r.concat(s),window.RM.constructorRouter.workspace.save_group(a,{skipHistory:!0})),this._deleteXHR&&this._deleteXHR.abort(),this._deleteXHR=this.save({pids:t},{success:xe.default.bind(function(){e.isEmptyPage||(this.set("has_deleted_pages",!0),this.trigger("change:has_deleted_pages",this)),o&&o(),e.isEmptyPage&&!this.get("shared")&&this.deleteTrashPage(e.id)},this)}),e.save({trash_date:new Date},{silent:!0,noSocketUpdate:!0,patch:!0})},checkDeletingPages:function(e=[]){if(e.find(r=>window.RM.constructorRouter.isPageLocked(r))!==void 0)return!1;let t=xe.default.reject(this.get("pids"),function(r){return e.includes(r)},this);return!xe.default.isEmpty(t)},deletePages:function(e,o){let t=xe.default.reject(this.get("pids"),function(a){return e.includes(a)},this);if(xe.default.isEmpty(t)){o&&o(new Error("can not delete all pages"));return}this.get("master_share_pid")&&e.includes(this.get("master_share_pid"))&&(this.unset("master_share_pid"),this.save({}));let r=[],i=[],s=[];if(e.forEach(a=>{let l=this.getPage(a);s=s.concat(l.getOwnGlobalWidgets()),l.isEmptyPage?r.push(l):i.push(l)}),!xe.default.isEmpty(s)){let a=this.pages.get(t[0]),l=this.changeParentPage(s,a,{silent:!0}),m=s.concat(l);window.RM.constructorRouter.workspace.save_group(m,{skipHistory:!0})}this._deleteXHR&&this._deleteXHR.abort(),this._deleteXHR=this.save({pids:t},{success:()=>{i.length&&(this.set("has_deleted_pages",!0),this.trigger("change:has_deleted_pages",this)),o&&o({deleteNotEmptyPages:!!i.length}),r.length&&(this.get("shared")?i=i.concat(r):this.deleteTrashPages(r.map(a=>a.get("_id")))),i.length&&this.sendPagesToTrash(i)},error:()=>{o&&o(new Error("save project pids error"))},patch:!0})},deleteMag:function(e){Oo.default.ajax({type:"POST",url:"/api/mags/archive",data:JSON.stringify({mag_num_ids:[Number(this.get("num_id"))],folder_num_ids:[]}),contentType:"application/json; charset=utf-8",success:function(){typeof e=="function"&&e()},error:function(o){console.log("Error deleting mag: "+o.responseText)},context:this})},publish:function(e,o){this.updateUsedFonts({success:xe.default.bind(function(){let t={major:e||void 0,description:e&&o||void 0};this.publish_attempts+=1,Oo.default.ajax({type:"POST",url:this.PUBLISH_URL+this.get("num_id"),global:!1,data:t,success:xe.default.bind(function(r){this.set(xe.default.extend(this.parse(r),{changed:!1})),this.publish_attempts=0},this),error:xe.default.bind(function(r){this.trigger("mag_publish_error",r.responseJSON||{error:r.statusText,message:r.responseText})},this)})},this),error:xe.default.bind(function(){this.trigger("mag_publish_error",{error:"Used fonts save error",message:"Used fonts save error"})},this)})},unpublish:function(){Oo.default.ajax({type:"POST",url:this.UNPUBLISH_URL+this.get("num_id"),success:xe.default.bind(function(){this.set({is_published:null,published:null,updated:null})},this),error:xe.default.bind(function(){console.error(arguments)},this)})},checkDomain:function(e,o){return Oo.default.ajax({type:"POST",url:this.CHECKDOMAIN_URL,data:{num_id:this.get("num_id"),domain:e},success:xe.default.bind(function(t){this.set({last_checked_domain:e},{silent:!0}),o&&o(t)},this),error:xe.default.bind(function(){console.error(arguments),o&&o(null)},this)})},mapDomain:function(e,o){return o=o||{},Oo.default.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{domain:e,status:"on"},success:xe.default.bind(function(t){this.set({domain:e},{silent:!0}),o.success&&o.success(t)},this),error:xe.default.bind(function(t){return t&&t.status>=500?o.error(null):o.error&&o.error({badDNSSettings:!0})},this)})},unmapDomain:function(e){return Oo.default.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{status:"off"},success:xe.default.bind(function(o){this.unset("domain",{silent:!0}),e&&e(o)},this),error:xe.default.bind(function(){console.error(arguments),e&&e(null)},this)})},loadUserTemplates(){return Sg().then(e=>(this.isTemplatesLoaded=!0,this.user_templates=e,e)).catch(()=>{throw this.isTemplatesLoaded=!1,new Error("Error loading page templates")})},getPageTemplate:function(e){let o=null;return xe.default.any(this.user_templates,function(t){if(t.id==e)return o=t,!0}),o},addCustomPageTemplate:function(e){let o=xe.default.find(this.user_templates,function(t){return t.custom});o&&o.templates.unshift(e)},getAllWidgets(){let e=[];return xe.default.each(this.pages.models,o=>{if(o.widgets.length){let t=o.attributes.wids;xe.default.each(o.widgets.models,r=>{let i=Pe.viewport_list.reduce((s,a)=>(r[a]&&(s[a]=r[a]),s),{});t.includes(r.id)&&e.push({...r.attributes,...i,...r.hasNested&&r.widgets_collection?.models?{widgets_collection:r.widgets_collection.models}:{}})})}else xe.default.each(o.attributes.wids,t=>e.push(t))}),e},getUsedFontsNames:function(){return new Set(uo.getUsedFontsFromWidgetsModels({models:this.getAllWidgets(),onlyFontsNames:!0},uo.fontsShortList))},getUsedFonts:function(e){e=e||{};let o=this.edit_params?this.edit_params.get("fonts"):this.get("edit_params")?this.get("edit_params").fonts:[];return uo.getUsedFontsFromWidgetsModels({...e,models:this.getAllWidgets(),customList:e.includeCustom?xe.default.filter(o,{provider:"custom"}):[]},uo.fontsShortList)},updateUsedFonts:function(e){e=e||{};let o=this.getUsedFonts({includeCustom:!0,excludeUnusedDefault:!0}),t=uo.sortFontsByProvider(o);this.save(t,{patch:!0,url:this.url()+"?skip_changed=true",success:xe.default.bind(function(){e.success&&e.success()},this),error:xe.default.bind(function(){e.error&&e.error()},this)})},filterUnusedFonts:function(){let e=this.edit_params.attributes.fonts;if(!xe.default.any(e,function(i){return i.provider=="typekit"&&i.hidden}))return;let t=xe.default.pluck(xe.default.where(this.getUsedFonts({includeCustom:!1}),{provider:"typekit"}),"css_name"),r=xe.default.reject(e,function(i){return t.indexOf(i.css_name)===-1&&i.hidden&&i.provider=="typekit"});xe.default.isEqual(xe.default.pluck(r,"css_name"),xe.default.pluck(e,"css_name"))||this.edit_params.save({fonts:r},{silent:!0})},getUsedStyles:function(e){return uo.getUsedStylesFromWidgetsModels(this.getAllWidgets(),e,e==="link")},mergeEditParams:function(e){e=e||{};let o=this.edit_params,t,r=xe.default.clone(o.get("paragraph_styles"))||[],i=!1;t=xe.default.pluck(r,"_name"),xe.default.each(e.paragraph_styles,function(l){xe.default.contains(t,l._name)||(r.push(l),i=!0)}),i&&(o.set("paragraph_styles",r),window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document));let s=xe.default.clone(o.get("link_styles"))||[],a=!1;t=xe.default.pluck(s,"_name"),xe.default.each(e.link_styles,function(l){xe.default.contains(t,l._name)||(s.push(l),a=!0)}),a&&(o.set("link_styles",s),window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document)),(i||a)&&this.save(),e.fonts&&e.fonts.length&&window.RM.constructorRouter.fonts.addFonts(e.fonts,"paste")},triggerEditParamsRewrite:function(e,o){JSON.stringify(e.paragraph_styles)!=JSON.stringify(o.paragraph_styles)&&window.RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),JSON.stringify(e.link_styles)!=JSON.stringify(o.link_styles)&&window.RM.constructorRouter.textStyles.generateCSS("link","constructor",document),JSON.stringify(e.fonts)!=JSON.stringify(o.fonts)&&window.RM.constructorRouter.fonts.appendFontsCssToDocument({version:"edit"},function(){window.RM.constructorRouter.trigger("font-added")})},fetchLastChanged:function(e){this.fetch({data:{fields:"last_changed"},noSocketUpdate:!0,success:xe.default.bind(function(){this.previousAttributes()&&this.previousAttributes().last_changed?new Date(this.previousAttributes().last_changed).getTime()+300*1e3<new Date(this.get("last_changed")).getTime()?e({wasChanged:!0}):e({wasChanged:!1}):e({wasChanged:!1})},this)})},updateLastChanged:function(){this.set("last_changed",new Date)},changeParentPage:function(e,o,t){t=xe.default.extend(t||{},{nosave:!0,changeParentPage:!0});let r=new Ob.default.Collection;return xe.default.each(e,function(i){let s=i.get("pid"),a=this.pages.get(s);s!=o.id&&(i.set("pid",o.id,{silent:!0}),i.collection=o.widgets,o.addWidget(i,t),t.forceRemove=!0,a.removeWidgets([i.id],t),r.add(a))}.bind(this)),r.isEmpty()||r.add(o),r.models},removeGlobalWidgets:function(e){let o=xe.default.difference(this.get("gwids"),e);this.save({gwids:o})},initGlobalWidgets:function(){let e=this.pages.chain().reduce(function(o,t){return[...o,...t.widgets.models]},[]).filter(function(o){return o.isGlobal()}).uniq(function(o){return o.get("_id")}.bind(this)).value();this.globalWidgets.set(e)},addGlobalWidgetsFromTemplate:function(e){let o=e.widgets.models.filter(i=>i.isGlobal()),t=xe.default.map(o,i=>i.get("_id")),r=ka.getPartialOrder(e.attributes.order,t);RM.constructorRouter.indexController.updateIndexAddFromTemplate(e,r),this.initGlobalWidgets()},hasGlobalWidgets:function(){return this.globalWidgets&&this.globalWidgets.length>0},hasCodeInjection(){if(xe.default.any(["ci_head","ci_body_top","ci_body_bottom","ci_css"],r=>this.get(r)))return!0;let o=!1,t=r=>{let i=(c,p)=>typeof c.get=="function"?c.get(p):c[p],s=!!(i(r,"type")==="iframe"&&i(r,"code"));if(!s||i(r,"use_iframe"))return;let l=(0,Nb.getEmbedType)(i(r,"code"))==="codeinjection";if(!l)return;let m=!!(xe.default.all(Pe.viewport_listall,function(c){let p=r[c];return p&&p.hidden||!p})&&i(r,"hidden"));s&&l&&!m&&(o=!0)};return this.pages.each(function(r){r.widgets.length?r.widgets.each(t):r.attributes.wids.forEach(t)}),o},hasWidgetsWithType(e){return this.pages.some(o=>(o.widgets.length?o.widgets:o.attributes.wids).some(t=>(typeof t.get=="function"?t.get("type"):t.type)===e))},getViewportWidth(e){return!e||e==="default"?this.get("desktopWidth")||Pe.dictionary.default.width:e==="phone_portrait"?this.get("phoneWidth")||Pe.dictionary.phone_portrait.width:Pe.dictionary[e].width},setViewportWidth(e,o){e==="default"?this.set("desktopWidth",o):e==="phone_portrait"&&this.set("phoneWidth",o)},isPermissionAllowed(e){return e?((this.rolePermissions||[]).find((t={})=>t.name===e)||{}).value??!0:!0},increaseWidgetAddCounter(){let e=this.get("widgetAddCounter")||0;this.save({widgetAddCounter:++e},{patch:!0}),(e>0&&e<=20&&e%5===0||e>20&&e<=100&&e%10===0)&&ae(ce.WidgetTotal,{total:e})}}),ya=$_;t_();var Ci=T(et());Sl();oa();var Fb=Mo.prototype,L_=Mo.extend({id:"_pageOrder",url:"/api/pageOrder/",name:"PageOrder",isNew:function(){return!1},load:function(e){let o=e.pages.reduce(function(t,r){return t.push({id:r.id,num:r.get("num"),parentPage:r.get("parentPage")||null}),t},[]);return this.magId=e.get("_id"),this.set({order:o}),null},saveInProgress:function(){return this._xhr&&this._xhr.state()==="pending"},save:function(e){if(e.order)return this.orderPages(e.order),this._xhr&&this._xhr.abort(),this._xhr=fi.prototype.save.apply(this,arguments),this._xhr.skipResponse=!0,this._xhr.fail(Ci.default.bind(function(o){if(o.responseJSON&&o.responseJSON.error&&o.responseJSON.error==="invalid order")return this.trigger("reorder");alert("Something went wrong while saving the pages order. Please, reload the page.")},this)),this._xhr},parse:function(e,o){if(o&&o.xhr&&o.xhr.skipResponse){Fb.parse.apply(this,arguments);return}return Fb.parse.apply(this,arguments)},orderPages:function(e,o={}){Ci.default.each(RM.constructorRouter.mag.getActivePages(),t=>{let r=Ci.default.find(e||this.get("order"),i=>i.id===t.id);r&&t.set({num:r.num,parentPage:r.parentPage||null},o)})},validateAndFixPageOrder(e){let o=Ci.default.pluck(this.get("order"),"num");(o[0]!==1||!Ci.default.isEqual(o,Ci.default.range(1,o.length+1)))&&this.fixPageOrder(e)},fixPageOrder(e){let o=e.getActivePages().map(t=>({id:t.get("_id"),num:t.get("num"),parentPage:t.parentPage||null}));this.fixNums(o,e.get("_id")||this.magId)},fixNums(e,o){let t=[],r={};return Ci.default.sortBy(e,"num").forEach((i,s)=>{t.push({id:i.id,parentPage:i.parentPage&&r[i.parentPage]?i.parentPage:null,num:s+1}),r[i.id]=i}),this.save({order:t,mid:o||this.magId})},reorderPagesAfterAdd({page:e,pageNum:o,magId:t}){let r=Array.from(this.get("order")),i=o||e.get("num"),s=i>r.length?r.length:r.findIndex(a=>a.num===i);r.splice(s,0,{id:e.get("_id"),num:i,parentPage:e.get("parentPage")}),this.fixNums(r,t)},reorderAfterDrag(e,o=0,t,r){let i=Array.from(this.get("order")),s=i.findIndex(c=>c.num===e);if(s===-1)return;let a=i.splice(s,o+1),l=e===t.num?e+1:t.num,m=i.findIndex(c=>c.num===l);m===-1&&(m=i.length),a.length&&(a[0]=t),i.splice(m,0,...a),this.fixNums(i,r)},deletePagesFromOrder(e,o){let r=this.get("order").filter(i=>!e.includes(i.id));return this.fixNums(r,o)},updateParentIds(e,o){let r=this.get("order").map(i=>e.includes(i.id)?{id:i.id,num:i.num,parentPage:o}:i);this.set("order",r)},removeParentIds(e){let t=this.get("order").map(r=>e.includes(r.id)?{id:r.id,num:r.num,parentPage:null}:r);this.set("order",t)}}),Wb=L_;var fo=T(et());fl();Vo();var Ub=function(e){this.edit_params=e,this.proxyMethods(["set","get","fetch","on","off","save"]),this.rememberStylesOrder(),this.on("sync",fo.default.bind(this.rememberStylesOrder,this))};Ub.prototype={id:"_textStyles",isNew:function(){return!1},proxyMethods:function(e){let o=this,t=this.edit_params;fo.default.each(e,function(r){o[r]=function(){return t[r].apply(t,arguments)}})},getList:function(e,o){let t=[];return e=="paragraph"&&(t=this.get("paragraph_styles")||[]),e=="link"&&(t=this.get("link_styles")||[]),o?fo.default.clone(t):t},getStylesListSorted:function(e){let o=this.getList(e,!0);return o.sort(function(t,r){return t._sort-r._sort}),o},getOrder:function(e){return fo.default.pluck(this.getList(e),"_sort")},rememberStylesOrder:function(){this.orderBefore={},this.orderBefore.paragraph=this.getOrder("paragraph"),this.orderBefore.link=this.getOrder("link")},generateCSS:function(e,o,t,r){uo.generateCSS(e,o,t,this.getList(e),r)},findStyle:function(e,o){return fo.default.findWhere(this.getList(e),{_name:o})},redefineStyle:function(e,o,t){let r=this.getList(e,!0);for(var i=0;i<r.length&&r[i]._name!=o;i++);if(i>=r.length)return;let s=fo.default.clone(r[i]);r[i]=fo.default.extend(s,t),this.save(e+"_styles",r)},reorder:function(e,o){let t=this.getList(e,!0);for(let r=0;r<t.length;r++)t[r]=fo.default.clone(t[r]),t[r]._sort=fo.default.indexOf(o,t[r]._name);this.set(e+"_styles",t)},addStyle:function(e,o){let t=this.getList(e,!0);return o=fo.default.extend({_caption:"New style",_name:e+"-"+Ye.generateUUID(),_sort:t.length},o),t.push(o),this.save(e+"_styles",t),o},deleteStyle:function(e,o){let t=this.getList(e),r=fo.default.findWhere(t,{_name:o});r&&(t=fo.default.without(t,r),this.save(e+"_styles",t))},duplicateStyle:function(e,o){let t=this.getList(e,!0),r=fo.default.findWhere(t,{_name:o});if(!r)return;let i=fo.default.clone(r);return i._name=e+"-"+Ye.generateUUID(),t.push(i),this.save(e+"_styles",t),i},changeStyle:function(e,o){let t=this.getList(e,!0);for(var r=0;r<t.length&&t[r]._name!=o;r++);r>=t.length||(t[r]=fo.default.clone(t[r]),this.save(e+"_styles",t))},restoreStyle:function(e,o,t){let r=this.getList(e);for(var i=0;i<r.length&&r[i]._name!=o;i++);i>=r.length||fo.default.extend(r[i],t)}};var Gb=Ub;y2();var Pi=T(St()),Ca=T(mo()),Ke=T(et());Fr();var Vb={"template-constructor-grid-guides-controller":Ct`
    <% if (offsetTop) { %>
        <div class="guide-columns ghost <%= zeroGutter ? 'zero-gutter' : '' %>" style="height: <%= offsetTop %>px; bottom: auto;">
            <% for (var i = 0; i < columnWidths.length; i++) { %>
                <div class="guide-column" style="width: <%= columnWidths[i] %>px;"></div>
            <% };%>
        </div>
    <% };%>
    <div class="guide-columns <%= zeroGutter ? 'zero-gutter' : '' %>" style="top: <%= offsetTop %>px; bottom: <%= offsetBottom %>px;">
        <% for (var i = 0; i < columnWidths.length; i++) { %>
            <div class="guide-column" style="width: <%= columnWidths[i] %>px;">
                <% if (zeroGutter) { %>
                    <svg viewBox="0 0 2 <%= maxGuideHeight %>" xmlns="http://www.w3.org/2000/svg" class="left-stroke">
                        <line x1="<%= i === 0 ? 0.5 : 1 %>" y1="0" x2="<%= i === 0 ? 0.5 : 1 %>" y2="100%" stroke-width="1"></line>
                    </svg>
                    <svg viewBox="0 0 2 <%= maxGuideHeight %>" xmlns="http://www.w3.org/2000/svg" class="right-stroke">
                        <line x1="<%= i === columnWidths.length - 1 ? 1.5 : 1 %>" y1="0" x2="<%= i === columnWidths.length - 1 ? 1.5 : 1 %>" y2="100%" stroke-width="1"></line>
                    </svg>
                <% };%>
            </div>
        <% };%>
    </div>
    <% if (offsetBottom) { %>
        <div class="guide-columns ghost <%= zeroGutter ? 'zero-gutter' : '' %>" style="height: <%= offsetBottom %>px; top: auto;">
            <% for (var i = 0; i < columnWidths.length; i++) { %>
                <div class="guide-column" style="width: <%= columnWidths[i] %>px;"></div>
            <% };%>
        </div>
    <% };%>
`};var jb=T(mo()),xn=T(et());Sl();var H_=Mo.extend({idAttribute:"_id",name:"Guides",addPage:function(e,o){if(xn.default.isArray(this.get("pages"))){let t=xn.default.clone(this.get("pages"));t.push(e),this.set({pages:t},o)}return this},removePage:function(e){return xn.default.isArray(this.get("pages"))&&this.set({pages:xn.default.without(this.get("pages"),e)}),this}}),Yb=jb.default.Collection.extend({model:H_,url:"/api/guides/",initialize:function(e,o){this.url+=""+o.mag.get("num_id")+"/"},getByPage:function(e){let o=this.find(function(t){return xn.default.contains(t.get("pages")||[],e.id)&&t.get("viewport")===e.getCurrentViewport()});if(!o){let t=RM.constructorRouter.mag.get("_id"),r=RM.constructorRouter.mag.pages.map(s=>s.get("_id")),i;try{i=JSON.parse(window.sessionStorage.getItem("RM-lastUsedGuidesSet")||"{}")[t]}catch{}i&&(o=this.find(function(s){return xn.default.intersection(s.get("pages")||[],r).length&&s.get("viewport")===e.getCurrentViewport()&&s.get("index")===i}))}return o||this.find(function(t){return t.get("index")===1&&t.get("viewport")===e.getCurrentViewport()})},getByIndex:function(e,o){return this.find(function(t){return t.get("index")===e&&t.get("viewport")===o})},setPage:function(e,o){let t=this.getByPage(e);t.get("viewport")===e.getCurrentViewport()&&t.removePage(e.id).save(),this.getByIndex(o,e.getCurrentViewport()).addPage(e.id).save()},comparator:function(e){return e.get("index")+e.get("viewport")}});var vn=T(St()),oo=T(Lu()),gp=class{constructor(o,t){this.type=["right","left"].includes(t)?"horizontal":"vertical",this.$el=(0,vn.default)(`<div class="distance-line distance-line-${this.type}"></div>`).appendTo(o),this.$length=(0,vn.default)('<span class="distance-length"></span>').appendTo(this.$el),["right","left"].includes(t)?(this.$markerLeft=(0,vn.default)('<span class="distance-marker-left"></span>').appendTo(this.$el),this.$markerRight=(0,vn.default)('<span class="distance-marker-right"></span>').appendTo(this.$el)):["top","bottom"].includes(t)&&(this.$markerTop=(0,vn.default)('<span class="distance-marker-top"></span>').appendTo(this.$el),this.$markerBottom=(0,vn.default)('<span class="distance-marker-bottom"></span>').appendTo(this.$el)),this.length=0}destroy(){this.$el.remove()}updateLength(o){this.length=o,this.$length.text(o)}update(o,t,r,i=!1,s=!1){let a=RM.constructorRouter.zoom.getZoom(),l=o*a,m=t*a,c=r*a;this.$el.toggleClass("only-text",i),this.$el.toggleClass("flip-text",s);let p=Math.round(Math.abs(t-r));if(this.type==="vertical"&&p<11){this.hide();return}if(this.type==="horizontal"&&p<8){this.hide();return}this.length!==p&&this.updateLength(p),this.type==="horizontal"?this.$el.css({height:1,left:Math.min(m,c),width:Math.abs(m-c),top:l}):this.$el.css({width:1,top:Math.min(m,c),height:Math.abs(m-c),left:l}),this.$el.toggleClass("visible",!0)}hide(){this.$el.removeClass("visible")}},kn=class e{constructor(o){this.workspace=o,this.linePool=oo.default.map(["top","left","right","bottom"],t=>({direction:t,line:new gp(o.$origin,t)}))}getMovedRects(o){let t=1/0,r=1/0,i=-1/0,s=-1/0;return oo.default.each(o,a=>{t=Math.min(t,a.latestPosSizeAngle.bb_left),r=Math.min(r,a.latestPosSizeAngle.bb_top),i=Math.max(i,a.latestPosSizeAngle.bb_left+a.latestPosSizeAngle.bb_width),s=Math.max(s,a.latestPosSizeAngle.bb_top+a.latestPosSizeAngle.bb_height)}),{bb_left:t,bb_top:r,bb_width:i-t,bb_height:s-r}}static rectIntersection(o,t,r){switch(r){case"top":case"bottom":{let[i,s]=o.bb_left<t.bb_left?[o,t]:[t,o],a=s.bb_left-i.bb_left<i.bb_width,l=r==="top"?o.bb_top>t.bb_top:o.bb_top+o.bb_height<t.bb_top;return a&&l}case"left":case"right":{let[i,s]=o.bb_top<t.bb_top?[o,t]:[t,o],a=s.bb_top-i.bb_top<i.bb_height;return(r==="left"?o.bb_left>t.bb_left:o.bb_left+o.bb_width<t.bb_left)&&a}}return!1}static rectDist(o,t,r){switch(r){case"left":return o.bb_left<t.bb_left+t.bb_width?1/0:o.bb_left-(t.bb_left+t.bb_width);case"right":return t.bb_left<o.bb_left+o.bb_width?1/0:t.bb_left-(o.bb_left+o.bb_width);case"top":return o.bb_top<t.bb_top+t.bb_height?1/0:o.bb_top-(t.bb_top+t.bb_height);case"bottom":return t.bb_top<o.bb_top+o.bb_height?1/0:t.bb_top-(o.bb_top+o.bb_height)}}getCloserRect(o,t,r){let i=oo.default.difference(o,t),s=this.getMovedRects(t),a=oo.default.filter(i,c=>!c.outofbox&&!c.model.get("fixed_position")&&e.rectIntersection(s,c.latestPosSizeAngle,r)),l=oo.default.filter(a,c=>isFinite(e.rectDist(s,c.latestPosSizeAngle,r))),m=oo.default.sortBy(l,c=>e.rectDist(s,c.latestPosSizeAngle,r))[0];return{softIntersection:!!a.length,closerRect:m&&m.latestPosSizeAngle}}static getOffset(o,t,r){switch(r){case"right":case"left":{if(!t)return o.bb_top+o.bb_height/2;let[i,s]=o.bb_top<t.bb_top?[o,t]:[t,o];return i.bb_top+i.bb_height>s.bb_top+s.bb_height?s.bb_top+s.bb_height/2:s.bb_top+(i.bb_top+i.bb_height-s.bb_top)/2}case"top":case"bottom":{if(!t)return o.bb_left+o.bb_width/2;let[i,s]=o.bb_left<t.bb_left?[o,t]:[t,o];return i.bb_left+i.bb_width>s.bb_left+s.bb_width?s.bb_left+s.bb_width/2:s.bb_left+(i.bb_left+i.bb_width-s.bb_left)/2}}}drawLine({line:o,direction:t},r,i,{closerRect:s,softIntersection:a},l,m,c){if(!s&&a){o.hide();return}let p=0,u=0;switch(t){case"right":{p=r.bb_left+r.bb_width,u=s?s.bb_left:i.width;break}case"left":{p=r.bb_left,u=s?s.bb_left+s.bb_width:0;break}case"top":{p=r.bb_top,u=s?s.bb_top+s.bb_height:0;break}case"bottom":{p=r.bb_top+r.bb_height,u=s?s.bb_top:i.pageHeight;break}}let d=!1;switch(t){case"top":case"bottom":u>i.top+i.height&&(d=!0),u<i.top&&(d=!0);break;case"left":case"right":}if(d){o.hide();return}o.update(l,p,u,m,c)}updateLine({line:o,direction:t},r,i){let s=this.getMovedRects(r),{closerRect:a,softIntersection:l}=this.getCloserRect(this.workspace.blocks,r,t);this.drawLine({line:o,direction:t},s,i,{closerRect:a,softIntersection:l},e.getOffset(s,a,t))}collectLines(o,t,r,i){let s=oo.default.chain(o).filter(g=>{let h=cs(g.latestPosSizeAngle,g.model.get("fixed_position"),i),[b,x]=["top","bottom"].includes(t)?["bb_left","bb_width"]:["bb_top","bb_height"];if(!(Math.abs(r[b]-h[b])<8&&r[x]===h[x]))return!1;switch(t){case"left":return h.bb_left+h.bb_width<r.bb_left;case"right":return h.bb_left>r.bb_left+r.bb_width;case"top":return h.bb_top+h.bb_height<r.bb_top;case"bottom":return h.bb_top>r.bb_top+r.bb_height}}).sortBy(g=>{let h=["left","top"].includes(t)?-1:1,b=["left","right"].includes(t)?"bb_left":"bb_top",x=cs(g.latestPosSizeAngle,g.model.get("fixed_position"),i);return h*x[b]}).value();if(s.length<2)return;let a=s[0],l=cs(a.latestPosSizeAngle,a.model.get("fixed_position"),i),m=cs(s[1].latestPosSizeAngle,s[1].model.get("fixed_position"),i),[c,p]=["left","right"].includes(t)?["bb_left","bb_width"]:["bb_top","bb_height"],u=l[c]-m[c]-m[p],d=!0;return{coord:l[c]+l[p]+u,block:a,inline:oo.default.filter(s,(g,h)=>{if(h>1&&d){let b=cs(g.latestPosSizeAngle,g.model.get("fixed_position"),i);d=cs(s[h-1].latestPosSizeAngle,s[h-1].model.get("fixed_position"),i)[c]-b[c]-b[p]===u}return d})}}deleteLinePool(){this.linePool.forEach(o=>{o.line.destroy()}),this.linePool=[]}checkIfFilteringIsNeeded({guide:o,guides:t,renderedDistances:r,movedRect:i,isTopBottomFiltering:s=!1,isLeftRightFiltering:a=!1}){let l=o.blockBox,m=s?"center":a?"middle":null;if(a){let c=l.bb_left>i.bb_left+i.bb_width,p=i.bb_left>l.bb_left+l.bb_width;if(!c&&!p)return!1}else if(s){let c=i.bb_top>l.bb_top+l.bb_height,p=l.bb_top>i.bb_top+i.bb_height;if(!c&&!p)return!1}return m&&[m].includes(o.type)?!r.includes(o):r.includes(o)?!1:!t.find(p=>{let u=p.blockBox;if(u.bb_height===l.bb_height&&u.bb_width===l.bb_width&&u.bb_top===l.bb_top&&u.bb_left===l.bb_left&&[m].includes(p.type))return!0})}generateLinePool(o,t){let r=[...this.linePool];o.forEach(i=>{let s=i.blockBox,a=t.bb_left>s.bb_left+s.bb_width,l=s.bb_left>t.bb_left+t.bb_width,m=t.bb_top>s.bb_top+s.bb_height,c=s.bb_top>t.bb_top+t.bb_height,p=null;if(["top","bottom","middle"].includes(i.type)?p=a?"left":l?"right":null:["left","right","center"].includes(i.type)&&(p=m?"top":c?"bottom":null),p){let u=new gp(this.workspace.$origin,p);r.push({direction:p,line:u,cid:i.cid})}}),this.linePool=[...r]}updateForRect(o,t,r,i,s){let a=i?o:{...o,bb_left:r.x,bb_top:r.y},l=oo.default.filter(t,u=>u?.block&&["top","bottom","middle"].includes(u.type)),m=oo.default.filter(t,u=>u?.block&&["left","right","center"].includes(u.type)),c=[];this.deleteLinePool(),this.generateLinePool(l,a),this.generateLinePool(m,a);let p=[];oo.default.each(this.linePool,u=>{switch(u.direction){case"left":case"right":{let d=oo.default.chain(l).filter(g=>this.checkIfFilteringIsNeeded({guide:g,guides:l,renderedDistances:p,movedRect:a,isLeftRightFiltering:!0})).sortBy(g=>{let h=g.blockBox;return u.direction==="left"?h.bb_left:-h.bb_left+h.bb_width}).value();if(d.length){let g=oo.default.find(d,y=>y.type==="middle"),h=g&&g.block===d[0].block?g:d[0],b=h.blockBox,x=0;x=h.y,p.push(h),this.drawLine(u,a,s,{closerRect:b,softIntersection:!1},x,!0,h.type==="bottom");return}c.push(u);break}case"top":case"bottom":{let d=oo.default.chain(m).filter(g=>this.checkIfFilteringIsNeeded({guide:g,guides:m,renderedDistances:p,movedRect:a,isTopBottomFiltering:!0})).sortBy(g=>{let h=g.blockBox;return u.direction==="top"?h.bb_top:-h.bb_top+h.bb_height}).value();if(d.length){let g=oo.default.find(d,y=>y.type==="center"),h=g&&g.block===d[0].block?g:d[0],b=h.blockBox,x=h.x;p.push(h),this.drawLine(u,a,s,{closerRect:b,softIntersection:!1},x,!0);return}c.push(u);break}}}),this.destroyDynLines(),oo.default.each(c,u=>{u.line.hide()})}update(){}destroyDynLines(){this.dynLines&&(oo.default.each(this.dynLines,o=>{o.line.hide(),delete o.line}),this.dynLines=null)}hide(){this.destroyDynLines(),oo.default.each(this.linePool,o=>{o.line.hide()})}},cs=(e,o,t)=>{if(!o)return e;let r=e.bb_left,i=e.bb_top;switch(o){case"nw":case"n":case"ne":i+=t.top;break;case"e":case"c":case"w":i+=t.top+t.height/2-e.bb_height/2;break;case"sw":case"s":case"se":i=t.top+t.height-i-e.bb_height;break}switch(o){case"nw":case"w":case"sw":r-=(t.viewportWidth-t.width)/2;break;case"n":case"c":case"s":r+=t.width/2-e.bb_width/2;break;case"ne":case"e":case"se":r=t.width+(t.viewportWidth-t.width)/2-r-e.bb_width;break}return{...e,bb_left:r,bb_top:i}};sn();ot();Fr();var qb=Ct`
    <div class="baseline-group <%= pale ? 'pale' : '' %>" style="top: <%= top %>px; height: <%= height %>px;">
        <% if (left) { %>
        <div class="left-baseline" style="width: <%= left || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= left %> 2" xmlns="http://www.w3.org/2000/svg" class="left-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>         
        </div>
        <% } %>
        <div class="middle-baseline" style="left: <%= left || 0 %>px; right: <%= right || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= maxGuideWidth %> 2" xmlns="http://www.w3.org/2000/svg" class="middle-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>
        </div>
        <% if (right) { %>
        <div class="right-baseline" style="width: <%= right || 0 %>px;">
            <% if (fill) { %>
            <div class="fill"></div>
            <% } %>
            <svg viewBox="0 0 <%= right %> 2" xmlns="http://www.w3.org/2000/svg" class="right-stroke">
                <line x1="0" y1="1" x2="100%" y2="1" stroke-width="1"></line>
            </svg>          
        </div>
        <% } %>
    </svg>
`;Ku();yo();Vn();var Zb=T(St());ot();var Jb=T(mo());_r();yr();var hp=4,fp=.25,Si=[fp,.5,1,1.25,2,hp],O_=187,Xb=189,Kb=48,N_=2e3,F_=4e3,Qb=Jb.default.View.extend({className:"zoom-panel hidden",zoom:void 0,sizesPanelShown:!1,typographyPanelShown:!1,guidesPanelShown:!1,hideTimeoutId:void 0,isZoomEnabled:!Modernizr.firefox,isZoomScaleEnabled:!Modernizr.firefox,zoomBeforeGesture:void 0,mag:void 0,router:void 0,initialize(e,o,t){this.mag=o,this.router=e,this.isZoomEnabled&&(t.append(this.$el),this.render(),ye.listenTo(e,"changeViewport",this.onViewportChange.bind(this)),ye.on("panel:showed",this.onControlPanelToggle.bind(this,!0)),ye.on("panel:hidden",this.onControlPanelToggle.bind(this,!1)),ye.on("panel:hiddenGroup",this.onControlPanelToggleGroup.bind(this,!1)),ye.on("sizes:shown",this.setSizesPanel.bind(this,!0)),ye.on("sizes:hidden",this.setSizesPanel.bind(this,!1)),ye.listenTo(o.edit_params,"change:sizes",this.onSizesModeToggle.bind(this)),ye.listenTo(o,"change:desktopWidth",this.onViewportWidthChange.bind(this)),ye.listenTo(o,"change:phoneWidth",this.onViewportWidthChange.bind(this)),ye.listenTo(e,"pageChange",this.onPageChange.bind(this)),this.isZoomScaleEnabled&&ye.listenTo(o,"change:opts",(r,i)=>{let s=r.previous("opts");s&&i.scalableviewer!==s.scalableviewer&&this.onScaleLayoutToggle(i.scalableviewer),s&&i.scalewidth!==s.scalewidth&&this.onMaxScaleWidthChange(i.scalewidth)}),document.addEventListener("keydown",this.onZoomKey.bind(this,e)),Modernizr.safari?(document.addEventListener("gesturestart",this.onGesturePinchStart.bind(this)),document.addEventListener("gesturechange",this.onGesturePinch.bind(this,e))):document.addEventListener("wheel",this.onWheelPinch.bind(this,e),{passive:!1}),window.addEventListener("resize",this.onResize.bind(this)))},render(){return this.$el.html((0,Zb.default)(`<div class="zoom-panel-content"><span class="zoom-panel-value">${Math.round(this.getZoom()*100)}</span>%${this.isScaledZoomEnabled()?" Scaled layout":""}</div>`)),this},showPanel(){this.$el.removeClass("hidden")},hidePanel(){this.$el.addClass("hidden")},getZoomLevels(){let e=this.getScaleRatio();return this.allowFullscreen()&&e!==1?[...Si,e].sort():Si},getZoom(){return this.isZoomEnabled&&this.zoom||1},setZoom(e){if(this.isZoomEnabled){let o=this.zoom;this.zoom=e,this.fullscreen=e===this.getScaleRatio(),this.render(),o&&o!==e&&this.togglePanel(!0),o!==e&&ye.trigger("zoom",e,this.isFullScreenOrMore());let t=document.documentElement.style;t.setProperty("--workspace-zoom",e),t.setProperty("--workspace-inverse-zoom",`${1/e}`),t.setProperty("--workspace-inverse-zoom-px",`${1/e}px`)}},togglePanel(e){window.clearTimeout(this.hideTimeoutId);let o=this.getZoom()!==1&&(!this.isBoundToScreenWidth()||this.typographyPanelShown||this.guidesPanelShown||this.isSizesPanelVisible()),t=this.isBoundToScreenWidth()&&(this.typographyPanelShown||this.guidesPanelShown||this.isSizesPanelVisible());(e||o)&&this.showPanel(),(!o||t)&&(this.hideTimeoutId=window.setTimeout(()=>this.hidePanel(),t?F_:N_))},getNextZoom(e,o){let t=this.getZoomLevels(),r=t.indexOf(e||1),i=r>-1?r+(o?-1:1):t.indexOf(this.getClosestZoom(e,o));return t[Math.max(Math.min(i,t.length-1),0)]},getClosestZoom(e,o){let t=this.getZoomLevels();return e===t[0]&&o||e===t[t.length-1]&&!o?e:t.reduce((r,i)=>r<e&&i>e?o?r:i:o?i:r,-1/0)},isFullScreenZoom(){return this.fullscreen},isFullScreenOrMore(){return this.getZoom()>=this.getScaleRatio()},isDefaultZoom(){return this.getZoom()===1},allowFullscreen(){return this.mag.get("opts").scalableviewer&&this.router.workspace&&this.router.workspace.viewport==="default"&&this.isZoomScaleEnabled},isScaledZoomEnabled(){return this.getZoom()===this.getScaleRatio()&&this.isFullScreenZoom()},isBoundToScreenWidth(){return this.allowFullscreen()&&this.isFullScreenZoom()},isSizesPanelVisible(){return this.sizesPanelShown&&this.mag.edit_params.get("sizes")},getCenter(e,o,t){let i=o.page.getViewportParam(o.viewport,"height");return o.getSelectedBlocks().length?gt.getBoundingBoxOfBlocks(o.getSelectedBlocks()):{left:t.scrollLeft/e+Math.min(o.mag.getViewportWidth(o.page.get("viewport"))*e,window.innerWidth)/2/e-10/2,top:t.scrollTop/e+Math.min(i*e,window.innerHeight)/2/e-10/2,width:10,height:10}},getCenteringOffset(e,o,t,r={}){return{left:Math.max((r.left+r.width/2)*e-t.offsetWidth/2,0),top:Math.max((r.top+r.height/2)*e-t.offsetHeight/2,0)}},zoomTo(e,o,t,r=void 0){if(this.setZoom(e),r){let{left:i,top:s}=this.getCenteringOffset(e,o,t,r);t.scrollLeft=i,t.scrollTop=s}window.dispatchEvent(new Event("resize"))},onZeroZoomKey(e){if(e.name!=="default")return;let o,t=this.getZoom(),r=this.allowFullscreen(),i=this.getScaleRatio();return t===i?o=1:t!==1?o=r?i:1:o=i,o},onZoomKey(e,o){let t=e.workspace.getViewports().find(i=>i.isCurrent),r=Modernizr.mac?o.metaKey:o.ctrlKey;if([Xb,O_,Kb].includes(o.keyCode)&&r){o.preventDefault();let i=o.keyCode===Kb?this.onZeroZoomKey(t):this.getNextZoom(this.getZoom(),o.keyCode===Xb);Fe(`shortcut_${o.key}_ctrl`),this.zoomTo(i,e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onWheelPinch(e,o){if(o.ctrlKey){o.preventDefault();let t=o.deltaY*.015;this.zoomTo(Math.min(Math.max(Si[0],this.getZoom()-t),Si[Si.length-1]),e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onGesturePinchStart(e){e.preventDefault(),this.zoomBeforeGesture=this.getZoom()},onGesturePinch(e,o){if(o.preventDefault(),o.scale){let t=o.scale-1;this.zoomTo(Math.min(Math.max(Si[0],this.zoomBeforeGesture+t),Si[Si.length-1]),e.workspace,e.workspace.$container[0],this.getCenter(this.getZoom(),e.workspace,e.workspace.$container[0]))}},onResize(){this.setZoom(this.isBoundToScreenWidth()?this.getScaleRatio():this.getZoom())},onMaxScaleWidthChange(e){this.isBoundToScreenWidth()&&(this.setZoom(this.getScaleRatio({maxScaleWidth:e})),window.dispatchEvent(new Event("resize")))},onViewportWidthChange(e,o){this.isBoundToScreenWidth()&&(this.setZoom(this.getScaleRatio({viewportWidth:o})),window.dispatchEvent(new Event("resize")))},onSizesModeToggle(e){e.get("sizes")!==e.previous("sizes")&&this.togglePanel()},onScaleLayoutToggle(e){e&&this.allowFullscreen()&&(this.isDefaultZoom()||!this.zoom)?(this.setZoom(this.getScaleRatio()),window.dispatchEvent(new Event("resize"))):!e&&this.isFullScreenZoom()&&(this.setZoom(1),window.dispatchEvent(new Event("resize"))),ye.trigger("zoom:fullscreen:toggle")},setSizesPanel(e){let o=this.sizesPanelShown!==e;this.sizesPanelShown=e,o&&this.togglePanel()},setTypographyPanel(e){let o=this.typographyPanelShown!==e;this.typographyPanelShown=e,o&&this.togglePanel()},setGuidesPanel(e){let o=this.guidesPanelShown!==e;this.guidesPanelShown=e,o&&this.togglePanel()},onControlPanelToggleGroup(e,o){o.includes("guides")&&this.setGuidesPanel(e)},onControlPanelToggle(e,o){o==="guides"&&this.setGuidesPanel(e)},onPageChange(){let e=this.getZoom();this.setZoom(this.allowFullscreen()?this.getScaleRatio():1);let o=this.getZoom();e!==o&&window.dispatchEvent(new Event("resize")),this.togglePanel()},onViewportChange(){this.setZoom(this.allowFullscreen()?this.getScaleRatio():1),window.dispatchEvent(new Event("resize"))},getScaleRatio({viewportWidth:e,minScaleWidth:o,maxScaleWidth:t}={}){return il.getLimitedRatio(e||this.mag.getViewportWidth(this.router.workspace?.viewport),t||this.mag.get("opts").scalewidth,o||Pe.dictionary.default.min_scale_width,!1)}});wi();bi();var bp=class{constructor(o){E(this,"horizontalLines");E(this,"verticalLines");E(this,"maxStepForHardGridSnapping");E(this,"minStickingDistance");this.horizontalLines=[],this.verticalLines=[],this.maxStepForHardGridSnapping=o.maxStepForHardGridSnapping,this.minStickingDistance=o.minStickingDistance}setNearestHorizontalLine(o){this.horizontalLines.push(o)}setNearestVerticalLine(o){this.verticalLines.push(o)}removeLines(o=null){if(o){let t=[...this.verticalLines],r=[...this.horizontalLines];o==="baseline"?r=r.filter(i=>i.lineType!==o):o==="guideline"?t=t.filter(i=>i.lineType!==o):(t=t.filter(i=>i.lineType!==o),r=r.filter(i=>i.lineType!==o)),this.verticalLines=[...t],this.horizontalLines=[...r]}else this.verticalLines=[],this.horizontalLines=[]}findNearestGridLines({blockCoords:o,step:t,leftBorderX:r}){let i={x:Math.round(o.x),y:Math.round(o.y),width:Math.round(o.width),height:Math.round(o.height)},s=(i.x-r)%t,a=(i.x-r+i.width)%t,l=i.y%t,m=(i.y+i.height)%t;if(this.removeLines("baseline"),this.removeLines("guideline"),this.removeLines("gridLine"),this.maxStepForHardGridSnapping>t){let c=Math.min(a,t-a)<Math.min(s,t-s)?a:s,p=Math.min(l,t-l)<Math.min(m,t-m)?l:m,u=c<t-c?-c:t-c,d=p<t-p?-p:t-p;this.setNearestVerticalLine({x:Math.round(i.x+u),lineType:"gridLine",delta:c,isVerticalSnapping:!0}),this.setNearestHorizontalLine({y:Math.round(i.y+d),lineType:"gridLine",delta:p,isHorizontalSnapping:!0})}else{let c=s,p=t-s,u=a,d=t-a,g=l,h=t-l,b=m,x=t-m,y=c<p?-c:p,S=u<d?-u:d,k=g<h?-g:h,P=b<x?-b:x,C=Math.abs(y)<Math.abs(S)?y:S,B=Math.abs(k)<Math.abs(P)?k:P;Math.abs(C)<this.minStickingDistance&&this.setNearestVerticalLine({x:i.x+C,lineType:"gridLine",delta:Math.abs(C),isVerticalSnapping:!0}),Math.abs(B)<this.minStickingDistance&&this.setNearestHorizontalLine({y:i.y+B,lineType:"gridLine",delta:Math.abs(B),isHorizontalSnapping:!0})}}findNearestGuidelines({guidelines:o,blockCoords:t}){this.removeLines("gridLine"),this.removeLines("guideline"),o.forEach(r=>{let i=Math.abs(r-t.x),s=Math.abs(r-t.x-t.width);i<this.minStickingDistance&&this.setNearestVerticalLine({x:r,lineType:"guideline",delta:i,isLeftSnapping:!0}),s<this.minStickingDistance&&this.setNearestVerticalLine({x:r,lineType:"guideline",delta:s,isRightSnapping:!0})})}findNearestBaselines({baselines:o,blockCoords:t}){this.removeLines("gridLine"),this.removeLines("baseline"),o.forEach(r=>{let i=Math.abs(r.y-t.y),s=Math.abs(r.y-t.y-t.height);i<this.minStickingDistance&&this.setNearestHorizontalLine({y:r.y,lineType:"baseline",delta:i,isTopSnapping:!0}),s<this.minStickingDistance&&this.setNearestHorizontalLine({y:r.y,lineType:"baseline",delta:s,isBottomSnapping:!0})})}findNearestWidgetLines({widgetLines:o,blockCoords:t,movingFixeds:r}){this.removeLines("widgetLine");let[i,s]=_a(r[0]);o.forEach(a=>{let l=a.block&&a.block.model.get("fixed_position")||"",[m,c]=_a(l);switch(a.type){case"left":case"right":{if(m!==i)break;let p=Math.abs(a.x-t.x),u=Math.abs(a.x-t.x-t.width);p<this.minStickingDistance&&this.setNearestVerticalLine({x:a.x,lineType:"widgetLine",delta:p,isLeftSnapping:!0}),u<this.minStickingDistance&&this.setNearestVerticalLine({x:a.x,lineType:"widgetLine",delta:u,isRightSnapping:!0});break}case"top":case"bottom":{if(c!==s)break;let p=Math.abs(a.y-t.y),u=Math.abs(a.y-t.y-t.height);p<this.minStickingDistance&&this.setNearestHorizontalLine({y:a.y,lineType:"widgetLine",delta:p,isTopSnapping:!0}),u<this.minStickingDistance&&this.setNearestHorizontalLine({y:a.y,lineType:"widgetLine",delta:u,isBottomSnapping:!0});break}case"center":{if(m!==i)break;let p=Math.abs(a.x-t.x-Math.floor(t.width/2));p<this.minStickingDistance&&this.setNearestVerticalLine({x:a.x,lineType:"widgetLine",delta:p,isCenterSnapping:!0});break}case"middle":{if(c!==s)break;let p=Math.abs(a.y-t.y-Math.floor(t.height/2));p<this.minStickingDistance&&this.setNearestHorizontalLine({y:a.y,lineType:"widgetLine",delta:p,isMiddleSnapping:!0});break}}a.toggleOpacity(0)})}getLineForVerticalSnapping(o){let t=[...this.verticalLines];return t.sort((r,i)=>r.delta-i.delta),t.length>0?{...t[0]}:{...o}}getLineForHorizontalSnapping(o){let t=[...this.horizontalLines];return t.sort((r,i)=>r.delta-i.delta),t.length>0?{...t[0]}:{...o}}snapToLine({blockCoords:o,gridActivated:t,guidesActivated:r}){t||this.removeLines("gridLine"),r||(this.removeLines("guideline"),this.removeLines("baseline"));let i=o?.fixed_position&&o.fixed_position.length>0,s={x:i?o.x:Math.round(o.x),y:i?o.y:Math.round(o.y),width:i?o.width:Math.round(o.width),height:i?o.height:Math.round(o.height)},a={x:s.x,y:s.y},l={...a},m=this.getLineForVerticalSnapping(a),c=this.getLineForHorizontalSnapping(a);return m.isRightSnapping?l.x=m.x-s.width:m.isLeftSnapping?l.x=m.x:m.isCenterSnapping&&(l.x=m.x-Math.ceil(s.width/2)),c.isBottomSnapping?l.y=c.y-s.height:c.isTopSnapping?l.y=c.y:c.isMiddleSnapping&&(l.y=c.y-Math.ceil(s.height/2)),m.isVerticalSnapping&&(l.x=m.x),c.isHorizontalSnapping&&(l.y=c.y),{x:i?l.x:Math.round(l.x),y:i?l.y:Math.round(l.y)}}};na();var ew=({deltaCorrectedX:e,deltaCorrectedY:o})=>{let t={right:!1,left:!1,top:!1,bottom:!1};return Math.abs(e)>Math.abs(o)?e<0?t.left=!0:e>0&&(t.right=!0):Math.abs(e)<Math.abs(o)&&(o<0?t.top=!0:o>0&&(t.bottom=!0)),t};function tw({step:e,leftBorderX:o,direction:t,correctedBox:r,originalBox:i,isSidePointProportional:s,fromCenter:a}){let l={...i},m=Math.round(o);function c({source:p,step:u}){let d=p%u;return d<u-d?-d:u-d}switch(t){case"n":{let p=c({source:r.top,step:e}),u=(r.height-p)/i.height,d=i.width/2-i.width*u/2;a?(l.height=r.height-p*2,l.top=r.top+p):(l.height=r.height-p,l.top=r.top+p),s&&!a&&(l.left=i.left+d);break}case"s":{let p=r.top+r.height,u=c({source:p,step:e}),d=(r.height+u)/i.height,g=i.width/2-i.width*d/2;a?(l.top=r.top-u,l.height=r.height+u*2):l.height=r.height+u,s&&!a&&(l.left=i.left+g);break}case"w":{let p=r.left-m,u=c({source:p,step:e}),d=(r.width-u)/i.width,g=i.height/2-i.height*d/2;a?(l.width=r.width-u*2,l.left=r.left+u):(l.width=r.width-u,l.left=r.left+u),s&&!a&&(l.top=i.top+g);break}case"e":{let p=r.left+r.width-m,u=c({source:p,step:e}),d=(r.width+u)/i.width,g=i.height/2-i.height*d/2;a?(l.left=r.left-u,l.width=r.width+u*2):l.width=r.width+u,s&&!a&&(l.top=i.top+g);break}case"nw":{let p=r.top,u=r.left-m,d=c({source:p,step:e}),g=c({source:u,step:e});a?(l.top=r.top+d,l.height=r.height-d*2,l.left=r.left+g,l.width=r.width-g*2):(l.top=r.top+d,l.height=r.height-d,l.left=r.left+g,l.width=r.width-g)}break;case"se":{let p=r.top+r.height,u=r.left+r.width-m,d=c({source:p,step:e}),g=c({source:u,step:e});a?(l.top=r.top-d,l.height=r.height+d*2,l.left=r.left-g,l.width=r.width+g*2):(l.height=r.height+d,l.width=r.width+g)}break;case"ne":{let p=r.top,u=r.left+r.width-m,d=c({source:p,step:e}),g=c({source:u,step:e});a?(l.top=r.top+d,l.height=r.height-d*2,l.left=r.left-g,l.width=r.width+g*2):(l.top=r.top+d,l.height=r.height-d,l.width=r.width+g);break}case"sw":{let p=r.top+r.height,u=r.left-m,d=c({source:p,step:e}),g=c({source:u,step:e});a?(l.top=r.top-d,l.height=r.height+d*2,l.left=r.left+g,l.width=r.width-g*2):(l.height=r.height+d,l.left=r.left+g,l.width=r.width-g);break}}return l.left=Math.ceil(parseFloat(l.left.toFixed(2))),l.top=Math.ceil(parseFloat(l.top.toFixed(2))),l.width=Math.floor(parseFloat(l.width.toFixed(2))),l.height=Math.floor(parseFloat(l.height.toFixed(2))),l}function Id({sticky:e,verticalLines:o,horizontalLines:t,leftBorderX:r,direction:i,correctedBox:s,originalBox:a,isSidePointProportional:l,fromCenter:m}){let c=m?2:1,p={left:Math.floor(parseFloat(s.left.toFixed(2))),top:Math.floor(parseFloat(s.top.toFixed(2))),width:Math.ceil(parseFloat(s.width.toFixed(2))),height:Math.ceil(parseFloat(s.height.toFixed(2)))},u={...a},d=o.find(h=>["nw","w","sw"].includes(i)&&Math.abs(h-s.left)<e||["ne","e","se"].includes(i)&&Math.abs(h-(s.left+s.width))<e)||null,g=t.find(h=>["nw","n","ne"].includes(i)&&Math.abs(h-s.top)<e||["sw","s","se"].includes(i)&&Math.abs(h-(s.top+s.height))<e)||null;switch(i){case"w":{if(d){let b=a.left-r-(d-r);if(u.left=d,u.width=a.width+b*c,l&&!m){let x=u.width/a.width,y=a.height/2-a.height*x/2;u.top=a.top+y,u.height=a.height+y}}else u={...p};break}case"e":{if(d){let h=a.left+a.width,b=d-r-(h-r);if(u.left=m?a.left-b:a.left,u.width=a.width+b*c,l&&!m){let x=u.width/a.width,y=a.height/2-a.height*x/2;u.top=a.top+y,u.height=a.height+y}}else u={...p};break}case"n":{if(g){let h=a.top,b=g-h;if(u.top=g,u.height=a.height-b*c,l&&!m){let x=u.height/a.height,y=a.width/2-a.width*x/2;u.left=a.left+y,u.width=a.width+y}}else u={...p};break}case"s":{if(g){let h=a.top+a.height,b=g-h;if(u.top=m?a.top-b:a.top,u.height=a.height+b*c,l&&!m){let x=u.height/a.height,y=a.width/2-a.width*x/2;u.left=a.left+y,u.width=a.width+y}}else u={...p};break}case"nw":{if(g||d){let h=a.left,b=a.top,x=g?g-b:0,y=d?h-r-(d-r):0,S=(a.width+y)/a.width,k=(a.height-x)/a.height,P=a.width-a.width*k,C=a.height*S-a.height;u.left=d||p.left,u.width=d?a.width+y*c:p.width,l&&!d&&(u.left=a.left+P,u.width=a.width-P*c),u.top=g||p.top,u.height=g?a.height-x*c:p.height,l&&!g&&(u.top=a.top-C,u.height=a.height+C*c)}else u={...p};break}case"sw":{if(g||d){let h=a.left,b=a.top+a.height,x=g?g-b:0,y=d?h-r-(d-r):0,S=(a.width+y)/a.width,k=(a.height+x)/a.height,P=a.width-a.width*k,C=a.height-a.height*S;u.left=d||p.left,u.width=d?a.width+y*c:p.width,l&&!d&&(u.left=a.left+P,u.width=a.width-P*c),u.top=g?m?a.top-x:a.top:p.top,u.height=g?a.height+x*c:p.height,l&&!g&&(u.height=a.height-C*c,m?u.top=a.top+C:u.top=a.top)}else u={...p};break}case"ne":{if(g||d){let h=a.left+a.width,b=a.top,x=g?g-b:0,y=d?d-r-(h-r):0,S=(a.width+y)/a.width,k=(a.height-x)/a.height,P=a.width*k;-a.width;let C=a.height*S-a.height;u.left=d?m?a.left-y:a.left:p.left,u.width=d?a.width+y*c:p.width,l&&!d&&(u.width=a.width-P*c,m?u.left=a.left+P:u.left=a.left),u.top=g||p.top,u.height=g?a.height-x*c:p.height,l&&!g&&(u.top=a.top-C,u.height=a.height+C*c)}else u={...p};break}case"se":{if(g||d){let h=a.left+a.width,b=a.top+a.height,x=g?g-b:0,y=d?d-r-(h-r):0,S=(a.height-x)/a.height,k=a.width*S,P=(a.width+y)/a.width,C=a.height-a.height*P;u.left=d?m?a.left-y:a.left:p.left,u.width=d?a.width+y*c:p.width,l&&!d&&(u.width=a.width-k*c,m?u.left=a.left+k:u.left=a.left),u.top=g?m?a.top-x:a.top:p.top,u.height=g?a.height+x*c:p.height,l&&!g&&(u.height=a.height-C*c,m?u.top=a.top+C:u.top=a.top)}else u={...p};break}}return{left:Math.ceil(u.left),top:Math.ceil(u.top),width:Math.floor(u.width),height:Math.floor(u.height)}}var W_=Ca.default.View.extend({initialize:function(e){Ke.default.bindAll(this),Ke.default.extend(this,e),this.created=!1,this.setElement((0,Pi.default)("#gg")),this.distance=new kn((0,Pi.default)("#gg"))},create:function(){if(!je.isPermissionAllowed("GridsAndGuidesCanUse"))return;this.snap=this.mag.edit_params.get("snap"),this.expand=this.mag.edit_params.get("expand"),this.workspace=RM.constructorRouter.workspace,this.updateDims();let e=new Yb(null,{mag:this.mag}),o=new bp({minStickingDistance:8,maxStepForHardGridSnapping:40});this.snapController=o,this.grid=new U_({el:this.$(".grid"),controller:this,enabled:this.mag.edit_params.get("grid"),snapController:o,models:e}),this.widget_lines=new G_({el:this.$(".lines"),controller:this,snapController:o}),this.guides=new iw({$guides:this.$(".guides"),$baselines:this.$(".baselines"),controller:this,snapController:o,enabled:this.mag.edit_params.get("guides"),models:e}),this.guides.hidden=!this.mag.edit_params.get("guides"),this.grid.hidden=!this.mag.edit_params.get("grid"),this.mag.edit_params.on("change:expand",this.onExpandChange),this.mag.edit_params.on("change:snap",this.onSnapChange),this.mag.edit_params.on("change:guides",this.guides.toggle),this.mag.edit_params.on("change:grid",this.grid.toggle),this.listenTo(this.mag,"change:desktopWidth",this.guides.renderColumns),this.listenTo(this.mag,"change:phoneWidth",this.guides.renderColumns),this.listenTo(this.mag,"change:tabletWidth",this.guides.renderColumns),this.onPageChange(this.workspace),this.router.on("pageChange",this.onPageChange),this.router.on("changeViewport",this.onViewportChange),(0,Pi.default)(window).on("resize",this.onResize),this.trigger("create"),this.created=!0},destroy(){this.stopListening(this.mag)},onResize:function(){this.updateDims(),this.guides.render.__debounced()},onViewportChange:function(){this.updateDims(),this.guides.changeViewport(),this.grid.changeViewport()},switchOn:function(e){let o=["guides","grid"];if(o.includes(e)){let t=o.filter(r=>r!==e);this.mag.edit_params.save(e,!0),t.forEach(r=>{this.mag.edit_params.save(r,!1)})}},onPageChange:function(e){if(!e){this.$el.detach();return}this.$el.appendTo(e.$el),this.workspace&&this.stopListening(this.workspace),this.workspace=e,this.listenTo(this.workspace,"workspace-resize",this.updateDims),this.updateDims(),setTimeout(Ke.default.bind(function(){this.updateDims(),this.guides.render()},this),450)},updateDims:function(){let e=this.mag.getViewportWidth(this.workspace.viewport),o=this.workspace.page.getViewportParam(this.workspace.viewport,"height"),t=this.workspace.viewport;if(this.$el.hide(),this.expand&&t=="default"){let i=this.workspace.$container.width()-this.workspace.$container[0].clientWidth,s=(0,Pi.default)("#main").width(),a=(0,Pi.default)("#main").height();this.dims={width:Math.max(s-i,e),height:Math.max(a,o),left:Math.min(Math.floor((e-s)/2),0),top:Math.min(Math.floor((o-a)/2),0)},this.workspace.$el.addClass("hide-border")}else this.dims={width:e,height:o,left:0,top:0},this.workspace.$el.removeClass("hide-border");this.$el.show();let r=RM.constructorRouter.zoom.getZoom();this.$el.css(Ke.default.mapObject(this.dims,i=>i*r)),this.mag.edit_params.get("guides")&&this.guides?this.guides.render():this.guides&&(this.guides.rendered=!1)},handleMoveStart:function(e,o){this._movingBlocks=e,this._duplicateMode=o;let t=!this.grid.hidden,r=!this.guides.hidden;this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:o,gridActivated:t,guidesActivated:r})},handleMoveEnd:function(){this.widget_lines.hideLines()},onSnapChange:function(){this.snap=this.mag.edit_params.get("snap")},onExpandChange:function(){this.expand=this.mag.edit_params.get("expand"),this.updateDims(),this.guides.render()},hideLinesWithDelay:function(){this._hideLinesTimeout&&clearTimeout(this._hideLinesTimeout),this._hideLinesTimeout=setTimeout(()=>{this.widget_lines.hideLines(),this.workspace.distance.hide()},1e3)},handleSnapMove:function({position:e,width:o,height:t,duplicateMode:r,fromKeyboard:i,workspacePosition:s,prevBlockPostion:a}){let l=e.fixeds&&e.fixeds.length>0,m=this.workspace.mag.edit_params.get("sizes"),c=!this.grid.hidden,p=!this.guides.hidden,u=this.workspace.viewport;i&&(this._movingBlocks=this.workspace.getSelectedBlocks()),this._duplicateMode!==r?(this._duplicateMode=r,this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:r,gridActivated:c,guidesActivated:p})):i&&this.widget_lines.loadLines({blocks:this.workspace.getActiveBlocks(),moving_blocks:this._movingBlocks,duplicateMode:r,gridActivated:c,guidesActivated:p});let d=Ke.default.chain(this._movingBlocks).map(x=>x.model.get("fixed_position")||"").uniq().value();if(d.length>1)return{x:0,y:0};this.widget_lines.findDataForSnapping({position:{x:e.x,y:e.y},width:o,height:t,movingFixeds:d}),p&&!i?this.guides.findDataForSnapping({position:e,width:o,height:t}):c&&!i&&this.grid.findDataForSnapping({position:e,width:o,height:t});let g=this.snapController.snapToLine({blockCoords:{x:e.x,y:e.y,width:o,height:t,fixed_position:e.fixeds},gridActivated:c,guidesActivated:p}),h=ew({deltaCorrectedX:e.x-a.x,deltaCorrectedY:e.y-a.y}),{sizeLines:b}=this.widget_lines.showSnapLines({corrected:i?{...e}:g,width:o,height:t,direction:h,fromKeyboard:i});return m&&RM.constructorRouter.workspace.distance.updateForRect({bb_top:e.y,bb_left:e.x,bb_width:o,bb_height:t,fixed:e.fixeds[0]},b,g,i,{...s,viewport:u}),{x:l?g.x-e.x:Math.round(g.x)-e.x,y:l?g.y-e.y:Math.round(g.y)-e.y}},handleSnapResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){if(!this.snap)return o;let s=Ke.default.clone(e),a=this.guides.model&&!this.guides.model.get("baseline_height")&&!this.guides.model.get("columns");return!this.guides.hidden&&!a?s=this.guides.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}):this.grid.hidden?s=this.widget_lines.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}):s=this.grid.stickOnResize({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}),s}}),rw=Ca.default.View.extend({created:!1,controller:void 0,model:void 0,initialize:function(e){this.controller=e.controller,this.models=e.models},getModelUrl:function(){return this.models.url+this.controller.router.workspace.viewport},create:function(e){this.created=!0,this.models.off("change",null,this),this.models.fetch({url:this.getModelUrl(),success:()=>{this.loadModel(),RM.constructorRouter.on("pageChange",this.loadModel),RM.constructorRouter.on("updateWorkspaceViewport",this.render),e&&this.show()}})},changeViewport:function(){let e=this.controller.router.workspace.page;this.model=this.models.getByPage(e);let o=this;!this.model||this.model.get("viewport")!==e.getCurrentViewport()?this.models.fetch({remove:!1,url:this.models.url+this.controller.router.workspace.viewport,success:function(){o.loadModel()}}):this.loadModel()},loadModel:function(e){if(e=e||this.controller.router.workspace,!this.controller.router)return;let o=this.model&&this.model.id;this.model=this.models.getByPage(e.page),this.model&&(this.model.id!=o&&(this.models.trigger("reload"),this.updateModel&&this.updateModel(this.model)),this.trigger("modelLoaded"),this.render())},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$el.fadeIn("fast"),this.hidden=!1}}),U_=rw.extend({step:8,count:8,hidden:!0,initialize:function(e){Ke.default.bindAll(this),Ke.default.extend(this,e),this.models=e.models,this.controller.mag.edit_params.on("change:grid_step",this.onGridChanged),this.controller.mag.edit_params.on("change:grid_count",this.onGridChanged),this.listenTo(this.controller.router.workspace,"workspace-resize",this.render),e.enabled?this.show():this.created||this.create(!1)},updateModel:function(e){this.model&&(this.model.off("change:grid_step",this.onGridChanged),this.model.off("change:grid_count",this.onGridChanged)),this.model=e,this.model.on("change:grid_step",this.onGridChanged),this.model.on("change:grid_count",this.onGridChanged),this.step=this.model.get("grid_step")||8,this.count=this.model.get("grid_count")||8,this.render()},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$el.fadeIn("fast"),this.hidden=!1},hide:function(){this.$el.fadeOut("fast"),this.hidden=!0},toggle:function(){this.controller.mag.edit_params.get("grid")?this.show():this.hide()},generateGridSVG:function(){let e=[],o=this.step*this.count,t="rgba(128, 128, 128, 1)",r="rgba(128, 128, 128, 0.4)",i=1/(window.devicePixelRatio||1)/RM.constructorRouter.zoom.getZoom();for(let s=1;s<this.count;s++)e.push('<rect width="'+i+'" height="'+o+'" x="'+s*this.step+'" y="0" style="fill:'+r+'"></rect>'),e.push('<rect height="'+i+'" width="'+o+'" y="'+s*this.step+'" x="0" style="fill:'+r+'"></rect>');return btoa('<?xml version="1.0" encoding="UTF-8"?><svg width="'+o+'px" height="'+o+'px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Line">'+e.join("")+'<rect width="'+i+'" height="'+o+'" x="0" y="0" style="fill:'+t+'"></rect><rect height="'+i+'" width="'+o+'" y="0" x="0" style="fill:'+t+'"></rect></g></svg>')},onGridChanged:function(){this.step=this.model.get("grid_step")||8,this.count=this.model.get("grid_count")||8,this.hidden&&this.controller.switchOn("grid"),this.render()},render:function(){let e=RM.constructorRouter.zoom.getZoom();this.$el.css({"background-size":this.step*this.count*e+"px "+this.step*this.count*e+"px","background-image":'url("data:image/svg+xml;base64,'+this.generateGridSVG()+'")'})},findDataForSnapping:function({position:e,width:o,height:t}){let r=this.controller.workspace.viewport,i=this.controller.mag.getViewportWidth(r),s=Pe.dictionary[r].width,a=0-Math.abs((i-s)/2),l={x:e.x,y:e.y,width:o,height:t};this.snapController.findNearestGridLines({blockCoords:l,step:this.step,leftBorderX:a})},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let s=this.controller.workspace.viewport,a=this.controller.mag.getViewportWidth(s),l=Pe.dictionary[s].width,m=0-Math.abs((a-l)/2),c={...e},p=this.step,u=tw({step:p,leftBorderX:m,originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i});return c={...c,...u},c}}),G_=Ca.default.View.extend({sticky:8,near:12,initialize:function(e){Ke.default.bindAll(this),Ke.default.extend(this,e),this.controller.mag.edit_params.on("change:snap",this.onSnapChange)},findDataForSnapping({position:e,width:o,height:t,movingFixeds:r}){this.snapController.findNearestWidgetLines({widgetLines:this.lines,blockCoords:{...e,width:o,height:t},movingFixeds:r})},showSnapLines({corrected:e,width:o,height:t,direction:r,fromKeyboard:i}){let s=[],a=Ke.default.uniq(this._movingBlocks?.map(l=>l.model.get("fixed_position")||""));return a.length===1&&this.getClosestLines({x:e.x,y:e.y,width:o,height:t},this.lines?.filter(m=>this.shouldSnapOnMove(a[0],m)),this.sticky).forEach(m=>{let c=!1;if(i){let p=m.blockBox;if(p){let u=e.x>p.bb_left+p.bb_width,d=p.bb_left>e.x+o,g=e.y>p.bb_top+p.bb_height,h=p.bb_top>e.y+t,b=e.y<=p.bb_top&&e.y+t>=p.bb_top||e.y>=p.bb_top&&e.y+t<=p.bb_top+p.bb_height||e.y<=p.bb_top+p.bb_height&&e.y+t>=p.bb_top+p.bb_height,x=e.x<=p.bb_left&&e.x+o>=p.bb_left||e.x>=p.bb_left&&e.x+o<=p.bb_left+p.bb_width||e.x<=p.bb_left+p.bb_width&&e.x+o>=p.bb_left+p.bb_width,y=Math.min(Math.abs(e.y-p.bb_top),Math.abs(e.y-(p.bb_top+p.bb_height))),S=Math.min(Math.abs(e.y+t-(p.bb_top+p.bb_height)),Math.abs(e.y+t-p.bb_top)),k=Math.min(Math.abs(e.x-p.bb_left),Math.abs(e.x-(p.bb_left+p.bb_width))),P=Math.min(Math.abs(e.x+o-(p.bb_left+p.bb_width)),Math.abs(e.x+o-p.bb_left)),C=(u||d)&&(y<=this.sticky||S<=this.sticky),B=(h||g)&&(k<=this.sticky||P<=this.sticky);(u||B||x)&&r.left?(s.push(m),c=!0):((d||B||x)&&r.right||(g||C||b)&&r.top||(h||C||b)&&r.bottom)&&(c=!0,s.push(m))}else c=!0,s.push(m)}else c=!0,s.push(m);c&&(m.opacity=1,m.calculateDimensions({x:e.x,y:e.y,width:o,height:t,fixed:a[0]}),m.render())}),{sizeLines:s}},getClosestLines(e,o=[],t){let r=y=>Math.abs(e.y-y.y),i=y=>Math.abs(e.y+e.height-y.y),s=y=>Math.abs(e.y+Math.floor(e.height/2)-y.y),a=y=>Math.abs(e.x-y.x),l=y=>Math.abs(e.x+e.width-y.x),m=y=>Math.abs(e.x+Math.floor(e.width/2)-y.x),c=o.filter(y=>["left","right"].includes(y.type)),p=o.filter(y=>["top","bottom"].includes(y.type)),u=Ke.default.min(p,r),d=Ke.default.min(p,i),g=Ke.default.min(o.filter(y=>y.type==="middle"),s),h=Ke.default.min(c,a),b=Ke.default.min(c,l),x=Ke.default.min(o.filter(y=>y.type==="center"),m);return Ke.default.compact([u&&r(u)<=t?u:void 0,d&&i(d)<=t?d:void 0,g&&s(g)<=t?g:void 0,h&&a(h)<=t?h:void 0,b&&l(b)<=t?b:void 0,x&&m(x)<=t?x:void 0])},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let s=this.sticky,a=this.lines,l=this.controller.workspace.viewport,m=this.controller.mag.getViewportWidth(l),c=Pe.dictionary[l].width,p=0-Math.abs((m-c)/2),u={x:null,delta:1/0},d={y:null,delta:1/0};a?.forEach(b=>{b.toggleOpacity(0);let x=Math.abs(b.y-o.top),y=Math.abs(b.y-o.top-o.height),S=Math.abs(b.x-o.left),k=Math.abs(b.x-o.left-o.width);S<s&&["w","sw","nw"].includes(t)&&["left","right"].includes(b.type)?S<u.delta&&(u.delta=S,u.x=b.x):k<s&&["e","se","ne"].includes(t)&&["left","right"].includes(b.type)&&k<u.delta&&(u.delta=k,u.x=b.x),x<s&&["n","ne","nw"].includes(t)&&["top","bottom"].includes(b.type)?x<d.delta&&(d.delta=x,d.y=b.y):y<s&&["s","se","sw"].includes(t)&&["top","bottom"].includes(b.type)&&y<d.delta&&(d.delta=y,d.y=b.y)});let g=Id({sticky:s,verticalLines:[u.x],horizontalLines:[d.y],leftBorderX:p,direction:t,correctedBox:o,originalBox:e,isSidePointProportional:r,fromCenter:i});return this.getClosestLines({x:g.left,y:g.top,width:g.width,height:g.height},this.lines?.filter(b=>this.shouldSnapOnResize(b,t)),this.sticky).forEach(b=>{b.opacity=1,b.calculateDimensions({x:g.left,y:g.top,width:g.width,height:g.height}),b.render()}),g},loadLines:function({blocks:e,moving_blocks:o,duplicateMode:t,gridActivated:r,guidesActivated:i}){this.moving_ids=Ke.default.pluck(o,"id"),this._movingBlocks=o;let s=this.controller.router.workspace.getViewportPosition(),a=this.controller.router.workspace.viewport,l=Pe.dictionary[a].width,m=this.controller.router.workspace.mag.getViewportWidth(a),c=RM.constructorRouter.zoom.getZoom();this.hideLines(),this.lines=(0,Ke.default)(e).chain().filter(g=>{if(!t&&Ke.default.contains(this.moving_ids,g.id))return!1;if(g.model.get("fixed_position"))return!0;let h=g.latestPosSizeAngle;return(h.bb_top+h.bb_height)*c>s.top*c&&h.bb_top*c<s.top*c+window.innerHeight&&(h.bb_left+h.bb_width-(l-m)/2)*c>s.left*c&&(h.bb_left-(l-m)/2)*c<s.left*c+window.innerWidth}).map(g=>{let h=[],b=g.latestPosSizeAngle,x=g.model.get("fixed_position");if(x){let y=this.controller.workspace.viewport,S=this.controller.workspace.$container[0],k=RM.constructorRouter.zoom.getZoom(),{x:P,y:C}=Kg({boxCoordinates:{x:b.bb_left||b.left,y:b.bb_top||b.top,w:b.width,h:b.height,fixed_position:x},scroller:{scrollTop:S.scrollTop,scrollLeft:S.scrollLeft},workspaceBox:{left:s.left,top:s.top,width:s.width,height:s.pageHeight},windowSize:{width:s.viewportWidth,height:s.height},viewportType:y,zoom:k});b={...b,bb_left:P,bb_top:C,fixed:x}}return g.model.get("type")==="background"?h:(h.push(this.newLine({x:b.bb_left,type:"left",block:g,blockBox:b})),h.push(this.newLine({x:b.bb_left+b.bb_width,type:"right",block:g,blockBox:b})),h.push(this.newLine({x:b.bb_left+Math.floor(b.bb_width/2),type:"center",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top,type:"top",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top+b.bb_height,type:"bottom",block:g,blockBox:b})),h.push(this.newLine({y:b.bb_top+Math.floor(b.bb_height/2),type:"middle",block:g,blockBox:b})),Ke.default.compact(h))}).flatten().value();let p=this.controller.dims;this.lines.push(this.newLine({hidden:!0,x:p.left,type:"left"})),this.lines.push(this.newLine({hidden:!0,x:p.left+p.width,type:"right"})),this.lines.push(this.newLine({hidden:!0,y:p.top,type:"top"})),this.lines.push(this.newLine({hidden:!0,y:p.top+p.height,type:"bottom"})),!r&&!i&&["center","left","right"].forEach(g=>{this.lines.push(this.newLine({x:l/2,type:g}))});let{top:u}=xt.mapFromViewportToElement({top:window.innerHeight/2,left:0},this.controller.workspace.$origin.get(0),1,c);!r&&!i&&["middle","top","bottom"].forEach(g=>{this.lines.push(this.newLine({y:u,type:g}))}),this.lines=Ke.default.compact(this.lines);let d=document.createDocumentFragment();this.lines?.forEach(g=>{let h=g.render();h&&d.appendChild(h[0])}),this.$el.append(d)},newLine:function(e){return new wp(Ke.default.extend(e,{$container:this.$el,controller:this.controller}))},onSnapChange:function(){this.controller.mag.edit_params.get("snap")||this.hideLines()},hideLines:function(){Ke.default.each(this.lines,function(e){e.remove()}),this.lines=[]},shouldSnapOnMove(e,o){let t=_a(e),r=_a(o.block?.model.get("fixed_position")),i=["left","right","center"].includes(o.type)&&t[0]===r[0],s=["top","bottom","middle"].includes(o.type)&&t[1]===r[1];return i||s},shouldSnapOnResize(e,o){let t=["left","right","center"].includes(e.type)&&["s","n"].includes(o),r=["top","bottom","middle"].includes(e.type)&&["e","w"].includes(o);return!t&&!r}}),wp=Ca.default.View.extend({type:"",x:void 0,y:void 0,length:void 0,opacity:0,block:void 0,blockBox:void 0,initialize:function(e){Ke.default.bindAll(this),Ke.default.extend(this,e),this.x&&delete this.y,this.y&&delete this.x,this._opacities={}},toggle:function(e,o){let t=this.getOpacity(e,o);return this.toggleOpacity(t),t>0},toggleOpacity(e){this.opacity!==e&&(this.opacity=e,this.draw(this.opacity))},getOpacity:function(e,o){return e<o?o/2>e?1:(o-e)/(o/2):0},calculateDimensions(e){let o=this.blockBox,t={top:e.y,left:e.x,bottom:e.y+e.height,right:e.x+e.width},r=this.length||0,i={x:null,y:null};if(o&&["left","right","center"].includes(this.type)){let s={top:o.bb_top,bottom:o.bb_top+o.bb_height};t.bottom<=s.top?(i.y=t.top,r=s.bottom-t.top):t.top<=s.top&&t.bottom>s.top?(i.y=t.top,r=Math.max(s.bottom,t.bottom)-t.top):t.top>s.top&&t.bottom<=s.bottom?(i.y=s.top,r=s.bottom-s.top):(t.bottom>s.bottom&&t.top<=s.bottom||t.top>s.bottom)&&(i.y=s.top,r=t.bottom-s.top)}else if(o&&["top","bottom","middle"].includes(this.type)){let s={left:o.bb_left,right:o.bb_left+o.bb_width};t.right<=s.left?(i.x=t.left,r=s.right-t.left):t.left<=s.left&&t.right>s.left?(i.x=t.left,r=Math.max(s.right,t.right)-t.left):t.right<=s.right&&t.left>s.left?(i.x=s.left,r=s.right-s.left):(t.right>s.right&&t.left<=s.right||t.left>s.right)&&(i.x=s.left,r=t.right-s.left)}this.x=i.x?i?.x:this.x,this.y=i.y?i?.y:this.y,this.length=Math.abs(r)},show:function(){this.draw(1)},draw:function(e){this.$el.css({opacity:e})},drawByWidget:function(e,o,t){this._opacities[e]=this.getOpacity(o,t);let r=Ke.default.reduce(this._opacities,function(i,s){return Math.max(i,s)},0);this.draw(r)},remove:function(){this.rendered=!1,this.$el&&this.$el.remove()},render:function(){let e=!this.rendered;if(this.rendered=!0,this.hidden)return;e&&this.setElement((0,Pi.default)("<div></div>").addClass(this.type));let o=RM.constructorRouter.zoom.getZoom(),{dictionary:t}=Pe,r=t[this.controller.workspace.viewport].width,i={left:(this.x-this.controller.dims.left+Math.abs(r-this.controller.dims.width)/2)*o,top:(this.y-this.controller.dims.top)*o,width:["top","bottom","middle"].includes(this.type)&&this.length?this.length*o:void 0,height:["left","right","center"].includes(this.type)&&this.length?this.length*o:void 0};return i.opacity=this.opacity,this.$el.css(i),this.$el}}),ow=wp.extend({initialize:function(e){e.type="baseline",wp.prototype.initialize.call(this,e)},render:function(){let e=this.y-this.controller.dims.top,o=RM.constructorRouter.zoom.getZoom(),t=this.controller.workspace.viewport,r=(0,Pi.default)(qb({maxGuideWidth:Ho.prototype.getViewportSetting("max_width",t)*hp,top:e*o,left:this.margin.left*o||0,right:this.margin.right*o||0,height:this.height*o,pale:this.margin.top>e||this.controller.dims.height-this.margin.bottom<e,fill:!!this.fill}));r.appendTo(this.$container),this.setElement(r)},remove:function(){wp.prototype.remove.apply(this),this.$pale_left&&this.$pale_left.remove(),this.$pale_right&&this.$pale_right.remove(),this.$leftLine&&this.$leftLine.remove(),this.$middleLine&&this.$middleLine.remove(),this.$rightLine&&this.$rightLine.remove()}}),V_=8,iw=rw.extend({sticky:8,hidden:!1,initialize:function(e){Ke.default.bindAll(this),Ke.default.extend(this,e),this.models=e.models,e.enabled&&this.show(),this.render.__debounced=Ke.default.debounce(this.render,100)},create:function(e){this.created=!0;let o=this;o.models.off("change",null,o),this.models.fetch({url:this.getModelUrl(),success:function(){o.loadModel(),o.models.on("change",o.onGuidesChange),o.models.on("change:margin.top",o.onGuidesChange),RM.constructorRouter.on("pageChange",o.loadModel),RM.constructorRouter.on("updateWorkspaceViewport",o.render),e&&o.show()}})},switchOn:function(e){this.hidden&&(e.changed.padding||e.changed.columns||e.changed.margin||e.changed.baseline_height||e.changed.baseline_group)&&this.controller.switchOn("guides")},onGuidesChange:function(e){this.switchOn(e),this.render(),e.changed.pages&&e.changed.pages.indexOf&&e.changed.pages.indexOf(this.controller.router.workspace.page.id)>-1&&this.loadModel()},getColumnWidths:function(e,o,t,r,i,s){if(s)return[...Array(i)].map(()=>s);{let m=e-t-o+r,c=m/i-r,p=Math.floor(c),u=(p+r)*i,d=m-u,g=[];for(var a=0;a<i;a++)g[a]=p;for(var a=0;a<d;a++)g[Math.floor((i-d)/2)+a]=Math.ceil(c);return g}},render:function(e){this.renderColumns(),this.renderBaselines(),this.rendered=!0,e&&e.callback&&e.callback.call()},renderColumns(){if(!this.model)return;let e=this.controller.workspace.viewport,o=RM.constructorRouter.zoom.getZoom(),t=this.controller.mag.getViewportWidth(e),r=Pe.dictionary[e].width,i=this.model.toJSON();i.margin=Ke.default.clone(i.margin),i.columns<=0&&(i.margin={top:0,right:0,bottom:0,left:0}),this.$guides.empty().css({margin:"0 "+Math.round(i.margin.right*o)+"px 0 "+Math.round(i.margin.left*o)+"px",width:t*o-i.margin.right*o-i.margin.left*o+"px"});let s=this.getColumnWidths(t,i.margin.left,i.margin.right,i.padding,i.columns,i.columnWidth);this.$guideColumns=this.template(Ke.default.extend({},i,{zeroGutter:!i.padding,columnWidths:s.map(c=>c*o),offsetTop:i.margin.top*o,offsetBottom:i.margin.bottom*o,maxGuideHeight:Ho.prototype.getViewportSetting("max_height",e)*hp})),this.$guides.html(this.$guideColumns),this.guidelines=[];let a=0-Math.abs(Math.round((t-r)/2)),l=r+Math.abs((t-r)/2),m=a+i.margin.left+this.controller.dims.left;for(let c=0;c<i.columns;c++)m=m+s[c],this.guidelines.push(m),i.padding&&(m+=i.padding,this.guidelines.push(m));Ke.default.each([a,a+i.margin.left,l-i.margin.right,l],function(c){this.guidelines.push(c+this.controller.dims.left)},this)},renderBaselines(){if(!this.model)return;this.$baselines.empty(),this.baselines=[];let e=this.model.toJSON();if(Ke.default.each([0,e.margin.top,this.controller.dims.height-e.margin.bottom+1,this.controller.dims.height],function(o){this.baselines.push(new ow({y:o+this.controller.dims.top,$container:this.$baselines,margin:e.margin}))},this),e.baseline_height>=V_)for(let o=1;o*e.baseline_height<=this.controller.dims.height;o++){let t=new ow({controller:this.controller,y:o*e.baseline_height+this.controller.dims.top,$container:this.$baselines,margin:e.margin,fill:o%e.baseline_group,height:e.baseline_height});t.render(),t.show(),this.baselines.push(t)}},show:function(){if(!this.created)return this.create(!0);this.rendered||this.render(),this.$guides.add(this.$baselines).fadeIn("fast"),this.hidden=!1},hide:function(){this.$guides.add(this.$baselines).fadeOut("fast"),this.hidden=!0},toggle:function(){this.controller.mag.edit_params.get("guides")?(this.show(),RM.constructorRouter.trigger("notice:triggerMetrics","guidesTurnOn")):this.hide()},findDataForSnapping:function({position:e,width:o,height:t}){let r={x:e.x,y:e.y,width:o,height:t};this.snapController.findNearestBaselines({baselines:this.baselines,blockCoords:r}),this.snapController.findNearestGuidelines({guidelines:this.guidelines,blockCoords:r})},stickOnResize:function({originalBox:e,correctedBox:o,direction:t,isSidePointProportional:r,fromCenter:i}){let s=this.controller.workspace.viewport,a=this.controller.mag.getViewportWidth(s),l=Pe.dictionary[s].width,m=this.sticky,c=this.baselines||[],p=this.guidelines||[],u=0-Math.abs((a-l)/2);return Id({sticky:m,verticalLines:p,horizontalLines:c?.map(g=>g.y),leftBorderX:u,direction:t,correctedBox:o,originalBox:e,isSidePointProportional:r,fromCenter:i})}}),_a=e=>(e=e||"",e.length===2?[e[1],e[0]]:e.length===0?["",""]:e==="c"?["c","c"]:["n","s"].includes(e)?["c",e]:[e,"c"]);iw.prototype.template=Vb["template-constructor-grid-guides-controller"];var nw=W_;var ds=T(St()),sw=T(mo()),Sa=T(et());Fr();var Ed={"template-constructor-arrows":Ct`
	<div aria-label="Left navigation arrow" class="navigation-arrow left" style="display: <%= hidden ? 'none' : 'block'%>;"><div class="icon sprite" style="background-image: url('<%=icons.sprite%>')"></div></div>
	<div aria-label="Right navigation arrow" class="navigation-arrow right" style="display: <%= hidden ? 'none' : 'block'%>;"><div class="icon sprite" style="background-image: url('<%=icons.sprite%>')"></div></div>
`,"template-constructor-arrows-color-selector":Ct`
	<div class="arrow-color-selector">
		<div class="color-clip-wrapper">
			<div class="color-wrapper">
				<div class="color white"></div>
				<div class="color black"></div>
			</div>
		</div>
	</div>
`};Wc();ot();var j_=sw.default.View.extend({colorSelectorTemplate:Ed["template-constructor-arrows-color-selector"],className:"constructor-navigation-arrows",events:{"click .navigation-arrow":"go","click .color-clip-wrapper":"toggleArrowsColor"},initialize:function(e){Sa.default.bindAll(this),this.router=e.router,this.router.on("pageChange changePids page-order-change",this.onPageChange),this.render(),this.listenTo(this.router.mag,"change:opts change:viewport_phone_portrait change:viewport_tablet_portrait",()=>{this.render(),this.onPageChange(this.router.workspace)}),this.listenTo(this.router,"changeViewport",this.render)},render:function(){let e=Ed["template-constructor-arrows"],o=this.router.workspace?.viewport||"default",t=o==="phone_portrait"||o==="tablet_portrait"?`viewport_${o}`:void 0,r=t?this.router.mag.get(t)?.opts?.viewertype||this.router.mag.get("opts").viewertype:this.router.mag.get("opts").viewertype;this.$el.toggleClass("is-vertical",r==="vertical"),this.$el.html(e({hidden:this.router.previewMode,icons:{sprite:on(`./common/navigation/sprite${Xu?"@2x":""}.png`)}})),(0,ds.default)("#constructor").prepend(this.$el),(0,Sa.default)(this.$(".navigation-arrow")).each(function(i){(0,ds.default)(i).append(this.colorSelectorTemplate())}.bind(this))},go:function(e){if((0,ds.default)(e.target).closest(".arrow-color-selector").length)return;let o=(0,ds.default)(e.currentTarget).hasClass("left")?"prev":"next";this.router.go(o)},onPageChange:function(e){!e||this.router.previewMode||Sa.default.defer(Sa.default.bind(function(){let o=this.router.isCurrentPageLocked();this.$(".left").toggle(e.page.get("num")!=1).toggleClass("disabled",!!o),this.$(".right").toggle(e.page.get("num")!=this.router.mag.get("pids").length).toggleClass("disabled",!!o),this.updateArrowsColor(e.page.get("arrows_color"))},this))},updateArrowsColor:function(e){e=e||"white",(0,ds.default)("#constructor").removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+e+"-arrows"),this.$(".arrow-color-selector").removeClass("white").removeClass("black").addClass(e)},toggleArrowsColor:function(){let e=this.router.workspace.page,o=this.$(".arrow-color-selector"),t=e.get("arrows_color")||"white",r=t=="white"?"black":"white";o.hasClass("disabled")||(this.$(".arrow-color-selector").addClass("disabled"),this.updateArrowsColor(r),e.save({arrows_color:r},{patch:!0,skipHistory:!0}).success(function(){this.updateArrowsColor(r)}.bind(this)).error(function(){this.updateArrowsColor(t)}.bind(this)).complete(function(){o.removeClass("disabled")}.bind(this)))},destroy(){this.stopListening(this.router.mag,"change:opts",this.render),this.stopListening(this.router,"changeViewport",this.render)}}),aw=j_;var Aw=T(mo()),Nt=T(et());pt();sl();yo();var ww=T(H()),Dd=T(et());tt();nd();ol();og();yo();var Ti=T(H()),lw=T(et());ol();B_();pt();function pw(e,o){return e.reduce((t,r)=>{let i=r[o];return typeof i=="string"&&(t[i]=r),t},{})}function cw(e,o){let t=Wu(o||new Date,e),[r,i]=t.split(" ");if(i==="seconds")return"Now";let a={minutes:"min",hour:"h",day:"d",months:"mo",year:"y"}[i]||i[0];return`${r}${a} ago`}var ms={zoomedBox:8e3,expandedBubble:1e4},dw=(e,o,t=[],r=[])=>{let i=r.map(a=>a.author),s=[o].concat(t).concat(i);return lw.default.unique(s,"_id").filter(a=>!a.isPending&&e._id!==a._id)};async function mw(e,o,t){let r=`${oe.readymag_auth_host}/edit/${e}/${o}/comment/${t}`;await navigator.clipboard.writeText(r)}var uw=gb("resize",()=>({zoom:window.RM.constructorRouter?.zoom?.getZoom()||0}),()=>({zoom:window.RM.constructorRouter?.zoom?.getZoom()||0})),Y_={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function gw(e){let[o,t]=(0,Ti.useState)(Y_),r=(0,Ti.useMemo)(()=>new ResizeObserver(i=>{if(i[0]){let{x:s,y:a,width:l,height:m,top:c,left:p,bottom:u,right:d}=i[0].contentRect;t({x:s,y:a,width:l,height:m,top:c,left:p,bottom:u,right:d})}}),[]);return(0,Ti.useEffect)(()=>{if(e)return r.observe(e),()=>{r.disconnect()}},[e]),o}var xp=(e,o)=>{let[t,r]=(0,Ti.useState)(null);return(0,Ti.useEffect)(()=>{if(e.current&&typeof IntersectionObserver=="function"){let i=a=>{r(a[0])},s=new IntersectionObserver(i,o);return s.observe(e.current),()=>{r(null),s.disconnect()}}},[e.current,o.threshold,o.root,o.rootMargin]),t};var Rd="commentsModeState",Ad="rm:comments-panel:height";var q_={comments:null},$d={viewTree:{},totalNew:0},[Mi,xw]=Wr($d);function vw(e,o){let t={},r=0;return e.forEach(i=>{i.status!=="resolved"&&(i.author._id!==o&&!i.seen.includes(o)?(t[i._id]?t[i._id].isNew=!0:t[i._id]={isNew:!0,newChildren:0},i.parent&&(t[i.parent]?t[i.parent].newChildren+=1:t[i.parent]={isNew:!1,newChildren:1}),r+=1):t[i._id]={isNew:!1,newChildren:0})}),{viewTree:t,totalNew:r}}function X_(){let e=sessionStorage.getItem(Rd);return e?!!parseInt(e):!1}function K_(e){sessionStorage.setItem(Rd,`${e?1:0}`)}var[Xr,kp,Z_]=Wr(null),[Zt,Pa,kw,Ld]=Wr(X_()),hw=!0,[J_,us,Bi]=Wr(q_),[yw,_w,Q_]=Wr("initial");function Hd(e,o){Q_()==="loading"&&_w("loaded");let t=pw(e,"_id"),i={...Bi().comments??{},...t};us({comments:i});let s=Object.values(i||{});xw(vw(s,o)),hw&&(hw=!1,ye.trigger("comments:init"))}function Cw(e){return(Bi().comments??{})[e]}function Od({id:e,frontId:o,comment:t,userId:r}){let i=Bi().comments??{},s=i[e]??{},a={...i,[e]:{...s,...t}};if(o&&a[o]){delete a[o];let m=Z_();if(m){let c={...m.comment};c.isTmp&&c._id===o&&(c._id=e,kp({...m,comment:c}))}}us({comments:a});let l=Object.values(a||{});xw(vw(l,r))}function yp({parentCommentId:e,childCommentId:o}){let t=Bi().comments??{},r={...t};if(e&&o){let i={...t[e]};i.children=i?.children??[],i.children=i.children.filter(s=>s._id!==o),delete r[o],r={...r,[e]:i}}else e&&!o&&delete r[e];us({comments:r})}function eC(e,o){return{...o,_id:e,projectId:window.RM.constructorRouter.mag.get("_id"),seen:[],status:"unresolved",author:{email:window.RM.constructorRouter.me?.attributes.email||"",name:window.RM.constructorRouter.me?.attributes.name||"",num_id:Number(window.RM.constructorRouter.me?.attributes.num_id)||0,_id:window.RM.constructorRouter.me?.attributes._id||""},attachments:[],createdDate:Uu(new Date),isTmp:!0}}function Sw(e){let o=Bi().comments??{};if(o[e]){let t={...o};delete t[e],us({comments:t})}}function _p(e){let o=cn(),t=Bi().comments??{},r=eC(o,e);return us({comments:{...t,[o]:r}}),window.RM.constructorRouter.sockets.createComment(e,o),r}function Pw({commentId:e,...o}){let t=Bi().comments??{},i={...t[e],...o};us({comments:{...t,[e]:i}}),window.RM.constructorRouter.sockets.updateComment({commentId:e,...o})}function Tw(e){yp(e),window.RM.constructorRouter.sockets.deleteComment({commentId:e.childCommentId??e.parentCommentId})}function Mw(e){window.RM.constructorRouter.sockets.deleteCommentsMany({widgetId:e})}function Bw(){_w("loading"),window.RM.constructorRouter.sockets.getProjectComments()}var vp=[],fw=0;function tC(){let e=[...vp];vp=[],window.RM.constructorRouter.sockets.viewManyComments({commentsIds:e})}function Iw({comment:e,userId:o,remove:t}){let r={...e};t?r.seen=r.seen.filter(i=>i!==o):r.seen.push(o),Od({id:r._id,comment:r,userId:o})}function zw({commentId:e,userId:o,remove:t}){let i=(Bi().comments??{})[e];Iw({comment:i,userId:o,remove:t})}async function Ew(e,o){vp.includes(e._id)||(vp.push(e._id),clearTimeout(fw),fw=setTimeout(tC,1500),setTimeout(()=>{Iw({comment:e,userId:o})},0))}function Cp(e={status:"unresolved"}){let[o]=J_();return(0,ww.useMemo)(()=>{let t=Object.values(o.comments||{}),r=Dd.default.where(t,e),i=Dd.default.groupBy(r,a=>a.parent?a.parent:"parents"),s=[];return i.parents&&(s=[...i.parents].sort((a,l)=>new Date(l.createdDate).getTime()-new Date(a.createdDate).getTime())),Object.keys(i).length>1&&s.forEach(a=>{i[a._id]&&(a.children=i[a._id].sort((l,m)=>new Date(l.createdDate).getTime()-new Date(m.createdDate).getTime()))}),s},[o.comments,e.status,e.viewport,e.pageId])}Ld(e=>{e||kp(null),K_(e),e&&ae(ce.CommentsMode,{settingsType:"on"})});var[Rw,oC]=Wr(new Date);function rC(){oC(new Date)}setInterval(rC,60*1e3);var Dw=function(e,o,t,r){return this.num_id=e,this.hash=o,this.user=t,this.router=r,this};Nt.default.extend(Dw.prototype,Aw.default.Events,{CONNECTION_TIMEOUT:5e3,CONNECTION_ATTEMPTS:5,initSocket:function(){if(!this.hash)return console.error("sockets hash not found for mag!");let e=window.location.origin===oe.readymag_auth_host&&oe.isProd?"sockets.readymag.com":"",o=io(e,{timeout:this.CONNECTION_TIMEOUT,transports:["websocket"]});this.socket=o,this.attempts=0,o.on("connect",Nt.default.bind(function(){RM.DEBUG&&console.log("socket.io connected :4095"),this.trigger("connect")},this)),o.on("disconnect",Nt.default.bind(function(){RM.DEBUG&&console.log("socket.io disconnected :4095"),this.trigger("disconnect"),this.connected?this.isConnectionErrorRaised||setTimeout(()=>{o.connect()},1e3):this.onConnectionError()},this)),o.on("technical stream",t=>{console.log("technical stream input",t)}),o.on("client connect",Nt.default.bind(this.onClientConnect,this)),o.on("client disconnect",Nt.default.bind(this.onClientDisconnect,this)),o.on("page comments",Nt.default.bind(this.onPageComments,this)),o.on("project comments",Nt.default.bind(this.onProjectComments,this)),o.on("update comment",Nt.default.bind(this.onUpdateComment,this)),o.on("delete comment",Nt.default.bind(this.onDeleteComment,this)),o.on("delete comments many",Nt.default.bind(this.onDeleteCommentsMany,this)),o.on("view many comments result",Nt.default.bind(this.onViewManyComments,this)),o.on("create comment error",Nt.default.bind(this.onCreateCommentError,this)),o.io.on("connect_error",Nt.default.bind(this.onConnectionError,this)),o.io.on("connect_timeout",Nt.default.bind(this.onConnectionError,this)),o.io.on("reconnect",Nt.default.bind(this.onReconnect,this)),this.on("connect",this.joinRoom,this),this.router.on("update_from_server",this.sendUpdate,this),Bw()},getMagLockedPages:function(){this.socket.emit("get mag locked pages",{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash})},getPageQueue:function(e){this.socket.emit("get page queue",{numId:this.num_id,pageId:e,userId:this.user.get("_id"),hash:this.hash})},getRedisStatus:function(){this.socket.emit("check redis status",{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash})},joinRoom:function(){this.socket.emit("join mag",{num_id:this.num_id,hash:this.hash,user_id:this.user.id,user_data:this.user.pick("name","email","pic","_id")})},lockPage:function(e){this.socket.emit("lock page",{page_id:e})},takeOver:function(e){this.socket.emit("take over",{page_id:e})},leavePage:function(e){this.socket.emit("leave page",{page_id:e})},onLockChange:function(e){let o=[];Nt.default.each(e&&e.unlocked,function(t){o.push({tp:"unlock",pageId:t.page_id,userId:t.user_id,user_data:this.users_list.get(t.user_id)})},this),Nt.default.each(e&&e.locked,function(t){o.push({tp:"lock",pageId:t.page_id,userId:t.user_id,user_data:this.users_list.get(t.user_id)})},this),this.trigger("lockChange",o)},onTakeOver:function(e){this.trigger("takeOver",this.users_list.get(e.user_id))},onClientConnect:function(e){this.attempts=0,RM.DEBUG&&console.log("client connect",e),this.connected||(this.socket.on("message",Nt.default.bind(this.onNewMessage,this)),this.socket.on("lock change",Nt.default.bind(this.onLockChange,this)),this.socket.on("take over",Nt.default.bind(this.onTakeOver,this)),this.socket.on("duplicate disconnect",Nt.default.bind(this.onDuplicateDisconnect,this))),!this.isConnectionErrorRaised&&(this.connected=!0,e&&e.user_id===this.user.id&&this.router.workspace.page&&this.lockPage(this.router.workspace.page.id),e?.list&&(this.users_list=new Qu(e.list,{parse:!0})),ye.trigger("sockets:connect",e))},onClientDisconnect:function(e){RM.DEBUG&&console.log("client disconnect",e),this.users_list&&this.users_list.remove(e.user_id),e.user_id&&this.trigger("client-disconnected",e.user_id)},onDuplicateDisconnect:function(){this.onConnectionError({duplicate:!0})},onConnectionError:function(e){RM.DEBUG&&console.log("socket connection error",e),this.attempts++,!(!e.duplicate&&this.attempts<this.CONNECTION_ATTEMPTS||this.isConnectionErrorRaised)&&(this.isConnectionErrorRaised=!0,this.errorRaisedAt=Date.now(),this.router.raiseSocketConnectionError())},onReconnect:function(e){RM.DEBUG&&console.log("socket reconnected",e),this.isConnectionErrorRaised&&(delete this.isConnectionErrorRaised,this.router.clearSocketConnectionError())},sendUpdate:function(e,o,t){RM.DEBUG&&console.log("send update",e,o),this.socket.emit("message",{type:"model_update",data:{modelName:e,viewport:t,data:o}})},onNewMessage:function(e){RM.DEBUG&&console.log("new socket message",e),e&&e.type==="model_update"&&this.router.updateFromSocket(e.data)},getAuthParams:function(){return{numId:this.num_id,userId:this.user.get("_id"),hash:this.hash,projectId:this.router.mag.get("_id")}},createComment:function({pageId:e,viewport:o,content:t,position:r,parent:i,attachments:s},a){this.socket.emit("create comment",{...this.getAuthParams(),pageId:e,viewport:o,content:t,position:r,parent:i,attachments:s},a)},updateComment:function({commentId:e,content:o,status:t,attachments:r}){this.socket.emit("update comment",{...this.getAuthParams(),commentId:e,content:o,status:t,attachments:r})},deleteComment:function({commentId:e}){this.socket.emit("delete comment",{...this.getAuthParams(),commentId:e})},viewComment:function({commentId:e,unview:o}){this.socket.emit("view comment",{...this.getAuthParams(),commentId:e,unview:o})},viewManyComments:function({commentsIds:e}){this.socket.emit("view many comments",{...this.getAuthParams(),commentsIds:e})},getPageComments:function(e,o){this.socket.emit("get page comments",{...this.getAuthParams(),pageId:e,viewport:o})},getProjectComments:function(){this.socket.emit("get project comments",{...this.getAuthParams()})},deleteCommentsMany:function({widgetId:e}){this.socket.emit("delete comments many",{...this.getAuthParams(),widgetId:e})},onPageComments:function({comments:e}){Hd(e,this.user.get("_id"))},onProjectComments:function({comments:e}){Hd(e,this.user.get("_id"))},onUpdateComment:function(e,o){Od({id:e._id,frontId:o,comment:e,userId:this.user.get("_id")})},onDeleteComment:function(e){yp(e,this.user.get("_id"))},onDeleteCommentsMany:function({deletedComments:e=[]}){e.forEach(o=>{yp({parentCommentId:o})})},onViewManyComments:function(e){e?.notProcessed&&e?.notProcessed.length&&e.userId&&e.notProcessed.forEach(o=>zw({commentId:o,userId:e.userId,remove:!0}))},onCreateCommentError:function({error:e,uuid:o}){console.error("create comment error",e),o&&Sw(o)}});var $w=Dw;var D=T(et());Gn();var rt=T(St());tt();wi();bi();yo();Vo();S2();ot();Cd();var Nd=T(mo()),Fd=T(nr()),Ft=T(et());cb();sd();bi();yo();nn();ct();_o();ct();sn();ot();hh();var nC=Nd.default.View.extend({className:"controls",attributes:{"aria-label":"Controls"},groupControls:{0:"common_pack",1:"common_unpack",2:"common_align",3:"common_arrange",4:"common_interactions",5:"common_position",6:"common_layer"},controls:[],groupControlsDividers:(e,o)=>o.viewport!=="default"&&!o.getSelectedBlocks().every(t=>t.model.get("is_global"))?["common_arrange"]:["common_align"],ICON_HEIGHT:30,ICON_PADDING:1+1,initialize:function(e){Ft.default.bindAll(this),this.workspace=e.workspace,this.workspace.on("deselect",this.hide),this.workspace.on("select",this.onSelect),this.$main.append(this.$el),this.$el.addClass(this.className),this.$el.append('<div id="controls-help-tour-tooltip"></div>'),this.selectedBlocks=[],this.tooltipIsMount=!1,ye.on("tips:show",this.showTip.bind(this))},getBlocksThatPassedRestrictionsCheck:function(e,o){let t=[],r=null;return e[0]&&e[0].has_parent_block?r=e[0].workspace:r=this.workspace,Ft.default.each(o,function(i){bn[i]&&bn[i].prototype.restrictions&&!bn[i].prototype.restrictions.call(this,r,e)||t.push(i)},this),t},setControls:function(e,o,t={}){let r=Ft.default.find(this.controls,function(u){return u.selected==!0});clearTimeout(this.hideTimeout);let i={},s={};Ft.default.isArray(o)||(o=[o]),!Ft.default.isArray(e)&&Ft.default.isString(e)&&(e=[e]);let a=this.getBlocksThatPassedRestrictionsCheck(o,e);Ft.default.each(this.controls,function(u){Ft.default.contains(a,u.name)?t.destroyAll?(i[u.name]=u.$el.position().top,u.destroy(!1)):s[u.name]=u:u.destroy(!0)},this),this.controls=[];let l=Ft.default.pluck(o,"model"),m=this.calculateDividersTotal(o,a),c=a.length*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING+m,p=-c/2;Ft.default.each(a,function(u){let d=s[u];if(d)d.moveToNewPos(p);else{let h=i[u]!=null;d=new bn[u]({blocks:o,models:l,master:this,$container:this.$el,appearanceAnimation:!h,fromY:h?i[u]:p,y:p})}d.moveToNewPos(p),p+=this.ICON_HEIGHT+this.ICON_PADDING;let g=this.getControlsByDividersField(o);g.length&&(p+=this.getDividerSize(g,u)),this.controls.push(d)},this),this.selectedBlocks=o,this.controls.indexOf(r)>-1&&!t.noSelect?this.select(r):Ft.default.invoke(this.controls,"removeFade"),this.workspace.trigger("controls-have-been-updated"),this.show(),this.$("div[data-alt]:not(.rmalttext)").RMAltText()},toggleHelpNotice:function(e){jo(["TextWidgetSelect","PictureWidgetUse","TextWidgetOpenPanel","TextWidgetProperties","ButtonWidgetAdjustVisualProperties","ButtonWidgetAddLink","ButtonWidgetAddLinkType","AddAnimations","PositionControlClick"],e)},softUpdateControlsForBlocks:function(e){if(!e||!e.length)return;let o=this.getBlocksGroupControls(e),t=e.length===1?e[0].controls:o,r=this.getBlocksThatPassedRestrictionsCheck(e,t),i=this.controls?.map(a=>a.name);Ft.default.isEqual(i,r)||this.setControls(r,e,{destroyAll:!0})},onSelect:function(e){if(this.toggleHelpNotice({show:!1}),e.length===1&&e[0].model.get("hidden")){this.hide();return}let t=this.getBlocksGroupControls(e),r=e.length===1?e[0].controls:t;!e||!e.length||(e.length>1&&e.every(i=>i.isVector&&i.isVector())&&(r=this.replacePictureSettings(r)),this.setControls(r,e,{destroyAll:!0}))},getBlocksGroupControls:function(e){if(e.length>1){let t=e.map(a=>a.groupControls?Object.values(a.groupControls).length:0).reduce((a,l,m)=>l?Object.assign({},a,e[m].groupControls||{}):a,{}),r={},i={};Object.keys(t).forEach(a=>{i[t[a]]||(i[t[a]]=a,r[a]=t[a])});let s=Object.keys(r).map(a=>parseInt(a));if(s.length){let l=Object.keys(this.groupControls).map(p=>parseInt(p)).length+s.length,m=[],c=0;for(let p=0;p<l;p++)s.includes(p)?(c+=1,m.push(t[p])):m.push(c?this.groupControls[p-c]:this.groupControls[p]);return Ft.default.uniq(m)}}return Object.values(this.groupControls)},show:function(){setTimeout(()=>{this.renderHelpTourTooltip()},100),this.eduTipForRender&&setTimeout(()=>{this.renderControlTooltip()},110),Ft.default.each(this.controls,function(o){o.render()},this);let e=this.selectedBlocks[0];e.settingsOnCreate&&e.model.created&&!e.model.settingsOpened&&!e.has_parent_block&&(e.onCreate?e.onCreate():this.selectFirst(),this.selectedBlocks[0].model.settingsOpened=!0)},hide:function(e){this.unmountHelpTourTooltip(),e?.fromAdd||this.toggleHelpNotice({show:!0}),this.hideTimeout=setTimeout(this.hideWithAnimation,0)},renderControlTooltip:function(){let e=this.$el.children("#controls-help-tour-tooltip")[0],o=this.tipsFromY?this.tipsFromY:this.controls[0]?.fromY;!e||!o||qn({component:Fl,domElement:e,model:new Nd.default.Model({position:this.eduTipForRender?"left":"top",indent:8,steps:["TextWidgetOpenPanel","ButtonWidgetAdjustVisualProperties"],styles:{position:"relative",top:this.eduTipForRender?o+this.ICON_HEIGHT/2:o},...this.eduTipForRender&&{eduTips:this.eduTipForRender}}),onRenderComplete:()=>{this.tooltipIsMount=!0,this.eduTipForRender&&(this.eduTipForRender=null),this.tipsFromY&&(this.tipsFromY=null)},onDestroy:()=>{Fd.default.unmountComponentAtNode(e),e&&e.parentNode&&e.parentNode.removeChild(e)}})},showTip:function(e){if(this.eduTipForRender=e,e.toLowerCase().includes("color")){let o=this.findControl("shape_color")||this.findControl("text_color");o&&(this.tipsFromY=o.fromY),this.renderControlTooltip()}else e.toLowerCase().includes("arrange")&&setTimeout(()=>{let o=this.findControl("common_arrange");o&&(this.tipsFromY=o.fromY)},100)},renderHelpTourTooltip:function(){let{started:e}=$t();e&&(this.tooltipIsMount&&this.unmountHelpTourTooltip(),this.renderControlTooltip())},unmountHelpTourTooltip:function(){if(!this.tooltipIsMount)return;let e=this.$el.children("#controls-help-tour-tooltip")[0];Fd.default.unmountComponentAtNode(e)&&(this.tooltipIsMount=!1)},canControlsBeClosed:function(e){let o=!0;return Ft.default.each(this.controls,function(t){o=!t.canControlBeClosed(e)&&o}),o},hideWithAnimation:function(){this.selectedBlocks=[],this.controls.length!==0&&(Ft.default.each(this.controls,function(e){let o=e instanceof bh;e.destroy(!o)}),this.controls=[])},select:function(e){if(!e||e.rolePermission&&!je.isPermissionAllowed(e.rolePermission))return;e.trigger("selected",{control:e,state:!0}),e.select();let o=Lg();o.message&&$g.includes(o.message)&&window.RM.constructorRouter.trigger("notice:triggerEduTipClose");let t=Ft.default.without(this.controls,e);Ft.default.each(t,function(r){r.fade()})},deselect:function(){this.nextHelpTourStepAfterDeselect(),Ft.default.each(this.controls,function(e){e.trigger("selected",{control:e,state:!1}),e.deselect()})},nextHelpTourStepAfterDeselect:function(){let{started:e}=$t();e&&(Ie(["TextWidgetSelect"]),Ie(["TextWidgetProperties"]),Ie(["TextWidgetOpenPanel","ButtonWidgetAddLink","ButtonWidgetAddLinkType"]),Ie(["PictureWidget","PictureWidgetClickOutside"],{fallback:!0}),Ie(["ButtonWidgetAdjustVisualProperties","ButtonWidgetAnchorLinkPosition"]),Ie(["PointerCursorUpload"]))},selectFirst:function(){this.select(this.controls[0])},selectSettingsControl:function(){this.controls[0]&&this.select(this.controls[0])},findControl:function(e){let o;return Ft.default.each(this.controls,function(t){t.name==e&&(o=t)}),o},getControlsHeight:function(){return Ft.default.isEmpty(this.controls)?0:this.controls.length*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING},getControlRelativePosition:function(e){let o=this.controls.indexOf(e);return o=o<0?0:o,o==0?o:o*(this.ICON_HEIGHT+this.ICON_PADDING)-this.ICON_PADDING/2},calculateDividersTotal:function(e,o){let t=0,r=this.getControlsByDividersField(e);for(let i of r)o.includes(i)&&(t+=this.getDividerSize(r,i));return t},replacePictureSettings(e){return[...e.join().replace("picture_settings","picture_color").split(",")]},getControlsByDividersField(e){let o=e.length===1?"controlsDividers":"groupControlsDividers",t=[];if(e[0][o]&&(Array.isArray(e[0][o])?t=[...e[0][o]]:typeof e[0][o]=="function"&&(t=[...e[0][o](e[0],this.workspace,Object.values(e[0].groupControls))]),e.length>1)){let r=typeof this.groupControlsDividers=="function"?this.groupControlsDividers(e[0],this.workspace,Object.values(e[0].groupControls)):this.groupControlsDividers;t.push(...r),e.every(i=>i.isVector&&i.isVector())&&(t=this.replacePictureSettings(t))}return t},getDividerSize:function(e,o){return e&&e.length&&e.includes(o)?22:0}}),Lw=nC;cb();tn();var Kr=T(St()),Wd=T(et());ot();Tl();var Hw=T(nr());nn();K2();var sC={props:{position:{type:String,default:null},indent:{type:Number,default:null},step:{type:String,default:null},modifiers:{type:Array,default:null},skidding:{type:Number,default:0},componentsProps:{type:Object,default:void 0}},mounted:function(){qn({component:Fl,domElement:this.$el,model:new Backbone.Model({position:this.position,indent:this.indent,steps:this.step,styles:{width:"100%",height:"100%"},skidding:this.skidding,modifiers:this.modifiers,componentsProps:this.componentsProps})})},beforeDestroy:function(){Hw.default.unmountComponentAtNode(this.$el)}},aC=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"help-tour-tooltip"})},lC=[],pC=void 0,cC=void 0,dC=void 0,mC=!1;function uC(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="helptour-tooltip.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var gC=uC({render:aC,staticRenderFns:lC},pC,sC,cC,mC,dC,!1,void 0,void 0,void 0),Ir=gC;yo();ct();var hC={components:{NumericInput:xi,HelpTourTooltip:Ir},props:{workspace:Object,defaultZoom:{type:Number,default:1},defaultSticky:Boolean},data:function(){return{pageHeight:0,draggable:!1,viewport:"",nearHovered:!1,sX:0,sY:0,zoom:this.defaultZoom||1,relativeToScreen:this.defaultSticky,helpTourStep:"PageHeight",isHelpTourStep:!1}},computed:{minH:function(){return this.getViewport().min_height},maxH:function(){return this.getViewport().max_height},isSticky(){return this.relativeToScreen&&Modernizr.csspositionsticky||this.isHelpTourStep},isFixed(){return this.relativeToScreen&&!Modernizr.csspositionsticky},roundedPageHeight:{get(){return Math.round(this.pageHeight)},set(e){this.pageHeight=e}}},mounted:function(){(0,Kr.default)(document).on("mousemove",this.dragMove),(0,Kr.default)(document).on("mouseup",this.dragEnd),(0,Kr.default)(window).on("blur",this.onBlur),ye.on("zoom",this.onZoom),ye.on("helptour:update",this.handleCheckTourStep),window.RM.constructorRouter.on("pageChange",this.handleCheckTourStep)},destroy:function(){(0,Kr.default)(document).off("mousemove",this.dragMove),(0,Kr.default)(document).off("mouseup",this.dragEnd),(0,Kr.default)(window).off("blur",this.onBlur),ye.off("helptour:update",this.handleCheckTourStep),window.RM.constructorRouter.off("pageChange",this.handleCheckTourStep)},methods:{savePage:Wd.default.debounce(function(){this.workspace.page.saveHeight()},300),loadHeight:function(){this.viewport=this.workspace.viewport,this.pageHeight=this.workspace.page.getViewportParam(this.workspace.viewport,"height")},getViewport:function(){return Wd.default.find(Pe.viewports,e=>e.name===this.viewport)},dragMove:function(e){if(this.dragged){let o=this.pageHeight+(e.pageY-this.startY)/this.zoom,t=this.workspace.$window.height();o<t/this.zoom&&this.viewport==="default"&&(o+=(e.pageY-this.startY)/this.zoom),e.pageY/this.zoom+20>t/this.zoom?this.downInt||(this.downInt=setInterval(()=>{this.pageHeight+=20},100)):this.downInt&&(clearInterval(this.downInt),this.downInt=null),this.pageHeight=Math.min(Math.max(o,this.minH),this.maxH),this.startY=e.pageY}else this.nearHovered&&document.activeElement!==this.$refs.input.$el&&Math.pow(this.sX-e.screenX,2)+Math.pow(this.sY-e.screenY,2)>6e3&&(this.nearHovered=!1)},dragStart:function(e){this.dragged=!0,this.startY=e.pageY,(0,Kr.default)("body").addClass("ns-resize-cursor"),this.workspace.page.trigger("change-height-start")},dragEnd:function(){this.dragged=!1,(0,Kr.default)("body").removeClass("ns-resize-cursor"),this.downInt&&(clearInterval(this.downInt),this.downInt=null),this.workspace.page.trigger("change-height-end")},onBlur:function(){this.nearHovered=!1,this.dragEnd()},onZoom:function(e,o){this.zoom=e,this.relativeToScreen=o},handleCheckTourStep:function(){let{step:e}=$t(),o=this.workspace.page.getPageId()===window.RM?.constructorRouter?.getCurrentPageId();this.isHelpTourStep=o&&e?.name==="PageHeight"}},watch:{pageHeight:function(e,o){if(this.workspace.page.getViewportParam(this.workspace.viewport,"height")===e)return;this.workspace.page.setViewportParam(this.workspace.viewport,"height",Math.round(this.pageHeight)),this.workspace.page.setViewportParam(this.workspace.viewport,"type","scroll");let t=this.workspace.$window.height();e>t/this.zoom&&e>o&&this.workspace.$container.scrollTop(this.workspace.$container.scrollTop()+Math.ceil((e-o)*this.zoom)),this.savePage(),Ie("PageHeight")},workspace:{handler:function(e,o){o&&(o.page.off("change:viewport",this.loadHeight),o.page.off("change:height",this.loadHeight),o.page.off("change:viewport_phone_portrait",this.loadHeight),o.page.off("change:viewport_tablet_portrait",this.loadHeight)),e.page.on("change:viewport",this.loadHeight),e.page.on("change:height",this.loadHeight),e.page.on("change:viewport_phone_portrait",this.loadHeight),e.page.on("change:viewport_tablet_portrait",this.loadHeight),this.loadHeight()},immediate:!0},nearHovered(e){this.workspace.toggleBorder({guidesOn:RM.constructorRouter.mag.edit_params.get("guides"),columnCount:RM.constructorRouter.gg.guides?.model?.get("columns"),margin:RM.constructorRouter.gg.guides?.model?.get("margin"),willResize:e})}}},fC=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{class:{"page-size-control":!0,sticky:e.isSticky,fixed:e.isFixed}},[t("transition",{attrs:{name:"page-size-fade"}},[e.nearHovered||e.isHelpTourStep?t("numeric-input",{ref:"input",staticClass:"size-input-readonly",attrs:{min:e.minH,max:e.maxH,autosize:!0,"thousand-delimiter":",","mouse-use":!1},model:{value:e.roundedPageHeight,callback:function(r){e.roundedPageHeight=r},expression:"roundedPageHeight"}}):e._e()],1),e._v(" "),e.isHelpTourStep?t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"top",indent:56}}):e._e(),e._v(" "),t("div",{staticClass:"size-handle",on:{mousedown:e.dragStart,mouseover:function(r){e.sX=r.screenX,e.sY=r.screenY,e.nearHovered=!0}}})],1)},bC=[],wC=void 0,xC=void 0,vC=void 0,kC=!1;function yC(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="page-size.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var _C=yC({render:fC,staticRenderFns:bC},wC,hC,xC,kC,vC,!1,void 0,void 0,void 0),Ow=_C;sp();Vn();pt();Xl();Lf();zl();id();ui();h_();sn();var Np=T(mo());wd();ed();M_();var gs=T(St());tn();var be=T(et());Vn();var lr=T(St());Tl();yo();var Ud=T(et());ct();var CC={components:{NumericInput:xi,HelpTourTooltip:Ir},props:{space:Object,spaces:Array,workspace:Object,blockHovered:Boolean,defaultZoom:{type:Number,default:1}},data(){return{workspaceWidth:this.workspace.mag.getViewportWidth(this.workspace.viewport),windowWidth:(0,lr.default)(window).width(),nearHandleHovered:!1,handleY:0,dragged:!1,needSizes:this.workspace.mag.edit_params.get("sizes"),zoom:this.defaultZoom||1,helpTourStep:"SetBlocksDistance"}},computed:{isMobile(){return this.workspace.viewport!=="default"},sideMargin(){return Math.max((this.windowWidth-this.workspaceWidth*this.zoom)/2/this.zoom,0)},resizeSign(){return this.startHandle==="top"?-1:1},prevSpace(){return this.spaces[this.spaces.indexOf(this.space)-1]||null},topGroupHeight(){return this.prevSpace?(this.space.top-this.prevSpace.bottom)*this.zoom:0}},created(){this.onResizeEndDebounced=Ud.default.debounce(this.onResizeEnd,300),this.onHeightChangeDebounced=Ud.default.debounce(this.onHeightChange,300)},mounted(){(0,lr.default)(window).on("resize",this.onWinowResize),(0,lr.default)("body").on("mousemove",this.onDragMove),this.workspace.page.on("change:viewport",this.onChangeViewport),this.workspace.mag.edit_params.on("change:sizes",this.onToggleSizes),ye.on("zoom",this.onZoom)},beforeDestroy(){(0,lr.default)(window).off("resize",this.onWinowResize),(0,lr.default)("body").off("mousemove",this.onDragMove),this.workspace.page.off("change:viewport",this.onChangeViewport),this.workspace.mag.edit_params.off("change:sizes",this.onToggleSizes)},methods:{onChangeViewport(){this.workspaceWidth=this.workspace.mag.getViewportWidth(this.workspace.viewport)},onToggleSizes(){this.needSizes=this.workspace.mag.edit_params.get("sizes")},onHandleHover(){this.handleY=null,this.nearHandleHovered=!0,Ie("HoverBetweenBlocks")},onHandleLeave(e){this.handleY=e.screenY,this.nearHandleHovered=!0},onWinowResize(){this.windowWidth=(0,lr.default)(window).width()},onStartDrag(e){if(e.target.parentNode!==this.$el)return;this.startEvent=e;let o=(0,lr.default)("body");o.addClass("move-cursor"),o.on("mouseup",this.onDragEnd),this.dragged=!0},onDragMove(e){this.dragged?(this.$emit("dragMove",this.space,(e.clientY-this.startEvent.clientY)/this.zoom),this.startEvent=e):this.handleY!==null&&Math.abs(e.screenY-this.handleY)>40&&(this.nearHandleHovered=!1)},onDragEnd(){Ie("DeselectAfterSetBlocksDistance"),this.dragged=!1;let e=(0,lr.default)("body");e.removeClass("move-cursor"),e.off("mousemove",this.onDragMove),e.off("mouseup",this.onDragEnd),this.$emit("dragEnd",this.space)},mousedown(e,o){this.startEvent=e,this.startHandle=o;let t=(0,lr.default)("body");t.addClass("ns-resize-cursor"),t.on("mousemove",this.mousemove),t.on("mouseup",this.mouseup)},mousemove(e){let o=(e.clientY-this.startEvent.clientY)/this.zoom;this.space.height+o<0&&(o=-this.space.height),o!==0&&(this.$emit("changeHeight",this.startHandle,this.space,o,e.shiftKey),this.startEvent=e)},onHeightChange(e){e&&(this.$emit("changeHeight","bottom",this.space,e-this.space.height,!1),this.onResizeEndDebounced(),e===80&&Ie("SetBlocksDistance"))},onResizeEnd(){this.$emit("resizeEnd",this.space)},mouseup(){let e=(0,lr.default)("body");e.removeClass("ns-resize-cursor"),e.off("mousemove",this.mousemove),e.off("mouseup",this.mouseup),this.$emit("resizeEnd",this.space)},onZoom:function(e){this.zoom=e}}},SC=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"space-highlighter",class:{isMobile:e.isMobile,isDesktop:!e.isMobile,"always-line":e.space.height<2,"always-plus":e.space.height<25},style:{top:e.space.top+"px",height:e.space.height+"px",left:-e.sideMargin+"px"},on:{mouseover:e.onHandleHover,mouseleave:e.onHandleLeave,mousedown:function(r){e.onStartDrag(r)}}},[t("div",{staticClass:"space-left",style:{"flex-basis":e.sideMargin+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.mousedown(r,"bottom")}}}),e._v(" "),t("div",{staticClass:"add-widget",on:{click:function(r){return e.$emit("addWidget",e.space)}}}),e._v(" "),e.prevSpace&&e.blockHovered?t("div",{staticClass:"duplicate-widget",style:{top:-e.topGroupHeight/2+"px"},on:{click:function(r){return e.$emit("duplicateGroup",e.space)}}}):e._e(),e._v(" "),e.nearHandleHovered&&e.needSizes?t("div",{staticClass:"space-size",on:{click:function(r){r.stopPropagation()}}},[t("div",{staticStyle:{position:"relative",top:"10px"}},[t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"right",indent:16}})],1),e._v(" "),t("numeric-input",{staticClass:"numeric",attrs:{autosize:!0,min:0,value:Math.round(e.space.height),"mouse-use":!1},on:{change:e.onHeightChangeDebounced}})],1):e._e()]),e._v(" "),t("div",{staticClass:"space-center",style:{"flex-basis":e.workspaceWidth+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.mousedown(r,"bottom")}}})]),e._v(" "),t("div",{staticClass:"space-right",style:{"flex-basis":e.sideMargin+"px"}},[e.space.isLast?e._e():t("div",{staticClass:"handle handle-bottom",on:{mousedown:function(r){e.mousedown(r,"bottom")}}})])])},PC=[],TC=void 0,MC=void 0,BC=void 0,IC=!1;function zC(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="space.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var EC=zC({render:SC,staticRenderFns:PC},TC,CC,MC,IC,BC,!1,void 0,void 0,void 0),Nw=EC;wi();Gt();var RC=Yt.extend(Nw),AC=class Sp{constructor(o){this.workspace=o,this._updateSpacesBinded=this.updateSpaces.bind(this),this._moveIntoSpacesBinded=this.moveIntoSpaces.bind(this),this._handleRotateBinded=this.resizeBlockHandler.bind(this),this._createWidgetHandlerBinded=this.createWidgetHandler.bind(this),this._removeWidgetHandlerBinded=this.removeWidgetHandler.bind(this),this._changeVisibilityHandlerBinded=this.changeVisibilityHandler.bind(this),this._undoRedoHandlerBinded=this.undoRedoHandler.bind(this),this._resizeBlockHandlerBinded=this.resizeBlockHandler.bind(this),this._resizePageHandlerBinded=this.resizePageHandler.bind(this),this._onMouseMoveBinded=this.onMouseMove.bind(this),this.refillGroupsDebounced=be.default.debounce(this.refillGroups.bind(this),100),this.currentSpaces=[],this.affectedBlocks=[],this._container=o.$el,o.page.on("widget:create",this._createWidgetHandlerBinded),o.page.on("widget:remove",this._removeWidgetHandlerBinded),o.page.on("change:viewport",this._updateSpacesBinded),o.page.on("change:height",this._resizePageHandlerBinded),this.initTimeout=setTimeout(()=>{be.default.each(this.workspace.blocks,t=>{t.on("resize",this._resizeBlockHandlerBinded),t.on("move",this._moveIntoSpacesBinded),t.model.on("change:hidden change:fixed_position",this._updateSpacesBinded),t.model.on("change:angle",this._handleRotateBinded),t.model.on("change",this._undoRedoHandlerBinded)}),this.updateSpaces()},0),be.default.each(o.getSelectedBlocks(),function(t){t.$el.removeClass("bundle-allow-top"),t.$el.removeClass("bundle-allow-bottom")}),o.$el.toggleClass("blocks-mode",!0),(0,gs.default)(document).on("mousemove",this._onMouseMoveBinded)}onMouseMove(o){let t=RM.constructorRouter.zoom.getZoom(),r=xt.mapPointerToElement(o,this.workspace.$origin[0],1,t);be.default.each(this.spaces,(i,s)=>{let a=this.spaces[s-1];if(a){let l={top:a.bottom,left:0,width:1/0,height:i.top-a.bottom};this.currentSpaces[s].blockHovered=r.top>l.top&&r.top<l.top+l.height}})}createWidgetHandler(o,t){be.default.each(this.workspace.blocks,r=>{r.off("resize",this._resizeBlockHandlerBinded),r.off("move",this._moveIntoSpacesBinded),r.model.off("change:hidden change:fixed_position",this._updateSpacesBinded),r.model.off("change:angle",this._handleRotateBinded),r.model.off("change",this._undoRedoHandlerBinded),r.on("resize",this._resizeBlockHandlerBinded),r.on("move",this._moveIntoSpacesBinded),r.model.on("change:hidden change:fixed_position",this._updateSpacesBinded),r.model.on("change:angle",this._handleRotateBinded),r.model.on("change",this._undoRedoHandlerBinded)}),this.pasteHandler(o,t),this.undoRedoHandler(o,t),this.duplicateGroupHandler(o,t)}duplicateGroupHandler(o,t){t.duplicateGroup&&this.refillGroupsDebounced()}refillGroups(){let o=this.workspace.filterAutolayoutBlocks(this.workspace.blocks);this.blocks=this.workspace.collectBlocks(o),this.packs=this.calcPackData(this.blocks),this.groupedBlocks=this.collectBlockGroups(this.blocks,this.packs,this.spaces),this.spaces=this.blocksGroupsToSpaces(this.groupedBlocks,this.spaces),this.redrawSpaces(!0)}pasteHandler(o,t){!t||!t.copy&&!t.clone||t.duplicateGroup||this.updateSpaces()}undoRedoHandler(o,t){!t||!t.undo&&!t.redo||this.updateSpaces()}removeWidgetHandler(o){let t=this.getGroupByModel(o);t&&(t.items=be.default.filter(t.items,r=>r.model!==o),this.recalcSpaces())}changeVisibilityHandler(){}resizePageHandler(o){let t=be.default.last(this.spaces);t.height=Math.max(30,o.get("height")-t.top),t.bottom=t.top+t.height,this.recalcSpaces()}resizeSpace(o,t,r="top"){if(!t)return;let i=this.groupedBlocks[o.groupIdx-1]||o.isLast&&be.default.last(this.groupedBlocks);if(r==="top"&&i){let s=i.bb.top+i.bb.height;t=Math.min(t,o.height),t=Math.max(t,s-o.top),o.top=Math.round(o.top+t),o.height=Math.round(o.height-t)}else r==="bottom"&&(o.height=Math.max(0,Math.round(o.height+t)))}resizeHandler(o,t,r,i){o==="top"?(this.resizeSpace(t,r,"top"),this.resizePageHandler(this.workspace.page)):o==="bottom"&&t.isLast?(this.resizeSpace(t,r,"bottom"),this.recalcSpaces()):i?(this.moveAllBlocksBottom(this.groupedBlocks,r,!0),this.resizePageHandler(this.workspace.page)):(this.moveBlocksBottom(this.groupedBlocks,t.groupIdx,r,!0),this.resizePageHandler(this.workspace.page))}resizeEndHandler(o){if(o.height<=1){let t=this.spaces.indexOf(o),r=this.groupedBlocks[o.groupIdx],i=this.groupedBlocks[o.groupIdx-1];i&&t>0&&(i.items.splice.apply(i.items,[i.items.length,0].concat(r.items)),this.spaces.splice(t,1),this.groupedBlocks.splice(o.groupIdx,1),be.default.each(this.spaces,(s,a)=>{t<=a&&s.groupIdx--}),i.spaceBottom=this.spaces[t])}this.recalcSpaces(),this.redrawSpaces(),this.saveChanges()}dragMoveSpace(o,t){let r=this.groupedBlocks[o.groupIdx-1];r&&(o.top+t<r.bottom&&(t=r.bottom-o.top),this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,t),be.default.each(this.spaces,i=>{i.groupIdx>=o.groupIdx&&(i.top+=t,i.bottom+=t)}),this.recalcSpaces())}dragEndSpace(){let o=-1,t=-1;be.default.each(this.spaces,(s,a)=>{o===s.top&&(t=a),o=s.bottom});let r=this.spaces[t],i=this.spaces[t-1];t>-1&&this.groupedBlocks[i.groupIdx].items.length===0&&(i.height+=r.height,i.bottom=i.top+i.height,this.groupedBlocks.splice(i.groupIdx,1),this.groupedBlocks[i.groupIdx]&&(this.groupedBlocks[i.groupIdx].spaceTop=i),be.default.each(this.spaces,s=>{s.groupIdx>i.groupIdx&&s.groupIdx--}),this.spaces.splice(t,1)),this.recalcSpaces(),this.redrawSpaces(!0),this.saveChanges()}splitSpace(o,t,r){let i=be.default.clone(o),s=this.spaces.indexOf(o),a=this.groupedBlocks[o.groupIdx],l=be.default.clone(a),m=Math.round((o.height-t)/2);l?(l.spaceBottom=i,a.spaceTop=i,this.groupedBlocks.splice(o.groupIdx,0,l)):(l={spaceTop:o,spaceBottom:i},this.groupedBlocks.push(l)),this.spaces.splice(s+1,0,i),o.height=m,o.bottom=o.top+m,i.height=m,i.top=o.bottom+t,i.bottom=i.top+i.height,l.items=be.default.map(r,c=>({block:c,model:c.model,box:c.getBoxData({includeBoundingBox:!0})})),be.default.each(this.spaces,(c,p)=>{p>s&&(c.groupIdx+=1)}),this.recalcSpaces()}createWidgetAtSpace(o,t,r,i,s){let a=this.spaces.indexOf(o),l=this.spaces[a+1];l||(r=!1);let m=o.bottom;r&&isFinite(s)&&(m=s-360/2,m+360>l.top&&(m=l.top-360),m=Math.max(o.bottom,m)),this.customCreateWidget()&&s&&(m=s-360/2),RM.constructorRouter.workspace.addWidget({type:t,y:m},{useDefaults:!0,success:c=>{if(this.customCreateWidget()&&s){this.updateSpaces();return}let p=be.default.find(this.workspace.blocks,g=>g.id===c.id);i&&i.success(c);let u=c.get("h"),d=this.spaces[this.spaces.indexOf(o)+1];if(r){let g=m+u-d.top;g>0&&(this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,g),be.default.each(this.spaces,(h,b)=>{b>a&&(h.top+=g,h.bottom+=g)})),this.groupedBlocks[o.groupIdx].items.push({block:p,model:p.model,box:p.getBoxData({includeBoundingBox:!0})})}else this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,u+o.height,!0),this.splitSpace(o,u,[p]);this.redrawSpaces(),this.saveChanges()},error:c=>{i&&i.error(c)}}),this.workspace.save_group(this.getModelToSave(),{silent:!0})}customCreateWidget(){return this.spaces.length===1}addWidgetAtOffset(o,t,r){let i,s;be.default.each(this.spaces,a=>{a.top<t&&a.bottom>t&&(i=a),a.bottom<t&&(s=a)}),i?this.createWidgetAtSpace(i,o,!1,r,t):s&&this.createWidgetAtSpace(s,o,!0,r,t)}duplicateGroup(o){let t=this.spaces[this.spaces.indexOf(o)-1],r=be.default.clone(o),i=o.top-t.bottom+20,s=this.spaces.indexOf(o),a=this.groupedBlocks[o.groupIdx-1],l=be.default.clone(a),m=20,c=o.top-t.bottom;this.moveBlocksBottom(this.groupedBlocks,o.groupIdx,i,!0),l.spaceBottom=r,a.spaceTop=r,this.groupedBlocks.splice(o.groupIdx+1,0,l),this.spaces.splice(s+1,0,r),o.height=m,o.bottom=o.top+o.height,r.top=o.bottom+c,r.bottom=r.top+r.height,l.items=[],be.default.each(this.spaces,(p,u)=>{u>s&&(p.groupIdx+=1)}),this.recalcSpaces(),this.groupedBlocks[t.groupIdx].items.length&&this.workspace.cloneBlocks(be.default.map(this.groupedBlocks[t.groupIdx].items,function(p){return p.block}),{offset:{y:i},duplicateGroup:!0}),this.redrawSpaces(!0),this.saveChanges()}addWidgetIntoSpace(o){lf({name:"widget-selector",payload:{y:o.top+(o.bottom-o.top)/2}})}static recalcBBoxes(o){o instanceof Array||(o=[o]),be.default.each(o,t=>{t.box=t.block.getBoxData({includeBoundingBox:!0})})}getBlocksToSave(){let o=be.default.chain(this.affectedBlocks).uniq().value();return this.affectedBlocks=[],o}getModelToSave(){return be.default.map(this.getBlocksToSave(),o=>o.model)}getGroupByBlock(o){return be.default.find(this.groupedBlocks,t=>be.default.find(t.items,r=>r.block===o))}getGroupByModel(o){return be.default.find(this.groupedBlocks,t=>be.default.find(t.items,r=>r.model===o))}getBlockOffsetInGroup(o,t){let r=be.default.reduce(t,(i,s)=>(i.top=Math.min(i.top,s.box.bb_y),i.bottom=Math.max(i.bottom,s.box.bb_y+s.box.bb_h),i),{top:1/0,bottom:-1/0});return{top:o.box.bb_y-r.top,bottom:r.bottom-o.box.bb_y-o.box.bb_h}}checkAllBlocksNear(o){let t=this.getGroupByModel(o[0].model);return be.default.reduce(o,(r,i)=>r&&t===this.getGroupByModel(i.model),!0)}getRestriction(o,t){let r=this.getGroupByModel(o);if(!r)return{canMoveTop:!0,canMoveBottom:!0};let i=be.default.find(r.items,m=>m.model===o),s=r.bb.top+r.bb.height,a=0,l=0;if(t.length>1){let m=this.getBlockOffsetInGroup(i,be.default.map(t,c=>{let p=this.getGroupByBlock(c);return be.default.find(p.items,u=>u.block===c)}));a=m.top,l=m.bottom}return{top:Math.min(r.spaceTop&&r.spaceTop.bottom||0,r.bb.top)+a,bottom:Math.max(r.spaceBottom.top,s)-l,canMoveTop:Math.round(i.box.bb_y)>Math.round(r.bb.top)||be.default.filter(r.items,m=>Math.round(r.bb.top)===Math.round(m.box.bb_y)).length>1,canMoveBottom:Math.round(i.box.bb_y+i.box.bb_h)<Math.round(s)||be.default.filter(r.items,m=>Math.round(s)===Math.round(m.box.bb_y+m.box.bb_h)).length>1}}shiftLayout(o){this.recalcGroupedBlocks();let t=0,r=[];be.default.each(this.spaces,i=>{let s=this.groupedBlocks[i.groupIdx-1],a=this.groupedBlocks[i.groupIdx];t&&s&&r.push({group:s,delta:t}),s&&(s===o?t+=s.bottom-i.top:t+=Math.max(0,s.bottom-i.top)),i.top+=t,i.bottom+=t,a&&a.spaceTop}),be.default.each(r,i=>{this.moveBlocksBottom([i.group],0,i.delta)}),this.recalcSpaces()}resizeBlockHandler(o,t){t?.autosize?(this.shiftLayout(o),this.saveChanges()):this.shiftLayout(o)}moveIntoSpaces(){this.recalcSpaces()}recalcBoxOnResize(o,t,r){let i=this.getGroupByModel(r);if(!i)return o;let s=t.boxOrig,a=t.DOTS_POS_X,l=t.DOTS_POS_Y,m=s.left+s.width*a,c=s.top+s.height*l,p=s.left+s.width/2,u=s.top+s.height/2,d=m-p,g=u-c,h=p+t.cosAngle*d+t.sinAngle*g,b=u+t.sinAngle*d-t.cosAngle*g,x=o.left+o.width*a,y=o.top+o.height*l,S=o.left+o.width/2,k=o.top+o.height/2,P=x-S,C=k-y,B=S+t.cosAngle*P+t.sinAngle*C,$=k+t.sinAngle*P-t.cosAngle*C,A=be.default.clone(o);A.left=o.left+(h-B),A.top=o.top+(b-$);let R=gt.calcBoundingBox(A),Z=i.spaceTop.bottom-R.bb_top;if(Z>0){let F=Math.sin(o.angle/180*Math.PI)*Math.cos(o.angle/180*Math.PI),V=F>0?o.height/o.width:o.width/o.height,W=Math.atan(V)+o.angle/180*Math.PI,J=R.bb_height-Z,me=F>0?W-Math.PI/2:Math.PI-W,se=J/Math.abs(Math.cos(me)),ee=o.height/o.width,ue=o.width-se/Math.sqrt(1+ee*ee),ke=ue*ee;o.top+=ke,o.height-=ke,o.width-=ue}return o}recalcGroupedBlocks(){be.default.each(this.groupedBlocks,o=>{be.default.isEmpty(o.items)?(o.bb={top:o.spaceTop.bottom,height:o.spaceBottom.top-o.spaceTop.bottom},o.top=o.spaceTop.bottom,o.bottom=o.top):(Sp.recalcBBoxes(o.items),o.bb=Sp.commonBB(o.items),o.top=o.bb.top,o.bottom=o.bb.top+o.bb.height)}),this.packs=this.calcPackData(this.blocks)}recalcSpaces(){this.recalcGroupedBlocks(),be.default.each(this.spaces,t=>{t.bottom=t.top+t.height});let o=Math.round(be.default.last(this.spaces).bottom);this.workspace.page.setViewportParam(this.workspace.viewport,"height",o),this.workspace.page.setViewportParam(this.workspace.viewport,"type","scroll")}redrawSpaces(o){(this.spaces.length<this.currentSpaces.length||o)&&(be.default.each(o?this.currentSpaces:this.currentSpaces.slice(this.spaces.length),t=>{t.$destroy(),t.$el.remove()}),o&&(this.currentSpaces=[])),this.currentSpaces=be.default.map(this.spaces,(t,r)=>{if(this.currentSpaces[r])return this.currentSpaces[r].space=t,this.currentSpaces[r];let i=(0,gs.default)("<div>").appendTo(this._container),s=new RC({el:i.get(0),propsData:{space:t,workspace:this.workspace,spaces:this.spaces,defaultZoom:RM.constructorRouter.zoom.getZoom()}});return s.$on("changeHeight",this.resizeHandler.bind(this)),s.$on("addWidget",this.addWidgetIntoSpace.bind(this)),s.$on("duplicateGroup",this.duplicateGroup.bind(this)),s.$on("dragMove",this.dragMoveSpace.bind(this)),s.$on("dragEnd",this.dragEndSpace.bind(this)),s.$on("resizeEnd",this.resizeEndHandler.bind(this)),s})}calcPackData(o){let t={};return be.default.each(o,r=>{let i=r.model.get("pack_id");i&&(t[i]=t[i]||{top:r.box.bb_y,bottom:r.box.bb_y+r.box.bb_h},t[i].top=Math.min(t[i].top,r.box.bb_y),t[i].bottom=Math.max(t[i].bottom,r.box.bb_y+r.box.bb_h))}),t}updateSpaces(){let o=this.workspace.filterAutolayoutBlocks(this.workspace.blocks);this.blocks=this.workspace.collectBlocks(o),this.packs=this.calcPackData(this.blocks),this.groupedBlocks=this.collectBlockGroups(this.blocks,this.packs),this.spaces=this.blocksGroupsToSpaces(this.groupedBlocks),this.redrawSpaces(!0)}getGroupIdxByTop(o,t,r){let i=null,s=be.default.find(r,a=>i?i.bottom<=o&&a.top>=t:(i=a,!1));return s?s.groupIdx-1:null}getGroupSize(o,t){for(let r=0;r<t.length;r++)if(t[r].groupIdx===o)return{top:t[r].bottom,bottom:t[r+1].top};return{top:0,bottom:0}}collectBlockGroups(o,t,r){let i=-1,s=!1;return be.default.chain(o).reduce((a,l)=>{let m=l.model.get("pack_id"),c=m?t[m].top:l.box.bb_y,p=m?t[m].bottom:l.box.bb_y+l.box.bb_h,u=be.default.isEmpty(a)||c-a[a.length-1].bottom>=2;if(r&&!s){let d=this.getGroupIdxByTop(c,p,r);if(d===null)s=!0;else{if(u=d!==i,d-i>1)for(let g=i+1;g<d;g++)a.push(be.default.extend(this.getGroupSize(g,r),{items:[]}));i=d}}return u?a.push({top:c,items:[l],bottom:p}):(a[a.length-1].items.push(l),a[a.length-1].bottom=Math.max(a[a.length-1].bottom,p)),a},[]).map(a=>(a.bb=Sp.commonBB(a.items),a)).value()}static commonBB(o){if(!o||be.default.isEmpty(o))return null;let t=1/0,r=-1/0,i=1/0,s=-1/0;return be.default.each(o,a=>{t=Math.min(t,a.box.bb_x),i=Math.min(i,a.box.bb_y),r=Math.max(r,a.box.bb_x+a.box.bb_w),s=Math.max(s,a.box.bb_y+a.box.bb_h)}),{left:Math.round(t),top:Math.round(i),width:Math.round(r-t),height:Math.round(s-i)}}blocksGroupsToSpaces(o,t){let r,i=be.default.find(RM.constructorRouter.workspace.getViewports(),m=>m.isCurrent).height,s=0,a=be.default.chain(o).map((m,c)=>{if(!c&&m.top<=0)return r=m,!1;let p={top:Math.floor(r&&r.bottom||0),bottom:Math.ceil(m.top),groupIdx:c};return t&&t[s]&&t[s].top>=p.top&&t[s].bottom<=p.bottom&&(p.top=t[s].top,p.bottom=t[s].bottom),p.height=p.bottom-p.top,m.spaceTop=p,r&&(r.spaceBottom=p),r=m,s++,p}).filter(m=>m).value(),l=Math.max(i-(r&&r.bottom||0),30);return a.push({top:r&&r.bottom||0,height:l,bottom:l+(r&&r.bottom||0),groupIdx:o.length||-1,isLast:!0,bbTop:r&&{top:-r.bb.height-1+"px",left:r.bb.left-1+"px",height:r.bb.height+"px",width:r.bb.width+"px"},bbBottom:null}),o.length&&(be.default.last(o).spaceBottom=be.default.last(a)),a}moveBlocksBottom(o,t,r,i){let s=null;be.default.each(o,(l,m)=>{m<t||(s=s||l.spaceTop,be.default.each(l.items,c=>{c.model.set("y",Math.round(c.model.get("y")+r)),c.box.bb_y=Math.round(c.box.bb_y+r),this.affectedBlocks.push(c.block)}),i&&(l.bb.top=Math.round(l.bb.top+r),l.bb.bottom=Math.round(l.bb.top+l.bb.height)))});let a=s?this.spaces.indexOf(s):this.spaces.length-1;i&&a>-1&&be.default.each(this.spaces,(l,m)=>{m===a?(l.height=Math.round(l.height+r),l.bottom=Math.round(l.bottom+r)):m>a&&(l.top=Math.round(l.top+r),l.bottom=Math.round(l.bottom+r))})}moveAllBlocksBottom(o,t,r){let i=t;be.default.each(o,s=>{be.default.each(s.items,a=>{a.model.set("y",Math.round(a.model.get("y")+i)),this.affectedBlocks.push(a.block)}),r&&(s.bb.top+=i,s.bb.bottom=s.bb.top+s.bb.height,s.spaceTop.height=Math.round(s.spaceTop.height+t),s.spaceTop.top=Math.round(s.spaceTop.top+i-t),s.spaceTop.bottom=s.spaceTop.top+s.spaceTop.height),i=Math.round(i+t)})}sizeBetweenSpaces(o){let t=o.spaceTop,r=this.spaces.indexOf(t),i=this.spaces[r+1];return i?i.top-(t&&t.bottom||0):null}moveBlockToGroup(o,t,r){let i=this.getGroupByModel(o.model),s=this.groupedBlocks.indexOf(i),a=this.groupedBlocks[t],l=s>t?-1:1,m=be.default.find(i.items,x=>x.block===o);if(!a||!i||a===i)return null;let c=this.getBlockOffsetInGroup(m,r),p=(o.model.get("angle")||0)*Math.PI/180,u=o.model.get("h"),d=u*Math.cos(p)+o.model.get("w")*Math.sin(p),g=d+c.top,h=Math.ceil((a.spaceTop&&a.spaceTop.bottom||0)+(d-u)/2+c.top),b=this.sizeBetweenSpaces(a);if(l<0&&b>g&&(h=Math.floor(a.spaceBottom.top-u-(d-u)/2-c.bottom)),o.latestPosSizeAngle.top=h,be.default.defer(()=>{o.model.set("y",h),o.redrawPosition(o.model,{forceRedraw:!0})}),a.items.push(m),i.items=be.default.without(i.items,m),b&&b<g){let x=g-b;this.moveBlocksBottom(this.groupedBlocks,this.groupedBlocks.indexOf(a)+1,x);let y=this.spaces.indexOf(a.spaceTop);be.default.each(this.spaces,(S,k)=>{k>y&&(S.top+=x,S.bottom+=x)})}return h}saveChanges(){this.workspace.page.saveHeight({skipHistory:!0}),this.workspace.save_group(this.getModelToSave())}moveBlocksToHighlighted(o){let t=this.groupedBlocks[this.highlightGroupIdx];this.highlight&&t&&(be.default.each(o,r=>{this.moveBlockToGroup(r,this.highlightGroupIdx,be.default.map(o,i=>{let s=this.getGroupByBlock(i);return be.default.find(s.items,a=>a.block===i)}))}),be.default.defer(()=>{this.recalcSpaces()}))}highlightGroup(o,t,r,i,s){if(i!==0)return;let a=r.reduce((u,d)=>{let g=d.getBoxData();return{top:Math.min(g.y,u.top?u.top:1/0),left:Math.min(g.x,u.left?u.left:1/0),right:Math.min(g.x+g.w,u.left?u.left:1/0),bottom:Math.min(g.y+g.h,u.top?u.top:1/0)}},{}),l=this.spaces[0];be.default.each(this.spaces,u=>{(s<0?u.top<a.top+s:u.bottom<a.bottom+s)&&(l=u)});let m=this.spaces[this.spaces.indexOf(l)+1],c=(0,gs.default)(window).width(),p=-Math.max((c-this.workspace.mag.getViewportWidth(this.workspace.viewport))/2,0);m&&(this.removeHighlight(),this.highlight=(0,gs.default)('<div class="space-highlighter green"/>').css({top:l.bottom,left:p,width:c,height:m.top-l.bottom}),this.highlight.appendTo(t.parent()),this.highlightGroupIdx=l.groupIdx)}needFreeze(o){return this.highlightGroupIdx!==this.groupedBlocks.indexOf(this.getGroupByBlock(o))}updateGhost(o,t,r,i,s){this.highlightGroup(s,i,o,t-this.prevdY,t),this.removeGhost(),this.ghostsContainers=be.default.map(o,a=>{let l=a.$el.clone(),m=this.groupedBlocks.indexOf(this.getGroupByBlock(a));return l.css({opacity:m!==this.highlightGroupIdx?1:".2","z-index":1e4,left:parseInt(l.css("left"),10)+r+"px",top:parseInt(l.css("top"),10)+t+"px"}),l.appendTo(i),m!==this.highlightGroupIdx&&a.$el.css({opacity:.2}),{ghost:l,source:a.$el}}),this.prevdY=t}removeGhost(){this.ghostsContainers&&(be.default.each(this.ghostsContainers,o=>{o.ghost.remove(),o.source.css({opacity:""})}),this.ghostsContainers=null)}removeHighlight(){this.highlight&&(this.highlight.remove(),this.highlight=null)}clearAll(){this.removeHighlight(),this.removeGhost()}destroy(){clearTimeout(this.initTimeout),this._container.find("> .space-highlighter").remove(),be.default.each(this.currentSpaces,o=>{o.$destroy()}),be.default.each(this.workspace.blocks,o=>{o.off("resize",this._resizeBlockHandlerBinded),o.off("move",this._moveIntoSpacesBinded),o.model.off("change:hidden change:fixed_position",this._updateSpacesBinded),o.model.off("change:angle",this._handleRotateBinded),o.model.off("change",this._undoRedoHandlerBinded)}),this.workspace.page.off("widget:create",this._createWidgetHandlerBinded),this.workspace.page.off("widget:remove",this._removeWidgetHandlerBinded),this.workspace.page.off("change:viewport",this._updateSpacesBinded),this.workspace.page.off("change:height",this._resizePageHandlerBinded),this.workspace.$el.toggleClass("blocks-mode",!1),(0,gs.default)("body").off("mousemove",this._onMouseMoveBinded)}},Fw=AC;nd();wo();cd();mb();var om=T(cl());ta();var ks=T(H());var Pp=T(H());function Ww(){let e=(0,Pp.useRef)(document.getElementById("main"));return(0,Pp.useLayoutEffect)(()=>(e.current.classList.add("comment-cursor"),()=>{e.current.classList.remove("comment-cursor")}),[]),null}var Uw=T(H());v();var Gw=(0,Uw.forwardRef)(({children:e,width:o,height:t},r)=>n("div",{style:{width:o,height:t,top:0,left:0,right:0,margin:"0 auto",position:"absolute"},"data-testid":"comment-root",children:n("div",{ref:r,style:{zoom:"var(--workspace-inverse-zoom)"},children:e})}));var Qo=T(H());G();Sr();var Vw=T(H());Sr();v();var DC=(0,Vw.forwardRef)((e,o)=>n("svg",{width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{d:"M25 13C25 19.6274 19.6274 25 13 25C9.41592 25 6.57143 25 1 25C0.999999 20.7143 1 16.0433 1 13C1 6.37258 6.37258 1 13 1C19.6274 1 25 6.37258 25 13Z",fill:"currentColor"})})),Tp={rotate:[0,-45,0,-45,0],transition:{duration:1}},Mp=qt(DC);var Vt=T(H()),y0=T(ga()),fs=T(qc());G();fa();Br();re();G();ve();v();var Gd="user",at={large:128,regular:72,medium:48,small:32,xsmall:24},jw={user:"lightGray",info:"orange",count:"white",settingsUser:"white",commentsUser:"white"},$C={user:"black",settingsUser:"black",info:"white",count:"black",commentsUser:"darkGray"},LC=Y(f)`
  display: inline-block;
  border-radius: 50%;
  user-select: none;
  position: relative;
  overflow: hidden;
`,HC=Y(Le)`
  text-transform: uppercase;
`,OC=Y("img")`
  top: 0;
  left: 0;
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
`,NC=e=>{let[o,t]=e.split(" ");return t?o[0]+t[0]:o[0]};function Yw({name:e,size:o,url:t,type:r,showInitials:i,showTitle:s,className:a,children:l,bgColor:m,textColor:c,...p}){let u=o?at[o]:at.regular,d=r==="user"||r==="settingsUser"||r==="commentsUser";return n(LC,{...p,width:u,height:u,cursor:p.onClick?"pointer":void 0,backgroundColor:r==="user"?jw.user:"transparent",className:a,children:n(f,{display:"flex",backgroundColor:m||jw[r||Gd],width:"100%",height:"100%",justifyContent:"center",alignItems:"center",title:s?e:void 0,children:l?n(K,{children:l}):n(K,{children:t?n(OC,{src:t,alt:e}):i?n(HC,{color:c||$C[r||Gd],textStyle:o==="regular"?"subheading":r==="count"||o==="xsmall"?"small":"regular",children:d?NC(e):e||"?"}):null})})})}Yw.defaultProps={name:"?",size:"regular",type:Gd,showInitials:!0};var qw=Yw;v();var Xw=[64,96,128,192,256],FC=(e,o)=>{let t=e.split(".").pop(),r=WC(o);return e&&r?e.replace(`.${t}`,`_${r}.${t}`):""},WC=e=>{let o=e*2;return Xw.reduce((t,r)=>o<=r&&o>t?r:t,Xw[0])};function Kw(e){return n(qw,{...e,url:e.url?FC(e.url,e.size?at[e.size]:at.regular):void 0})}Kw.defaultProps={size:"regular"};var zt=Kw;ve();ao();re();k2();var r0=T(H()),i0=T(H());Sr();G();Xo();go();Yr();re();var Bp=T(H());Sr();G();zh();re();var Jw=T(ga());ha();v();var Vd={type:"spring",damping:40,stiffness:280},jd="rgba(0,0,0,.6)",UC=qt(Y(f)({width:"100vw",height:"100vh",position:"fixed",zIndex:99999,top:0,left:0})),GC=qt(Y(f)({width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:1,backgroundColor:jd,cursor:"zoom-out"})),Zw=qt(Y(f)({width:"100%",height:"100%",backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"contain",opacity:0}));function Qw({imgSrc:e,thumbSrc:o,isVisible:t,onClose:r}){Ko(Jw.Key.Escape,r);let[i,s]=(0,Bp.useState)(!1);return(0,Bp.useEffect)(()=>{if(t){let l=new Image;l.src=e,l.decode().then(()=>s(!0))}return()=>s(!1)},[e,t]),n(Al,{container:()=>document.getElementById("constructor"),children:n(qo,{children:t&&n(UC,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:w(GC,{role:"presentation",animate:{backgroundColor:jd},transition:Vd,onClick:l=>{l.stopPropagation(),r()},style:{width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:1,backgroundColor:jd,cursor:"zoom-out"},children:[n(Zw,{role:"dialog",initial:{opacity:0},animate:{opacity:i?1:0},exit:{opacity:0},transition:Vd,style:{backgroundImage:`url(${e})`,zIndex:0}}),o&&n(Zw,{initial:{opacity:1},animate:{opacity:i?0:1},exit:{opacity:0},transition:Vd,style:{backgroundImage:`url(${o})`,zIndex:1,filter:"blur(0.6px)"}})]})})})})}var e0=T(H());v();var t0=(0,e0.forwardRef)((e,o)=>n("svg",{width:"32",height:"32",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{d:"M23.0146 8C23.5669 8 24.0146 8.44772 24.0146 9V13.5858C24.0146 14.4767 22.9375 14.9229 22.3075 14.2929L20.7573 12.7426L18.2573 15.2426C17.8667 15.6332 17.2336 15.6332 16.8431 15.2426C16.4525 14.8521 16.4525 14.219 16.8431 13.8284L19.3431 11.3284L17.7217 9.70711C17.0918 9.07714 17.5379 8 18.4288 8H23.0146ZM9 24.0356C8.44772 24.0356 8 23.5879 8 23.0356V18.4499C8 17.559 9.07714 17.1128 9.70711 17.7428L11.2574 19.293L13.7574 16.793C14.1479 16.4025 14.781 16.4025 15.1716 16.793C15.5621 17.1835 15.5621 17.8167 15.1716 18.2072L12.6716 20.7072L14.2929 22.3285C14.9229 22.9585 14.4767 24.0356 13.5858 24.0356H9Z",fill:"currentColor"})}));v();var o0=Y(mt)`
  &:hover {
    color: ${e=>e.theme.colors.orange};
  }
`,Ip=r0.default.memo(function({image:e,showRemove:o,onRemove:t}){let r=e.url,i=e.meta?.thumbUrl,s=()=>{t&&t()},{isHovered:a,...l}=Ge(!1),[m,c]=(0,i0.useState)(!1),p=()=>{c(!0)},u=()=>{c(!1)},d=g=>{g.stopPropagation(),p()};return w(K,{children:[w(f,{width:"100%",height:112,marginBottom:4,marginTop:8,borderRadius:4,backgroundImage:`url(${r})`,backgroundColor:"transparent",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative",borderWidth:1,borderStyle:"solid",borderColor:Me("darkGray",.15),...l,children:[o&&n(o0,{height:32,width:32,position:"absolute",top:-8,right:-8,hoverColor:"white",activeColor:"white",onClick:s,children:n(Ht,{})}),n(qo,{children:a&&!o&&n(qt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:n(o0,{height:32,width:32,position:"absolute",left:"50%",bottom:9,transform:"translateX(-50%)",hoverColor:"white",activeColor:"white",onClickCapture:d,children:n(t0,{})})})})]}),n(Qw,{imgSrc:r,thumbSrc:i,isVisible:m,onClose:u})]})});var n0=T(H());v();var s0=(0,n0.forwardRef)((e,o)=>n("svg",{width:"26",height:"24",viewBox:"0 0 26 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.1313 3C17.5224 3 16.2182 4.30421 16.2182 5.91304C16.2182 7.52188 17.5224 8.82609 19.1313 8.82609C20.7401 8.82609 22.0443 7.52187 22.0443 5.91304C22.0443 4.30421 20.7401 3 19.1313 3ZM14.2182 5.91304C14.2182 3.19965 16.4179 1 19.1313 1C21.8447 1 24.0443 3.19964 24.0443 5.91304C24.0443 8.62645 21.8447 10.8261 19.1313 10.8261C16.4179 10.8261 14.2182 8.62644 14.2182 5.91304ZM10.7503 7.67753L15.9307 16.6501C16.3187 17.3222 17.2912 17.3154 17.6697 16.6379L19.0717 14.1287L22.9108 21L18.8129 21L18.8092 21L18.8067 21H3.05861L10.7503 7.67753ZM9.20062 6.36174C9.88939 5.16875 11.6113 5.16876 12.3001 6.36174L16.7825 14.1255L17.5095 12.8242C18.1924 11.602 19.951 11.602 20.6338 12.8242L24.8318 20.3377C25.4983 21.5305 24.636 23 23.2696 23H18.8129L18.8104 23L18.8067 23H2.69397C1.31643 23 0.455476 21.5088 1.14424 20.3158L9.20062 6.36174Z",fill:"currentColor"})}));var a0=T(H());v();var l0=(0,a0.forwardRef)((e,o)=>n("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{d:"M11.7379 9.04793C13.4178 9.04793 14.493 10.3984 14.493 12.5758C14.493 14.7531 13.4178 16.1312 11.7111 16.1312C10.0849 16.1312 9.09041 14.7945 9.09041 12.5758C9.09041 10.3571 10.0715 9.04793 11.7379 9.04793ZM12.1949 1C5.5559 1 1 5.68544 1 12.5069C1 19.4937 5.46182 24 12.4233 24C14.0226 24 15.5547 23.7795 16.7104 23.3936V21.4368C15.9041 21.7813 14.2108 22.0156 12.5174 22.0156C6.77886 22.0156 3.09652 18.3361 3.09652 12.5758C3.09652 6.93948 6.81918 2.95686 12.047 2.95686C17.3286 2.95686 20.9035 6.29179 20.9035 11.2804C20.9035 14.4086 19.8955 16.4206 18.3097 16.4206C17.3958 16.4206 16.8852 15.8418 16.8852 14.8772V7.13241H14.6005V8.79988H14.372C13.8479 7.58718 12.6518 6.84302 11.2407 6.84302C8.49908 6.84302 6.61759 9.17196 6.61759 12.5207C6.61759 16.0072 8.48564 18.3499 11.281 18.3499C12.8534 18.3499 14.0226 17.592 14.587 16.2001H14.8155C15.0305 17.5368 16.2535 18.4326 17.8662 18.4326C21.011 18.4326 23 15.6351 23 11.1977C23 5.16177 18.5785 1 12.1949 1Z",fill:"currentColor"})}));var Yd=T(H());v();var p0=(0,Yd.forwardRef)((e,o)=>n("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{d:"M11.1924 0.707108C11.5829 1.09763 11.5829 1.7308 11.1924 2.12132L7.36396 5.94975L11.1924 9.77818C11.5829 10.1687 11.5829 10.8019 11.1924 11.1924C10.8019 11.5829 10.1687 11.5829 9.77818 11.1924L5.94975 7.36396L2.12132 11.1924C1.7308 11.5829 1.09763 11.5829 0.707108 11.1924C0.316584 10.8019 0.316583 10.1687 0.707108 9.77818L4.53554 5.94975L0.707108 2.12132C0.316584 1.7308 0.316584 1.09763 0.707108 0.707108C1.09763 0.316584 1.7308 0.316584 2.12132 0.707108L5.94975 4.53554L9.77818 0.707108C10.1687 0.316584 10.8019 0.316584 11.1924 0.707108Z",fill:"currentColor"})})),c0=(0,Yd.forwardRef)((e,o)=>n("svg",{width:"7",height:"12",viewBox:"0 0 7 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,ref:o,children:n("path",{d:"M0.7072 0.7072C0.316676 1.09772 0.316675 1.73089 0.7072 2.12141L4.53566 5.94988L0.707271 9.77827C0.316747 10.1688 0.316746 10.802 0.707271 11.1925C1.09779 11.583 1.73096 11.583 2.12148 11.1925L6.65459 6.65938C6.75612 6.55785 6.83125 6.43992 6.87999 6.31412C7.02054 5.95529 6.94585 5.53164 6.65593 5.24172L2.12141 0.7072C1.73089 0.316676 1.09772 0.316676 0.7072 0.7072Z",fill:"currentColor"})}));ep();pt();var yn=T(H()),m0=T(nr());_b();G();re();ha();var zp=T(ga());v();ig();var d0=(e="",o="")=>!e||o.toLowerCase().includes(e.toLowerCase()),VC=({items:e=[],search:o="",disabled:t,isOpen:r,isCaretAtSearch:i,onToggle:s,onChange:a,getKey:l,getLabel:m,trigger:c,dropdownContainer:p,children:u,...d})=>{let[g,h]=(0,yn.useState)(0),b=o?o.replace(/^@/,""):"",x=e.filter(y=>d0(b,m(y)));return Ko(zp.Key.ArrowDown,y=>{r&&(y.preventDefault(),h(Math.min(x.length-1,g+1)))},[g,x.length,r]),Ko(zp.Key.ArrowUp,y=>{r&&(y.preventDefault(),h(Math.max(0,g-1)))},[g,r]),Ko(zp.Key.Enter,y=>{if(r){y.preventDefault(),y.stopPropagation();let S=e.filter(k=>d0(b,m(k)));a(S[g]),s(!1)}},[g,e,r]),(0,yn.useEffect)(()=>{!t&&i&&s(x.length>0)},[x.length,i,t]),(0,yn.useEffect)(()=>{r||h(0)},[r]),n(wn,{onStateChange:({isOpen:y})=>{y!==void 0&&!t&&s(y)},highlightedIndex:g,itemToString:m,children:({getItemProps:y,getMenuProps:S,highlightedIndex:k,getRootProps:P,getToggleButtonProps:C})=>w(f,{...P(),...d,children:[r?void 0:(0,yn.cloneElement)(c,{...C,onClick:()=>s(t?!1:!r)}),r?m0.default.createPortal(n(f,{as:"ul",display:"flex",flexDirection:"column",gap:"4px 0",...S(),"data-testid":"mention-suggest",children:x.map((B,$)=>{let A=l(B);return rg(f,{as:"li",...y({key:A,index:$,item:B}),onClick:R=>{R.stopPropagation(),a(B),s(!1)},key:A,display:"flex",alignItems:"center",height:"32px",lineHeight:"32px",padding:"0 8px",gap:"0 8px",borderRadius:"8px",background:k===$?Me("gray",.32):"none",cursor:"pointer",whiteSpace:"nowrap"},u(B))})}),p):void 0]})})},u0=VC;ha();var Ap=T(H()),Ii=T(qc());var g0=T(qc());hl();Ue();Gc();var jC=Y("span")`
  color: ${O.darkGray};
`,Ep=jC;v();var Ta="MENTION",YC=/\[@([^\]]+)]\(([^)]+)\)/g,qC=/\[@([^\]]+)]\(([^)]+)\)/,XC=/(\[@[^\]]+]\([^)]+\))/g,KC=(e,o)=>`[@${o}](${e})`,h0=e=>e.split(XC).map((o,t)=>{let[,r,i]=o.match(qC)||[];return r&&i?w(Ep,{children:["@",r]},t):o}),f0=e=>{let o=[],t={},r=0,i=0,s=(l,m,c,p)=>{let u=r;return o.push({offset:p+i,length:m.length+1,key:u}),t[u.toString()]={type:Ta,mutability:"IMMUTABLE",data:{key:c}},i=i+m.length+1-l.length,r++,"@"+m};return{blocks:e.replace(YC,s).split(`
`).map(l=>({text:l,type:"unstyled",entityRanges:o})),entityMap:t}},Rp=e=>{let o=e.getCurrentContent();return o.getBlocksAsArray().reduce((t,r)=>{let i=r.getText(),s=0;return r.findEntityRanges(function(l){let m=l.getEntity(),c=m!==null?o.getEntity(m):void 0;return!!(c&&c.getType()===Ta)},function(l,m){let c=r.getEntityAt(l),u=o.getEntity(c).getData()?.key||"",d=i.slice(l+s,m+s).replace(/^@/,""),g=KC(u,d);u&&(i=i.slice(0,l+s)+g+i.slice(m+s),s=s+g.length-d.length-1)}),t?t+`
`+i:i},"")},b0=(e,o,t)=>{let r=g0.Entity.create(Ta,"IMMUTABLE",{key:t}),i=e,s=i.getSelection().isCollapsed()&&ul(i)||"",[a,l]=gl(e,-1);/^@/.test(s)&&!a&&!l&&(i=bg(i));let{startOffset:m}=wg(i),c=hg(i,1),p=c&&!/\s/.test(c);p&&(i=Xn({editorState:i,text:" "})),i=Xn({editorState:i,text:"@"+o,entityKey:r});let u=fg(i,1),d=u&&!/\s/.test(u);d&&(i=Xn({editorState:i,text:" "}));let g=m+(p?1:0)+1+o.length+(d?1:0),h=i.getSelection().merge({anchorOffset:g,focusOffset:g});return ml(i,h)};hl();v();var w0=new Ii.CompositeDecorator([{strategy:(e,o,t)=>{e.findEntityRanges(r=>{let i=r.getEntity();return i===null?!1:t.getEntity(i).getType()===Ta},o)},component:({children:e})=>n(Ep,{children:e})}]),Xd=(0,Ap.createContext)({items:[],isCaretAtSearch:!1,wordAtCaret:"",hasText:!1,editorState:Ii.EditorState.createEmpty(),setEditorState(e){},clearContent(){},onMention(e){},getMarkdown:()=>"",getKey:e=>"",getLabel:e=>""}),ZC=({markdown:e="",items:o,children:t,getLabel:r,getKey:i})=>{let s=f0(e),[a,l]=(0,Ap.useState)(()=>Ii.EditorState.createWithContent((0,Ii.convertFromRaw)(s),w0)),m=y=>{let S=i(y);l(b0(a,r(y),S))},c=()=>Rp(a),p=()=>{l(Ii.EditorState.createEmpty(w0))},d=a.getSelection().isCollapsed()?ul(a):"",[g,h]=gl(a,-1),b=/^@/.test(d)&&!g&&!h,x=!!c();return n(Xd.Provider,{value:{editorState:a,setEditorState:l,onMention:m,items:o,isCaretAtSearch:b,wordAtCaret:d,hasText:x,getMarkdown:c,clearContent:p,getKey:i,getLabel:r},children:t})},x0=ZC;hl();var Zr=T(H());v();var Ma=(0,Zr.createContext)({teammates:[],getTeammateKey:()=>"",getTeammateLabel:()=>"",userId:"",ownerId:"",viewState:$d,availableMentions:!0,availableAttachment:!0});function hs({me:e,owner:o,projectTeam:t=[],viewState:r,children:i}){let s=(0,Zr.useCallback)(p=>p?p.name||p.email:"",[]),a=(0,Zr.useCallback)(p=>p?p.num_id.toString():"",[]),l=(0,Zr.useMemo)(()=>dw(e,o,t),[e,o,t]),m=(0,Zr.useMemo)(()=>({availableMentions:!!o.permissions.can_use_comment_mentions,availableAttachment:!!o.permissions.can_use_comment_attachments}),[o.permissions.can_use_comment_mentions,o.permissions.can_use_comment_attachments]),c=(0,Zr.useMemo)(()=>({getTeammateLabel:s,getTeammateKey:a,teammates:l,viewState:r,userId:e._id,ownerId:o._id,...m}),[s,a,l,e._id,o._id,r,m]);return n(Ma.Provider,{value:c,children:i})}v();var Kd=Y("button")`
  box-sizing: border-box;
  width: 32px;
  height: 32px;
  padding: 0;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  border-radius: 50%;
  color: ${e=>e.theme.colors.black};
  background-color: transparent;
  cursor: pointer;

  &:hover {
    color: ${e=>e.theme.colors.orange};
  }

  &:disabled {
    color: ${e=>e.theme.colors.gray};
    pointer-events: none;
  }
`,v0=Y(Kd)`
  border: 1px solid ${e=>Me(e.theme.colors.darkGray,.15)};

  &:hover {
    color: white;
  }

  ${e=>ll({submit:{"&:hover":{backgroundColor:e.theme.colors.orange}},close:{"&:hover":{backgroundColor:e.theme.colors.black}}})}
`,JC=e=>{let o=e.current,t=e.current?.editor;if(!o||!t)return;let r=i=>{i.preventDefault();let s=i.clipboardData?.getData("text/plain");s&&o.props?.handlePaste&&o.props.handlePaste(s,void 0,o?._latestEditorState)};return t.addEventListener("paste",r,!0),{unregister(){t.removeEventListener("paste",r,!0)}}},k0={editorSave:"editor-save"},QC=Y(Le)`
  & .public-DraftEditorPlaceholder-root {
    color: ${({theme:e})=>e.colors.gray};
    position: absolute;
    pointer-events: none;
  }
`;function eS({defaultContent:e,image:o,textStyle:t,showCancel:r=!0,onCancel:i,onSubmit:s,disableMentions:a=!1,disableAttachments:l=!1,draftEditorRef:m,...c}){let p=(0,Vt.useRef)(null),u=(0,Vt.useRef)(!0),d=xp(p,{root:null,rootMargin:"0px",threshold:1}),[g,h]=(0,Vt.useState)(!1),[b,x]=(0,Vt.useState)(o||void 0),{items:y,onMention:S,hasText:k,isCaretAtSearch:P,wordAtCaret:C,clearContent:B,getMarkdown:$,getKey:A,getLabel:R,editorState:Z,setEditorState:F}=(0,Vt.useContext)(Xd),V=y.length>0,W=!V||a,J=(0,Vt.useRef)(null),[me,se]=(0,Vt.useState)(!1),[ee,ue]=(0,Vt.useState)(V&&P&&!W),ke=(0,Vt.useRef)(null),ge=ug(m,ke);(0,Vt.useEffect)(()=>{let pe=p.current,ze=d&&d.intersectionRatio<1;pe&&ze&&u.current&&(u.current=!1,pe.scrollIntoView({block:"end"}))},[d]);let we=pe=>{let ze=p.current,Ae=d&&d.intersectionRatio<1;ze&&Ae&&ze.scrollIntoView({block:"end"}),F(pe)},L=(0,Vt.useCallback)(async pe=>{if(!l){if(pe.size>oe.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(oe.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!g){h(!0);try{let ze=await yi("comment-image",pe);ze&&ze.picture&&x({url:ze.picture.url,originUrl:ze.picture.originUrls?.url,meta:{size:ze.size,thumbUrl:ze.picture.thumbUrl}})}catch(ze){console.error("upload image error",ze)}finally{h(!1)}}}},[g,l]),j=()=>{x(null)};(0,Vt.useEffect)(()=>{if(ke&&ke.current!==null&&ke.current.editor){let pe=JC(ke);return F(fs.EditorState.moveFocusToEnd(Z)),()=>{pe?.unregister()}}},[ke]);let N=pe=>{pe.stopPropagation(),B(),i?.()},de=k||b,le=pe=>{pe&&pe.stopPropagation(),de&&(s($(),b),B())};function We(pe){return pe.code==="Enter"&&!pe.shiftKey?k0.editorSave:(0,fs.getDefaultKeyBinding)(pe)}function he(pe){return pe===k0.editorSave?(ee||le(),"handled"):"not-handled"}let fe=(0,Vt.useCallback)((pe,ze,Ae)=>{let Ne=Xn({editorState:Ae,text:pe});return F(Ne),"handled"},[F]);return Ko(y0.Key.Escape,()=>{B(),i?.()},[B]),(0,Vt.useEffect)(()=>{W||ue(P)},[P,W]),(0,Vt.useEffect)(()=>{k||ue(!1)},[k]),w(f,{...c,ref:p,scrollMargin:30,"data-testid":"comment-editor",children:[b&&n(Ip,{image:b,showRemove:!0,onRemove:j}),n(QC,{as:"div",textStyle:t,cursor:"initial",onClick:pe=>pe.stopPropagation(),children:n(fs.Editor,{ref:ge,placeholder:"Add a comment",editorState:Z,onChange:we,keyBindingFn:We,handleKeyCommand:he,handlePaste:fe,"data-testid":"comment-input"})}),n(f,{marginTop:16,overflow:"hidden",children:n(tS,{left:w(f,{display:"flex",gap:4,marginLeft:-4,children:[me&&J.current&&n(u0,{title:V?void 0:"Add collaborator first",disabled:W,isOpen:ee,isCaretAtSearch:P,onToggle:ue,onChange:S,items:y,search:P?C:void 0,getKey:A,getLabel:R,trigger:n(f,{children:n(dt,{text:"Upgrade to mention teammates",disabled:!a,children:n(f,{as:"span",children:n(Kd,{title:V?"Mention":void 0,disabled:W,"data-testid":"comment-mention-trigger",children:n(l0,{})})})})}),dropdownContainer:J.current,children:pe=>w(K,{children:[n(zt,{size:"xsmall",url:pe.pic,name:pe.name||pe.email,flex:"none"}),n(Le,{textStyle:"small",overflow:"hidden",textOverflow:"ellipsis",children:pe.name||pe.email})]})}),ee?void 0:n(dt,{text:"Upgrade to upload images",disabled:!l,children:n("span",{children:n(Kd,{title:"Add image",disabled:g||l,children:n(Tr,{accept:"image/*",dropFile:!1,readFileData:!1,onChange:L,disabled:g,title:"Add image",children:n(f,{display:"flex",justifyContent:"center",alignItems:"center",children:g?n(Xt,{color:"darkGray",bgColor:"transparent",size:24}):n(s0,{})})})})})})]}),right:ee?void 0:w(f,{display:"flex",gap:8,role:"button",children:[r?n(v0,{onClick:N,variant:"close",children:n(p0,{})}):void 0,n(v0,{onClick:le,disabled:!de,variant:"submit","data-testid":"submit-comment",children:n(c0,{})})]})})}),n(f,{ref:pe=>{J.current=pe,se(!0)}})]})}var tS=({left:e,right:o,...t})=>w(f,{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",...t,children:[n(f,{children:e}),n(f,{children:o})]});function bs({content:e,...o}){let{getTeammateKey:t=()=>"",getTeammateLabel:r=()=>"",teammates:i=[],availableMentions:s,availableAttachment:a}=(0,Vt.useContext)(Ma);return n(x0,{markdown:e,items:i,getLabel:r,getKey:t,children:n(eS,{...o,disableMentions:!s,disableAttachments:!a})})}var Ba=T(H());wi();v();function _0(e,o,t=1){let r=xt.mapPointerToDocument(e,1,t),i=xt.mapElementToDocument(o,1,t);return xt.absoluteToRelative(r,i)}function C0({workspace:e,onCreate:o}){let[t,r]=(0,Ba.useState)({width:0,height:0,top:0,left:0});(0,Ba.useEffect)(()=>{function s(a,l){let m=window.RM.constructorRouter.zoom.getZoom(),c=a.$el.get(0),p=a.getBoxData({includeRotationData:!0}),u=_0(l,c,m),d=xt.rotate(u,{left:p.w/2,top:p.h/2},-p.angle);o({widgetId:a.model.id,placement:{x:d.left,y:d.top}})}return e.on("block:click",s),()=>{e.off("block:click",s)}},[e,o]),(0,Ba.useEffect)(()=>{function s(){let a=window.RM.constructorRouter.zoom.getZoom(),l=e.getDocumentBox(),m=e.getOriginBox(),c={width:l.width,height:l.height,top:-m.top,left:-m.left};r(xt.resize(c,a))}return s(),e.on("workspace-resize",s),()=>{e.off("workspace-resize",s)}},[e]);function i(s){let a=window.RM.constructorRouter.zoom.getZoom(),l=_0(s.nativeEvent,e.$origin.get(0),a);o({placement:{x:l.left,y:l.top}})}return n("div",{onClick:i,style:{position:"absolute",...t}})}var Ia=T(H());re();G();wi();v();var oS=27,rS=0,iS=Y(f,{excludeProps:["placement","top","left","bottom","right","offsetTop","offsetLeft"]})`
  top: ${e=>ws(e.placement.top)};
  left: ${e=>ws(e.placement.left)};
  bottom: ${e=>ws(e.placement.bottom)};
  right: ${e=>ws(e.placement.right)};
  z-index: ${e=>e.zIndex||ms.zoomedBox};
  margin-top: ${e=>ws(e.offsetTop)};
  margin-left: ${e=>ws(e.offsetLeft)};
  transform: ${e=>nS(e.placement)};
`,Dp=(0,Ia.forwardRef)(({commentPosition:e,children:o,...t},r)=>{if(!e)return null;let i=e.y,s=e.x,a=e?.style?.right??0,l=e?.style?.bottom??0,m=e?.style?.marginTop??0,c=e?.style?.marginLeft??0;return n(iS,{...t,ref:r,offsetTop:m,offsetLeft:c,placement:{top:i,left:s,bottom:l,right:a},position:e?.style?.position??"absolute","aria-label":"comment",children:n(f,{marginTop:-oS,marginLeft:-rS,children:o})})});function $p(e,o,t){let{zoom:r}=uw(),i=(0,Ia.useMemo)(()=>{if(e)return t.getActiveBlocks().find(a=>a.id===e.widgetId)},[e]),s=i?.model?.get("sticked");return(0,Ia.useMemo)(()=>{if(!e)return null;let a=o===t.getPageId();return i&&(a||i.model.get("is_global"))?cS(e.placement,i):a?e.placement:null},[e,i,s?r:void 0])}function ws(e){return e?e==="auto"||typeof e=="string"&&e.endsWith("%")?e:`calc(${e}px * var(--workspace-zoom))`:""}function nS(e){return e.right&&e.bottom?"translate(100%, 100%)":e.right?"translateX(100%)":e.bottom?"translateY(100%)":"none"}function sS(e,o){let t=xt.rotate({left:e.x,top:e.y},{left:o.w/2,top:o.h/2},o.angle),r=t.left,i=t.top;return{x:r,y:i}}function xs(e){return e?e.endsWith("%")?e:parseFloat(e):0}function aS(e){let o=e.style;return{left:xs(o.left),top:xs(o.top),right:xs(o.right),bottom:xs(o.bottom),marginTop:xs(o.marginTop),marginLeft:xs(o.marginLeft)}}function lS(e,o,t,r){let i=aS(r),{top:s,left:a}=i;return["nw","w","sw"].includes(t)&&typeof a=="number"&&(a+=e.x),["nw","n","ne"].includes(t)&&typeof s=="number"&&(s+=e.y),["ne","e","se"].includes(t)&&typeof i.right=="number"&&(i.right+=o.w-e.x),["sw","s","se"].includes(t)&&typeof i.bottom=="number"&&(i.bottom+=o.h-e.y),["n","c","s"].includes(t)&&(i.marginLeft+=e.x),["w","c","e"].includes(t)&&(i.marginTop+=e.y),{y:s,x:a,style:{position:"fixed",...i}}}function pS(e,o){let t=xt.relativeToAbsolute({top:e.y,left:e.x},{left:o.x,top:o.y});return{y:t.top,x:t.left}}function cS(e,o){let t=o.getBoxData({includeBoundingBox:!0,includeRotationData:!0}),r=e.x>t.w?t.w:e.x,i=e.y>t.h?t.h:e.y,s=sS({x:r,y:i},t),a=o.model.get("fixed_position");if(a){let l=o.$el.get(0);return lS(s,t,a,l)}return pS(s,t)}var zi=T(H());ld();L2();v();var dS=300,mS={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn({state:e,name:o,options:t}){let r=Bh(e,t),{x:i,y:s}=e.modifiersData.preventOverflow||{x:0,y:0},{width:a,height:l}=e.rects.popper,[m]=e.placement.split("-"),c=m==="left"?"left":"right",p=m==="top"?"top":"bottom";e.modifiersData[o]={width:a-r[c]-i,height:l-r[p]-s}}},uS={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:e}){let{height:o}=e.modifiersData.maxSize;e.styles.popper.maxHeight=`${o}px`}},Zd=(e={})=>({rootBoundary:"document",boundary:document.body,padding:30,...e});function Lp({children:e}){let[o,t]=(0,zi.useState)(null),[r,i]=(0,zi.useState)(null),{height:s}=gw(r),a=rs(o,r,{modifiers:[{name:"preventOverflow",options:Zd()},{name:"offset",options:{offset:[0,16]}},{name:"flip",options:Zd({padding:{right:dS}})},{...mS,options:Zd()},uS],placement:"right"}),{styles:l,attributes:m}=a;(0,zi.useEffect)(()=>{s!==0&&a?.update?.()},[s]);let c=(0,zi.useCallback)(u=>{t(u)},[]),p=(0,zi.useCallback)(u=>{i(u)},[]);return n(K,{children:e({setReferenceElementRef:c,setPopperElementRef:p,styles:l,attributes:m})})}Be();ha();var S0=T(ga());hl();v();function P0({workspace:e,onDone:o}){let[t,r]=(0,Qo.useState)(null),i=$p(t,e.getPageId(),e),[s,a]=Xr(),l=(0,Qo.useRef)(null),{me:m,owner:c,projectTeam:p}=(0,Qo.useContext)(ie),u=xh(),d=(0,Qo.useCallback)((b=!0)=>{let x="";if(l.current?.props.editorState){x=Rp(l.current.props.editorState);let S=ml(l.current.props.editorState,gg({content:l.current.props.editorState.getCurrentContent()}));l.current.props.onChange(S)}let y=x.length===0;return!y&&b&&u.start("shake"),y},[]);Ko(S0.Key.Escape,()=>{d(!1)&&r(null)},[d]),(0,Qo.useEffect)(()=>{s!==null&&i!==null&&r(null)},[s,i]);function g(b){if(s){a(null);return}if(t){d()&&r(null);return}r(b)}function h(b,x){t&&o({position:t,content:b,commentImage:x}),r(null)}return w(Qo.Fragment,{children:[n(Dp,{commentPosition:i,zIndex:ms.expandedBubble,children:n(Lp,{children:({setPopperElementRef:b,setReferenceElementRef:x,attributes:y,styles:S})=>w(K,{children:[n(f,{color:"orange",ref:x,children:n(Mp,{animate:u,variants:{shake:Tp},initial:{rotate:0},exit:{rotate:0,transition:{duration:.2}},style:{transformOrigin:"bottom left"},stroke:"white",strokeWidth:2,filter:"drop-shadow(0px 2px 12px rgba(0, 0, 0, 0.16))"})}),n(f,{ref:b,style:S.popper,...y.popper,children:n(hs,{me:m,owner:c,projectTeam:p,children:n(bs,{onSubmit:h,width:224,padding:"12px 16px 16px 16px",boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)",backgroundColor:"white",cursor:"initial",showCancel:!1,borderRadius:8,draftEditorRef:l})})})]})})}),n(C0,{onCreate:g,workspace:e})]})}var Jr=T(H());G();Be();var Wt=T(H());r_();go();G();var T0=T(H());G();re();v();var gS=Y(f,{excludeProps:["dense"]})(({dense:e})=>({display:"flex",position:"relative",flexDirection:"column",padding:e?"0":"12px 8px"})),hS=Y(f,{excludeProps:["dense"]})(({selected:e,dense:o})=>({display:"flex",borderRadius:"8px",position:"relative",flexDirection:"column",padding:o?"0":"12px 8px 16px 8px",cursor:"pointer",backgroundColor:e?"white":"inherit",boxShadow:e?"0px 2px 16px rgba(0, 0, 0, 0.08)":"none","&:hover":{backgroundColor:"white"}})),Jd=(0,T0.forwardRef)(({children:e,disableSelectable:o=!1,selected:t,...r},i)=>n(o?gS:hS,{selected:t,ref:i,...r,children:e}));var M0=T(H()),_n=(0,M0.createContext)({selected:!1,hover:!1,commentRef:null,isTread:!1,readonly:!1});var Hp=T(H());G();ve();re();hd();Xo();ca();re();v();var fS=Y(f)({display:"flex",gap:"8px",width:"100%",alignItems:"center"});function B0({author:e,actions:o,description:t,disableActions:r}){let{hover:i}=(0,Hp.useContext)(_n),[s,a]=(0,Hp.useState)(!1),{name:l,pic:m}=e,c=i||s;return(r||o.length===0)&&(c=!1),w(fS,{children:[w(f,{position:"relative",height:24,children:[n(zt,{size:"xsmall",type:"commentsUser",name:l,url:m}),m?null:n(f,{position:"absolute",top:0,width:24,height:24,borderRadius:"50%",boxShadow:"0 0 0 1px inset rgba(133, 133, 133, 0.16)"})]}),n(Le,{textStyle:"small",color:"darkGray",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",as:"div",children:i?t:l}),c?n(f,{marginLeft:"auto",as:"span",children:n(ss,{width:224,zIndex:9999,popperOffset:[-84,26],listItems:o,container:document.body,border:"none",borderRadius:8,boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)","data-testid":"comment-context-menu",onToggleDropdown:a,role:"menu",children:({toggleDropdown:p})=>n(mt,{"aria-haspopup":!0,height:24,width:24,color:"transparent",activeColor:"lightGray",hoverColor:"lightGray","data-testid":"comment-context-menu-trigger",borderWidth:1,borderStyle:"solid",borderColor:s?"transparent":Me("darkGray",.15),borderRadius:"50%",backgroundColor:s?"lightGray":"transparent",marginRight:0,onClick:u=>{u.stopPropagation(),p()},"aria-expanded":s?"true":"false",children:n($o,{color:"black"})})})}):null]})}var No=T(H());G();ve();re();v();var bS=20,wS=8,xS=Y(f)({marginTop:4,paddingLeft:32}),Qd=Y(Le)`
  display: block;
  overflow: hidden;
  white-space: pre-wrap;
  overflow-wrap: break-word;
`;Qd.defaultProps={textStyle:"regular"};var vS=Y(Qd)`
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 8;
  text-overflow: ellipsis;
`,kS=(0,No.forwardRef)(({children:e,collapsed:o},t)=>n(o?Qd:vS,{ref:t,children:e}));function I0({content:e,image:o,edit:t,onEdit:r,onCloseEdit:i}){let[s,a]=(0,No.useState)(!1),{readonly:l}=(0,No.useContext)(_n);function m(u){u.stopPropagation(),a(!0)}return n(xS,{cursor:l?"inherit":"pointer",children:t?n(bs,{content:e,image:o,onCancel:i,onSubmit:r,textStyle:"regular"}):n(yS,{image:o,content:e,collapsed:s,onShowContent:m})})}function yS({image:e,content:o,collapsed:t=!1,onShowContent:r}){let i=(0,No.useRef)(null),[s,a]=(0,No.useState)(0);(0,No.useLayoutEffect)(()=>{i.current&&a(i.current.getBoundingClientRect().height/bS)},[o]);let l=(0,No.useMemo)(()=>h0(o),[o]);return w(f,{children:[e&&n(Ip,{image:e}),n(kS,{ref:i,collapsed:s===0||t,children:n(ng,{color:"darkGray",target:"_blank",children:l})}),s>wS&&!t?n(Le,{display:"block",role:"button",color:"darkGray",cursor:"pointer",onClick:r,children:"Show more"}):null]})}var z0=T(H());G();v();var em=(0,z0.memo)(function({color:o,children:t,...r}){return n(f,{display:"flex",flexDirection:"column",gap:16,paddingBottom:16,color:o,...r,children:t})});var Op=T(H());G();ve();pa();re();Jf();v();var _S=Y(f)`
  display: flex;
  flex-direction: column;
  margin-top: 16px;
  scroll-margin: 60px;
  gap: 16px;
`;function tm({open:e,onClick:o,repliesCount:t,children:r}){let i=(0,Op.useRef)(null),s=rp(t);return(0,Op.useEffect)(()=>{s&&s<t&&i?.current?.scrollIntoView({block:"end",behavior:"smooth"})},[t,s]),w(K,{children:[w(SS,{open:e,onClick:o,"data-testid":"comment-reply-toggle",children:[t," repl",t>1?"ies":"y"]}),e?n(_S,{role:"list",ref:i,children:r}):null]})}var CS=Y(f)`
  gap: 8px;
  display: flex;
  align-items: center;
  margin-top: 24px;

  &:hover {
    color: ${({theme:e})=>e.colors.orange};
  }
`;function SS({open:e,children:o,onClick:t,...r}){return w(CS,{role:"button",onClick:t,...r,children:[n(Do,{transform:e?"rotate(0deg)":"rotate(-90deg)",transition:"transform 0.3s"}),n(Le,{textStyle:"small",userSelect:"none",children:o})]})}var E0=T(H());G();Oe();re();v();var PS=Y(f)({marginTop:20,paddingLeft:32});function R0({onSubmit:e}){let[o,t]=(0,E0.useState)(!1);function r(){t(!0)}function i(){t(!1)}function s(m,c){t(!1),e(m,c)}return n(PS,{children:o?n(bs,{width:"100%",position:"relative",onSubmit:s,onCancel:i,textStyle:"regular"}):n(TS,{onClick:r})})}function TS(e){return n(Ze,{variant:"primary",color:"orange","data-testid":"reply-to-comment",...e,children:"Reply"})}var A0=T(H());G();re();v();var MS=Y("span")({position:"relative"}),BS=Y(f)(({theme:e,offset:o=[0,0]})=>({top:o[0]??0,left:o[1]??0,width:6,height:6,position:"absolute",borderRadius:"50%",backgroundColor:e.colors.orange})),Cn=(0,A0.memo)(function({show:o,offset:t,children:r}){return w(MS,{children:[o?n(BS,{offset:t,title:"A new comment"}):null,r]})});ot();tt();v();var za=(0,Wt.memo)(function(o){let{comment:t,page:r,projectNumId:i,selected:s=!1,onStartEditing:a,onClick:l,isTread:m=!1,parentComment:c,readonly:p=!1,disableSelectable:u=!1,isLast:d=!1}=o,{userId:g,ownerId:h,viewState:b}=(0,Wt.useContext)(Ma),[x]=Rw(),[y,S]=(0,Wt.useState)(!1),[k,P]=(0,Wt.useState)(!1),{isHovered:C,...B}=Ge(),$=(0,Wt.useRef)(null),A=xp($,{root:null,rootMargin:"0px",threshold:1}),R=(0,Wt.useRef)(!1),{author:Z,createdDate:F,viewport:V,isTmp:W}=t,J=g===Z._id,me=h===g,se=!!b?.viewTree[t._id]?.isNew,ee=!!b?.viewTree[t._id]?.newChildren;(0,Wt.useEffect)(()=>{C&&se&&!J&&g&&Ew(t,g)},[t,C,se,J,g]),(0,Wt.useEffect)(()=>{if(!m)if(s){let Ae=A&&A.intersectionRatio>0;A&&A.intersectionRatio===0&&!R.current?($.current?.scrollIntoView(),R.current=!0):Ae&&!R.current&&(R.current=!0)}else R.current=!1},[s,m,A]);let ue=Ae=>{Ae.stopPropagation(),l?.({comment:t,parentComment:c},s?"selected":"regular")},ke=(0,Wt.useCallback)(Ae=>{Ae&&Ae.stopPropagation(),!(y||!J||W||p)&&(S(!0),a&&a({comment:t,parentComment:c}))},[J,y,W,p,t,c,a]),ge=_f({onClick:ue,onDoubleClick:ke}),we=(0,Wt.useCallback)(Ae=>{Ae.stopPropagation(),P(Ne=>!Ne)},[]),L=(Ae,Ne)=>{S(!1);let ft=Ne?[{type:"image",...Ne}]:Ne===null?[]:void 0;Pw({commentId:t._id,content:Ae,attachments:ft})},j=(Ae,Ne)=>{let ft=Ne?[{type:"image",...Ne}]:void 0,M=c||t;_p({pageId:r._id,viewport:t.viewport,content:Ae,parent:M._id,attachments:ft}),ae(ce.CommentAdd,{type:"reply"})},N=()=>{S(!1)},de=(0,Wt.useCallback)(Ae=>{Ae.stopPropagation();let Ne=c||t;mw(i,r?.num,Ne._id)},[i,r,t,c]),le=(0,Wt.useCallback)(Ae=>{Ae.stopPropagation();let Ne=c||t,ft=c?t:void 0;Tw({parentCommentId:Ne._id,childCommentId:ft?._id})},[t,c]),We=(0,Wt.useMemo)(()=>{let Ae=cw(new Date(F),x),Ne=Vs[V],ft=r.pageNestedNum??r.num;return`${Ae}, P.${ft}, ${Ne}`},[V,F,x,r]),he=(0,Wt.useMemo)(()=>{let Ae=[];return J&&Ae.push({title:"Edit",onClick:ke,closeOnClick:!0,props:{paddingLeft:"48px"}}),(J||me)&&Ae.push({title:t.children?"Delete thread":"Delete",onClick:le,closeOnClick:!0,props:{paddingLeft:"48px"}}),m||Ae.push({title:"Copy link",onClick:de,closeOnClick:!0,props:{paddingLeft:"48px"}}),Ae},[J,m,me,t.children,ke,de,le]),fe=s&&!m&&!t.children||!m&&k,pe=(0,Wt.useMemo)(()=>({selected:s,hover:C,commentRef:$,isTread:m,readonly:p}),[s,C,m,p]),ze={disableSelectable:u,selected:s,ref:$,dense:!1,...B};return m&&(ze.dense=!0),n(_n.Provider,{value:pe,children:w(Jd,{role:"comment",...ze,marginBottom:d&&y?16:0,children:[w(f,{...ge,children:[n(Cn,{offset:[-5,0],show:se,children:n(B0,{author:Z,actions:he,description:We,disableActions:y||p})}),n(I0,{edit:y,content:t.content,image:t.attachments?.[0],onCloseEdit:N,onEdit:L})]}),t.children?.length?n(Cn,{offset:[29,0],show:!k&&ee,children:n(tm,{open:k,onClick:we,repliesCount:t.children.length,children:t.children.map((Ae,Ne,ft)=>n(za,{...o,isTread:!0,disableSelectable:!0,comment:Ae,parentComment:t,isLast:Ne+1===ft.length},Ae._id))})}):null,!p&&fe?n(R0,{onSubmit:j}):null]})})});var vs=T(H());G();re();Jf();v();var zS=Y(f)(({theme:e})=>({width:224,padding:8,borderRadius:8,cursor:"initial",backgroundColor:e?.colors.lightGray})),ES=Y(f)({overflowY:"auto"}),D0=(0,vs.forwardRef)(({onClose:e,replies:o,maxHeight:t,children:r,...i},s)=>{let a=(0,vs.useRef)(null),l=rp(o);return(0,vs.useEffect)(()=>{if(l&&l<o){let m=a.current;m.scrollTop=m.scrollHeight-m.scrollTop}},[o,l]),n(zS,{ref:s,...i,children:n(ES,{ref:a,maxHeight:t,children:r})})});wi();v();var RS=306;function $0({comments:e,workspace:o}){let[,t]=Xr();function r(){t(null)}return n(K,{children:e.map(i=>n(AS,{comment:i,workspace:o,onClose:r},i._id))})}function AS({comment:e,workspace:o,onClose:t}){let[r,i]=Xr(),s=$p(e.position,e.pageId,o),{pages:a,me:l,owner:m,projectTeam:c,project:p}=(0,Jr.useContext)(ie),[u]=Mi(),d=(0,Jr.useRef)(null),g=DS(d,o,window.RM.constructorRouter.zoom),h=r?.comment._id===e._id,x=h&&r?.fromList&&!r?.comment.isTmp;(0,Jr.useEffect)(()=>{h&&g()},[h]);let y=(0,Jr.useCallback)(()=>{e._id===r?.comment._id?i(null):i({comment:e,commentElem:d.current,fromList:!1})},[e,r,i]);return n(Dp,{commentPosition:s,zIndex:h?ms.expandedBubble:void 0,ref:d,"data-testid":"comment-bubble",children:n(Lp,{children:({setReferenceElementRef:S,setPopperElementRef:k,styles:P,attributes:C})=>w(K,{children:[n(f,{cursor:"pointer",position:"relative",ref:S,color:h?"orange":"white",children:n(Mp,{animate:x?Tp:void 0,initial:{rotate:0},exit:{rotate:0,transition:{duration:.2}},style:{transformOrigin:"bottom left"},stroke:h?"white":"orange",strokeWidth:2,onClick:y,filter:"drop-shadow(0px 2px 12px rgba(0, 0, 0, 0.16))"})}),h&&!r?.fromList?n(hs,{me:l,owner:m,projectTeam:c,viewState:u,children:n(D0,{ref:k,style:P.popper,onClose:t,replies:e?.children?.length??0,maxHeight:`calc(${P.popper.maxHeight} - 16px)`,...C.popper,children:n(za,{selected:!0,disableSelectable:!0,comment:e,projectNumId:p.num_id,page:a.find(B=>B._id===e.pageId)})})}):null]})})})}function DS(e,o,t){let[r,i]=[0,window.innerWidth-RS];return(0,Jr.useCallback)(()=>{let s=e.current;if(!s)return;let a=s;if(Modernizr.firefox){a.scrollIntoView({block:"center",behavior:"smooth"});return}let l=xt.mapElementToViewport(a,1,1),m=t.getZoom();function c(){let p=l.left,u=l.left+l.width;(p<r||u>i)&&m>fp?(t.zoomTo(Math.max(fp,m-=.08),o,o.$container[0],t.getCenter(t.getZoom(),o,o.$container[0])),l=xt.mapElementToViewport(a,1,1),requestAnimationFrame(c)):a.scrollIntoView({block:"center",behavior:"smooth"})}requestAnimationFrame(c)},[o,r,i])}Be();ot();tt();v();function L0({workspace:e,router:o}){let[t,r]=(0,ks.useState)(()=>e.viewport),[,i]=Xr(),s=(0,ks.useMemo)(()=>({viewport:t,status:"unresolved"}),[t]),a=Cp(s);(0,ks.useEffect)(()=>{let u=e.mag.pages;function d(){r(e.viewport)}return u.on("change:viewport",d),()=>{u.off("change:viewport",d)}},[e,o]);function l(u){let d=e.getPageId(),g=u.commentImage?[{type:"image",...u.commentImage}]:void 0,h=_p({position:u.position,content:u.content,pageId:d,viewport:t,attachments:g});i({comment:h,fromList:!0}),ae(ce.CommentAdd,{type:"origin"})}let m=e.viewport,c=e.page.getViewportParam(e.viewport,"height"),p=Pe.dictionary[m].width;return w(Gw,{width:p,height:c,children:[n(Ww,{}),w(Jn,{project:e.mag,router:o,children:[n($0,{workspace:e,comments:a}),n(P0,{workspace:e,onDone:l})]})]})}v();function H0(e,o){let t=om.default.createRoot(e);function r(){t.render(n(vr,{withGlobalStyles:!1,children:n(L0,{workspace:o.workspace,router:o.router})}))}function i(){t.unmount(),t=om.default.createRoot(e)}return{render:r,unmount:i}}oa();var $S=fi.extend({idAttribute:"pack_id",urlRoot:"/api/pack/",name:"Pack"}),Ea=$S;na();gf();ct();_r();yr();E_();m_();var rm=class extends Np.default.View{constructor(t){super();E(this,"mag");E(this,"blocks",[]);E(this,"page");E(this,"packs",{});E(this,"$origin");E(this,"$scroller");E(this,"$frame");E(this,"$border");E(this,"$window");E(this,"$container");E(this,"loader");E(this,"$bottomShiftLine");E(this,"workspaceContainer");E(this,"position",{top:0,left:0});E(this,"locked",!1);E(this,"visible",!1);E(this,"eCommerceManager");E(this,"spacesController");E(this,"syncManager");E(this,"controls");E(this,"distance");E(this,"pagesize");E(this,"block");E(this,"common_layer");E(this,"rendered",!1);E(this,"bottomBlocksToMove");E(this,"movingBlocks");E(this,"movingDelta");E(this,"isDragActive",!1);E(this,"isBlockMovementActive",!1);E(this,"animationMode",!1);E(this,"cachedSizes");E(this,"animationSteps");E(this,"disableDragging");E(this,"disableBlocksInteractive");E(this,"disabledSelectMultiple");E(this,"saveGroupDebounced");E(this,"unsubscribeCommentMode");E(this,"previousObjectsUnderCursor",[]);E(this,"previousIgnoreWidgetPacks");E(this,"oldParams");E(this,"bundleDragTimeout");E(this,"blocksToClone",{});E(this,"redrawPacksFramesHolded",!1);E(this,"cloneBlocksDebounced");E(this,"restoreFocusForCopyPasteDebounced");E(this,"triggerSelectOnSelectedBlockDebounced");E(this,"viewportScrolls",{});E(this,"viewportScroll",0);E(this,"_unselectedBlocksForBottomLine");E(this,"widgetResizingOrRotating");E(this,"commentsRoot");E(this,"isActiveCommentMode",kw());E(this,"deletedWidgetsCount",0);E(this,"_enableCommentMode",t=>{this.isActiveCommentMode&&!t?.force||(window.RM.constructorRouter.changeEditorMode("member"),window.RM.constructorRouter.changeBlocksMode(!1),this.disableDragging=!0,this.disabledSelectMultiple=!0,this.disableBlocksInteractive=!0,this.trigger("deselect"),this.getAllPacks().forEach(r=>{r.frame.setFrameBorderVisible(!1)}),this.blocks.forEach(r=>{r.frame?.toggleFrameColor("orange-border",!0)}),this.commentsRoot.render())});E(this,"_disableCommentMode",()=>{this.isActiveCommentMode&&(this.disableDragging=!1,this.disabledSelectMultiple=!1,this.disableBlocksInteractive=!1,this.getAllPacks().forEach(t=>{t.frame.setFrameBorderVisible(!0)}),this.blocks.forEach(t=>{t.frame?.toggleFrameColor("orange-border",!1)}),this.commentsRoot.unmount())});E(this,"getCommentModeState",()=>this.isActiveCommentMode);E(this,"onMouseLeave",()=>{this.updateBlocksHighlight({cursorX:0,cursorY:0,disableAllHighlights:!0})});E(this,"onMouseMove",t=>{let r=window.Modernizr?.mac?"metaKey":"ctrlKey",i=t[r];this.updateBlocksHighlight({cursorX:t.clientX,cursorY:t.clientY,ignoreWidgetPacks:i})});E(this,"updateBlocksHighlight",({cursorX:t,cursorY:r,ignoreWidgetPacks:i,disableAllHighlights:s})=>{if(this.previousObjectsUnderCursor=this.previousObjectsUnderCursor||[],!this.isBlocksHighlightActive()||s){this.previousObjectsUnderCursor.forEach(d=>d.triggerMouseLeave?.()),this.previousObjectsUnderCursor=[];return}let l=this.getBlocksByAbsoluteCoords({x:t,y:r,ignoreWidgetPacks:i}),m=this.getTopmostBlock({blocks:l}),c=m?[m]:[];(this.previousIgnoreWidgetPacks!==i?this.previousObjectsUnderCursor:D.default.difference(this.previousObjectsUnderCursor,c)).forEach(d=>d.triggerMouseLeave?.()),(this.previousIgnoreWidgetPacks!==i?c:D.default.difference(c,this.previousObjectsUnderCursor)).forEach(d=>d.triggerMouseEnter?.({metaKey:i})),this.previousObjectsUnderCursor=c,this.previousIgnoreWidgetPacks=i});E(this,"getTopmostBlock",({blocks:t})=>{let r=t,{topBlock:i}=r.reduce((s,a)=>{let l=a instanceof sa?a.blocks[0].currentZ:a.currentZ;return l>s.maxZ?{maxZ:l,topBlock:a}:s},{maxZ:0,topBlock:void 0});return i});E(this,"getBlocksByAbsoluteCoords",({x:t,y:r,ignoreWidgetPacks:i})=>{let s=this.getSelectableBlocks(),a=i?[]:this.getAllPacks(),l=s.concat(a);return l=l.filter(m=>{let c=this.getBlockPositionInWindow(m);return c.left<=t&&c.left+c.width>=t&&c.top<=r&&c.top+c.height>=r}).filter(m=>!m.latestPosSizeAngle?.angle||m.contains({x:this.convertX(t,"workspace"),y:this.convertY(r,"workspace")})),l});E(this,"getBlockPositionInWindow",t=>{let r=window.RM.constructorRouter.zoom.getZoom(),i=this.viewport==="default",s=this.getCachedSizes(),a,l={left:t.latestPosSizeAngle.bb_left,top:t.latestPosSizeAngle.bb_top,width:t.latestPosSizeAngle.bb_width,height:t.latestPosSizeAngle.bb_height};if(t.isFixed())if(t instanceof sa)a={left:l.left*r+this.position.left,top:l.top*r+this.position.top,width:l.width*r,height:l.height*r};else{let m;i?(m=Ao.getFixedPositionBox(t.model.get("fixed_position"),{x:l.left,y:l.top,w:l.width,h:l.height},r,{width:s.width,height:s.height}),a=m):(m=Ao.getFixedPositionBox(t.model.get("fixed_position"),{x:l.left,y:l.top,w:l.width,h:l.height},r,{width:s.elWidth,height:(s.height||0)-this.position.top-(this.position.bottom||0)}),a={left:m.left+this.position.left,top:m.top+this.position.top,width:m.width,height:m.height})}else a={left:this.convertX(l.left,"absolute"),top:this.convertY(l.top,"absolute"),width:l.width*r,height:l.height*r};return a});E(this,"isBlocksHighlightActive",()=>this.isActiveCommentMode?!0:!this.isDragActive&&!this.isBlockMovementActive&&!window.RM.constructorRouter.isPageLocked(this.getPageId()));E(this,"convertX",(t,r)=>{let i=window.RM.constructorRouter.zoom.getZoom(),s=this.viewport,a=Pe.dictionary[s].width,l=this.mag.getViewportWidth(s);switch(r){case"absolute":return Math.max((window.innerWidth-l*i)/2,0)+(t+(l-a)/2)*i-(this.$container.scrollLeft()||0);case"workspace":return(t-Math.max((window.innerWidth-l*i)/2,0)-(l-a)/2*i+(this.$container.scrollLeft()||0))/i;default:return t}});E(this,"convertY",(t,r)=>{let i=window.RM.constructorRouter.zoom.getZoom();switch(r){case"absolute":return t*i+this.position.top*i-(this.$container.scrollTop()||0);case"workspace":return(t-this.position.top+(this.$container.scrollTop()||0))/i;default:return t}});E(this,"getWorkspaceBox",()=>({...this.position,...this.getWorkspaceSize()}));E(this,"getOriginBox",()=>{let t=this.viewport,r=this.getWorkspaceBox(),i=Jo.getViewportSetting("width",t),s={left:(r.width-i)/2,top:0,width:i,height:r.height};return xt.relativeToAbsolute(s,this.position)});E(this,"getDocumentBox",()=>{let t=this.viewport,r=this.getCachedSizes(),i={width:r.clientWidth,height:r.height,left:0,top:0},s=this.mag.getViewportWidth(t),a=this.page.getViewportParam(this.viewport,"height"),l=window.RM.constructorRouter.zoom.getZoom(),m=xt.mapFromViewportToDocument(i,1,l);return{left:0,top:0,width:Math.max(m.width,s),height:Math.max(m.height,a)}});E(this,"getParameters",()=>({workspaceSize:this.getWorkspaceSize(),windowSize:this.getClientSize(),viewport:this.viewport,zoom:window.RM.constructorRouter.zoom.getZoom(),scroller:this.$scroller[0]}));E(this,"listenToGuides",()=>{this.stopListeningToGuides(),window.RM.constructorRouter.gg.guides?.models&&window.RM.constructorRouter.gg.guides?.model&&(this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")}),this.listenTo(window.RM.constructorRouter.gg.guides.models,"change:columns",(t,r)=>this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:r,margin:t.get("margin")})),this.listenTo(window.RM.constructorRouter.gg.guides.models,"change:margin",(t,r)=>this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:t.get("columns"),margin:r})),this.listenTo(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.toggleBorder({guidesOn:this.mag.edit_params.get("guides"),columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")})}),this.listenTo(this.mag.edit_params,"change:guides",(t,r)=>{this.toggleBorder({guidesOn:r,columnCount:window.RM.constructorRouter.gg.guides.model.get("columns"),margin:window.RM.constructorRouter.gg.guides.model.get("margin")})}))});E(this,"stopListeningToGuides",()=>{this.stopListening(window.RM.constructorRouter.gg.guides),this.stopListening(window.RM.constructorRouter.gg.guides?.models),this.stopListening(this.mag.edit_params)});E(this,"show",(t={})=>{this.$el.show().css({opacity:"1"}).addClass("current"),this.onResize(),this.rendered||this.render(),this.visible=!0,t.switchToViewport&&this.setViewport(t.switchToViewport,{...t,doNotSaveScroll:!0}),this.renderGlobalBlocks(),this.trigger("show"),this.controls?.$el.show(),this.restoreViewportScroll(this.viewport),this.updateLockState(),this.$border.toggleClass("fullscreen",window.RM.constructorRouter.zoom.isFullScreenOrMore()&&this.page.get("height")*window.RM.constructorRouter.zoom.getZoom()>=window.innerHeight),this.$border.toggleClass("ghost",this.viewport!=="default"&&!this.mag.edit_params.get("guides")),window.RM.constructorRouter.gg.guides?.models?.length?this.listenToGuides():window.RM.constructorRouter.gg?.guides?this.listenToOnce(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.listenToGuides()}):(this.mag.edit_params.get("guides")||this.toggleBorder({guidesOn:!1,margin:{}}),this.listenToOnce(window.RM.constructorRouter.gg,"create",()=>{this.listenToOnce(window.RM.constructorRouter.gg.guides,"modelLoaded",()=>{this.listenToGuides()})})),this.isActiveCommentMode&&requestAnimationFrame(()=>{this._enableCommentMode({force:!0})}),this.workspaceContainer.addEventListener("mousemove",this.onMouseMove,{passive:!0}),this.workspaceContainer.addEventListener("mouseleave",this.onMouseLeave)});E(this,"hide",()=>{this.isActiveCommentMode&&this._disableCommentMode(),this.removeGlobalBlocks(),this.visible=!1,this.$el.css({opacity:"0"}).hide().removeClass("current"),this.trigger("hide"),this.controls?.$el.hide(),this.saveViewportScroll(this.viewport),this.trigger("deselect"),this.stopListeningToGuides(),this.workspaceContainer.removeEventListener("mousemove",this.onMouseMove),this.workspaceContainer.removeEventListener("mouseleave",this.onMouseLeave)});E(this,"render",()=>{this.rendered=!0;let t=Lw.extend({$main:(0,rt.default)("#constructor")});if(this.controls=new t({workspace:this}),this.common_layer=new bn.common_layer({master:this.controls,noInit:!0}),D.default.each(this.blocks,function(i){try{this.renderBlock(i)}catch(s){console.error(s.message,s.stack)}},this),this.page.from_template){let i=this.page.getUsedFonts({includeCustom:!1});i&&window.RM.constructorRouter.fonts.addFonts(i,"template")}let r=Yt.extend(Ow);return this.pagesize=new r({el:this.$el.find(".page-size-control").get(0),propsData:{workspace:this,defaultSticky:window.RM.constructorRouter.zoom.isFullScreenOrMore(),defaultZoom:window.RM.constructorRouter.zoom.getZoom()}}),this.redrawPacksFrames(),setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:"22px"})},100),this.page.on("change:viewport",()=>{setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:""}),setTimeout(()=>{this.$el.find(".page-size-control").css({bottom:"22px"})},100)},100)}),this.toggleBlocksEditParams(),this});E(this,"onGlobalAppear",t=>{!this.visible||D.default.find(this.blocks,function(i){return i.model.id===t.id})||this.renderGlobalBlock(t)});E(this,"onGlobalDisappear",t=>{t.get("pid")!==this.page.id&&this.removeGlobalBlock(t)});E(this,"renderGlobalBlock",t=>{t.collection=window.RM.constructorRouter.workspace.page.widgets,t.setViewport(this.viewport),t.clearChanges(),this.createBlock(t,{instant:!0})});E(this,"renderGlobalBlocks",()=>{this.mag.globalWidgets.each(t=>this.renderGlobalBlock(t))});E(this,"removeGlobalBlock",t=>{this.removeBlock(t)});E(this,"removeGlobalBlocks",()=>{this.mag.globalWidgets.each(t=>this.removeGlobalBlock(t))});E(this,"switchOnAnimationMode",t=>{this.animationMode=!0,this.animationSteps=t});E(this,"switchOffAnimationMode",()=>{this.animationMode=!1,delete this.animationSteps});E(this,"onclick",t=>{this.locked||this.visible&&(window.suppressClick&&window.suppressClick>+new Date||this.$el[0].contains(t.target)&&!t.target?.isSameNode(this.$el[0])&&!t.target?.isSameNode(this.$origin[0])||(0,rt.default)(t.target).hasClass("page-size-control")||(0,rt.default)(t.target).closest(".page-size-control").length||(0,rt.default)(t.target).hasClass("add-widget")||(0,rt.default)(t.target).closest(".add-widget").length||(!this.controls||this.controls.canControlsBeClosed())&&(this.widgets_in_widgets_deselected()&&this.trigger("deselect"),D.default.defer(function(){this.getSelectedBlocks().length===0&&this.trigger("whitespace_click")}.bind(this))))});E(this,"onBlockMouseEnter",t=>{this.trigger("block:mouseenter",(0,rt.default)(t.currentTarget).data("id"))});E(this,"onBlockMouseLeave",t=>{this.trigger("block:mouseleave",(0,rt.default)(t.currentTarget).data("id"))});E(this,"widgets_in_widgets_deselected",()=>{let t=this.getSelectedBlocks(),r=[];return t.forEach(function(i){i.child_workspace&&(r=r.concat(i.child_workspace.getSelectedBlocks()))}),r.length?(t.forEach(function(i){i.child_workspace&&i.child_workspace.trigger("deselect")}),this.controls?.onSelect(t),!1):!0});E(this,"onDragStart",(t,r)=>{if(!je.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=(0,rt.default)(t.target);if(i.closest(".controls").length>0||i.closest(".page-size-control").length>0||i.closest(".space-highlighter").length>0)return!1;let s=(0,rt.default)(window).width()||0;if(r.startX+18>s)return!1;this.$frame.show(),r.scrollTop=this.$container.scrollTop()||0,this.isDragActive=!0});E(this,"onDrag",(t,r)=>{if(!je.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=window.RM.constructorRouter.zoom.getZoom(),s=r.drag,a=r.startY/i+r.scrollTop/i,l=t.pageY/i+(this.$container.scrollTop()||0)/i,m={top:Math.min(a,l)-this.position.top,left:Math.min(t.pageX/i,r.startX/i)-this.position.left+s.scrollLeft/i,height:Math.abs(a-l),width:Math.abs(t.pageX/i-r.startX/i)};Ye.autoWindowScroll(t,this.$container,function(){this.onDrag(t,r)}.bind(this)),this.$frame.css(m)});E(this,"onDragEnd",t=>{if(!je.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;Ye.autoWindowScrollClear();let r=this.getFramePosition();this.selectBlocks(r,{merge:t.shiftKey}),this.$frame.hide(),this.isDragActive=!1});E(this,"checkBundleDragMode",(t,r)=>{let i=t.keyCode===rt.default.keycodes.v||t.keyCode===rt.default.keycodes.f||!!r;if(this.canEnterBundleDrag()&&i&&!t.metaKey){let s,a;t.keyCode===rt.default.keycodes.v&&(s=t.type==="keydown",a=this.bottomBlocksToMove?this.bottomBlocksToMove.fPressed:!1),t.keyCode===rt.default.keycodes.f&&(s=this.bottomBlocksToMove?this.bottomBlocksToMove.vPressed:!1,a=t.type==="keydown");let l=s||a;r&&(s=r==="bottom",a=r==="top");let m=s||a;this.bottomBlocksToMove?(this.bottomBlocksToMove.vPressed!==s||this.bottomBlocksToMove.fPressed!==a||this.bottomBlocksToMove.kbActivate!==l||this.bottomBlocksToMove.mouseActivate!==r)&&(this.bottomBlocksToMove.active=m,this.bottomBlocksToMove.vPressed=s,this.bottomBlocksToMove.fPressed=a,this.bottomBlocksToMove.kbActivate=l,this.bottomBlocksToMove.mouseActivate=r,delete this.bottomBlocksToMove.list,this.redrawBottomShiftLine({tp:m?"show":"hide"}),m&&((Modernizr.mac?t.metaKey:t.ctrlKey)||Fe(`shortcut_${String.fromCharCode(t.keyCode)}`))):(this.bottomBlocksToMove={active:m,mouseActivate:r,kbActivate:l,vPressed:s,fPressed:a},this.redrawBottomShiftLine({tp:"show"}))}this.bottomBlocksToMove&&this.bottomBlocksToMove.active&&i&&t.metaKey&&(clearTimeout(this.bundleDragTimeout),this.bundleDragTimeout=setTimeout(function(){delete this.bottomBlocksToMove,this.redrawBottomShiftLine({tp:"hide"})}.bind(this),250))});E(this,"canEnterBundleDrag",()=>!this.animationMode&&!this.spacesController&&!this.getSelectedBlocks().find(t=>t.cropmode));E(this,"onFileDrop",async t=>{let r=!!t.target.closest(".can-drop"),i=t.dataTransfer?.files?.[0];if(!(r||!i)&&!/^image/.test(i.type)&&/^video/.test(i.type))try{Gf.validateVideoFile(i);let s=await new Promise((l,m)=>this.addWidget({...bb.defaults,type:"video"},{success:l,error:m}));this.findBlock(s.id).uploadFile?.(i)}catch(s){alert(s)}});E(this,"bindUploader",()=>{if(Dt("widget.videoV2")&&this.el.addEventListener("drop",this.onFileDrop),!je.isPermissionAllowed("BaseWidgetCanAdd")||window.RM.constructorRouter.$uploader)return;let t,r,i;window.RM.constructorRouter.$uploader=(0,rt.default)("#workspaceUpload").fileupload({dataType:"json",dropZone:(0,rt.default)("#main"),pasteZone:(0,rt.default)(document),fileInput:(0,rt.default)("#workspaceUpload"),replaceFileInput:!1,singleFileUploads:!0,sequentialUploads:!0}).bind("fileuploaddragover",function(s){t=window.RM.constructorRouter.workspace;let a=s.delegatedEvent,l=(0,rt.default)(a.target),m=l.closest(".block.picture:not(.no-drag)"),c=l.closest(".block.shots"),p=!1;if(m.length){if(clearTimeout(i),i=setTimeout(function(){t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace")},500),m.hasClass("replace"))return;t.$(".picture").removeClass("replace"),m.addClass("replace"),p=!0}else if(c.length){if(clearTimeout(i),i=setTimeout(function(){t.$(".shots.replace").removeClass("replace")},500),c.hasClass("replace"))return;t.$(".shots").removeClass("replace"),c.addClass("replace"),p=!0}else{if(!p)return;t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace"),p=!1}}).bind("fileuploaddrop",function(s){if(t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace"),(0,rt.default)(s.delegatedEvent.target).closest(".block.can-drop").length)return!1}).bind("fileuploadpaste",function(){let s=window.RM.constructorRouter;if(s.previewMode)return!1;t=s.workspace}).bind("fileuploadadd",function(s,a){let l=a.files&&a.files[0].size,m=a.files&&a.files[0].type;if(a.allowUpload=!1,Dt("widget.videoV2")&&/^video/.test(m))return;let c=s.delegatedEvent,p=(0,rt.default)(c.target),u=p.closest(".block.picture:not(.no-drag)"),d=p.closest(".block.shots");if(a.files[0].$picture=u,u.length&&(a.files[0].block=(0,D.default)(t.getAllBlocks("picture")).find(function(g){return g.id===u.data("id")})),a.originalFiles.length>1&&a.files[0].block)return alert(oe.MSG_UPLOAD_ONLY_SINGLE_FILE),!1;if(d.length)return l>oe.UPLOAD_SHOTS_SIZE_LIMIT?(alert(a.files[0].uploadError=oe.MSG_UPLOAD_SHOTS_SIZE_ERROR),!1):!0;l>oe.UPLOAD_IMAGE_SIZE_LIMIT?alert(a.files[0].uploadError=oe.MSG_UPLOAD_IMAGE_SIZE_ERROR):ki.MimeTypeRegExp.test(m)?(a.files[0].name||(a.files[0].name="pasteimage."+m.split("/")[1]),a.allowUpload=!0):alert(a.files[0].uploadError=oe.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)}).bind("fileuploadsubmit",function(s,a){if(!a.allowUpload)return!1;a.files[0].uploading=!0,r=!1,a.files[0].setPictureCallback=D.default.after(2,function(){if(a.files[0].uploading=!1,r)t.page.removeWidgets([a.files[0].wid]);else{let m=t.findBlock(a.files[0].wid);m&&m.changePicture(a.files[0].result,{skipHistory:!0})}clearTimeout(a.files[0].loaderTimeout)});let l=a.files[0].block;l&&(l.showIconLoader(),t.$(".picture.replace")&&t.$(".picture.replace").removeClass("replace")),a.formData={name:"Picture",uploadType:"picture",id:l?l.model.id:"p"+t.page.id,mid:t.mag.get("num_id"),unique:!0}}).bind("fileuploadsend",function(s,a){let l=a.files[0].block;if(l)t.setTempPicture(a.files,l);else{let m={success:function(c){a.files[0].wid=c.id,a.files[0].setPictureCallback();let p=t.findBlock(c.id);p&&(p.skipShowPanel=!0,t.setTempPicture(a.files,p))},error:function(){r=!0,a.files[0].setPictureCallback()}};if(t.spacesController){let c=t.$el,p=c?c.offset():void 0,u=s.delegatedEvent.pageY-(p?p.top:0);t.spacesController.addWidgetAtOffset("picture",u,m)}else{let c={type:"picture",hiddenBeforeUpload:!1};c.hiddenBeforeUpload=!0,t.addWidget(c,m)}}}).bind("fileuploaddone",function(s,a){if(!a||!a.result){console.error("error file upload!");return}let l=a.files[0].block;if(l){l.model.created=!0,l.changePicture(a.result,{save:!1,toHistory:!0}),l=null;let m=t.controls?.findControl("picture_crop");m?.master.select(m)}else a.files[0].result=a.result,a.files[0].setPictureCallback()}).bind("fileuploadfail",function(s,a){(a&&a.jqXHR&&a.jqXHR.status)===500&&alert(oe.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR),window.RM.constructorRouter.workspace.hideLoader(),r=!0,a.files[0].setPictureCallback()})});E(this,"getFramePosition",()=>{let t=this.viewport,r=this.mag.getViewportWidth(t),i=Pe.dictionary[t].width;return{x:this.$frame.position().left-(r-i)/2,y:this.$frame.position().top,w:(this.$frame.width()||0)+2,h:(this.$frame.height()||0)+2}});E(this,"getAllBlocks",t=>{let r=D.default.filter(this.blocks,function(s){return!t||s.model.get("type")===t}),i=[];return D.default.each(this.blocks,function(s){D.default.isEmpty(s.child_workspace)||D.default.each(s.child_workspace?.blocks,function(a){(!t||a.model.get("type")===t)&&i.push(a)})}),r.concat(i)});E(this,"getFirstSelectableBlock",t=>this.getAllBlocks(t).filter(s=>s.isSelectable())[0]);E(this,"getAllPacks",()=>Object.entries(this.packs||{}).map(([t,r])=>r));E(this,"getPack",t=>this.packs[t]);E(this,"onResize",()=>{let t=window.RM.constructorRouter.zoom.getZoom(),r=this.mag.getViewportWidth(this.viewport),i=this.page.getViewportParam(this.viewport,"height")*t,s=this.$window.height()||0,a=this.$window.width()||0,l=this.viewport,m=Math.floor(Math.max(Math.ceil((a-r*t)/2),0)/t),c=0,p=0,u=os();if(l==="default")p=Math.max(Math.ceil((s-i)/2),0)/t,this.$el.css({top:p,left:m,"border-top":"","border-bottom":""});else if(u){let{height:d}=Ao.fitToDevice(r,this.viewport,u);p=Math.max(Math.ceil((s-(t<1?i:d))/2),0)/t,c=Math.max(Math.floor((s-(t<1?i:d))/t)-p,0),this.$el.css({top:0,left:m,"border-top":p+"px solid transparent","border-bottom":c+"px solid transparent"}),document.documentElement.style.setProperty("--phone-viewport-height",`${d}px`)}if(this.position.left=m,this.position.top=p,this.position.bottom=c,this.cachedSizes=void 0,D.default.defer(function(){this.trigger("workspace-resize",this.position)}.bind(this)),D.default.any(this.blocks,function(d){return d.model.get("fixed_position")})){this.redrawPacksFrames(),this.redrawBottomShiftLine();let d=D.default.filter(this.blocks,g=>g.model.get("fixed_position"));this.viewport!=="default"&&d.forEach(g=>g.redrawPosition(void 0,{skipTriggerRedraw:!0})),D.default.invoke(d,"recalcFixedLine")}});E(this,"moveSelected",(t,r)=>{if(this.animationMode){this.animationSteps.moveSelected(t,r);return}let i=t.shiftKey,s=Modernizr.mac?t.metaKey:t.ctrlKey;Fe(`shortcut_${t.key}`+(i?"_shift":"")+(s?"_ctrl":""));let a=D.default.filter(this.movingBlocks||this.getSelectedBlocks(),u=>!u.isLocked());if(D.default.isEmpty(a))return!1;if(D.default.any(a,function(u){return u.isFullWidth()})&&(0,D.default)(["left","right"]).contains(r)||D.default.any(a,function(u){return u.isFullHeight()})&&(0,D.default)(["up","down"]).contains(r))return;let c=i?10:1,p={deltaY:0,deltaX:0,isClone:!1,isCloneByKeys:!1};switch(r){case"up":p.deltaY=-c;break;case"right":p.deltaX=c;break;case"down":p.deltaY=c;break;case"left":p.deltaX=-c;break}if(this.movingBlocks||(this.movingBlocks=t.altKey?a:void 0,this.movingBlocks&&D.default.each(a,function(u){u.clone()})),this.movingBlocks&&(p.isClone=!0,p.isCloneByKeys=!0,this.movingDelta?(this.movingDelta.deltaX+=p.deltaX,this.movingDelta.deltaY+=p.deltaY):this.movingDelta=D.default.clone(p),this.movingDelta&&(this.movingDelta.deltaXOrig=p.deltaX,this.movingDelta.deltaYOrig=p.deltaY)),!this.movingBlocks&&a.length&&a[0].model.get("type")==="hotspot"&&a[0].tip_workspace.workspaceEditMode)return a[0].moveTip(p);if(a.length===1&&a[0]?.model?.get("type")==="picture"&&a[0].cropmode){a[0].onCropResizeUsingKeyboard&&a[0].onCropResizeUsingKeyboard(t,p),t.stopPropagation(),t.preventDefault();return}if(t.metaKey||t.ctrlKey?(ip.prototype.resizeBlocks(this,a,p,t,{hideFrameMs:500}),t.stopPropagation(),t.preventDefault()):ip.prototype.moveBlocks(this,a,this.movingDelta||p,t),this.movingBlocks)this.cloneBlocksDebounced(this.movingBlocks);else{this.redrawPacksFrames({tp:"move"}),this.redrawBottomShiftLine({tp:"move"});let u=this.bottomBlocksToMove;a=[...a,...u&&u.tosave||[]];let d=D.default.map(a,function(g){return D.default.extend({_id:g.id},g.getBoxData())});this.set_group(d),this.saveGroupDebounced(D.default.pluck(a,"model"))}return t.stopPropagation(),t.preventDefault(),this.clearBottomBlocksToMove(),!0});E(this,"changeBlocksOpacity",t=>{let r=D.default.map(this.getSelectedBlocks(),i=>i.model);t===0&&(t=10),D.default.each(r,i=>{switch(i.get("type")){case"button":if(!je.isPermissionAllowed("ButtonCanChangeSettings"))break;i.set("background-color-opacity",t*10);break;case"shape":if(!je.isPermissionAllowed("ShapeCanChangeSettings"))break;i.set("bg_opacity",t*.1);break;case"picture":if(!je.isPermissionAllowed("PictureCanChangeSettings"))break;i.set("opacity",t*.1)}}),this.save_group(r)});E(this,"setViewport",(t,r)=>{if(t===this.viewport)return;this.locked&&(t="default");let i=this.page.get("viewport_"+t);i=i||{};let s=ra[i.enabled||t==="default"?t:this.viewport]||"Desktop";if(Il(s),!i.enabled&&t!=="default"){window.sessionStorage&&window.sessionStorage.removeItem("constructorViewport");return}let a=this.getSelectedBlocks();this.trigger("deselect",{deselectOnViewportChange:!0});let l=!!this.spacesController;this.spacesController&&this.toggleBundleBlocks(!1),this.page.set("viewport",t,r),l&&this.toggleBundleBlocks(!0),a.length>0&&D.default.defer(()=>{a.map(m=>m.select(!1,{noFrame:a.length>0})),this.trigger("select",a)}),window.sessionStorage.setItem("constructorViewport",t)});E(this,"showUsedViewport",()=>{let t=window.sessionStorage.getItem("constructorViewport")||"default",r=t==="default"||this.page.get(`viewport_${t}`)?.enabled;this.setViewport(r?t:"default")});E(this,"isViewportEnabled",t=>t==="default"||this.page.get(`viewport_${t}`)?.enabled);E(this,"suspendAllBlocks",()=>{for(let t of this.blocks)t.model.suspend()});E(this,"resumeAllBlocks",()=>{for(let t of this.blocks)t.model.resume()});E(this,"onChangeViewport",(t,r)=>{this.updateWorkspaceViewport(t),this.blocks.forEach(i=>i.model.setViewport(r)),window.RM.constructorRouter.trigger("changeViewport",r),this.blocks.filter(i=>i.isFixed()).forEach(i=>i.onFixPosition()),this.blocks.filter(i=>!!i.model.get("sticked")).forEach(i=>i.setStickedDims()),this.checkOneWidgetPacks()});E(this,"saveViewportScroll",t=>{t&&(this.viewportScrolls["scroll-viewport-"+t]=this.$container.scrollTop()||0)});E(this,"saveScroll",()=>{this.viewportScroll=this.$container.scrollTop()||0});E(this,"restoreViewportScroll",t=>{t&&this.$container.scrollTop(this.viewportScrolls["scroll-viewport-"+t]||0)});E(this,"restoreScroll",()=>{this.$container.scrollTop(this.viewportScroll)});E(this,"getScrollTop",()=>this.$container.scrollTop());E(this,"updateWorkspaceViewport",t=>{let r={width:this.mag.getViewportWidth(this.viewport),height:this.page.getViewportParam(this.viewport,"height"),min_height:Jo.getViewportSetting("min_height",this.viewport),viewport:this.viewport,device:os()};if(D.default.isEqual(r,this.oldParams))return;this.$el.attr("data-viewport",r.viewport),r.viewport==="phone_portrait"&&document.documentElement.style.setProperty("--phone-viewport-width",`${r.width}px`),this.$el.css({width:r.width,height:r.height}),this.$origin.css({width:Pe.dictionary[this.viewport].width,height:r.height}),this.onResize(),(!t||!t.hasChanged("viewport"))&&window.RM.constructorRouter.trigger("updateWorkspaceViewport");let i=D.default.findWhere(this.blocks,{name:"Background"});i&&i.onViewportUpdate&&i.onViewportUpdate(r),this.oldParams=r});E(this,"getTriggeredBlocks",t=>t?t.reduce((r,i)=>{let s=this.blocks.filter(a=>{let l=a.getAllAnimationTriggers(),m=a.model.get("triggers");return l.includes(i)||m&&m.includes(i)});return[...r,...s]},[]):[]);E(this,"onWidgetsRemove",t=>{let r=this.getTriggeredBlocks(t);D.default.each(r,i=>{t.indexOf(i.id)===-1&&i.blink(!0)}),r.length&&window.RM.constructorRouter.trigger("notice:triggerEduTip","workspaceAnimationTriggerRemoved",{closeByTimer:!0})});E(this,"onWidgetsContextChange",t=>{t=t||[];let r=D.default.map(t,"id"),i=this.getTriggeredBlocks(r),s=t.concat(i),a=[];D.default.each(s,function(l){let m=l.getTriggerBlocks();D.default.each(m,function(c){c&&!qf.canBeExternalTrigger(c)&&(c.blink(!0),l.removeAllAnimationTriggers(),a.push(l))})}.bind(this)),a.length&&(this.save_group(D.default.map(a,"model")),window.RM.constructorRouter.trigger("notice:triggerEduTip","workspaceAnimationTriggerUnlinked",{closeByTimer:!0}))});E(this,"createWidget",(t,r={})=>{if(this.spacesController&&r.y!==void 0)this.spacesController.addWidgetAtOffset(t,r.y);else if(this.spacesController){let i=Math.floor((this.$el.offsetParent()?.height()||0)/2)-(this.$el?.offset()?.top||0);this.viewport!=="default"&&(i-=203),this.spacesController.addWidgetAtOffset(t,i)}else this.addWidget({type:t},{useDefaults:!0})});E(this,"addWidget",(t,r)=>{if(r=r||{},r.group||this.trigger("deselect",{fromAdd:!0}),r.copy&&!r.disableDeleteViewportAttributes&&D.default.each(Pe.viewport_list,a=>{let l=this.page.get(a);D.default.isEmpty(l)&&delete t[a]}),t||(t={}),!t.type){console.error("creating widget with no type");return}r.isMultiple||(t.type==="text"&&window.RM.constructorRouter.trigger("notice:triggerMetrics","countTextWidgetCreated"),D.default.isEmpty(this.packs)||window.RM.constructorRouter.trigger("notice:triggerMetrics","widgetsGrouped"),window.RM.constructorRouter.trigger("notice:triggerMetrics","countWidgetCreated"));let i=t.type.toLowerCase(),s=ho[i];return r&&r.useDefaults&&D.default.defaults(t,D.default.mapObject(Qt(s.defaults),function(a){return D.default.isFunction(a)?a():a})),Pe.types.forEach(a=>{let l=(r.cloningWidgetZIndex||this.getMaxZIndex(a))+1;Object.assign(t,ff(t,{z:l},a))}),t.y=t.y===void 0?this.getDefaultY(t):t.y,t.x=t.x&&t.x==="center"?this.getCenterX(t):t.x,t.y=s.yOffsetOnCreate&&typeof s.yOffsetOnCreate=="number"&&t.y!==void 0?t.y+s.yOffsetOnCreate:t.y,this.page.addWidget(t,r),this.mag.increaseWidgetAddCounter(),t});E(this,"getMaxZIndex",t=>{let i=this.blocks.filter(s=>!s.outofbox).map(s=>{if(t){let a=s.model.toJSON();return t==="default"?a.z:a[t]?.z??a.z}return parseInt(s.model.get("z"))}).reduce((s,a)=>Math.max(a,s),-1/0);return i<=0&&(i=99),i});E(this,"getDefaultY",(t={})=>{let r=t.h||oe.widget.defaults.h,i=this.getCachedSizes(),s=window.RM.constructorRouter.zoom.getZoom(),a=i.windowClientHeight||0;return Math.round(a/2/s-r/2+(this.$container.scrollTop()||0)/s-this.position.top)});E(this,"getCenterX",t=>{t=t||{};let r=t.w||oe.widget.defaults.w,i=this.$el.width()||0,s=this.$window.width()||0,a=window.RM.constructorRouter.zoom.getZoom();return i*a<=s?Math.round(i/2-r/2):Math.round(s/2/a-r/2+(this.$container.scrollLeft()||0)/a)});E(this,"getViewportPosition",()=>{let t=this.$el.offset()||{left:0,top:0},r=parseFloat(this.$el.css("border-top-width"));return{top:t.top||r?-t.top-r:0,left:t.left?-t.left:0,height:this.$el.parent().height(),width:this.$el.width(),viewportWidth:this.$el.parent().width(),pageHeight:this.page.get("height")}});E(this,"createBlock",(t,r)=>{if(r=r||{},!!D.default.find(this.blocks,function(l){return l.model.id===t.id}))return;let s=this.addBlock(t,r),a=this.blocksToClone&&this.blocksToClone[t.id];this.renderBlock(s,a,{isNew:!0}),a&&(delete a.$cloneEl,delete this.blocksToClone[t.id]),t._nestedWidgetsJSON&&this.createNestedBlocks(s,t._nestedWidgetsJSON,function(){delete t._nestedWidgetsJSON}),t.isGlobal()||this.trigger("redraw"),!r.undo&&!r.redo&&!r.group&&(!t.isGlobal()||r.is_new_global)&&(s.select(!1,{noFrame:r.isMultiple}),this.triggerSelectOnSelectedBlockDebounced())});E(this,"triggerSelectOnSelectedBlock",()=>{let t=this.getSelectedBlocks();!t||!t.length||this.trigger("select",t)});E(this,"renderMissedWidgets",()=>{this.page.widgets.chain().reject(t=>t.isGlobal()||!this.page.get("wids").includes(t.id)).map(t=>{let r=this.findBlock(t.get("_id"));r||(r=this.addBlock(t),this.renderBlock(r))})});E(this,"addBlock",(t,r)=>{let i=ho[t.get("type")],s=window.sessionStorage.getItem("constructorViewport")||"default",a=ns({target:t,viewport:s,pageId:this.page.id,disposable:!1,minimalViewports:Ye.canUseMinimalViewport()}),l=new i(a,this);return this.blocks.push(l),this.trigger("block:create",l,r),l});E(this,"renderBlock",(t,r,i)=>{if(t.render(i),t.model.get("sticked")){let s=t.getStickedDims();t.model.set({x:s.x,y:s.y})}t.outofbox||t.redrawPosition(t.model,{forceRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),r&&D.default.isObject(r)&&(r.$cloneEl&&r.$cloneEl.remove(),r.name==="Shape"&&r.redrawShape(r.model.get("w"),r.model.get("h")))});E(this,"removeBlock",t=>{let r=D.default.find(this.blocks,function(i){return i.model.id===t.id});r&&(this.blocks=D.default.without(this.blocks,r),this.trigger("block:remove",r),r.destroy(),r.model.stopListening(),this.redrawPacksFrames({tp:"remove"}),this.redrawBottomShiftLine({tp:"remove"}))});E(this,"selectAllBlocks",()=>{je.isPermissionAllowed("BaseWidgetCanSelectMultiple")&&(this.disabledSelectMultiple||this.selectBlocks({x:-5e4,y:-5e4,w:1e5,h:201600},{merge:!1}))});E(this,"selectListBlocks",(t,r)=>{if(!je.isPermissionAllowed("BaseWidgetCanSelectMultiple")||this.disabledSelectMultiple)return;let i=D.default.flatten(D.default.difference(D.default.intersection(t,r),r));D.default.each(i,function(s){s.deselect()}),D.default.each(t,function(s){s instanceof Array?s[0].selectFromWidgetBar({shiftKey:!0},!0):s.select(!0)}),this.trigger("select",this.getSelectedBlocks(),D.default.flatten(i))});E(this,"selectBlocks",(t,r)=>{r=r||{};let i=6;this.viewport!=="default"&&window.RM.constructorRouter.trigger("notice:triggerMetrics","mobileGroupSelected");let a=D.default.filter(this.blocks,function(d){return d.isSelectable()&&d.inArea(t)});if(a=D.default.filter(a,function(d){return!!(!d.isLocked()||r?.includeLocked)}),r?.selectOnlyFrontmostBlock&&a.length>0){let d=a.reduce((g,h)=>h.currentZ>g.currentZ?h:g);d&&(a=[d])}let l=["Shape","Picture","Button","Text"],m=D.default.map(a,d=>d.name),c=D.default.uniq(m);m.length>=2&&c.length===1&&l.includes(c[0])&&window.RM.constructorRouter.trigger("notice:triggerMetrics","multipleWidgetsOfSameTypeSelected");let p=D.default.filter(this.packs||{},function(d){let g=d.getBoxData(),h=g.y,b=g.b;if(d.isFixed()){let x=this.$container.scrollTop();h+=x,b+=x}return Math.max(t.x,g.x)<Math.min(t.x+t.w,g.r)&&Math.max(t.y,h)<Math.min(t.y+t.h,b)}.bind(this));if(r?.selectOnlyFrontmostBlock&&p.length>0){let d=p.reduce((g,h)=>{let b=h.blocks.reduce((y,S)=>S.currentZ>y.currentZ?S:y),x={pack:h,maxZIndex:b.currentZ};return x.maxZIndex>g?.maxZIndex?x:g},{pack:{},maxZIndex:-1/0});Object.keys(d.pack).length>0&&d.maxZIndex>-1/0&&(p=[d.pack],a=[])}D.default.each(p,D.default.bind(function(d){a=D.default.union(a,D.default.filter(this.getPackBlocks(d.id),function(g){return!!(!g.isLocked()||r?.includeLocked)}))},this)),a=D.default.uniq(a);let u;r.merge||(D.default.isEmpty(a)?this.getSelectedBlocks().length?(u=this.controls?.canControlsBeClosed(),(!this.controls||u)&&this.trigger("deselect")):t.w<=i&&t.h<=i&&this.trigger("whitespace_click"):this.trigger("deselect")),D.default.defer(function(){let d=[],g=r?.merge?a.length-D.default.filter(a,x=>x.selected).length>1:a.length>1;D.default.each(a,function(x){r?.merge&&x.selected?(x.deselect(),d.push(x)):x.select(!1,{noFrame:g})});let h=r?.merge?this.getSelectedBlocks():a,b=this.redefineSelection(h,d);D.default.isEmpty(b.selected)?(!this.controls||u===null&&this.controls.canControlsBeClosed()||u)&&this.trigger("deselect"):this.trigger("select",b.selected,b.deselected)}.bind(this))});E(this,"onPackClick",t=>{let r=window.RM.constructorRouter.zoom.getZoom(),i=this.getCachedSizes(),s=this.viewport,a=Pe.dictionary[s].width;this.selectBlocks({x:(t.pageX-((i.width||0)-a*r)/2)/r,y:(t.pageY+(this.$container.scrollTop()||0)-this.position.top)/r,w:1,h:1},{merge:t.shiftKey,includeLocked:!0,selectOnlyFrontmostBlock:!0})});E(this,"redefineSelection",(t,r,{ignorePacks:i=!1}={})=>{if(!je.isPermissionAllowed("BaseWidgetCanSelectMultiple"))return{selected:[t[0]],deselected:[]};if(this.disabledSelectMultiple)return{selected:[t[0]],deselected:[]};if(t&&!D.default.isArray(t)&&(t=[t]),r&&!D.default.isArray(r)&&(r=[r]),t=t||[],r=r||[],i)return{selected:D.default.difference(t,r),deselected:r};let s=D.default.uniq(D.default.compact(D.default.map(t,function(m){return m.model.get("pack_id")}))),a=[];D.default.each(s,D.default.bind(function(m){a=D.default.union(a,this.getPackBlocks(m))},this)),a=D.default.difference(a,t),D.default.each(a,function(m){m.select(!1,{noFrame:!0})}),t=D.default.union(t,a);let l=D.default.uniq(D.default.compact(D.default.map(r,function(m){return m.model.get("pack_id")})));return a=[],D.default.each(l,D.default.bind(function(m){a=D.default.union(a,this.getPackBlocks(m))},this)),D.default.each(a,function(m){m.deselect()}),r=D.default.union(r,a),t=D.default.difference(t,r),{selected:t,deselected:r}});E(this,"redrawPacksFrames",(t={})=>{je.isPermissionAllowed("BaseWidgetCanSelectMultiple")&&(this.disabledSelectMultiple||this.redrawPacksFramesHolded||(this.redrawPacksFramesHolded=!0,window.requestAnimationFrame(()=>this._redrawPacksFrames(t))))});E(this,"_redrawPacksFrames",(t={})=>{this.redrawPacksFramesHolded=!1;let r=this.getSelectableBlocks(),i={},s=D.default.map(this.packs,function(u){return u.export()}),a=(u,d)=>{if(!i[u]){let h=this.packs[u];h?(h.reset(),i[u]=h):i[u]=new sa({id:u,workspace:this})}i[u].addBlock(d,{noSizeConstraints:t.tp&&["move","select"].includes(t.tp)})};D.default.each(r,function(u){let d=u.model.get("pack_id");u.selected&&this.getSelectedBlocks().length>1&&a("selected",u),d&&a(d,u)},this);let l=D.default.map(i,function(u){return u.export()}),m=D.default.any(this.blocks,function(u){return u.model.get("fixed_position")});if(D.default.isEqual(s,l)&&!m)return;let c=this.$el.children().first();D.default.each(this.packs,function(u){D.default.has(i,u.id)||u.destroy()}.bind(this));let p=u=>u.blocks.every(d=>i.selected?.blocks.find(g=>g===d));D.default.each(i,function(d){d.rendered||(c.append(d.render()),this.listenTo(d,"click",this.onPackClick.bind(this))),d.update({isInSelectionWithOthers:d.id!=="selected"&&p(d)})}.bind(this)),this.packs=i,this.checkBundleDragAbility()});E(this,"getPackBlocks",t=>D.default.filter(this.blocks,function(r){return r.model.get("pack_id")===t}));E(this,"checkOneWidgetPacks",()=>{let t=D.default.groupBy(this.getExistingWidgets(),function(r){return r.get("pack_id")?r.get("pack_id"):0});D.default.each(t,function(r,i){i!=="0"&&r.length===1&&r[0].save("pack_id",null,{patch:!0})})});E(this,"onSelect",()=>{this.redrawPacksFrames({tp:"select"}),this.redrawBottomShiftLine({tp:"select"});let t=$t();t.step?.name==="MobileMenuVisible"&&!this.getSelectedBlocks()[0].model.get("hidden")&&Ie(["MobileMenuVisible"]),t.step?.name==="FixMenuClickOutside"&&Ie(["FixMenuClickOutside"]),t.step?.name==="BeforeAddAnimations"&&this.getSelectedBlocks().length===2&&Ie(["BeforeAddAnimations"])});E(this,"onDeselect",t=>{let r=$t();D.default.chain(this.blocks).where({selected:!0}).invoke("deselect",t),D.default.defer(function(){this.redrawPacksFrames({tp:"deselect"}),this.redrawBottomShiftLine({tp:"deselect"}),r.started&&r.step?.name==="EverythingInItsRightPlace"&&Ie(["EverythingInItsRightPlace"]),r.started&&r.step?.name==="DeselectAfterSetBlocksDistance"&&Ie(["DeselectAfterSetBlocksDistance"]),this.restoreFocusForCopyPaste()}.bind(this))});E(this,"restoreFocusForCopyPaste",()=>{(0,rt.default)(".copyhack").selectText()});E(this,"preloadBlocks",()=>{this.blocks.forEach(t=>t.preload?.())});E(this,"getSelectedBlocks",()=>D.default.filter(this.blocks,function(t){return t.selected}));E(this,"deselectBlocksExcept",t=>{this.getSelectedBlocks().filter(r=>r!==t).forEach(r=>r.deselect())});E(this,"getActiveBlocks",()=>this.blocks.filter(function(t){return!t.model.get("hidden")}));E(this,"getSelectableBlocks",()=>this.blocks.filter(function(t){return!t.model.get("hidden")&&!t.outofbox}));E(this,"getExistingWidgets",()=>(0,D.default)(this.blocks).chain().pluck("model").value());E(this,"save_group",(t,r)=>{this.set_group(t,r,!0)});E(this,"set_group",(t,r,i)=>{let s=this.viewport,a=t;if(Array.isArray(t)&&t[0]?.getWidget)a=t.map(l=>l.getWidget());else if(Array.isArray(t)&&t.length&&!(t[0]instanceof Np.default.Model)){let l=t.map(m=>{let c=m._id,p;for(let u of this.blocks||[]){let d=u.model.id===c;if(d){p=u?.model;break}else if(!d&&u.child_workspace){let h=u.child_workspace?.blocks?.find(b=>b.model.id===c);if(h){p=h?.model;break}}}return Dt("widget.anomalyMonitoring")&&p&&p.viewport==="default"&&s!==p.viewport&&Wl.sendEvent({type:"setInMismatchedViewport",widget:p.toJSON(),payload:m}),p?p.normalizeUpdate(m,r):{update:m}});a=l.map(m=>m.update),r=l.length?l[0].options:r}i?this.syncManager.saveGroup(a,r):this.syncManager.setGroup(a,r)});E(this,"changeVisibilityForSelectedBlocks",()=>{let t=this.getSelectedBlocks(),r=[],i=!1;t.forEach(s=>{let a=s.model.get("hidden");a&&(i=!0),r.push({_id:s.model.get("_id"),hidden:a})}),i?r.forEach(s=>s.hidden=!1):r.forEach(s=>s.hidden=!0),this.save_group([...r]),this.selectListBlocks(t,[])});E(this,"changeLockForSelectedBlocks",()=>{let t=this.getSelectedBlocks(),r=[],i=!1;for(let s of t){let a=s.model.get("is_locked"),l=s.model.get("_id");a&&(i=!0),r.push({_id:l,is_locked:a})}i?r.forEach(s=>s.is_locked=!1):r.forEach(s=>s.is_locked=!0),this.save_group(r)});E(this,"toggleWidgets",t=>{t=t||{};let r=[],i=[];D.default.each(t.wids||[],D.default.bind(function(a){let l=this.page.widgets.get(a)||this.mag.globalWidgets.get(a);l&&r.push({_id:l.get("_id"),hidden:!!t.hidden})},this));let s=this.getBlocksThatOnlyOnesInGroupByChangeset(r);s.length>0&&(i=s.map(a=>({_id:a.get("_id"),pack_id:null}))),this.save_group([...r,...i])});E(this,"deleteSelectedBlocks",()=>{if(!je.isPermissionAllowed("BaseWidgetCanDelete"))return;if(this.animationMode){this.animationSteps.removeSelected();return}let t=$t(),r=this.getSelectedBlocks();this.deleteBlocks(r),this.deletedWidgetsCount=this.deletedWidgetsCount+r.length;let i=6;t.step?.name==="SelectBlocksAndDelete"&&this.deletedWidgetsCount>=i&&Ie("SelectBlocksAndDelete"),Ie(["DeleteBlocks","DeleteNavBar"]),r.forEach(s=>{this.deleteCommentsFromBlock(s.model.get("_id"))})});E(this,"getBlocksThatOnlyOnesInGroupByChangeset",t=>{let r=[];return t.forEach(s=>{let a=this.blocks.findIndex(l=>l.model.get("_id")===s._id);a!==-1&&r.push(this.blocks[a])}),this.getBlocksThatOnlyOnesInGroup(r)});E(this,"getBlocksThatOnlyOnesInGroup",(t,r=!1)=>{let i=[],s={};t?.forEach(a=>{let l=a.model.get("_id"),m=a.getPack();a.model.isGlobal()||m&&(s[m.model.cid]?s[m.model.cid]=s[m.model.cid].filter(c=>c.model.get("_id")!==l):s[m.model.cid]=[...m.blocks.filter(c=>c.model.get("_id")!==l)])});for(let a in s)if(s[a].length===1){let l=s[a][0];l.model&&r&&l.model.set({pack_id:null}),i.push(l.model)}return i});E(this,"deleteBlocks",(t,r={})=>{if(!je.isPermissionAllowed("BaseWidgetCanDelete"))return;let i=this.viewport,s=D.default.pluck(t,"model"),a={},l=new Np.default.Collection,m=!1;(0,D.default)(s).each(function(p){let u=!1;r.forceRemove||(u=p.isGlobal()&&i!=="default");let d=u?this.page:this.mag.getPage(p.get("pid"));d&&(l.add(d),a[d.id]=(a[d.id]||[]).concat(p.id),p.get("type")==="ecommercecart"&&!u&&(m=!0))},this),D.default.each(a,function(p,u){this.mag.getPage(u).removeWidgets(p,{nosave:!0,viewport:this.viewport,...r})},this),m&&this.eCommerceManager.setCartWidgetExistState(!1);let c=i==="default"?this.getBlocksThatOnlyOnesInGroup(t,!0):[];l.isEmpty()||this.save_group([...l.models,...c],{page:this.page.id})});E(this,"pastePreset",(t,r={})=>{let i=Qt(t),s=this.viewport;if(r.customLayersName){let c=r.customLayersName,p=[...i.blocks.filter(u=>!u.pack_id),...i.packs??[]];for(let u of p)u.name=c}let{left:a,top:l}=xt.mapFromViewportToElement({top:window.innerHeight/2,left:window.innerWidth/2},this.$origin.get(0),1,window.RM.constructorRouter.zoom.getZoom()),m=c=>{let p={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};return c.forEach(u=>{p.t=Math.min(p.t,u.y),p.l=Math.min(p.l,u.x),p.b=Math.max(p.b,u.y+u.h),p.r=Math.max(p.r,u.x+u.w)}),{x:p.l,y:p.t,w:p.r-p.l,h:p.b-p.t}};Pe.viewport_listall.forEach(c=>{let p=i.blocks.filter(u=>{let d=c==="viewport_default"?u:u[c]??u;return!d.hidden&&!d.fixed_position});if(p.length){let u=m(p.map(b=>{let x=c==="viewport_default"?b:b[c]??b;return{h:x.h??b.h,w:x.w??b.w,x:x.x??b.x,y:x.y??b.y}})),d=u.x,g=u.y;c===`viewport_${s}`&&(d-=a-u.w/2,g-=l-u.h/2),i.blocks.forEach(b=>{c!=="viewport_default"&&!b[c]&&(b[c]={x:b.x,y:b.y,pack_id:b.pack_id});let x=c==="viewport_default"?b:b[c];x.fixed_position||(x.y=Math.floor((x.y??b.y)-g),x.x=Math.floor((x.x??b.x)-d))})}}),this.pasteBlocks(i,{disablePositionY:!0,...r})});E(this,"pasteBlocks",(t,r={})=>{if(!je.isPermissionAllowed("BaseWidgetCanAdd"))return;let i=[...t.blocks],s=i&&i.length&&i.length>1,a=10,l=i[0].pid===this.page.get("_id"),m=t.mag_num_id!==this.mag.get("num_id");if(this.trigger("deselect"),!i||!i.length){console.error("cannot paste empty array of blocks!");return}let c=i.reduce((S,k)=>(S.push(k.pack_id),S.push(k.viewport_phone_portrait?.pack_id),S.push(k.viewport_tablet_portrait?.pack_id),S),[]).filter(Boolean),u=D.default.unique(c).reduce((S,k)=>(S[k]=Ye.generateUUID(),S),{}),d={},g={},h={},b={viewport_default:[],viewport_phone_portrait:[],viewport_tablet_portrait:[]};i=D.default.sortBy(i,function(S){return S.z}),i.forEach(S=>{b.viewport_default.push(S._id)}),Pe.viewport_list.forEach(S=>{D.default.sortBy(t.blocks,P=>P[S]?.z??P.z).forEach(P=>{b[S].push(P._id)})}),m&&(this.mag.mergeEditParams(t.mag_edit_params),t.mag_edit_params&&Yl({newTextStyles:t.mag_edit_params.textStyles||[],newLinkStyles:t.mag_edit_params.linkStyles||[],newListStyles:t.mag_edit_params.listStyles||[]}));let x=vd(i),y=D.default.bind(function(S){let k=i[S];k&&k.type==="text"&&k.version!==3&&(k=ub(k));let P=k&&k._id,C=Qt(k);if(!C){this.page.groupSaveWids(this.getExistingWidgets()),this.handleAnimationTriggerClone(x,h),this.handleRestoreViewportIndex(b);return}let B=this.getDefaultY(C);delete C._id,delete C.id,delete C.__v,delete C.pid,r.disableDeleteGlobalAttributes||(delete C.is_global,delete C.is_above),C.pack_id&&(C.pack_id=u[C.pack_id]),D.default.each(Pe.viewport_list,Z=>{let F=C[Z];if(F){let V=F.pack_id;F.pack_id=u[V]}});let $=C.hotspots_group_id;$&&(d[$]=d[$]||Ye.generateUUID(),C.hotspots_group_id=d[$]),this.handleAnimationGroups(C,g),r.disablePositionY||(C._variationY!==void 0&&!C.fixed_position&&(C.y=B+C._variationY,delete C._variationY),l&&C.x!==void 0&&C.y!==void 0&&(C.x+=a,C.y+=a,D.default.each(Pe.viewport_list,Z=>{let F=C[Z];F&&(F.x+=a,F.y+=a)})));let A=Qt(C._nestedWidgetsJSON);delete C._nestedWidgetsJSON;let R=function(Z){A&&(Z._nestedWidgetsJSON=A,this.createNestedBlocks(this.findBlock(Z.id),A,function(){delete Z._nestedWidgetsJSON})),h[P]=Z.id,Pe.viewport_listall.forEach(F=>{let V=b[F].indexOf(P);b[F][V]=Z.id}),y(S+1)}.bind(this);this.addWidget(Qt(C),{copy:!0,group:!0,isMultiple:s,success:R,error:R,...r})},this);if(y(0),t.packs?.length){let S=t.packs.map(k=>({...k,pack_id:u[k.pack_id],_id:void 0,mid:this.mag.id}));S.filter(k=>k.name||k.atomic).map(k=>{new Ea(k).save()}),this.mag.set("packs",this.mag.get("packs").concat(S))}});E(this,"handleRestoreViewportIndex",t=>{let i=t.viewport_default.map(l=>this.findBlock(l)).filter(Boolean).map(l=>l.model);[{viewport:"phone_portrait",key:"viewport_phone_portrait"},{viewport:"tablet_portrait",key:"viewport_tablet_portrait"}].forEach(({viewport:l,key:m})=>{t[m].forEach((p,u)=>{let d=i.find(b=>b.get("_id")===p),g=d.toJSON(),h=(g[m]?.z??g.z)+u;window.RM.constructorRouter.indexController.moveWidget(this.page,[d],h,l)})});let s=window.RM.constructorRouter.indexController.getFullOrder();s[this.page.id]&&this.page.save({order:s[this.page.id]},{silent:!0,skipHistory:!0,patch:!0})});E(this,"cloneBlocks",(t,r)=>{if(!je.isPermissionAllowed("BaseWidgetCanAdd"))return;if(delete this.movingBlocks,delete this.movingDelta,!t||!t.length)return console.error("cannot clone empty array of blocks");D.default.each(t,c=>{let p=window.RM.constructorRouter.indexController.getZIndex(c.model.id,this.page.id,this.viewport);c._z=p||c.model.get("z")}),t=D.default.sortBy(t,c=>c._z),this.blocksToClone=this.blocksToClone||{};let i={},s={},a={};r=r||{};let l=vd(t),m=D.default.bind(function(c){let p=t[c],u=p&&p.id;if(!p){this.page.groupSaveWids(this.getExistingWidgets(),D.default.extend(D.default.clone(r),{clone:!0})),this.handleAnimationTriggerClone(l,a);return}let d=p.model.cloneJSON();d=D.default.omit(d,D.default.union(["_id","id","__v"])),p._z&&(d.z=p._z,delete p._z),d.is_global&&(d.is_global=!1),d.is_above&&(d.is_above=!1),D.default.each(Pe.viewport_list,function(b){if(!d[b])return;let x=d[b].pack_id;x&&(i[x]=i[x]||Ye.generateUUID(),d[b].pack_id=i[x])});let g=d.pack_id;if(g&&(i[g]=i[g]||Ye.generateUUID(),d.pack_id=i[g]),this.handleAnimationGroups(d,s),p.$cloneEl||r?.offset){let b=p.getBoxData({includeRotationData:!0}),x,y,S;p.$cloneEl&&(x=p.$el.offset(),y=p.$cloneEl.offset()),D.default.each(Pe.viewport_listall,function(k){if(k==="viewport_default")S=d;else{if(!d[k])return;S=d[k]}let P,C;if(p.$cloneEl?(P=(y.left-x.left)*(S.fixed_position&&S.fixed_position.indexOf("e")>-1?-1:1),C=(y.top-x.top)*(S.fixed_position&&S.fixed_position.indexOf("s")>-1?-1:1)):(P=r?.offset.x??0,C=r?.offset.y??0),"x"in S||(S.x=b.x),"y"in S||(S.y=b.y),S.x+=P,S.y+=C,(S.type==="hotspot"&&S.flags?.tipFreePosition||!1)&&(S.tip_x+=P,S.tip_y+=C),S.sticked){let A=S.sticked==="left"||S.sticked==="right"?y.left-x.left:y.top-x.top;(S.sticked==="right"||S.sticked==="bottom")&&(A*=-1),S.sticked_margin=(S.sticked_margin||0)+A}})}let h=function(b){p.getNestedWidgetsJSON&&(b._nestedWidgetsJSON=p.getNestedWidgetsJSON(!0)),a[u]=b.id,m(c+1)}.bind(this);this.addWidget(d,D.default.extend(D.default.clone(r),{silent:!0,clone:!0,group:!0,cloningWidgetZIndex:d.z||p.attributes.z,success:D.default.bind(function(b){this.blocksToClone[b.id]=p,h(b)},this),error(b){h(b),p.$cloneEl&&p.$cloneEl.remove(),delete p.$cloneEl}}))},this);this.trigger("deselect"),m(0)});E(this,"handleAnimationGroups",(t,r)=>{Pe.viewport_listall.forEach(i=>{let s=i==="viewport_default"?t.animation:t[i]&&t[i].animation;if(s){let a=es.normalizeAnimations(s).map(l=>l.UUID?(r[l.UUID]=r[l.UUID]||Ye.generateUUID(),{...l,UUID:r[l.UUID]}):l);i==="viewport_default"?t.animation=a:t[i].animation=a}})});E(this,"handleAnimationTriggerClone",(t,r,i)=>{if(t.length){let s=Yf(t,r,i||this.blocks);D.default.each(s,function(l){l.selected&&l.model.trigger("animation:trigger:add")});let a=s.map(l=>l.model);Promise.all(a.map(l=>this.syncManager.whenModelReady(l))).then(()=>this.save_group(a,{skipHistory:!0}))}});E(this,"onReturnFromPreview",()=>{this.$("svg").hide(),D.default.delay(D.default.bind(function(){this.$("svg").show()},this))});E(this,"clearBottomBlocksToMove",()=>{this.bottomBlocksToMove&&(delete this.bottomBlocksToMove.list,delete this.bottomBlocksToMove.tosave,delete this.bottomBlocksToMove.deltaYcorrection,delete this.bottomBlocksToMove.prevDeltaY)});E(this,"redrawBottomShiftLine",t=>{let r=()=>{this.$bottomShiftLine&&this.$bottomShiftLine.remove(),delete this.$bottomShiftLine},i=m=>{this.$bottomShiftLine||(this.$bottomShiftLine=(0,rt.default)('<div class="bottom-shift-line"></div>').appendTo(this.$el.children().first())),this.$bottomShiftLine.css("top",m)};t=t||{};let s=this.bottomBlocksToMove;if(!s||!s.active||t.hide){r();return}t.tp==="move-unselected-start"&&(this._unselectedBlocksForBottomLine=t.blocks),t.tp==="move-unselected-end"&&delete this._unselectedBlocksForBottomLine;let a=this._unselectedBlocksForBottomLine||D.default.filter(this.getSelectedBlocks(),function(m){return!m.isLocked()});if(a.length===1&&(a[0].frame.rotationState||a[0].animationMode)){r();return}let l=D.default.reduce(a,function(m,c){return!c.model.get("fixed_position")&&!c.outofbox?s.fPressed?Math.min(m||99999999,c.latestPosSizeAngle.bb_top):Math.max(m||-99999999,c.latestPosSizeAngle.bb_top+c.latestPosSizeAngle.bb_height-1):m},void 0);l===void 0?r():i(l)});E(this,"checkBundleDragAbility",()=>{if(this.spacesController)return;let t=this.blocks.filter(d=>!d.model.get("pack_id")).concat(this.getAllPacks()),r=this.getAllPacks().filter(d=>d.isSelected()),i=this.getSelectedBlocks().concat(r),s,a,l=999999,m=0,c=D.default.map(i,function(d){return{b:d,bb:d.getBoxData({includeBoundingBox:!0})}});D.default.each(c,function(d){l>d.bb.bb_y&&(l=d.bb.bb_y,s=d),m<d.bb.bb_y+d.bb.bb_h&&(m=d.bb.bb_y+d.bb.bb_h,a=d)});let p=!1,u=!1;D.default.each(t,function(d){if(d.model.get("fixed_position")||d.model.get("sticked")||d.outofbox||D.default.contains(i,d))return;let g=d.getBoxData({includeBoundingBox:!0});g.bb_y>m&&(u=!0),g.bb_y>l&&(p=!0)}),D.default.each(c,function(d){d.b.$el.removeClass("bundle-allow-top"),d.b.$el.removeClass("bundle-allow-bottom"),p&&s&&Math.abs(s.bb.bb_y-d.bb.bb_y)<.1&&d.b.$el.addClass("bundle-allow-top"),u&&a&&Math.abs(a.bb.bb_y+a.bb.bb_h-(d.bb.bb_y+d.bb.bb_h))<.1&&d.b.$el.addClass("bundle-allow-bottom")})});E(this,"calcBottomBlocksToMove",(t,r)=>{let i=[],s=[],a=D.default.reduce(t,function(m,c){return!c.model.get("fixed_position")&&!c.outofbox?r.fPressed?Math.min(m||99999999,c.latestPosSizeAngle.bb_top):Math.max(m||-99999999,c.latestPosSizeAngle.bb_top+c.latestPosSizeAngle.bb_height):m},void 0),l=Jo.getViewportSetting("min_height",this.viewport);if(a!==void 0){i=D.default.filter(this.blocks,function(p){return p.model.get("fixed_position")||p.model.get("sticked")||p.model.get("is_locked")||p.outofbox||D.default.contains(t,p)?!1:a>p.latestPosSizeAngle.bb_top?(p.model.get("hidden")||(l=Math.max(p.latestPosSizeAngle.bb_top+p.latestPosSizeAngle.bb_height,l)),!1):(s.push(p.getBoxData({includeBoundingBox:!0})),!0)}),i=i.filter(p=>{let u=p.model.get("pack_id"),d=this.packs[u];return!d||d.blocks.length===i.filter(g=>g.model.get("pack_id")===u).length}),s=i.map(p=>p.getBoxData({includeBoundingBox:!0})),l=Math.round(l);let m=D.default.uniq(D.default.compact(D.default.map(i,function(p){return p.model.get("pack_id")}))),c=[];D.default.each(m,D.default.bind(function(p){c=D.default.union(c,this.getPackBlocks(p))},this)),c=D.default.difference(c,i),c=D.default.filter(c,function(p){return p.model.get("fixed_position")||p.outofbox||p.model.get("sticked")||p.model.get("is_locked")?!1:(s.push(p.getBoxData({includeBoundingBox:!0})),!0)}),i=D.default.union(i,c)}return{list:i,minPageHeight:l,initPageHeight:this.page.getViewportParam(this.viewport,"height"),initial:s}});E(this,"onSpecialKey",t=>{this.checkBundleDragMode(t),!this.widgetResizingOrRotating&&je.isPermissionAllowed("BaseWidgetCanAdd")&&(t.type==="keydown"&&t.altKey&&(0,rt.default)("html").addClass("alt-key-pressed"),t.type==="keyup"&&t.keyCode===rt.default.keycodes.alt&&(0,rt.default)("html").removeClass("alt-key-pressed"))});E(this,"findBlock",t=>D.default.find(this.blocks,function(r){return r.model.id===t}));E(this,"getPageNum",()=>this.mag.getPageNum(this.page.id));E(this,"getPageId",()=>this.page.id);E(this,"findPage",t=>{let r=this.getPageNum()??1;return t==="next"&&(r+=1),t==="prev"&&(r-=1),this.mag.getPageId(r.toString(),{onlyActive:!0})});E(this,"showLoader",t=>{this.loader.css(t).fadeIn(100)});E(this,"insertLoaderToElem",(t,r)=>this.loader.clone().css(D.default.extend({position:"absolute"},r)).prependTo(t).fadeIn(100));E(this,"hideLoader",()=>{this.loader.fadeOut(100),this.trigger("hideLoader")});E(this,"getTemplateJSON",(t={})=>{let r=[],i=[],s=D.default.chain(this.page.toJSON()).omit("__v","num_id","hidden","custom_shares","seo").value();return t.withGlobalWidgets&&(s.wids=s.wids?D.default.uniq(s.wids.concat(this.mag.globalWidgets.map(l=>l.get("_id")))):[]),t.withGlobalWidgets?D.default.each(s.wids||[],l=>{let m=(0,D.default)(this.blocks).find(function(p){return p.id===l&&!p.model.isGlobal()});m&&r.push(a(m));let c=(0,D.default)(this.blocks).find(function(p){return p.id===l&&p.model.isGlobal()});c&&!i.map(p=>p.id).includes(c.id)&&i.push(a(c))}):D.default.each(s.wids||[],l=>{let m=(0,D.default)(this.blocks).find(function(c){return c.id===l&&!c.model.isGlobal()});m&&r.push(a(m))}),s.wids=r,s.globalWids=i,s.mag_num_id=this.mag.get("num_id"),s.has_globals=!this.mag.globalWidgets.isEmpty(),s.options=t,s;function a(l){let m=l.model,c=D.default.chain(m.toJSON()).omit("__v","pid").value();return l.getNestedWidgetsJSON&&(c.wids=l.getNestedWidgetsJSON(!0)),c}});E(this,"toggleBorder",({guidesOn:t=!1,columnCount:r=0,margin:i={},willResize:s=!1})=>{this.$border.toggleClass("ghost",!t),t?this.$border.css({opacity:"","border-top":r&&!i.top?"none":"","border-right":r&&!i.right?"none":"","border-bottom":r&&!i.bottom?"none":"","border-left":r&&!i.left?"none":""}):this.viewport!=="default"||s?this.$border.css({opacity:1,"border-top":"","border-right":"","border-bottom":"","border-left":""}):this.$border.css({opacity:0})});E(this,"toggleBlocksEditParams",()=>{if(!this.rendered)return;this.triggerNextHelpTourStep();let t=!!this.mag.edit_params.get("blocks");t&&ae(ce.BlocksMode,{settingsType:"on"}),this.toggleBundleBlocks(t)});E(this,"toggleBundleBlocks",t=>{t=t===void 0?!this.spacesController:t,!t&&this.spacesController?(this.spacesController?.destroy(),this.spacesController=void 0):t&&!this.spacesController&&(this.spacesController=new Fw(this))});E(this,"onGuidesChange",()=>{this.triggerNextHelpTourStep()});E(this,"triggerNextHelpTourStep",()=>{let t=$t();t.started&&t.step?.name==="DisableBlocksAndGrid"&&!(this.mag.edit_params.get("blocks")||this.mag.edit_params.get("guides"))&&Ie("DisableBlocksAndGrid")});E(this,"updateLockState",()=>{let t=this.page.get("_id");this.locked=!!window.RM.constructorRouter.isPageLocked(t),this.$origin.toggleClass("locked",this.locked),this.controls?.$el.toggle(!this.locked)});E(this,"scrollToTop",()=>{this.$container.scrollTop(0)});E(this,"scrollToBottom",()=>{let t=this.page.getViewportParam(this.viewport,"height");this.$container.scrollTop(t)});E(this,"getViewports",()=>D.default.map(Pe.viewports,function(r){let i=r.name==="default"||this.page.get("viewport_"+r.name),s=r.name!=="tablet_portrait"?!1:!(this.page.getViewportParam("tablet_portrait","enabled")||this.page.getViewportParam("tablet_portrait","isHidden")===!1);return{name:r.name,min_height:r.min_height,max_height:r.max_height,isCurrent:r.name===this.viewport,enabled:!!(r.name==="default"||i&&this.page.getViewportParam(r.name,"enabled")),height:i?this.page.getViewportParam(r.name,"height"):r.min_height,noDisable:r.name==="default",isHidden:s}}.bind(this)));E(this,"restoreDesktopComposition",(t=[],{resetAllKeys:r=!1,preserveFixedPosition:i=!1}={})=>{let s=this.viewport,a=1024,l=this.mag.getViewportWidth(s),m=(a-l)/2,c=["x","y","w","h","z","angle","pack_id","sticked","scale"];i||c.push("fixed_position"),t.forEach(p=>{let u=p.model,d=hf(u.get("type"),u.get("version"),Ye.canUseMinimalViewport()),g=Object.keys(p.model.getOverrides(s)),h=r?Object.fromEntries(g.map(b=>d.includes(b)?[b,p.model.viewport_default[b]]:[b,void 0])):{};if(h=D.default.reduce(p.model.viewport_default,function(b,x,y){return c.indexOf(y)>=0&&(b[y]=x),b},h),p.model.viewport_default.is_full_width){h.w=p.model.get("full_width_initial_w"),h.x=p.model.get("full_width_initial_x"),h.is_full_width=!1;let b=p.model.get("originalH"),x=p.model.get("originalW");b&&x&&(h.h=Math.round(h.w/x*b))}if(p.model.viewport_default.is_full_height){h.h=p.model.get("full_height_initial_h"),h.y=p.model.get("full_height_initial_y"),h.is_full_height=!1;let b=p.model.get("originalH"),x=p.model.get("originalW");b&&x&&(h.w=Math.round(h.h/b*x))}if(p.model.viewport_default.fixed_position||(h.x-=m),p.model.get("type")==="text"&&p.model.get("version")===3&&(h.blocksMeta=p.model.viewport_default.blocksMeta,h.styles=p.model.viewport_default.styles,h.entityMap=p.model.viewport_default.entityMap,h.bgColor=p.model.viewport_default.bgColor,p.model.viewport_default.columns&&(h.columns=p.model.viewport_default.columns)),p.model.get("type")==="slideshow"&&(h.captions_h=p.model.viewport_default.captions_h,h.images_h=p.model.viewport_default.images_h),p.model.get("type")==="picture"&&(h.border_size=p.model.viewport_default.border_size),(p.model.get("type")==="shape"||p.model.get("type")==="hotspot")&&(h.borders=p.model.viewport_default.borders),p.model.get("type")==="button"&&(h["font-size"]=p.model.viewport_default["font-size"],h["letter-spacing"]=p.model.viewport_default["letter-spacing"],h.icon_h=p.model.viewport_default.icon_h,h.icon_w=p.model.viewport_default.icon_w,h["border-width"]=p.model.viewport_default["border-width"]),p.model.get("type")==="form"){let b=`style-${p.model.viewport_default.style}`;h.style=p.model.viewport_default.style,h.layout=p.model.viewport_default.layout,h[`${b}-fields`]={...p.model.viewport_default[`${b}-fields`]},h[`${b}-button-default`]={...p.model.viewport_default[`${b}-button-default`]},h[`${b}-button-hover`]={...p.model.viewport_default[`${b}-button-hover`]}}if(p.model.get("type")==="addtocart"&&(h.attributes_margin=p.model.viewport_default.attributes_margin,h.select_btn_margin=p.model.viewport_default.select_btn_margin,h["attrs-icon-h"]=p.model.viewport_default["attrs-icon-h"],h["attrs-icon-w"]=p.model.viewport_default["attrs-icon-w"],h["attrs-border-width"]=p.model.viewport_default["attrs-border-width"],h["border-width"]=p.model.viewport_default["border-width"],h["hover-border-width"]=p.model.viewport_default["hover-border-width"],h["attrs-font-size"]=p.model.viewport_default["attrs-font-size"],h["font-size"]=p.model.viewport_default["font-size"]),p.model.set(h),p.model.viewport_default.fixed_position){let{x:b,y:x}=ip.getViewportDefaults(p.model,s);p.model.set({x:b,y:x})}p.model.get("type")==="text"&&p.model.get("version")===3&&p.onRestoreLayout()}),window.RM.constructorRouter.indexController.restoreViewportToDefault(this.page,this.viewport)});E(this,"eliminateBlockIntersections",(t=[],r=20)=>{let i=gt.getBoundingBoxOfBlocks(t),s={up:[],down:[]};this.blocks.forEach(m=>{if(m.model.get("type")==="background"||m.model.get("is_global")||m.model.get("hidden")||m.model.get("fixed_position")||t.find(p=>p.model.get("_id")===m.model.get("_id")))return;let c=gt.calcBoundingBoxForBlock(m,!0,!1);c.top<i.top&&c.top+c.height>i.top&&s.up.push(m),c.top>=i.top&&s.down.push(m)});let a=i.top;if(s.up.length&&s.up.forEach(m=>{let c=gt.calcBoundingBoxForBlock(m,!0);c.top+c.height>a&&(a=c.top+c.height+r)}),a){let m=a-i.top;t.forEach(c=>c.model.set({y:c.model.get("y")+m})),i=gt.getBoundingBoxOfBlocks(t)}let l=0;return s.down.length&&(s.down.forEach(m=>{let c=gt.calcBoundingBoxForBlock(m,!0);if(c.top<=i.bottom){let p=i.bottom+r-c.top;p>l&&(l=p)}}),l&&s.down.forEach(m=>m.model.set({y:m.model.get("y")+l}))),!!l});E(this,"collapseEmptySpace",(t=[],r=20)=>{let i=gt.getBoundingBoxOfBlocks(t),s=D.default.chain(this.blocks).filter(a=>a.model.get("type")==="background"||a.model.get("is_global")||a.model.get("hidden")||a.model.get("fixed_position")||a.model.get("sticked")||t.find(m=>m.model.get("_id")===a.model.get("_id"))?!1:gt.calcBoundingBoxForBlock(a,!0).top>i.bottom).sortBy(a=>a.getBoxData().y).value();if(s.length){let a=s[0],l=gt.calcBoundingBoxForBlock(a,!0);if(l.top-i.bottom>r){let m=l.top-i.bottom-r;s.forEach(c=>c.model.set({y:c.model.get("y")-m}))}}return!!s.length});E(this,"singleColumnLayout",(t=[],{topMargin:r=20,rightMargin:i=20,bottomMargin:s,leftMargin:a=20,verticalGap:l=20,includeHidden:m=!1,includeGlobal:c=!1,includeFixed:p=!1,includeAboveAll:u=!1,preserveGroups:d=!0,includeAtomic:g=!1}={})=>{let h=!!this.spacesController;this.toggleBundleBlocks(!1);let b=this.viewport,x=Jo.getViewportSetting("width",b),y=this.mag.getViewportWidth(b),S=y-a-i,k=(x-y)/2+a,P=this,C=D.default.isEqual(t.map(ee=>ee.id).sort(),this.blocks.map(ee=>ee.id).sort()),B=this.mag.pages.filter(ee=>(ee.get("viewport_"+b)||{}).enabled&&ee!==P.page).length>0,$=c||!B,A=[],R=this.filterAutolayoutBlocks(t,{includeHidden:m,includeGlobal:c,includeFixed:p,includeAboveAll:u,includeAtomic:g}),Z=gt.getBoundingBoxOfBlocks(R),F=C?r:Z.top;this.restoreDesktopComposition(R,{preserveFixedPosition:!0});let V=this.collectBlocks(R,{fitText:!0,preserveGroups:d});if(V.length===0){h&&this.toggleBundleBlocks(!0);return}if(!$){let ee=V.filter(ue=>ue.model?.get("is_global"));V=D.default.difference(V,ee),A=D.default.reduce(ee,(ue,ke)=>{if(!ue.length)ue.push({from:ke.box.bb_y,to:ke.box.bb_y+ke.box.bb_h});else{let ge=D.default.last(ue);if(!ge)return ue;ge.to>ke.box.bb_y?ue.push({from:ke.box.bb_y,to:ke.box.bb_y+ke.box.bb_h}):ge.to=ke.box.bb_y+ke.box.bb_h}return ue},[])}let W=function(ee,ue){let ke=ue*Math.sqrt(ee.height*ee.height+ee.width*ee.width)/ee.bb_width,ge=ee.height/ee.width,we=ke/Math.sqrt(ge*ge+1),L=Math.floor(we*ge);return D.default.extend(ee,gt.calcBoundingBox(D.default.extend(ee,{width:we,height:L})))},J=function(ee,ue,ke){let ge,we;return D.default.each(ee,L=>{L.from<ue&&L.to>ue&&(ge=L),L.from<ue+ke&&L.to>ue+ke&&(we=L),L.from>ue&&L.to<ue+ke&&(we=L)}),!ge&&!we?ue:we?J(ee,we.to,ke):ge?J(ee,ge.to,ke):0},me=ee=>{ee.get("fixed_position")&&ee.set("fixed_position",""),ee.get("is_full_width")&&ee.set("is_full_width",!1),ee.get("is_full_height")&&ee.set("is_full_height",!1)};D.default.each(V,(ee,ue)=>{let ke=!!ee.pack_id,ge=ee.model;if(ke){let ze=ee.w;ze.forEach(M=>me(M.block.model));let Ae={width:S,left:k,top:F},Ne=this.scaleBlocksGroup(ze.map(M=>M.block),Ae,{widgetPackId:ee.pack_id,downsizeOnly:!0}),ft=0;Ne.top!==F&&(ft=F-Ne.top,Ne.top=F),ze.forEach(M=>{let z={...M.block.getSaveBoxData({resizeContent:!0})};z.y+=ft,M.model.set(z)}),F+=Ne.height,ee.groupBox=Ne,F=Math.ceil(J(A,F,Ne.height))+l;return}let we=ee.block,L=ee.box,j={width:L.w,height:L.h},N={height:L.h,width:L.w,top:L.y,left:L.x,bb_width:L.bb_w,bb_height:L.bb_h,bb_top:L.bb_y,bb_left:L.bb_x,angle:ge.get("angle")||0,flip_v:!!ge.get("flip_v"),flip_h:!!ge.get("flip_h"),sinAngle:Math.sin(-(ge.get("angle")||0)*Math.PI/180),cosAngle:Math.cos(-(ge.get("angle")||0)*Math.PI/180)};N.bb_width>S&&(N=we.frame.applyConstraints(W(N,S))),me(ge);let de=Math.round(N.width),le=Math.round(N.height),We=N.angle?k-(N.bb_left-N.left):k;if(ge.set({x:We,w:de,h:le}),we instanceof ho.text){we.scaleContent?.({width:de,height:le},j,{resizeText:!1,resizePaddings:!0});let ze=we.getRealContentHeight?.(!0,de);ge.set("h",ze)}let he=Number(ge.get("ratio")),fe=Number(ge.get("scale"));if(fe&&he){let ze=he<1?L.h/le:L.w/de,Ae=fe/ze;if(fe!==Ae)ge.set({scale:Ae});else{let Ne=ge.viewport_default&&Number(ge.viewport_default.scale),ft=ge.viewport_default&&Number(ge.viewport_default.w),M=ge.viewport_default&&Number(ge.viewport_default.h);if(Ne===Ae&&(ft!==de||M!==le)){let z=he<1?M/le:ft/de,U=Ne/z;fe!==U&&ge.set({scale:U})}}}we instanceof ho.picture&&we.onSingleColumnLayout({width:ge.get("w"),height:ge.get("h")}),we instanceof ho.text&&(we.fitContentToBox(),N=D.default.extend(N,{left:ge.get("x"),top:ge.get("y"),width:ge.get("w"),height:ge.get("h"),angle:ge.get("angle")||0,flip_v:!!ge.get("flip_v"),flip_h:!!ge.get("flip_h"),sinAngle:Math.sin(-(ge.get("angle")||0)*Math.PI/180),cosAngle:Math.cos(-(ge.get("angle")||0)*Math.PI/180)}),N=D.default.extend(N,gt.calcBoundingBox(N))),F=Math.ceil(J(A,F,N.bb_height)),N.angle?ge.set({y:F-(N.bb_top-N.top)}):ge.set({y:F});let pe=we.getSaveBoxData();ge.set(pe),F+=N.bb_height+(ue<V.length-1?l:0)}),this.page.set({used_autolayout:!0});let se=!1;if(!C){let ee=[];V.forEach(ue=>{if(ue.pack_id){let ke=ue.w.map(ge=>ge.block);ee=ee.concat(ke)}else ee.push(ue.block)}),se=this.eliminateBlockIntersections(ee,l),se||(se=this.collapseEmptySpace(ee,l))}this.redrawPacksFrames(),this.storeAutolayoutBlocks(V,{updateHeight:C||se,considerStickedBottom:!C,updateStickyBottomMargin:!0,previousBoundingBox:Z,bottomMargin:s,patch:!1}),h&&this.toggleBundleBlocks(!0)});E(this,"restoreDesktopLayout",(t=[],{resetAllKeys:r=!1,includeHidden:i=!1,includeFixed:s=!1,includeGlobal:a=!1,includeAboveAll:l=!1,includeAtomic:m=!1}={})=>{let p=D.default.isEqual(t.map(x=>x.id).sort(),this.blocks.map(x=>x.id).sort()),u=this.filterAutolayoutBlocks(t,{includeHidden:i,includeGlobal:a,includeFixed:s,includeAboveAll:l,includeAtomic:m}),d=gt.getBoundingBoxOfBlocks(u),g=!!this.spacesController,h=!1;if(this.toggleBundleBlocks(!1),this.restoreDesktopComposition(u,{resetAllKeys:r}),!p){let x=gt.getBoundingBoxOfBlocks(u),{top:y,left:S}=xt.absoluteToRelative(d,x),k=xt.center(x,this.getWorkspaceBox()),{left:P}=xt.absoluteToRelative(k,d);u.forEach(C=>{C.model.set({x:C.model.get("x")+S+P,y:C.model.get("y")+y})})}p||(h=this.eliminateBlockIntersections(u,20),this.redrawPacksFrames(),h||(h=this.collapseEmptySpace(u,20)));let b=u.map(x=>({block:x,model:x.model}));this.storeAutolayoutBlocks(b,{updateHeight:p||h,dontUseViewportMinimal:!0,patch:!1}),g&&this.toggleBundleBlocks(!0)});E(this,"desktopLayoutFitMobile",(t=[],{resetAllKeys:r=!1,includeHidden:i=!1,includeGlobal:s=!1,includeFixed:a=!1,includeAboveAll:l=!1,includeAtomic:m=!1}={})=>{let u=this.viewport,d=Jo.getViewportSetting("width",u),g=this.mag.getViewportWidth(u),h=g-2*20,b=(d-g)/2+20,x=D.default.isEqual(t.map(F=>F.id).sort(),this.blocks.map(F=>F.id).sort()),y=this.filterAutolayoutBlocks(t,{includeHidden:i,includeGlobal:s,includeFixed:a,includeAboveAll:l,includeAtomic:m}),S=this.getWorkspaceBox().top,k=gt.getBoundingBoxOfBlocks(y),P=Math.max(S>0?-S:0,x?20:k.top),C={considerStickedBottom:!0,updateHeight:!1,restoreFullHeight:!1},B=this.mag.getViewportWidth("default"),$=!!this.spacesController;this.toggleBundleBlocks(!1),this.restoreDesktopComposition(y,{resetAllKeys:r});let A=y.map(F=>({block:F,model:F.model})),R=A.map(F=>F.block);if(x&&R.length===1){let F=gt.getBoundingBoxOfBlocks(R);if(F.width>h){this.scaleBlocksGroup(R,{width:h,top:F.top,left:b});let V={...R[0].getSaveBoxData({resizeContent:!0})};R[0].model.set(V)}else R[0].model.set("x",20);this.storeAutolayoutBlocks(A,{updateHeight:!1,patch:!1});return}this.scaleBlocksGroup(R.filter(F=>!F.model.get("fixed_position")),{width:h,top:P,left:b}),R.filter(F=>F.model.get("fixed_position")).forEach(F=>{let V=g/B,W={width:F.model.viewport_default.w*V,top:F.model.viewport_default.y*V,left:F.model.viewport_default.x*V};this.scaleBlocksGroup([F],W)}),A.forEach(F=>{let V={...F.block.getSaveBoxData({resizeContent:!0})};F.model.viewport_default?.is_full_width&&(V.w=g,V.x=0,F.model.get("is_full_width")&&(V.is_full_width=!1)),F.model.viewport_default?.is_full_height&&(C.restoreFullHeight=!0,F.model.get("is_full_height")&&(V.is_full_height=!1));let W=F.model.viewport_default?.sticked;W&&["top","right","left"].includes(W)&&(V.sticked=void 0),F.model.set(V)});let Z=!1;x||(Z=this.eliminateBlockIntersections(R,20),this.redrawPacksFrames(),Z||(Z=this.collapseEmptySpace(R,20))),C.updateHeight=x||Z,this.storeAutolayoutBlocks(A,{...C,patch:!1}),$&&this.toggleBundleBlocks(!0)});E(this,"storeAutolayoutBlocks",(t,r={updateHeight:!0,considerStickedBottom:!1,updateStickyBottomMargin:!1,patch:!0})=>{let i=this.blocks.filter(d=>d.model.get("sticked")==="bottom"),s=i.filter(d=>{let g=d.model;return!r.previousBoundingBox||g.get("y")>r.previousBoundingBox.top+r.previousBoundingBox.height}),a=D.default.reduce(s,(d,g)=>{let h=g.model;return Math.max(d,h.get("h")+h.get("sticked_margin"))},0),l=D.default.reduce(this.blocks,(d,g)=>{let h=g.model;if(!h.get("fixed_position")&&h.get("type")!=="background"&&(!r.considerStickedBottom||!h.get("sticked"))){let b=g.getBoxData({includeBoundingBox:!0});return Math.max(d,b.bb_y+b.bb_h)}else return d},0),m=Jo.getViewportSetting("min_height",this.viewport),c=Math.max(l+(r.bottomMargin??86)+(r.considerStickedBottom?a:0),m),p=r.updateHeight?c-this.page.getViewportParam(this.viewport,"height"):0,u=[];this.blocks.forEach(d=>{u.push(d.model),r.restoreFullHeight&&d.model.viewport_default?.is_full_height&&(d.model.set("y",0),d.model.set("h",c||this.page.get(`viewport_${this.viewport}`).height))}),r.updateStickyBottomMargin&&i.filter(d=>{let g=d.model.get("sticked_margin");d.model.set("sticked_margin",g+p)}),this.save_group(u,{...D.default.pick(r,"dontUseViewportMinimal"),byStoreAutolayoutBlocks:!0,patch:r.patch??!0}),t.forEach(d=>{let g=d.block;g instanceof ho.picture&&g.setScaledImage(null,{skipHistory:!0,isGroupResize:!0}),g instanceof ho.text&&g.refreshState&&g.refreshState(g.model)}),(r.updateHeight&&c||c>this.page.getViewportParam(this.viewport,"height"))&&(this.page.setViewportParam(this.viewport,"height",Math.ceil(c)),this.page.setViewportParam(this.viewport,"type","scroll"),this.page.saveHeight()),r.updateStickyBottomMargin&&i.forEach(d=>d.recalcStickedLine()),this.trigger("autoLayout")});E(this,"destroyAllBlocks",()=>{this.blocks.forEach(t=>{t.destroy()})});E(this,"destroy",()=>{this.el.removeEventListener("drop",this.onFileDrop),this.stopListening(this.page),this.stopListening(this.mag),this.stopListeningToGuides(),ye.off("zoom"),ye.off("global_appear:widget"),ye.off("global_disappear:widget"),this.off("widget:context:change",this.onWidgetsContextChange),this.mag.edit_params.off("change:blocks",this.toggleBlocksEditParams),this.mag.edit_params.off("change:guides",this.onGuidesChange),this.pagesize&&this.pagesize.$destroy&&this.pagesize.$destroy(),this.$el.off("mouseenter",".block",this.onBlockMouseEnter),this.$el.off("mouseleave",".block",this.onBlockMouseLeave),this.workspaceContainer.removeEventListener("mousemove",this.onMouseMove),this.workspaceContainer.removeEventListener("mouseleave",this.onMouseLeave),this.$window.off("resize",this.onResize),this.$container.off("click",this.onclick),this.commentsRoot.unmount(),this.unsubscribeCommentMode?.(),this.destroyAllBlocks(),this.$el.remove()});this.$container=t.$container,this.mag=t.mag,this.setElement((0,rt.default)(t.template()).hide().appendTo(this.$container)),this.syncManager=t.syncManager,this.eCommerceManager=t.eCommerceManager,this.$container.on("click",this.onclick),this.$window=(0,rt.default)(window),this.$window.on("resize",this.onResize),this.$origin=this.$(".origin"),this.$scroller=t.$container,this.$frame=this.$(".selectframe").hide(),this.$border=this.$(".workspace-border"),this.page=this.mag.getPage(t.page_id),this.page.workspace=this,this.page.on("widget:create",this.createBlock),this.page.on("widget:remove",this.removeBlock),this.page.on("toggleWidgets",this.toggleWidgets),this.page.widgets.chain().reject(function(r){return r.isGlobal()}).map(r=>this.addBlock(r)),this.onResize(),this.page.on("change",this.updateWorkspaceViewport),this.updateWorkspaceViewport(),this.page.on("change:viewport",this.onChangeViewport),this.listenTo(this.page,"widgets:remove",this.onWidgetsRemove),this.on("widget:context:change",this.onWidgetsContextChange),this.on("redraw",D.default.debounce((r={})=>{window.RM.constructorRouter.trigger("redrawPage",r.is_global?this.page.id:t.page_id)},500)),this.on("select",this.onSelect),this.on("deselect",this.onDeselect),this.saveGroupDebounced=D.default.debounce(this.save_group,500),this.cloneBlocksDebounced=D.default.debounce(this.cloneBlocks,500),this.restoreFocusForCopyPasteDebounced=D.default.debounce(this.restoreFocusForCopyPaste,0),this.triggerSelectOnSelectedBlockDebounced=D.default.debounce(this.triggerSelectOnSelectedBlock,50),this.viewportScrolls={},this.bindUploader(),this.loader=(0,rt.default)(".rm-loader").eq(0),this.locked=!1,this.on("specialKeydown specialKeyup",this.onSpecialKey),this.on("selectAll",this.selectAllBlocks),ye.on("global_appear:widget",this.onGlobalAppear),ye.on("global_disappear:widget",this.onGlobalDisappear),ye.on("zoom",(r,i)=>this.$border.toggleClass("fullscreen",i&&this.page.get("height")*r>=window.innerHeight)),this.listenTo(this.page,"change:height",(r,i)=>{this.$border.toggleClass("fullscreen",window.RM.constructorRouter.zoom.isFullScreenOrMore()&&i*window.RM.constructorRouter.zoom.getZoom()>=window.innerHeight)}),this.$el.on("mouseenter",".block",this.onBlockMouseEnter),this.$el.on("mouseleave",".block",this.onBlockMouseLeave),this.toggleBlocksEditParams(),this.mag.edit_params.on("change:blocks",this.toggleBlocksEditParams),this.mag.edit_params.on("change:guides",this.onGuidesChange),this.mag.on("change:desktopWidth",this.updateWorkspaceViewport),this.mag.on("change:phoneWidth",this.updateWorkspaceViewport),this.distance=new kn(this),this.workspaceContainer=this.$el.get(0),this.unsubscribeCommentMode=Ld(this.onChangeCommentMode.bind(this)),this.commentsRoot=H0(this.$el.get(0).querySelector("#comments"),{workspace:this,router:window.RM.constructorRouter})}get viewport(){return this.page.getCurrentViewport()}onChangeCommentMode(t){this.visible&&(t?this._enableCommentMode():this._disableCommentMode()),this.isActiveCommentMode=t}getClientSize(){return{width:this.$container[0].clientWidth,height:this.$container[0].clientHeight}}getWorkspaceSize(){let t=this.mag.getViewportWidth(this.viewport),r=this.page.getViewportParam(this.viewport,"height");return{width:t,height:r}}setTempPicture(t,r){let i=t&&t.length&&t[0];i&&Kl(i).then(({content:s,width:a,height:l,ext:m})=>{t[0].uploading&&r.setTempPicture({content:s,width:a,height:l,ext:m},{withoutResize:!0})}).catch(()=>{})}createNestedBlocks(t,r,i){if(i=i||D.default.noop,!t.child_workspace)return i();let s=function(a){let l=r[a];if(!l)return i();t.child_workspace?.add_widget(l,{copy:!0,success:function(){s(a+1)},error:function(){s(a+1)}})};s(0)}deleteCommentsFromBlock(t){Mw(t)}filterAutolayoutBlocks(t,r={includeHidden:!1,includeFixed:!1,includeGlobal:!1,includeAboveAll:!1,includeAtomic:!1}){let i=this.mag.get("packs").reduce((s,a)=>(s[a.pack_id]=a,s),{});if(r.includeAboveAll&&(!r.includeFixed||!r.includeGlobal))throw"If you include above page widgets in the autolayout, please include fixed and global widgets as well.";return t.filter(s=>{let a=s.model,l=a.get("pack_id");return!(s instanceof ho.background)&&(r.includeHidden||!a.get("hidden"))&&(r.includeAtomic||!i[l]?.atomic)&&(r.includeGlobal||!a.get("is_global"))&&(r.includeFixed||!a.get("fixed_position"))&&(r.includeAboveAll||!a.get("is_above"))})}collectBlocks(t=[],r={fitText:!1,preserveGroups:!1}){let i=t.map(function(s){return r.fitText&&s instanceof ho.text&&s.fitContentToBox(),{block:s,model:s.model,box:s.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0})}});if(r.preserveGroups){let s={};i=i.reduce((a,l)=>{let m=l.model.get("pack_id");return m?(s[m]||(s[m]={pack_id:m,y:l.box.bb_y,x:l.box.bb_x,w:[],fixed:!!l.model.get("fixed_position")},a.push(s[m])),s[m].y=Math.min(s[m].y,l.box.bb_y),s[m].x=Math.min(s[m].x,l.box.bb_x),s[m].w.push(l)):a.push(l),a},[]),i=D.default.sortBy(i,a=>a.model&&a.model.get("fixed_position")?a.box.bb_y*1e6+a.box.bb_x:a.pack_id&&a.fixed?a.y*1e6+a.x:(a.pack_id?a.y:a.box.bb_y)*1e12+(a.pack_id?a.x:a.box.bb_x)),i=i.reduce((a,l)=>!r.preserveGroups&&l.pack_id?[...a,...D.default.sortBy(l.w,m=>m.box.bb_y*1e6+m.box.bb_x)]:(a.push(l),a),[])}else i=D.default.sortBy(i,({box:s,model:a})=>a.get("fixed_position")?s.bb_y*1e6+s.bb_x:s.bb_y*1e12+s.bb_x);return i}scaleBlocksGroup(t,r,{downsizeOnly:i=!1,widgetPackId:s=cn()}={}){let a=new sa({id:s,workspace:this});t.forEach(p=>{a.addBlock(p)}),a.render();let l=a.getModelBox(),m,c=l.width===r.width?1:i?Math.min(r.width/l.width,1):r.width/l.width;if(l.width!==r.width||l.top!==r.top||l.left!==r.left){let p={...l,left:r.left,top:r.top,width:Math.round(l.width*c),height:Math.round(l.height*c)};m=a.frame.doResize(p,!1,"se",!1),a.destroy()}return m}findBlockByFunction(t){return this.blocks.find(t)}getCachedSizes(){return this.cachedSizes||(this.cachedSizes={width:this.$container.width()||0,height:this.$container.height()||0,clientWidth:this.$container[0].clientWidth,elHeight:this.$el.height()||0,elWidth:this.$el.width()||0,windowClientWidth:document.documentElement.clientWidth,windowClientHeight:document.documentElement.clientHeight}),this.cachedSizes}};(0,rt.default)(function(){let e;(0,rt.default)("#main").drag("start",function(...o){return e=window.RM.constructorRouter.workspace,!e||e.locked?!1:e.onDragStart(...o)}).drag(function(...o){return e.onDrag(...o)}).drag("end",function(...o){return e.onDragEnd(o[0])}),(0,rt.default)(window).on("contextmenu",function(o){(0,rt.default)(o.target).hasClass("dot")&&(o.stopPropagation(),o.preventDefault())})});var N0=rm;var Qr=T(St()),V0=T(mo()),Sn=T(et());Fr();var F0={"template-constructor-helpers-code-editor-container":Ct`
	<div class="code-editor-container">
		
		<% if (modal) { %>
		<div class="code-editor-modal-overlay"></div>
		<% } %>

		<div class="code-editor-block"  style="height:<%= height %>px;">
			<div class="code-editor-wrapper">

			</div>
			<div class="resize-handle"></div>			
		</div>
	</div>
`};Vo();var ys=T(St()),U0=T(mo()),pr=T(et());tt();Fr();var W0={"template-constructor-helpers-code-editor":Ct`
	<div class="rm-code-editor">
		<div class="code-editor-upgrade-alert">
			<% if (is_subscription_paused) { %>
			<div class="alert-message">Please <a class="link upgrade-link" target="_blank" rel="noopener noreferrer" href="/settings#change-plan">unpause</a> your subscription to make custom code work after publishing. <a class="link" rel="noopener noreferrer" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" target="_blank">Learn more</a>.</div>
			<% } else if (!is_contributor) { %>
			<div class="alert-message">Please <a class="link upgrade-link" target="_blank" rel="noopener noreferrer" href="/settings#change-plan">upgrade</a> your account to make custom code work after publishing. <a class="link" rel="noopener noreferrer" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" target="_blank">Learn more</a>.</div>
			<% } else { %>
			<div class="alert-message">Please upgrade owner’s account to make custom code work after you publish the project. <a class="link" href="http://help.readymag.com/hc/en-us/articles/360020527012-Embed-Code" rel="noopener noreferrer" target="_blank">See exceptions</a>. <a href="mailto:<%= owner_email %>">Contact owner</a>.</div>
			<% } %>
			<div class="alert-close">Close</div>
		</div>

		<div class="rm-code-editor-toolbar">
			<table class="toolbar-table">
				<tr>
					<td class="item widget-code">
 						<div class="tb-button pane-button" data-type="widget"><span class="tb-bullet"></span><span class="tb-title">Widget Code</span></div>
 					</td>
 					<td class="item project-code">
 						<div class="tb-caption">Project Code:</div>
 						<div class="tb-button pane-button" data-type="head"><span class="tb-bullet"></span><span class="tb-title">&lt;HEAD&gt;</span></div>
 						<div class="tb-button pane-button" data-type="body_top"><span class="tb-bullet"></span><span class="tb-title">After &lt;BODY&gt;</span></div>
 						<div class="tb-button pane-button" data-type="body_bottom"><span class="tb-bullet"></span><span class="tb-title">Before &lt;/BODY&gt;</span></div>
 						<div class="tb-button pane-button" data-type="css"><span class="tb-bullet"></span><span class="tb-title">CSS</span></div>
					</td>
					<% if (showUpdateButton) { %>
						<td class="item update"><div class="tb-button update"><span class="tb-title">Apply (<%= Modernizr.mac ? '\u2318' : 'Ctrl' %>+U)</span></div></td>
					<% } %>
					<td class="item save"><div class="tb-button save"><span class="tb-close">Save & Close</span></div></td>
				</tr>
			</table>
		</div>
		<div class="rm-code-editor-panes">
			<div class="code-pane" data-type="widget">
				<div class="code-editor-area"></div>
				<div class="options-area">
					<table class="options-table">
						<tr>
							<td class="option links">
								<a class="code-editor-learn-link" href="https://help.readymag.com/hc/en-us/articles/360020844171-Adding-custom-code" rel="noopener noreferrer" target="_blank">Learn about custom code</a>
								<a class="code-editor-integrations-link" href="https://readymag.com/integrations" rel="noopener noreferrer" target="_blank">Find out integrations</a>
							</td>
							<td class="option clear"><div class="option-title">Clear widget contents when switching to another page</div><div class="switcher clear rmswitcher"></div>
							</td>
							<td class="option use-iframe"><div class="option-title">Use iFrame</div><div class="switcher use-iframe rmswitcher"></div>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class="code-pane" data-type="head"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="body_top"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="body_bottom"><div class="code-editor-area"></div></div>
			<div class="code-pane" data-type="css"><div class="code-editor-area"></div></div>

			<div class="editor-preloader rmpreloader">
				<div class="arc"></div>
			</div>
		</div>
	</div>
`};var LS=U0.default.View.extend({template:W0["template-constructor-helpers-code-editor"],EDITOR_CONFIG:{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",theme:"readymag",keyMap:"sublime",scrollbarStyle:"overlay",viewportMargin:50},events:{"click .tb-button.pane-selector .tb-title":"onPaneSelectorButtonClick","click .tb-button.update:not(.disabled)":"onUpdateButtonClick","click .tb-button.save":"onSaveButtonClick","click .pane-button:not(.selected)":"onPaneButtonClick","click .alert-close":"onCloseAlertClick","click .code-editor-learn-link":"onClickLearnLink","click .code-editor-integrations-link":"onClickIntegrationsLink"},initialize:function(e){pr.default.bindAll(this),this.codes=e.codes||[],this.defaultCode=e.defaultCode||"head",this.updateDelegate=e.updateDelegate,this.is_contributor=e.is_contributor,this.owner_email=e.owner_email,this.is_subscription_paused=e.is_subscription_paused,this.$container=e.$container,this.parent=e.parent,this.editors={},this.showUpgradeAlert=e.showUpgradeAlert,this.tabsNames={widget:"widget",head:"head",body_top:"body_top",body_bottom:"body_bottom",css:"css"},this.activePane=this.tabsNames.widget,this.refreshEditors_debounced=pr.default.debounce(this.refreshEditors,100),this.onCodeChange_throttled=pr.default.throttle(this.onCodeChange,400)},render:function(){this.setElement((0,ys.default)(this.template({is_contributor:this.is_contributor,owner_email:this.owner_email,showUpdateButton:this.activePane===this.tabsNames.widget,is_subscription_paused:this.is_subscription_paused}))),this.showUpgradeAlert||this.$(".code-editor-upgrade-alert").remove(),this.$container.html(this.$el),this.setElement(this.$el),!!pr.default.findWhere(this.codes,{type:"widget"})||(this.$(".rm-code-editor-toolbar .item.widget-code").remove(),this.$(".rm-code-editor-toolbar .item.update").remove(),this.$('.code-pane[data-type="widget"]').remove()),this.$paneSelectorPopup=this.$(".pane-selector-popup"),this.$codePanes=this.$(".code-pane"),this.initCodePanes(),this.parent&&this.listenTo(this.parent,"resize",this.refreshEditors_debounced)},initCodePanes:function(){import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-73Y4BWEE.js").then(({default:e})=>{pr.default.each(this.$codePanes,function(o){let t=(0,ys.default)(o),r=t.attr("data-type"),i=pr.default.findWhere(this.codes,{type:r}),s,a;r==="css"?(s=pr.default.clone(this.EDITOR_CONFIG),s.mode="css"):s=this.EDITOR_CONFIG,s.placeholder=HS[r],a=e(t.find(".code-editor-area")[0],s),this.editors[r]=a,a.rm_editor_type=r;let l=Modernizr.mac?"Cmd-U":"Ctrl-U",m=Modernizr.mac?"Cmd-S":"Ctrl-S",c={};c[l]=this.onUpdateButtonClick,c[m]=this.onUpdateButtonClick,c.Esc=this.onSaveButtonClick,a.setOption("extraKeys",c);let p=i&&i.code||"";a.setValue(p);let u=i.positions||{};u.cursor&&a.setCursor(u.cursor),u.scroll&&a.scrollTo(null,u.scroll),this.onCodeChange(a),a.on("change",this.onCodeChange_throttled),a.on("focus",this.onEditorFocusChange),a.on("blur",this.onEditorFocusChange),r===this.tabsNames.widget&&(this.iframeSwitcher=(0,ys.default)(this.$(".switcher.use-iframe")).RMSwitcher({state:i.options.use_iframe,height:32,"color-0":"#0078ff","color-1":"#c9c8c9"},function(d){this.updateOption("use-iframe",d)}.bind(this)).data("switcher"),this.updateOption("use-iframe",i.options.use_iframe),this.clearSwitcher=(0,ys.default)(this.$(".switcher.clear")).RMSwitcher({state:i.options.clear_content,height:32,"color-0":"#0078ff","color-1":"#c9c8c9"},function(d){this.updateOption("clear",d)}.bind(this)).data("switcher"),this.updateOption("clear",i.options.clear_content))}.bind(this)),this.switchToPane(this.defaultCode),this.hidePreloader()})},updateOption:function(e,o){this.$(".option."+e).toggleClass("active",!!o)},getCodePane:function(e){return this.$('.code-pane[data-type="'+e+'"]')},hidePreloader:function(){this.$(".editor-preloader").remove()},onPaneButtonClick:function(e){let o=(0,ys.default)(e.currentTarget),t=o.attr("data-type");this.switchToPane(t),this.checkUpdateButtonVisibility(t)},switchToPane:function(e){let o=this.getCodePane(e);this.$(".code-pane").removeClass("active"),o.addClass("active"),this.$(".pane-button").removeClass("selected"),this.$('.section-item[data-type="'+e+'"]').addClass("selected"),this.$('.pane-button[data-type="'+e+'"]').addClass("selected"),this.activePane=e},checkUpdateButtonVisibility:function(e){let o=this.$(".item.update");e===this.tabsNames.widget?o.show():o.hide()},getAllCodes:function(){let e={};return pr.default.each(this.editors,function(o,t){let r={code:o.getValue().trim(),cursor:o.getCursor(),scroll:o.getScrollInfo().top};t==="widget"&&(r.options={clear_content:this.clearSwitcher.settings.state,use_iframe:this.iframeSwitcher.settings.state}),e[t]=r}.bind(this)),e},onUpdateButtonClick:function(){let e=this.$(".tb-button.update"),o=this.getAllCodes();e.hasClass("disabled")||(pr.default.isFunction(this.updateDelegate)?(e.addClass("disabled"),this.updateDelegate(o,function(){e.removeClass("disabled")})):this.trigger("update",o))},onSaveButtonClick:function(){this.trigger("save",this.getAllCodes())},refreshEditors:function(){pr.default.each(this.editors,function(e){e.refresh()})},onCloseAlertClick:function(){this.$(".code-editor-upgrade-alert").remove(),this.trigger("alert-close"),this.refreshEditors()},onCodeChange:function(e){let o=e.getValue().trim(),t=e.rm_editor_type,r=!!o;this.$('.pane-button[data-type="'+t+'"]').toggleClass("has-code",r)},onEditorFocusChange:function(e){let o=e.hasFocus(),t=e.state.placeholder;t&&(t.style.display=o?"none":"")},onClickLearnLink:function(){ae(ce.WidgetMisc,{action:"learn about adding custom code",widgetType:"code"})},onClickIntegrationsLink:function(){ae(ce.WidgetMisc,{action:"learn about intergrations",widgetType:"code"})}}),HS={widget:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,head:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,body_top:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,body_bottom:`<!-- 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
-->`,css:`/* 
Please note that custom code added to the
project is beyond of the scope of Readymag
support. Bend matter carefully.

 \\      oo
  \\____|\\mm
  //_//\\ \\_\\
 /K-9/  \\/_/
/___/_____\\
-----------
*/`},G0=LS;rd();var OS=V0.default.View.extend({template:F0["template-constructor-helpers-code-editor-container"],events:{"click .code-editor-modal-overlay":"onOverlayClick"},MIN_HEIGHT:47,INITIAL_HEIGHT_PERCENT:40,MAX_HEIGHT_PERCENT:80,initialize:function(e){Sn.default.bindAll(this),this.widgetModel=e.model,this.router=e.router,this.mag=e.mag},render:function(){let e=this.getSavedHeight(),o=(0,Qr.default)(window).height(),t,r=RM.common.codeEditorPositions||{};e?t=Math.min(e,Math.round(o*this.MAX_HEIGHT_PERCENT/100)):t=Math.max(Math.round((0,Qr.default)(window).height()*this.INITIAL_HEIGHT_PERCENT/100),this.MIN_HEIGHT),this.setElement((0,Qr.default)(this.template({height:t,modal:!this.widgetModel}))),this.$el.insertAfter("#constructor"),this.setElement(this.$el),this.$editorBlock=this.$(".code-editor-block"),this.$overlay=this.$(".code-editor-modal-overlay"),(0,Qr.default)(this.$(".resize-handle")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0});let i=!this.router.codeInjectionAlertAlreadyShown&&!this.router.me.get("permissions").can_inject_code,s=[{type:"head",code:this.mag.get("ci_head")||"",positions:r.head},{type:"body_top",code:this.mag.get("ci_body_top")||"",positions:r.body_top},{type:"body_bottom",code:this.mag.get("ci_body_bottom")||"",positions:r.body_bottom},{type:"css",code:this.mag.get("ci_css")||"",positions:r.css}];this.widgetModel&&s.push({type:"widget",code:this.widgetModel.get("code")||"",options:{use_iframe:this.widgetModel.get("use_iframe"),clear_content:this.widgetModel.get("clear_content")},positions:r[this.widgetModel.get("_id")]}),this.codeEditor=new G0({$container:this.$(".code-editor-wrapper"),parent:this,codes:s,defaultCode:this.widgetModel?"widget":"head",updateDelegate:function(a,l){this.widgetModel.save({code:a.widget.code,options:a.widget.options},{success:l,error:function(){l()}}),Sn.default.delay(function(){l()},5e3)}.bind(this),showUpgradeAlert:i,is_contributor:!this.router.isOwner,owner_email:this.router.mag.get("user").email,is_subscription_paused:Ye.isSubscriptionPaused()}),this.listenTo(this.codeEditor,"save",function(){this.router.closeCodeEditor()}),this.listenToOnce(this.codeEditor,"alert-close",function(){this.router.codeInjectionAlertAlreadyShown=!0}.bind(this)),this.codeEditor.render()},saveCodes:function(){let e=this.codeEditor.getAllCodes(),o=e.widget||{},t=this.widgetModel,r={},i;if(i=RM.common.codeEditorPositions||{},RM.common.codeEditorPositions=i,Sn.default.each(e,function(s,a){a!=="widget"&&(r["ci_"+a]=s.code,i[a]={cursor:s.cursor,scroll:s.scroll})}.bind(this)),t){let s={code:o.code};Sn.default.extend(s,o.options),t.set(s),t.hasChanged()&&this.widgetModel.save(s),i[t.get("_id")]={cursor:o.cursor,scroll:o.scroll}}this.mag.set(r),this.mag.hasChanged()&&this.mag.save(r,{patch:!0})},startHandleDrag:function(e){let o=(0,Qr.default)(e.currentTarget);this.resizeParams={$handle:o,initial_h:this.$editorBlock.height()}},moveHandleDrag:function(e){let o=this.resizeParams.initial_h-e.deltaY;this.updateHeight(o)},endHandleDrag:function(){this.changedHeight=this.height},updateHeight:function(o){var o=o||this.$editorBlock.height(),t=Math.max(Math.round((0,Qr.default)(window).height()*this.MAX_HEIGHT_PERCENT/100),this.MIN_HEIGHT);o>t&&(o=t),o<this.MIN_HEIGHT&&(o=this.MIN_HEIGHT),this.height=o,this.$editorBlock.height(o),this.trigger("resize")},show:function(){this.render(),Sn.default.delay(function(){this.$el.addClass("visible")}.bind(this),20),(0,Qr.default)(window).on("resize",this.onWindowResize),this.shown=!0},hide:function(){this.$el.removeClass("visible"),setTimeout(Sn.default.bind(function(){this.remove()},this),200),(0,Qr.default)(window).off("resize",this.onWindowResize),this.changedHeight&&this.saveHeight(),pn(),this.shown=!1},saveHeight:function(){window.localStorage&&window.localStorage.setItem("RMCodeEditorHeight",this.height)},getSavedHeight:function(){return window.localStorage&&window.localStorage.getItem("RMCodeEditorHeight")},onWindowResize:function(){this.updateHeight()},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")},onOverlayClick:function(){this.router.closeCodeEditor()}}),j0=OS;var cr=T(St());sl();zl();id();ot();yo();Uf();Vo();var dr=T(et()),_s=T(mo());pt();na();wo();var NS=_s.default.Router.prototype;eg();var Y0=Ho.extend({setupEcommerceSidebar:async function(){if(this.eCommerceManager.getConnectedProvider()==="ecwid"){let{default:e}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-3WELJVF6.js");this.cartSidebar=new e(this)}else{let{default:e}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-474IC4RC.js");this.cartSidebar=new e(this)}},getContainerSize(){if(["phone_portrait","tablet_portrait"].includes(this.viewport)){let{width:e,height:o}=Ao.fitToDevice(this.viewport==="tablet_portrait"?this.getViewportWidth(this.viewport)*.75:this.getViewportWidth(this.viewport),this.viewport,os());return this.containerSize={width:e,height:Math.min(o,this.$el.height())},this.containerSize}else return Ho.prototype.getContainerSize.call(this)},switchToViewport(e,o){Ho.prototype.switchToViewport.call(this,e),ia[os()]!==e&&Il(o||ra[e]),this.currentPage&&!this.aboveGlobalWidgetsRendered&&this.viewOpts.viewertype==="horizontal"&&this.renderAboveGlobalWidgets(this.currentPage),this.setViewerOptions(e),this.setViewerClasses(),this.onResize(),this.loadPages()}}),FS=_s.default.Router.extend({routes:{},prefix:"edit/",isPreview:!0,deviceSwitch:void 0,initialize:function(e){if(e.constructorViewport=window.sessionStorage.getItem("constructorViewport")||"default",dr.default.bindAll(this),this.environment=oe.environment.viewer,this.started=!1,window.RM.data.usersLoader.me&&(this.me=window.RM.data.usersLoader.me),this.$mags_container=(0,cr.default)("#mags"),this.magsData=window.ServerData&&window.ServerData.mags,xa.init(window.ServerData&&window.ServerData.userPermissions),this.internalHistory=[],this.magsData){if(this.cachedMag=dr.default.clone(this.magsData.mag),!this.cachedMag||!this.cachedMag.user||!this.cachedMag.user._id)return;this.cachedMag.user.isMe=this.me&&this.me.get("_id")==this.cachedMag.user._id}import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FPMR7KM2.js").then(({default:o})=>{RM.analytics=RM.analytics||new o({router:this}),this.analytics=RM.analytics;let t=window.RM?.common?.isDomainViewer===!0;oe.isProd&&!t&&import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-7QN67JWB.js").then(({getWebVitals:r})=>{r()})}),this.environment=oe.environment.preview,e.title=e.title||"Project Title",this.$constructor=e.$constructor,this.mag=new Y0(e,this),this.cachedMag=this.mag,this.listenTo(this.mag,"menuShown",this.onViewerMenuShow),this.listenTo(this.mag,"menuHidden",this.onViewerMenuHide),this.listenTo(this.mag,"change:viewport",this.onChangeViewport,this),(0,cr.default)("body").on("keydown",this.onKeyDown),this.mag.user&&(this.mag.user._id,RM.constructorRouter.me.get("_id")),ye.on("change:device",this.onChangeDevice,this)},navigate:function(e,o){let t=e.indexOf("/"+this.prefix)!==0?this.prefix+e:e;NS.navigate.call(this,t,o)},setTitle:function(){window.document.title=this.mag.title+" (Preview)"},onViewerMenuShow:function(){this.mag.viewOpts.viewertype==="vertical"&&this.$constructor&&this.$constructor.addClass("shift-toolbar-on-viewer-menu-open")},onViewerMenuHide:function(){this.mag.viewOpts.viewertype==="vertical"&&this.$constructor&&this.$constructor.removeClass("shift-toolbar-on-viewer-menu-open")},onKeyDown:function(e){if(e.ctrlKey||e.metaKey)return!0;e.target.tagName.toLowerCase()==="input"||e.target.tagName.toLowerCase()==="textarea"||e.keyCode===cr.default.keycodes.esc&&(RM.constructorRouter.togglePreview(),(0,cr.default)("body").off("keydown",this.onKeyDown))},destroy:function(){this.onViewerMenuHide(),(0,cr.default)("body").off("keydown",this.onKeyDown),this.deviceSwitch&&(gh(this.deviceSwitch),this.deviceSwitch?.parentNode?.removeChild(this.deviceSwitch)),ye.off("change:device",this.onChangeDevice,this),this.mag&&this.mag.destroy()},go:function(e,o){if(e=e||1,o.isPageNum)this.mag.showPage(e,o);else{let t=this.mag.getPageByPath(e)||{};this.mag.showPage(t.num||e,o)}if(this.scrollTop&&(this.mag.setScrollPosition({offset:this.scrollTop,animate:!1}),delete this.scrollTop),!this.deviceSwitch){this.deviceSwitch=document.createElement("div"),document.body.appendChild(this.deviceSwitch);let t=ra[window.sessionStorage.getItem("constructorViewport")]||"Desktop";uh(this.deviceSwitch,{defaultDevice:t,router:this,project:RM.constructorRouter.previewMag})}},getMagUri:function(e){return"edit/"+e.num_id+"/preview/"},setScroll:function(e){this.scrollTop=e},getScroll:function(){return this.mag.getScrollPosition()},onChangeViewport:function(e){window.sessionStorage.setItem("constructorViewport",e.viewport||"default")},onChangeDevice(e){if(!this.mag.active)return;let o=ia[e];o!==this.mag.viewport?this.mag.switchToViewport(o,e):this.mag.onResize()},startByPageNum:function(e,o,t){this.start(e,o,null,t)},getPageUrlFromCodeExportLink:function(e){if(!e)return e;if(window.RM.config?.root){let o=window.RM.config.root;return o[0]==="/"&&(o=o.substr(1)),e.replace(o,"")}return e},start:function(e,o,t,r){if(isNaN(parseInt(r))&&(r=void 0),!r){if(parseInt(e,10)==e||/^p\d+\/?$/i.test(e)){let s=o;o=e,t=s,e=null}if(!o)return this.notFound()}this.latestFragment=_s.default.history.getFragment(),t=t||1,r&&(t=r);let i=e+"_"+o;if(this.username=e,!(this.started==i&&this.loaded!=i)){if(this.started=i,this.loaded==this.started){this.go(t,{animation:!1,isPageNum:!!r});return}if(this.cachedMag&&!dr.default.isEmpty(this.cachedMag)){!(this.cachedMag instanceof Ho)&&!this.cachedMag.forbidden&&!this.cachedMag.is_suspended&&(this.cachedMag=new Ho(this.cachedMag,this)),this.mag=this.cachedMag,this.onPreloadMag(t,!!r);return}this._loadingMagDataXHR&&this._loadingMagDataXHR.abort(),this._loadingMagDataXHR=this.fetchData(this.username,o,{success:dr.default.bind(function(s){this.mag&&this.mag.num_id&&s&&s.num_id!=this.mag.num_id&&window.location.reload(),this.mag=new Ho(s,this),this.cachedMag=this.mag,this.onPreloadMag(t,!!r)},this),error:this.notFound})}},restartMag({currentPage:e,viewport:o}={}){let t=e||this.mag.currentPage.num,r=o||this.mag.viewport;this.stopListening(this.mag),this.mag.destroy();let i=this.mag.model.toJSON();this.mag=new Y0({...i,user:this.mag.user,constructorViewport:r,hasSummary:!0,globalWidgets:this.mag.staticGlobalWidgetsData,aboveAllWidgets:this.mag.aboveGlobalWidgetsData},this),this.cachedMag=this.mag,this.mag.showPage(t),this.mag.toolbar.toggleToolbarVisibility(!0),this.listenTo(this.mag,"menuShown",this.onViewerMenuShow),this.listenTo(this.mag,"menuHidden",this.onViewerMenuHide),this.listenTo(this.mag,"change:viewport",this.onChangeViewport,this),window.sessionStorage.setItem("constructorViewport",r||"default"),ye.trigger("preview:mag:restart")},fetchMagPages:async function(e){let o=Array.isArray(e)&&e.length?e.join(","):void 0;return this._loadingPagesDataXHR&&this._loadingPagesDataXHR.abort(),this._loadingPagesDataXHR=cr.default.ajax({url:`/api/magpages/${this.mag.num_id}`,method:"GET",data:o?{pages:o}:void 0,success:function(t){return t},error:function(t){return null},context:this}),this._loadingPagesDataXHR},onPreloadMag:function(e,o){cp(Ye.usedWidgets(this.mag.pages||[],this.mag.aboveGlobalWidgetsData)).finally(()=>{this.onLoadMag(e,o)})},onLoadMag:function(e,o){let t;if(this.loaded=this.started||!0,this.mag.forbidden){this.requestMagPassword(this.latestFragment,dr.default.clone(this.mag)),delete this.cachedMag,delete this.loaded,delete this.started;return}if(this.mag.is_suspended){this.showSuspended();return}this.mag._requested_page&&!o?(t=this.mag._requested_page,delete this.mag._requested_page):t=e,this.mag.render(),this.go(t,{animation:!1,isPageNum:o}),RM.common.mode="mag"},fetchData:function(e,o,r){var r=r||{};return e?r.url="/api/readymag/"+e+"/"+o:r.url="/api/readymag/"+o,cr.default.ajax(r)},sendReadyEvent:function(e){if(e=e||{},e=dr.default.defaults(e,{page:{}}),window.loadNotifier){if(e.error)return window.loadNotifier({error:e.error});window.loadNotifier({width:e.page.width,height:e.page.height})}},trackPage:function(){RM.screenshot||dr.default.defer(dr.default.bind(function(){this.analytics&&this.analytics.trackPage()},this))},goBack:function(){let e=this.internalHistory[this.internalHistory.length-2];e&&(e&&this.go(e,{skipInternalHistory:!0}),this.internalHistory.pop())},setUrlString:function(e){if(this.noUrlRewrite||(e=e||{},RM.screenshot))return;let o=this.mag.num_id+"/preview/",t=this.mag.currentPage;if(t&&t.num!="1"&&(o+=(t.pagePath||t.uri||t.num.toString())+"/"),e.skipInternalHistory||this.internalHistory.push(t.num.toString()),o===_s.default.history.getFragment())return;let i=(parseInt(dr.default.last(_s.default.history.getFragment(),"/"))||1)==t.num||e.replace;this.navigate(o,{replace:i})},getPreviousFragment:function(){return this.internalHistory[this.internalHistory.length-2]},getUserPermissions(){return this.userPermissions||[]},onError:function(){this.mag&&this.go(1,{animation:!1})},createMagFromTemplate:async function(e,o){let{default:t}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-EO7S4D4M.js");new t({router:this,me:this.me,tp:e,templateID:o})},requestMagPassword:async function(e,o){if(!this.magPasswordView){let{default:t}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-FXCKOXOL.js");this.magPasswordView=new t({router:this,$parent:(0,cr.default)("#mags")})}this.magPasswordView.render({mag:o,mag_url:e})},showSuspended:async function(){let{default:e}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-6BBREYNL.js");new e({type:"mag-suspended",$container:(0,cr.default)("#service-pages")}).render()},notFound:function(){dr.default.defer(async function(){let{default:e}=await import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-6BBREYNL.js");new e({type:"404",$container:(0,cr.default)("#service-pages")}).render()})}}),q0=FS;var Fp=T(mo()),Ve=T(et());yo();ot();oa();Jc();var Fo=T(et());Sl();yo();ui();var WS=Mo.extend({id:"_groupSave",url:"/api/modelsGroup/",name:"GroupSave",skipResponse:!0,isNew:function(){return!1},toJSON:function(e){e=e||{};let o=e.attrs||Mo.prototype.toJSON.apply(this,arguments),t=[];return Fo.default.each(o.changeset,function(r){let i=r.model.name==="Widget",s;!e.patch&&(i||Dt("widget.putNotPatch"))?s=r.model.toJSON():s=Fo.default.clone(r.attrs),s.modelType=r.model.name.toLowerCase(),t.push(s)}),t},set:function(e,o,t){if(e==null)return this;let r;return typeof e=="object"?(r=e,t=o):(r={})[e]=o,t||(t={}),t.noSet||(Fo.default.each(r.changeset,function(i){let s=i.model,a=Fo.default.clone(i.attrs);t.reset&&(a=s.getResetAttrs(s,a),a=s.parse(a)),t.groupsave=!0,i.model.set(a,t)}),r.changeset=Fo.default.reject(r.changeset,function(i){return i.model.fakeSave})),Mo.prototype.set.apply(this,arguments)},save:function(e,o,t){let r=this,i;Fo.default.isObject(e)||e==null?(i=e,t=o):(i={},i[e]=o),!this.skipMagChanging&&!t?.skipMagChanging&&RM.constructorRouter.mag&&RM.constructorRouter.mag.set("changed",!0);let s=Mo.prototype.save.apply(this,arguments);s&&(s.error(function(a,l){l!=="abort"&&(a.status&&a.status<500||(r.wasNotSaved=!0,RM.constructorRouter.raiseConnectionError()))}),s.success(function(){r.wasNotSaved&&r.trigger("re-saved"),r.wasNotSaved=!1})),e&&e.changeset&&ye.trigger("save:group",{changeset:e.changeset,options:Fo.default.isObject(o)?o:t})},sync:function(e,o,t){if(t.attrs&&t.attrs.changeset&&e=="patch"&&(t.attrs=this.toJSON(t)),!Fo.default.isEmpty(t.attrs)||!Fo.default.isEmpty(this.get("changeset")))return Mo.prototype.sync.apply(this,arguments)},triggerSocketUpdate:function(e,o){let t=this.getViewport&&this.getViewport()||o?.viewport,r=Fo.default.uniq(Fo.default.map(e,function(i){return this.modelsList[i._id].model.getPageId()},this));if(e={changes:o.patch&&o.attrs?[...o.attrs]:e,pids:r},Array.isArray(e.changes)&&e.changes.length){let i={},s=[];if(e.changes.forEach(a=>{if(a?.modelType!=="widget"){s.push(a);return}(t&&t==="default"||a?._id&&this.modelsList[a._id]?.model?.get("is_global"))&&s.push(a),a.is_global&&a._id&&this.modelsList&&this.modelsList[a._id]&&this.modelsList[a._id].attrs&&(i[a._id]=this.modelsList[a._id].attrs)}),!s.length){RM.constructorRouter.trigger("update_from_server","UpdateInMobileViewport");return}s.length&&(e.changes=s),Fo.default.isEmpty(i)||(e.widgetsAttrs=i)}RM.constructorRouter.trigger("update_from_server",this.name,e,t),this.clear({silent:!0})}}),X0=WS;oa();ui();var K0=function(e,o){return this.router=e,this.mag=o,ye.on("set:model",this.onModelSet,this),ye.on("save:model",this.onModelSave,this),ye.on("ready:model",this.onModelReady,this),this.addHistoryStep.__debounced=Ve.default.debounce(this.addHistoryStep,300),this.historyModelsList={},this.groupSave=new X0,this.groupSave.modelsList=this.historyModelsList,this.lastSave=0,this.prevChangedList={},this.lastChangedList={},this};Ve.default.extend(K0.prototype,Fp.default.Events,{MERGE_UNDO_DIFF:500,onModelReady:function(e){!e.tracked||this.historyModelsList[e.id]||(this.historyModelsList[e.id]={model:e,attrs:e.cloneJSON()})},whenModelReady(e){return new Promise(o=>{let t=e.id,r=i=>{i.id===t&&(ye.off("ready:model",r),o())};this.historyModelsList[t]?o():ye.on("ready:model",r)})},onModelSet:function(e){let o=e.model,t=e.options||{};if(this.historyModelsList[o.id]){if(fi.isIncomingUpdate(t))return this.historyModelsList[o.id]={model:o,attrs:o.cloneJSON()},this.historyModelsList[o.id];this.lastChangedList[o.id]=Ve.default.keys(o.changed)}},onModelSave:function(e){let o=e.model,t=e.setAttrs;this.historyModelsList[o.id]&&this.addHistoryStep({model:o,attrs:this.historyModelsList[o.id].attrs,setAttrs:t},e.options)},setGroup:function(e,o){o=o||{};let t=[];Ve.default.each(e,function(r){let i=this.historyModelsList[r._id]&&this.historyModelsList[r._id].model;if(!i&&r instanceof fi&&(i=r,r=Ve.default.extend({_id:r.get("_id")},r.changed)),o.socketUpdate&&i&&r.modelType==="widget"){let s=!1;if(Pe.viewport_listall.forEach(a=>{r[a]&&(s=!0,i[a]={...i[a]||{},...r[a]})}),s)return}if(!(!i&&o.socketUpdate)){if(!i)return console.error("SyncManager: model not found",r);t.push({model:i,attrs:r})}},this),this.groupSave.set({changeset:t},o),o.socketUpdate&&Ve.default.each(t,function(r){typeof r.attrs.is_global=="boolean"&&!r.attrs.is_global?this.historyModelsList[r.model.id]&&delete this.historyModelsList[r.model.id]:this.historyModelsList[r.model.id]={model:r.model,attrs:r.model.cloneJSON()}},this)},saveGroup:function(e=[],o){let t=e.reduce((s,a)=>s===a.name?s:"mixed",e?.[0]?.name);o=Ve.default.defaults(o||{},{patch:!(t==="Widget"&&Dt("widget.putNotPatch"))}),(o.undo||o.redo)&&(o.reset=!0,o.patch=!1);let r=o.changeset||this.getChangeset(e,o);o=Ve.default.omit(o,"changeset"),this.groupSaveXHR=this.groupSave.save({changeset:r},o);let i=this.getHistoryDict(r);o.applySnapshot&&o.applySnapshot(),this.addHistoryStep(i,o)},getChangeset:function(e,o){return e instanceof Fp.default.Collection&&(e=e.models),Ve.default.isEmpty(e)&&(e=Ve.default.map(this.historyModelsList,function(t){return t.model})),e[0]instanceof Fp.default.Model&&!Ve.default.isEmpty(e)?(o&&(o.noSet=!0),this.getChangedModelsData(e,o)):Ve.default.map(e,function(t){return{model:this.historyModelsList[t._id].model,attrs:t}},this)},getHistoryDict:function(e){return Ve.default.map(e,function(o){return Ve.default.extend({},this.historyModelsList[o.model.id],{setAttrs:o.attrs})},this)},getChangedModelsData:function(e,o={}){let t=[];return Ve.default.each(e,function(r){let i=r.toJSON(o),s=Ve.default.objectDifference(this.historyModelsList[r.id].attrs,i);o.byStoreAutolayoutBlocks&&Ve.default.isObject(r?.attributes)&&r.attributes.type==="text"&&r.attributes.version===3&&(Ve.default.isArray(i?.blocksMeta)&&(s.blocksMeta=[...i.blocksMeta]),Ve.default.isArray(i?.styles)&&(s.styles=[...i.styles])),Ve.default.isEmpty(s)||t.push({model:r,attrs:Ve.default.extend(s,{_id:r.get("_id")})})},this),t},addHistoryStep:function(e,o){if(Ve.default.isArray(e)||(e=[e]),o=o||{},Ve.default.each(e,function(i){i.model.undoKeys&&(i.attrs=Ve.default.pick(i.attrs,Ve.default.union(i.model.undoKeys,["_id"])))}),e=Ve.default.reject(e,function(i){let s=i.model.toJSON();return i.model.undoKeys&&(s=Ve.default.pick(s,Ve.default.keys(i.attrs))),Ve.default.isEqual(s,i.attrs)},this),Ve.default.isEmpty(e))return;let t=Ve.default.map(e,function(i){return i.model.id});Date.now()-this.lastSave<=this.MERGE_UNDO_DIFF&&!o.undo&&!o.redo&&Ve.default.all(Ve.default.pluck(e,"model"),function(s){return s.mergeUndoSteps!==!1})&&Ve.default.isEqual(Ve.default.pick(this.lastChangedList,t),this.prevChangedList)&&(o.replace=!0),o.undo||o.redo||o.skipHistory?this.prevChangedList={}:this.prevChangedList=Ve.default.clone(Ve.default.pick(this.lastChangedList,t)),this.lastChangedList=Ve.default.omit(this.lastChangedList,t),o.skipHistory||(this.lastSave=Date.now());let r=Ve.default.map(e,function(i){return{model:i.model,attrs:i.attrs}});o.skipHistory||Lt.add(r,o),Ve.default.each(e,function(i){let s=i.model.cloneJSON();if(o.patch){let a=i.setAttrs;s=Ve.default.deepExtend({},this.historyModelsList[i.model.id].attrs,a)}this.historyModelsList[i.model.id]={model:i.model,attrs:s}},this)}});var im=K0;Fr();var Z0={"template-constructor-workspace":Ct`


	<div class="workspace" aria-label="Workspace">
		<div class="origin" >
		</div>
        <div class="selectframe">
            <div class="frameborder"></div>
        </div>
		<div class="workspace-border"></div>
		<div class="page-size-control"></div>
		<div id="comments"></div>
	</div>
`};Hu();ui();ed();yo();wd();n_();Qg();sn();cg();var mm=T(cl()),cx=T(H());ol();ta();var er=T(H());var J0=(e,o)=>{let t=e.getFullYear().toString(),r=(e.getMonth()+1).toString(),i=e.getDate().toString();switch(r=r.length===1?"0"+r:r,i=i.length===1?"0"+i:i,o){case"YYYYMMDD":return t+r+i;case"MMDDYYYY":return r+i+t;case"DDMMYYYY":return i+r+t;default:throw new Error("Invalid date format pattern")}};var ax=T(xf());ag();re();Ue();G();Oe();var Q0=T(H());var ex=e=>{let[o,t]=(0,Q0.useState)(e);return{isOpen:o,onToggle:()=>t(!o),onOpen:()=>t(!0),onClose:()=>t(!1)}};Yr();$h();re();G();I_();ve();var Wp=T(H()),tx=e=>{(0,Wp.useEffect)(()=>{if(!e)return;let o=document.createElement("script");return o.type="text/javascript",o.innerHTML=`(function(){${e}})()`,document.body.appendChild(o),()=>{window.onClearWhatsNewPopup&&window.onClearWhatsNewPopup(),document.body.removeChild(o)}},[e])},ox=e=>{(0,Wp.useLayoutEffect)(()=>{if(!e)return;let o=document.createElement("style");return o.innerHTML=e,document.head.appendChild(o),()=>{document.head.removeChild(o)}},[e])};v();var US=e=>e.hover?{":hover":e.hover}:{},rx=Y(f)`
  z-index: 0;
  width: 336px;
  height: 496px;
  display: flex;
  color: #fff;
  border-radius: 8px;
  position: relative;
  user-select: none;
  background-size: cover;
  flex-direction: column;
  -webkit-font-smoothing: initial;
  ${Ur("backgroundColor")}
  ${Ur("backgroundImage",{transform:e=>()=>`url(${e})`})})}
`;rx.defaultProps={id:"popup-wrapper"};var nm=Y(Le)`
  font-size: 16px;
  margin-top: 25px;
  text-align: center;
`;nm.defaultProps={id:"popup-caption"};var sm=Y(Le)`
  font-size: 24px;
  font-weight: 400;
  text-align: center;
  padding-bottom: 3px;
`;sm.defaultProps={id:"popup-date-caption"};var am=Y(Le)`
  text-align: center;
  ${Ur("lineHeight",{transform:e=>()=>`${e}px`})};
  ${Ur("marginTop")};
`;am.defaultProps={id:"popup-title"};var lm=hb;lm.defaultProps={id:"popup-image"};var pm=Y(Le)`
  text-align: center;
  ${Ur("lineHeight",{transform:e=>()=>`${e}px`})};
  ${Ur("marginTop")};
`;pm.defaultProps={id:"popup-description"};var cm=Y(Re)`
  display: block;
  cursor: pointer;
  font-size: 16px;
  text-decoration: none;
  user-select: none;
  text-align: center;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  transition: 0.1s color, 0.1s background-color, 0.1s border-radius, 0.1s width, 0.1s height, 0.1s line-height;
  ${Ur("lineHeight",{transform:e=>()=>`${e}px`})};
  ${Ur("backgroundColor")};
  ${US}
`;cm.defaultProps={id:"popup-button"};function ix({customJsCode:e,customCssCode:o,...t}){return ox(o),tx(e),n(rx,{...t})}vf();v();var[GS]=hi,nx=5,Ei=(e=>(e.prev="prev",e.next="next",e.show="show",e.close="close",e.outsideClose="outsideClose",e.buttonClick="buttonClick",e))(Ei||{});function VS({defaultIsOpen:e=!1,getWhatsNew:o,onSeen:t,formatDate:r,lastUserSeen:i,userRegistrationDate:s,onClose:a,onAction:l}){let m=(0,er.useRef)(!0),[c,p]=(0,er.useState)({limit:10,skip:0}),[u,d]=(0,er.useState)(0),[g,h]=(0,er.useState)([]),{isOpen:b,onClose:x,onOpen:y}=ex(e),S=(0,er.useRef)("");(0,er.useEffect)(()=>{function V(W){o(c).then(J=>{W(J),J.length<c.limit&&(m.current=!1),h(me=>[...me,...J])})}V(W=>{if(!b&&i!==void 0&&s!==void 0&&W.length){let[J]=W,me=new Date(J.date);new Date(i)<me&&new Date(s)<me&&y()}})},[c]),(0,er.useEffect)(()=>{b?(t&&t(),l&&l("show",S.current)):d(0)},[b]);let k=()=>{let V=Math.min(g.length,u+1);V%nx===0&&g[V+nx]===void 0&&m.current&&p({limit:10,skip:c.skip+10}),d(V),l?.("next",A(g[V]))},P=()=>{let V=Math.max(0,u-1);d(V),l?.("prev",A(g[V]))},C=V=>{B(V,!0)},B=(V,W=!1)=>{if(x(),a&&a(V),l){let{close:J,outsideClose:me}=Ei;l?.(W?me:J,S.current)}},$=()=>{l?.("buttonClick",S.current)},A=V=>{if(!V)return"";let W=V.name?.value||`_${V._id}`;return`${V.date&&J0(new Date(V.date),"YYYYMMDD")}${W}`},R=(0,er.useMemo)(()=>{let V=g[u];return S.current=A(V),V},[u,g]),Z=b&&R!==void 0,[F]=Ul(Z);return Z?n(ax.default,{onExit:C,verticallyCenter:!0,titleId:"#popup-caption",initialFocus:"#close-popup-button",dialogStyle:F,underlayStyle:{...F,zIndex:1e4},children:w(f,{position:"relative",children:[w(ix,{customJsCode:R.js,customCssCode:R.css,...R.wrapper.cssProperties,children:[n(nm,{...R.caption.cssProperties,children:"What's New"}),n(sm,{...R.caption.cssProperties,children:r(R.date)}),R.title.text?n(am,{dangerouslySetInnerHTML:{__html:Ys.sanitize(R.title.text)},...R.title.cssProperties}):null,R.picture.url?n(lm,{marginLeft:"auto",marginRight:"auto",display:"block",srcSet:`${R.picture.url}, ${R.picture.url2x} 2x`,...R.picture.cssProperties}):null,R.description.text?n(pm,{dangerouslySetInnerHTML:{__html:Ys.sanitize(R.description.text)},...R.description.cssProperties}):null,n(cm,{href:R.button.href,target:"blank",onClick:$,hover:R.button.hover,...R.button.cssProperties,children:R.button.text})]},R._id),n(jS,{id:"close-popup-button",variant:"unstyled",onClick:B,children:n(Ht,{height:14,width:14,color:"white"})}),w(f,{position:"absolute",display:"flex",flexDirection:"column",bottom:2,right:-64,children:[n(sx,{disabled:u===0,onClick:P,dir:"up",variant:"unstyled",children:n(aa,{height:14,width:14,color:"#424242"})}),n(sx,{dir:"down",variant:"unstyled",onClick:k,disabled:u===g.length-1,children:n(aa,{height:14,width:14,color:"#424242"})})]})]})}):null}var jS=Y(ne)`
  top: 0;
  right: -56px;
  position: absolute;
  border-radius: 50%;
  opacity: 0.6;

  &:focus-within {
    outline-offset: 1px;
    outline: 1px auto rgb(153, 200, 255);
  }

  &:hover {
    opacity: 1;
  }

  @media (max-width: ${GS}) {
    top: -56px;
    right: 0;
  }
`,sx=Y(ne)`
  width: 32px;
  height: 32px;
  display: flex;
  border-radius: 50%;
  margin-top: 8px;
  align-items: center;
  justify-content: center;
  background-color: ${({theme:e})=>e.colors.gray};

  &:focus-within {
    outline-offset: 1px;
    outline: 1px auto rgb(153, 200, 255);
  }

  &:hover {
    background-color: #fff;
  }

  ${e=>`transform: rotate(${e.dir==="up"?"90deg":"270deg"});`}
`,dm=VS;tt();jc();var lx=async e=>{let{data:o}=await gi.get("/api/whats-new",e);return o||[]},px=async e=>{await gi.post("/api/whats-new/seen",{date:e,type:"popup"})};v();function YS(e){let o=new Date().getFullYear(),t=new Date(e).getFullYear(),r=o===t?"MMMM d":"MMMM d, yyyy";return tl(new Date(e),r)}function Up(e){let o=(0,cx.useCallback)((t,r)=>{let i=s=>{ae(ce.WhatsNewPopup,{action:s,content:r})};switch(t){case Ei.show:i("impression");break;case Ei.next:case Ei.prev:i(t===Ei.next?"up":"down"),i("impression");break;case Ei.buttonClick:i("click");break;default:i("close")}},[]);return n(dm,{formatDate:YS,onSeen:()=>px(new Date().toISOString()),getWhatsNew:lx,onAction:o,...e})}var um=(e,{lastUserSeen:o,userRegistrationDate:t})=>{let r=mm.default.createRoot(e);function i(){r.unmount(),r=mm.default.createRoot(e)}function s(){r.render(n(vr,{withGlobalStyles:!1,children:n(Up,{lastUserSeen:o,userRegistrationDate:t})}))}return s(),{unmount:i}};tt();id();Uf();bi();rn();_o();ct();var X1=T(nr());ta();G();Be();Gt();to();var mr=T(H());Vo();v();var tr=(0,mr.createContext)({user:void 0,isFreePlan:!0,setUserOptions:()=>{},setUserMetrics:()=>{}});function Gp({userModel:e,children:o}){let[t,r]=(0,mr.useState)(()=>e?{...e.attributes}:void 0);(0,mr.useEffect)(()=>{function l(m){r(c=>({...c,...m.attributes}))}return e?.on("change",l),()=>{e?.off("change",l)}},[]);let i=(0,mr.useCallback)(l=>{if(t){let m={...t.opts,...l};r({...t,opts:m}),e?.save({opts:m},{patch:!0,silent:!0})}},[e,t]),s=(0,mr.useCallback)(l=>{e?.save({behavior_metrics:{...e.get("behavior_metrics")||{},...l}},{patch:!0,silent:!0})},[e]),a=!!(window?.RM?.constructorRouter?.isOwner&&Ye.isFreePlan(t?.plan));return n(tr.Provider,{value:{user:t,isFreePlan:a,setUserOptions:i,setUserMetrics:s},children:o})}var Cs=()=>(0,mr.useContext)(tr);re();G();ao();G2();var Aa=T(H());H2();O2();G();Ue();_o();Pt();re();v();function qS({id:e,targetSteps:o,hidden:t,width:r,height:i,borderRadius:s,onClick:a,onMouseEnter:l,onMouseLeave:m,className:c,children:p,backgroundColor:u,disableHover:d=!1,color:g,disabled:h,tooltip:b,tooltipPosition:x,tooltipDisabled:y,tooltipPadding:S,forceTooltip:k,"data-testid":P,tooltipPreventOverflow:C,cursor:B}){let $=n(f,{onMouseEnter:l,onMouseLeave:m,className:c,width:r||56,height:i||56,alignItems:"center",justifyContent:"center",borderRadius:s||30,color:g||h?"gray":"white",backgroundColor:u||Me(k?"black":"darkGray",.88),cursor:B||"pointer",backdropFilter:"blur(3px)",display:t?"none":"flex",css:te`
        ${d?"":`
          &:hover {
            background: ${Ee(.12,h?O.darkGray:O.black)};
          }
        `}
      `,children:p}),A={key:b,placement:x||"top",indent:4,open:y?!1:k,preventOverflow:C,componentProps:{tooltip:{padding:S}}};return n(f,{display:"flex",id:e,"data-testid":P,onClick:a,children:b?(()=>n(ht,{...A,targetSteps:o,defaultText:b,children:$}))():$})}var Vp=f.withComponent(qS);Be();ct();dn();v();function XS({previewOnly:e,hidden:o}){let t=(0,Aa.useContext)(Te),{scrollTop:r}=(0,Aa.useContext)(kr),[i,s]=(0,Aa.useState)(!1),a=e||t.inPreview;return n(Vp,{id:"preview-toggle-button",targetSteps:["PreviewAndPublish","BackToConstructor","CheckPreview","GoBackToEditor"],tooltip:a?"Edit (P)":"Preview (P)",tooltipDisabled:i,hidden:o,onMouseEnter:()=>i&&s(!1),tooltipPreventOverflow:16,onClick:()=>{t.togglePreview({scrollTop:a?r:void 0}),s(!0),a?Ie(["BackToConstructor","GoBackToEditor"]):(window.RM.constructorRouter.trigger("notice:triggerEduTipClose"),Ie(["PreviewAndPublish","CheckPreview"]))},children:a?n(Hh,{preserveAspectRatio:"none",width:38,height:38}):n(Oh,{height:"26px",width:"38px"})})}var jp=XS;var Ri=T(H());Be();G();ve();Br();Ue();pt();pt();var ur=e=>e.is_published?e.changed?"unpublishedChanges":"sameAsPublished":"unpublished",Yp=(e,o=!1)=>{let t=oe.readymag_viewer_host,r=t.split("//")[1],i=e.domain,s=e.user.domain,a=o?`${t.split("//")[0]}//`:"",l=i||s||`${r}/${e.user.uri}`;return a+l},dx=e=>{let o=oe.readymag_viewer_host;return e.domain?e.domain:`${o}/${e.uri}`},mx=e=>/[^\x00-\x7f]/.test(e)?e.replace(/[^\x00-\x7f]/g,""):e,ux=e=>/\s/.test(e)?e.replace(/\s/g,""):e,qp=e=>{let o=e.trim();return o=o.replace(/^\/\//,""),o=o.replace(/^[A-Za-z]+?:\/\//,""),o=o.replace(/\/.*$/,""),o=o.replace(/:\d*$/,""),o=o.replace(/^.*?@/,""),o=o.trim(),o},gm=e=>{let o="",t="",r="";return e&&(e.arecord&&(o="A-record",t=e.usedArecord||t,r=e.validArecord||r),e.cname&&(o="CNAME-record",t=e.usedCname||t,r=e.validCname&&e.validCname+"."||r)),{domain:e.domain,subdomain:e.subdomain,recordType:o,currentValue:t,neededValue:r}},hm=(e,o="")=>e.replace(/(\r?\n|\r)+/g,o);wo();Pt();bl();re();sn();ct();ar();bl();v();function ZS({textStyle:e,...o}){let t=(0,Ri.useContext)(ie),r=(0,Ri.useContext)(Te),{showNotice:i}=kl(),s=ur(t.project),a=(0,Ri.useCallback)(()=>{let d="Injected Code, Forms, Lottie and Shots will not work in Published project.",g=!t.hasPermission("can_inject_code")&&t.hasCustomCode(),h=!t.hasPermission("can_use_shots")&&t.hasShots(),b=!t.hasPermission("can_use_forms")&&t.hasForms();(g||h||b)&&i(d,{canBeClosed:!0,closeByTimer:!0})},[]),m=`${oe.readymag_viewer_host}/${t.project.user.uri}/${t.project.uri}/`,c=(0,Ri.useMemo)(()=>{let d=t.pages.find(g=>g._id===t.currentPageId);return d&&d.num!==1?`${m}num/${d.num_id}`:m},[m,t.currentPageId]),p=!t.isPublishError&&!t.publishInProgress&&s==="sameAsPublished",u=(0,Ri.useCallback)(async()=>{if(s!=="sameAsPublished"&&!t.publishInProgress)try{await t.publishWithNotice({fromPreview:r.inPreview}),Ie("BackToConstructor",{cb:r.togglePreview})}catch(d){if(d instanceof Kn&&d.type==="warning"){await t.publishWithNotice({skipWarnings:!0,alsoExport:r.exportAsTemlate,dontRenewScreenshots:r.dontRenewScreenshots});let g=["type-widget-shots","type-code-injection","type-widget-shots","type-widget-lottie"];d.tag&&g.includes(d.tag)?st("widgets"):st("default")}else if(d instanceof Kn){let g={canBeClosed:!0,closeByTimer:!0};d.tag==="type-publish-noemail"?i(d.message,g):d.tag==="type-publish-limit"?st("publish-limit"):d.tag==="type-publish-paused-subcription"?i(d.message,g):st("default")}else throw d}},[s,t.publishInProgress]);return n(f,{id:"publish-button",width:128,height:56,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:30,backgroundColor:Ee(.12,O.darkGray),color:"white",position:"relative",cursor:"pointer",backdropFilter:"blur(3px)",css:te`
        &:hover {
          background: ${Ee(.12,O.black)};
        }
      `,onMouseEnter:p?void 0:a,onClick:u,...o,children:n(I,{textStyle:e,textAlign:"center",as:p?"a":"span",href:p?c:void 0,target:"_blank",display:"block",lineHeight:"52px",height:"56px",textDecoration:"none",color:"inherit",...p?{position:"absolute",top:0,right:0,bottom:0,left:0}:{},children:t.isPublishError?"Error":t.publishInProgress?n(Xt,{bgColor:"transparent"}):s==="sameAsPublished"?"Open":s==="unpublishedChanges"?"Republish":"Publish"})})}var gx=ZS;var Ai=T(H());G();ve();ps();re();wo();Ue();Pt();tt();Gt();var Jt=T(H());ld();re();G();zh();re();Gt();i_();Hu();Be();v();var wm=(0,Jt.createContext)({});wm.displayName="ToolbarPopoverContext";var JS=(0,Jt.forwardRef)(({stroke:e},o)=>n("svg",{ref:o,width:"16",height:e?"10":"8",xmlns:"http://www.w3.org/2000/svg",viewBox:e?"0 0 16 10":"0 0 16 8",children:e?w(K,{children:[n("path",{fill:"currentColor",d:"M16 0H0V2C2.20914 2 4 3.79086 4 6C4 8.20914 5.79086 10 8 10C10.2091 10 12 8.20914 12 6C12 3.79086 13.7909 2 16 2V0Z",fillRule:"evenodd"}),n(f,{as:"path",fillRule:"evenodd",fill:e,d:"M0 0.0059433V2.00594C2.20914 2.00594 4 3.79681 4 6.00594C4 8.21508 5.79086 10.0059 8 10.0059C10.2091 10.0059 12 8.21508 12 6.00594C12 3.79681 13.7909 2.00594 16 2.00594V0.0059433C16 0.0059433 14.8115 0.00594401 14 0.347355C12 1.18877 10 3.39351 10 6.00594C10 7.11051 9.10457 8.00594 8 8.00594C6.89543 8.00594 6 7.11051 6 6.00594C6 3.39351 4.33039 1.17103 2 0.347355C1.36768 0.129361 0.930277 0.0625123 0 0.0059433Z"})]}):n("path",{fill:"currentColor",d:"M0 0C2.20914 0 4 1.79086 4 4C4 6.20914 5.79086 8 8 8C10.2091 8 12 6.20914 12 4C12 1.79086 13.7909 0 16 0H0Z",fillRule:"evenodd"})})),Et=(0,Jt.forwardRef)(({id:e,name:o,closeOnOutsideClick:t=!0,onWindowBlur:r,children:i,skidding:s,button:a,onToggle:l,isAutoHeight:m,panelPosition:c={},ArrowProps:p={},withArrow:u=!0,watchingClick:d=B=>B,disabled:g=!1,disableInteractions:h=!1,disablePortal:b=!1,"data-testid":x,transform:y,onButtonClick:S,alwaysOpen:k,...P},C)=>{let{currentPanel:B,openPanel:$,closePanels:A}=(0,Jt.useContext)(kt),R=(0,Jt.useContext)(Te),[Z,F]=(0,Jt.useState)(null),[V,W]=(0,Jt.useState)(null),[J,me]=(0,Jt.useState)(null),se=(0,Jt.useRef)(null),ee=(0,Jt.useRef)(null),ue=B?B===o:!1,[ke,ge]=(0,Jt.useState)({tooltipContainer:se.current||void 0,dropdownContainer:ee.current||void 0});(0,Jt.useEffect)(()=>{(ke.tooltipContainer!==se.current||ke.dropdownContainer!==ee.current)&&ge(le=>({...le,tooltipContainer:se.current||void 0,dropdownContainer:ee.current||void 0}))},[se.current,ee.current]),(0,Jt.useEffect)(()=>{function le(){r?.(document.activeElement,A)}return ue&&r&&window.addEventListener("blur",le),()=>{window.removeEventListener("blur",le)}},[ue,r,A]);let we=Tf({watchingClick:d(ue&&!R.isUserTemplatesModalShown&&!R.isRmTemplatesModalShown),callback:le=>{let We=!document.body.contains(le.target),he=fe=>Array.from(document.querySelectorAll("#settings-container, #react-aria-modal-dialog, .template-center, #my-templates-modal, .constructor-navigation-arrows, body > .popups, .code-editor-modal-overlay, .help-shortcuts, .code-editor-block")).find(ze=>ze&&ze.contains(fe));t&&Z&&!Z.contains(le.target)&&!We&&!he(le.target)&&A()}},[t]),{styles:L,attributes:j,update:N}=rs(Z,V,{placement:"top",modifiers:[{name:"offset",options:{offset:[s||0,16]}},{name:"arrow",options:{element:J,padding:p.popperPadding}}]});(0,Jt.useEffect)(()=>{N&&N(),l&&l(ue)},[ue]);function de(le){S?S(le):g||(ue?A():$(o))}return w(K,{children:[(ue||k)&&n(Al,{disablePortal:b,ref:le=>{if(b){let We=le;W(We),we.current=We}},children:n(f,{ref:le=>{b||(W(le),we.current=le,C&&(C.current=le))},id:e,display:"flex",flexDirection:"column",justifyContent:"flex-end",width:"224px",height:m?"auto":Un.isTablet()?`${window.innerHeight-108}px`:"calc(100vh - 108px)",maxHeight:Un.isTablet()?`${window.innerHeight-108}px`:"calc(100vh - 108px)",zIndex:"7100",style:{...L.popper,...y?{transform:y}:{}},"data-testid":x,css:te`
                ${h?`
                  pointer-events: none;
                  user-select: none;

                  * {
                    pointer-events: none !important;
                    user-select: none !important;
                  }
                `:""}
              `,...c,...j.popper,children:w(wm.Provider,{value:ke,children:[typeof i=="function"?i({popoverShown:ue}):i,u&&n(f,{zIndex:"1",bottom:-10,ref:me,style:L.arrow,position:"absolute",color:p.backgroundColor||Me("lightGray",.96),...p.position,children:n(JS,{stroke:p.stroke})}),n(f,{ref:se}),n(f,{ref:ee})]})})}),n(f,{ref:F,...P,onClick:de,opacity:g?.4:1,pointerEvents:g?"none":"all",children:a({isPanelShown:ue})})]})});v();v();Be();dn();zl();ot();G();v();function yt({padding:e,margin:o,"data-testid":t,textAlign:r="center",children:i}){return n(f,{width:"100%",padding:e||"12px 16px",margin:o||"0",borderRadius:"8px",backgroundColor:"white",textAlign:r,"data-testid":t||"common-error-message",children:i})}v_();_o();ct();v();var QS=({isActive:e,name:o,divider:t=!0,disabled:r})=>n(f,{width:"100%",height:48,display:"flex",cursor:"pointer",userSelect:"none",alignItems:"center",position:"relative",justifyContent:"left","data-testid":"project-settings-viewer","aria-label":`${o} viewer settings tab`,borderTop:"2px solid",borderTopColor:t?"gray":"transparent",css:te`
        &:hover {
          & span {
            color: ${e&&r?O.gray:e?O.black:O.red};
          }
        }
      `,children:n(f,{position:"relative",bottom:"2px",children:n(I,{color:r?"gray":"black",textStyle:"subheading",children:o})})});function xm({children:e,button:o,...t}){let{desktopOptions:r,phoneOptions:i,tabletOptions:s,setProjectOptions:a,viewport:l,setViewport:m,currentPageId:c,iframeElement:p}=(0,Ai.useContext)(kr),{getProjectPermissionsOverrides:u,pages:d}=xl(),[g]=Bl(),h=d.find(C=>C._id===c),b=h?.viewport_phone_portrait?.enabled,x=h?.viewport_tablet_portrait?.enabled,y=$t(),S=(0,Ai.useMemo)(()=>({default:{options:r,...u(r),name:"Desktop"},tablet_portrait:{options:s,...u(s),name:"Tablet"},phone_portrait:{options:i,...u(i),name:"Mobile"}}),[i,s,r,u]),k=g==="iPhone SE horizontal"&&!x?"default":g==="iPhone SE horizontal"&&x?"tablet_portrait":l;k==="default"&&y.started&&y?.step?.name==="SwitchToDesktop"&&Ie("SwitchToDesktop");let P=(0,Ai.useCallback)((C,B)=>{C===p&&B()},[p]);return n(Et,{disablePortal:!0,name:"viewer-settings",skidding:-28,button:o,onWindowBlur:P,ArrowProps:{stroke:Ee(.84,O.gray)},onToggle:C=>{C?ae(ce.SettingsPreviewViewer,{action:"viewer settings open"}):y.started&&y.tourType==="pro"&&y?.step?.name==="PointerCursorUpload"&&Ie("PointerCursorUpload")},...t,children:n(f,{width:224,height:"100%",color:"black",display:"flex",borderRadius:"2rm",flexDirection:"column",backgroundColor:"lightGray",border:"2px solid rgba(184, 184, 184, 0.16)",children:n(f,{height:"calc(100% - 100px)",flexGrow:1,children:n(Zo,{transition:{mass:1,stiffness:210,damping:20},value:k,onChange:C=>{l&&m(C),C==="phone_portrait"&&ae(ce.SettingsPreviewViewer,{action:"mobile tab open"})},children:Object.keys(S).map((C,B)=>{let{options:$,disabled:A,name:R}=S[C],Z=C==="phone_portrait",F=C==="tablet_portrait",V=F?x:Z?b:!0,W=(0,Ai.useMemo)(()=>F||Z?["scalableviewer","slidein","projectinfo","useCustomCursor","controlsontop","viewerNext"]:[],[F,Z]),J=(0,Ai.useCallback)(me=>{a(me,C)},[C,a]);return n(Kt,{value:C,renderButton:({isActive:me})=>w(f,{padding:"0 16px",children:[R==="Desktop"&&n(f,{position:"relative",top:24,children:n(ht,{targetSteps:["SwitchToDesktop"],position:"left",indent:24,children:n("div",{})})}),n(QS,{isActive:me,name:R,divider:B>0,disabled:!V})]}),children:me=>n(f,{ref:me,paddingLeft:16,paddingRight:16,paddingBottom:16,"aria-label":`${R} viewer`,children:V?n(ob,{options:$,exclude:W,disabled:A,setProjectOptions:J}):n(yt,{margin:"0 0 14px",children:n(I,{textStyle:"small",color:"black",children:"Desktop layout is used"})})})},C)})})})})})}var Ss=T(H());re();go();Oe();Pt();_o();v();var hx=(0,Ss.createContext)({isSomeHovered:!1,getButtonProps:()=>({})});function fx({children:e}){let{isHovered:o,...t}=Ge(),r=(0,Ss.useCallback)(()=>t,[t]);return n(hx.Provider,{value:{isSomeHovered:o,getButtonProps:r},children:e})}var e4=Y(Ze)`
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: ${({isActive:e,theme:o})=>e?Ee(.25,o.colors.black):"initial"};

  &:hover {
    background-color: ${({theme:e})=>Ee(.25,e.colors.black)};
  }
`;function vm({TooltipProps:e,tooltipTargetSteps:o,icon:t,isActive:r,...i}){let{isSomeHovered:s,getButtonProps:a}=(0,Ss.useContext)(hx);return n(ht,{indent:8,leaveDelay:100,enterDelay:1400,open:e.disabled?!1:void 0,...e,defaultText:e.text,targetSteps:o,children:n("span",{children:n(e4,{variant:"unstyled",isActive:!s&&r,"aria-label":e.text,...i,...a(),children:t})})})}v();var bx=()=>w("svg",{width:"56",height:"56",viewBox:"0 0 56 56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[n("path",{d:"M36.0343 20.5346C36.4265 20.9248 36.4273 21.5593 36.0361 21.9505C35.6463 22.3404 35.0145 22.3412 34.6237 21.9523L28.9741 16.3309L29.0009 34.0111C29.0017 34.5569 28.5595 34.9998 28.0137 34.9998C27.4691 34.9998 27.0274 34.5587 27.0265 34.0141L26.9998 16.3903L21.4028 21.9817C21.0123 22.3719 20.3794 22.3718 19.989 21.9814C19.5983 21.5907 19.5985 20.9573 19.9893 20.5668L27.2331 13.3302C27.3191 13.2443 27.4169 13.1773 27.5213 13.1292C27.9048 12.8986 28.4098 12.948 28.7414 13.2779L36.0343 20.5346Z",fill:"currentColor"}),n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 25.9999C16.5523 25.9999 17 26.4476 17 26.9999V36.9999C17 39.7613 19.2386 41.9999 22 41.9999H34C36.7614 41.9999 39 39.7613 39 36.9999V26.9999C39 26.4476 39.4477 25.9999 40 25.9999C40.5523 25.9999 41 26.4476 41 26.9999V36.9999C41 40.8659 37.866 43.9999 34 43.9999H22C18.134 43.9999 15 40.8659 15 36.9999V26.9999C15 26.4476 15.4477 25.9999 16 25.9999Z",fill:"currentColor"})]});var nc=T(H());G();dn();Gt();var ic=T(H());G();ps();var Pn=T(H());G();Oe();ve();tt();re();re();G();v();var t4=e=>n("svg",{width:44,height:16,viewBox:"0 0 44 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.6665 2H13.9998C17.3135 2 19.9998 4.68629 19.9998 8C19.9998 11.3137 17.3135 14 13.9998 14H8.66651C5.3528 14 2.6665 11.3137 2.6665 8C2.6665 4.68629 5.3528 2 8.6665 2ZM0.666504 8C0.666504 3.58172 4.24823 0 8.6665 0H13.9998C18.4181 0 21.9998 3.58172 21.9998 8C21.9998 12.4183 18.4181 16 13.9998 16H8.66651C4.24823 16 0.666504 12.4183 0.666504 8ZM21.9998 8C21.9998 12.4183 25.5816 16 29.9998 16H35.3332C39.7514 16 43.3332 12.4183 43.3332 8C43.3332 3.58172 39.7514 0 35.3332 0H29.9998C25.5816 0 21.9998 3.58172 21.9998 8ZM29.9998 2H35.3332C38.6469 2 41.3332 4.68629 41.3332 8C41.3332 11.3137 38.6469 14 35.3332 14H29.9998C26.6861 14 23.9998 11.3137 23.9998 8C23.9998 4.68629 26.6861 2 29.9998 2Z",fill:"currentColor"})}),o4=f.withComponent(Y(t4)`
      display: block;
    `),wx=o4;Be();pt();v();function xx({shareMode:e}){let[o,t]=(0,Pn.useState)(!1),{project:r,currentPageId:i,pages:s}=(0,Pn.useContext)(ie),a=(0,Pn.useMemo)(()=>s.find(c=>c._id===i),[i]),l=(0,Pn.useMemo)(()=>{let c=oe.readymag_viewer_host;return r.domain||new URL(c).hostname},[r.domain]),m=()=>{let c=e==="page"?`${a?.num}`:r.num_id,p=RM.common.embedDomainName||window.location.protocol+"//"+l;navigator.clipboard.writeText(`${p}/${c}`),t(!0),ae(ce.SettingsProject,{settingsType:"copy link"}),setTimeout(()=>t(!1),2500)};return w(f,{display:"flex",flexDirection:"column",gap:16,paddingBottom:16,children:[r.is_published?null:n(s4,{}),n(f,{children:n(n4,{icon:n(wx,{}),onClick:m,disabled:!r.is_published,label:o?"Copied":"Copy Link"})})]})}var r4=Y(Ze)`
  &:disabled {
    opacity: initial;
  }
`,i4=Y(Le)`
  opacity: ${e=>e.disabled?"0.4":"initial"};
`;function n4({label:e,icon:o,onClick:t,disabled:r}){return w(r4,{width:88,display:"block",textAlign:"left",onClick:t,disabled:r,children:[n(f,{height:88,display:"flex",borderRadius:6,position:"relative",alignItems:"center",justifyContent:"center",backgroundColor:"white",children:o}),n(i4,{textStyle:"small",marginTop:"8px",color:"black",display:"block",disabled:r,children:e})]})}var s4=()=>n(f,{children:n(yt,{children:n(Le,{textStyle:"small",color:"black",children:"Invite collaborators or share your project openly once published."})})});var or=T(H()),Xp=T(nr());Oe();ve();G();var Di=T(H());G();Oe();ve();Yo();tt();G();ua();var vx=T(ga());ha();var lo={sidebarZindex:7100,sidebarWidth:"240px",popupZindex:9999,moveSpeed:"0.3s"},Tn={projectSettings:1,pageItem:1,footerButtons:2,helpPanel:3};v();function a4({children:e,onExit:o}){return Ko(vx.Key.Escape,o,[o]),w(K,{children:[n(Pr,{zIndex:lo.popupZindex-1,backgroundColor:"#000","data-testid":"export-modal-overlay",onClick:o}),n(f,{display:"flex",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:lo.popupZindex-1,margin:"auto",padding:"16px 24px 28px 24px",borderRadius:"8px",flexDirection:"column",backgroundColor:"lightGray",width:336,height:584,role:"dialog","aria-modal":"true",children:e})]})}var Ps=a4;Zn();re();v();function l4({numId:e,onExit:o,totalPages:t,email:r="your email"}){let[i,s]=(0,Di.useState)(!1),[a,l]=(0,Di.useState)(!1),[m,c]=(0,Di.useState)(""),[p,u]=(0,Di.useState)(!1),[d,g]=(0,Di.useState)(),[h,b]=(0,Di.useState)(!1),[x,y]=(0,Di.useState)(""),S=$=>{let A=[],R=$.split(",").map(Z=>Z.trim());for(let Z of R){if(!/^\d+$/.test(Z)&&!/^\d+-\d+$/.test(Z))return y("Please enter valid numeric values and valid ranges (e.g., 1-5)"),[];if(/^\d+$/.test(Z)){let F=parseInt(Z,10);if(F===0)return y("Pages amount can not be 0"),[];A.push(F)}else if(/^\d+-\d+$/.test(Z)){let[F,V]=Z.split("-").map(W=>parseInt(W,10));for(let W=F;W<=V;W++)A.push(W)}}return Math.max(...A)>t?(y("It\u2019s impossible to export more pages than the project includes"),[]):Array.from(new Set(A))};return w(Ps,{onExit:o,children:[n(I,{as:"div",textStyle:"subheading",marginBottom:24,lineHeight:"30px",children:"Export to PDF"}),i?w(K,{children:[w(I,{as:"div",children:["Your project is being converted.",n("br",{}),"We will send you the download link to ",r," when it\u2019s ready."]}),n(ne,{width:"100%",height:56,marginTop:"auto",variant:"bordered",onClick:o,children:"Done"})]}):w(K,{children:[w("form",{onSubmit:async $=>{if(a)return;$.preventDefault();let A;try{A=p?S(m):void 0}catch(R){g(R);return}try{l(!0),await yg(e,A),l(!1),s(!0),ae(ce.SettingsProject,{settingsType:"export to pdf"})}catch(R){l(!1),b(!0),y(R),setTimeout(()=>{b(!1),y("")},5e3)}},children:[w(f,{display:"flex",children:[n(f,{width:"50%",children:n(Re,{color:p?"gray":"black",onClick:$=>{$.preventDefault(),u(!1),y("")},children:"All pages"})}),n(f,{width:"50%",children:n(vt,{name:"page-range",value:m,placeholder:"or select e.g. 2-8",onChange:$=>{g(void 0),y("");let{value:A}=$.target;u(!!A),c(A),S(A)},onFocus:()=>{u(!!m),g(void 0),S(m)},padding:0,color:p?"black":"gray",css:te`
                    &:focus {
                      border: none;
                    }
                  `})})]}),n(ne,{disabled:h||!!x||a,width:"100%",height:56,marginTop:20,variant:"bordered",children:h||x?"Error":"Create PDF"})]}),!!x&&n(I,{as:"div",textStyle:"small",color:"tomato",marginTop:14,children:x}),d&&n(I,{as:"div",textStyle:"small",color:"tomato",marginTop:14,children:d}),n(I,{as:"div",marginTop:"auto",textStyle:"small",color:"darkGray",children:"Please note: due to license restrictions, all Adobe Fonts or type.today fonts will be replaced with alternatives."})]})]})}var kx=l4;var Ts=T(H());tt();re();Zn();ve();Oe();Yo();G();Mr();v();var Da=Y(f)`
  & + & {
    margin-top: 1.3em;
  }
`;function p4({numId:e,defaultSearchEngineIndexing:o,email:t="your email",onExit:r}){let[i,s]=(0,Ts.useState)(!1),[a,l]=(0,Ts.useState)(""),[m,c]=(0,Ts.useState)(!1),[p,u]=(0,Ts.useState)(!1),[d,g]=(0,Ts.useState)(o);return w(Ps,{onExit:r,children:[n(I,{as:"div",textStyle:"subheading",marginBottom:24,lineHeight:"30px",children:"Export to HTML"}),i?w(K,{children:[w(I,{as:"div",children:["Your project is being converted. We will send you the download link to ",t," when it\u2019s ready."]}),n(ne,{width:"100%",height:56,marginTop:"auto",variant:"bordered",onClick:r,children:"Done"})]}):w(K,{children:[w("form",{onSubmit:async b=>{if(!(p||!a)){b.preventDefault();try{u(!0),ae(ce.SettingsProject,{settingsType:"export to html"}),await _g(e,{origin:a,searchEngineIndexing:d}),s(!0),u(!1)}catch{u(!1),c(!0),setTimeout(()=>c(!1),5e3)}}},children:[n(I,{as:"div",children:"Please provide the full path for your destination webpage. Typekit fonts will only work on the URL specified."}),n(vt,{name:"base-url",placeholder:"domain.com or domain.com/page",value:a,onChange:b=>l(b.target.value),padding:0,marginTop:12,css:te`
                &:focus {
                  border: none;
                }
              `}),n(ne,{disabled:!a||m||p,width:"100%",height:56,marginTop:20,variant:"bordered",children:m?"Error":"Create export"}),w(f,{as:"label",display:"flex",alignItems:"center",marginTop:20,justifyContent:"space-between",children:[n(I,{children:"Search engine indexing"}),n(Ot,{backgroundChecked:"green",checked:d,onChange:g})]})]}),w(I,{as:"div",marginTop:"auto",textStyle:"small",color:"darkGray",children:[n(Da,{children:"Please note:"}),n(Da,{children:"Exported forms will not work with Google Docs or Mailchimp. The URL option will still be available."}),n(Da,{children:"Page-specific sharing settings will not be exported. Sharing settings from the first page will be applied to the whole project."}),n(Da,{children:"Exported projects cannot be password-protected."}),n(Da,{children:n(Re,{textStyle:"small",href:"https://help.readymag.com/hc/en-us/articles/360020647452-Code-export",target:"_blank",rel:"noopener noreferrer",children:"Learn more"})})]})]})]})}var yx=p4;var ti=T(H());tt();G();ve();tp();Oe();dd();Pf();Mr();v();function c4({magUrl:e,projectNumId:o,onIframeEmbedAllowedChange:t,isIframeEmbedAllowed:r=!1,onExit:i}){let[s,a]=(0,ti.useState)("Copy code"),[l,m]=(0,ti.useState)(0),[c,p]=(0,ti.useState)(0),[u,d]=(0,ti.useState)(!1),g=[{title:"Pixels"},{title:"Percentage"}],h=l===0,b=c===0,[x,y]=(0,ti.useState)(640),[S,k]=(0,ti.useState)(480),[P,C]=(0,ti.useState)(100),[B,$]=(0,ti.useState)(100),A=h?`width: ${x}px`:`width: ${P}%`,R=b?`height: ${S}px`:`height: ${B}%`,F=`<iframe src="${u?e:`${e}?link_target=parent`}" style="border: 0; ${A}; ${R};"></iframe>`,V=()=>{navigator.clipboard.writeText(F),a("Copied"),ae(ce.SettingsProject,{settingsType:"export to iframe"}),setTimeout(()=>{a("Copy code")},2500)},W=()=>{t(r?"disallow":"allow",o)},J=h?x:P,me=String(J).length,se=me===4?42:me===5?33.6:56,ee=me===4?1.5:me===5?1.835:1,ue=b?S:B,ke=String(ue).length;return w(Ps,{onExit:i,children:[n(I,{as:"div",textStyle:"subheading",marginBottom:26,lineHeight:"30px",children:"Embed as iframe"}),w(f,{display:"flex",marginBottom:"4px",children:[w(f,{width:144,children:[n(I,{display:"block",children:"Width"}),n(f,{marginLeft:-16,marginTop:"-3px",marginBottom:"1px",width:140,children:n(ba,{items:g,onChange:m,activeIndex:l})}),n(hn,{fontSize:se,value:J,lineHeight:ee,height:66,min:0,max:h?99999:100,maxLength:5,onChange:({value:L})=>h?y(L):C(L)})]}),w(f,{children:[n(I,{display:"block",children:"Height"}),n(f,{marginLeft:-16,marginTop:"-3px",marginBottom:"1px",width:140,children:n(ba,{items:g,onChange:p,activeIndex:c})}),n(hn,{fontSize:ke===4?42:ke===5?33.6:56,value:ue,lineHeight:ke===4?1.5:ke===5?1.835:1,height:66,min:0,max:b?99999:100,maxLength:5,onChange:({value:L})=>b?k(L):$(L)})]})]}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rm",children:[n(I,{fontSize:12,textStyle:"small",color:"black",children:"Open links within the same iframe"}),n(Ot,{checked:u,backgroundChecked:"black",onChange:()=>{d(!u)}})]}),n(Lo,{height:"104px",padding:"12px 15px",fontSize:"12px",fontWeight:"500",lineHeight:"16px",color:"darkGray",backgroundColor:"white",border:"1px solid rgba(64, 64, 64, 0.08)",borderRadius:"8px",rows:5,readOnly:!0,value:F}),n(ne,{variant:"bordered",width:"100%",height:56,marginTop:"2rm",marginBottom:32,onClick:V,children:s}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:15,borderBottom:"2px solid rgba(230, 230, 230)",marginBottom:20,children:[n(I,{fontSize:12,textStyle:"small",color:"black",children:"Allow third-party embeds"}),n(Ot,{checked:r,backgroundChecked:"black",onChange:W})]}),n(I,{fontSize:12,marginBottom:16,textStyle:"small",color:"darkGray",children:"With an iframe, a Readymag project can be inserted into any other web page in a few minutes."}),n(Re,{textStyle:"small",href:"https://help.readymag.com/hc/en-us/articles/4417292690587",target:"_blank",rel:"noopener noreferrer",children:"Learn more"})]})}var _x=c4;Be();ar();wo();pt();_2();v();function Kp(){let e=(0,or.useContext)(ie),o=e.hasPermission("can_export_pdf"),t=e.hasPermission("can_export_code"),r=e.hasPermission("can_use_iframe"),[i,s]=(0,or.useState)(!1),[a,l]=(0,or.useState)(!1),[m,c]=(0,or.useState)(!1),[p,u]=(0,or.useState)(!1),[d,g]=(0,or.useState)(!1),[h,b]=(0,or.useState)(!1),[x,y]=(0,or.useState)(""),S=document.querySelector("body > .popups"),k=e.project,P=e.isSubscriptionPaused(),C=Z=>{let F=oe.readymag_viewer_host;return Z||`${F}/${k.user.uri}/${k.uri}/`},B=async(Z,F,V)=>{let W=C(k.domain);if(V){let J=await Cg("user",V);J.userdomain_data&&J.userdomain_data.status==="on"&&J.userdomain_data.type&&J.userdomain_data.type.toLowerCase()==="user"&&J.userdomain_data.user&&J.userdomain_data.user._id===Z&&J.userdomain_data.mag&&J.userdomain_data.mag.num_id&&J.userdomain_data.mag.num_id===F?y(C(V)):y(W)}else y(W)};(0,or.useEffect)(()=>{B(k.user._id,k.num_id,k.user.domain)},[]);let $=()=>{o?l(!0):st("export-pdf")},A=()=>{t?s(!0):st("export-html")},R=()=>{r?c(!0):st("export-iframe")};return w(f,{display:"flex",flexDirection:"column",gap:16,children:[P&&k.is_published&&n(yt,{children:n(I,{textStyle:"small",color:"black",children:"To activate export and embed options, the subscription has to be active."})}),!k.is_published&&n(yt,{children:n(I,{textStyle:"small",color:"black",children:"To activate export and embed options, the project has to be published."})}),n(ne,{display:"block",disabled:!k.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:P?void 0:$,"data-testid":"export-pdf-button",children:P?n(Re,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:p?"Unpause":"PDF"}):"PDF"}),n(ne,{display:"block",disabled:!k.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:P?void 0:A,"data-testid":"export-html-button",children:P?n(Re,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:d?"Unpause":"HTML"}):"HTML"}),n(ne,{display:"block",disabled:!k.is_published,width:"100%",height:40,variant:"bordered",textStyle:"small",onClick:P?void 0:R,"data-testid":"export-iframe-button",children:P?n(Re,{textStyle:"small",display:"block",color:"inherit",href:"/settings#change-plan",lineHeight:"inherit",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:h?"Unpause":"iframe"}):"iframe"}),i&&S?Xp.default.createPortal(n(yx,{numId:e.project.num_id,email:e.project.user.email,onExit:()=>s(!1),defaultSearchEngineIndexing:e.project.opts.allowindex}),S):null,a&&S?Xp.default.createPortal(n(kx,{numId:e.project.num_id,onExit:()=>l(!1),totalPages:e.pages.length,email:e.project.user.email}),S):null,m&&S?Xp.default.createPortal(n(_x,{magUrl:x,projectNumId:k.num_id,isIframeEmbedAllowed:k.allow_iframe_embed,onIframeEmbedAllowedChange:(Z,F)=>{e.toggleAllowIframeEmbed(Z,F)},onExit:()=>c(!1)}),S):null]})}var oi=T(H());G();ps();ve();Ue();re();var Rt=T(H());jr();tp();G();ve();Mr();var Wo=T(H());var Zp=T(H());Pt();Oe();Ue();G();v();var $a=(0,Zp.memo)(({link:e,margin:o,color:t,borderColor:r})=>{let[i,s]=(0,Zp.useState)("Copy link"),a=()=>{s("Copied"),setTimeout(()=>{s("Copy link")},2500)},l=async m=>{m.preventDefault(),await navigator.clipboard.writeText(e),a()};return w(f,{display:"flex",width:"100%",height:40,margin:o||0,justifyContent:"space-between",children:[n(ne,{width:92,height:40,variant:"bordered",borderColor:r||Ee(.92,O.black),textStyle:"small",color:t||"black",onClick:l,children:i}),n(ne,{boxSizing:"border-box",width:92,height:40,variant:"bordered",borderColor:r||Ee(.92,O.black),as:"a",href:e,target:"_blank",textStyle:"small",color:t||"black",lineHeight:"38px","data-testid":"open-project-by-link",children:"Open"})]})});$a.displayName="OpenAndCopyLink";var ro=T(H()),Cx=T(nr());f_();Yo();G();ve();Ue();re();v();var d4=(e,o,t,r="left")=>({top:Math.abs(e.top-o.top)-t.height/2+o.height/2,left:r==="right"?Math.abs(e.left-o.left)+o.width:Math.abs(e.left-o.left)-t.width}),Sx=e=>{if(e)return e.scrollHeight>e.clientHeight?e:e.parentNode?Sx(e.parentNode):void 0};function m4({link:e,disabled:o,id:t,name:r,placeholder:i,color:s,inactiveColor:a,textStyle:l="regular",withSlash:m,validationMessageContainer:c=document.body,validationMessageAnchor:p,validationMessageZIndex:u,validationMessagePlacement:d="left",validate:g,filter:h,onDone:b,setInputRef:x,...y}){let[S,k]=(0,ro.useState)(e||""),[P,C]=(0,ro.useState)(S),[B,$]=(0,ro.useState)(!1),[A,R]=(0,ro.useState)(),[Z,F]=(0,ro.useState)(),[V,W]=(0,ro.useState)(!1),[J,me]=(0,ro.useState)(!1),se=(0,ro.useCallback)(j=>{j.keyCode===13&&(j.preventDefault(),j.currentTarget.blur())},[]),ee=j=>{let N=h?h(j.currentTarget.value):j.currentTarget.value,de=g(N);W(!1),k(N),R(de)},ue=(0,ro.useCallback)(()=>{$(!1),A?(k(P),R(void 0)):(C(S),b(S))},[S,P,A]),ke=(0,ro.useCallback)(()=>{C(S),$(!0),W(!1)},[S]),ge=(0,ro.useCallback)(j=>{if(p&&c&&j){let N=j.getBoundingClientRect();F(d4(c.getBoundingClientRect(),p.getBoundingClientRect(),N,d))}},[p,c]);(0,ro.useEffect)(()=>{k(e||""),C(e||"")},[e]);let we=(0,ro.useRef)(null),L=(0,ro.useCallback)(()=>W(!0),[]);return(0,ro.useEffect)(()=>{let j=J&&we.current?Sx(we.current):void 0;return j&&(A?j.addEventListener("scroll",L):j.removeEventListener("scroll",L)),()=>{j&&j.removeEventListener("scroll",L)}},[we,J,A]),w(f,{display:"flex",...y,ref:j=>{we.current=j,me(!0)},children:[m&&n(I,{textStyle:l,color:(B||S)&&!o?s||O.black:a||O.gray,children:"/"}),n(vt,{ref:j=>{x&&x(j)},type:"text",id:t,name:r,textStyle:l,color:A?O.red:s||O.black,placeholder:i,spellCheck:!1,autoComplete:"off",autoCorrect:"off",value:S,disabled:o,onKeyDown:se,onChange:ee,onFocus:ke,onBlur:ue,height:"auto",padding:0,textOverflow:"ellipsis",css:te`
          &::placeholder {
            color: ${a||O.gray};
          }
          &:disabled {
            color: ${a||O.gray};
          }
          &:focus {
            border: none;
          }
        `}),B&&A&&c&&!V&&Cx.default.createPortal(n(Kf,{marginLeft:"-4px",visibility:Z?"visible":"hidden",ref:ge,text:A||"",position:"absolute",arrowPosition:d==="right"?{right:"100%",transform:"translateX(4px) rotate(90deg)"}:void 0,top:Z&&Z.top,left:Z&&Z.left,zIndex:10},A),c)]})}var Ms=m4;G();ve();v();var u4=e=>{let o=[{regex:/(_)/gi,replacer:"-"},{regex:/([^a-zA-Z0-9-])/gi,replacer:""},{regex:/(-{2,})/gi,replacer:"-"}],t=e;return o.forEach(r=>{t.match(r.regex)&&(t=t.replace(r.regex,r.replacer))}),t};var g4=(e,o,t)=>{let r=e.toLowerCase();if(/(^-)|(-$)/.test(r))return new Error("The link should not start or end with a hyphen");if(r==="info")return new Error("Sorry, info is not acceptable");if(r&&r.length>128)return new Error("The link should be less than 128 characters long");if(/^[0-9]+$/.test(r)&&r!==o.toString())return new Error("The link should not consist of digits only");if(!t.reduce((i,s)=>i&&r!==s.uri,!0))return new Error("You already have a project with this link")},km=(0,Wo.memo)(({projectNumId:e,publishState:o,projectUri:t,fullProjectLink:r,urlDomainString:i,hideInput:s,loadUserProjectsLinks:a,saveProjectUri:l})=>{let[m,c]=(0,Wo.useState)([]),[p,u]=(0,Wo.useState)(!1);(0,Wo.useEffect)(()=>{p||(u(!0),a().then(x=>{c(x),u(!1)}).finally(()=>{u(!1)}))},[]);let d=(0,Wo.useCallback)(x=>{let y=g4(x,e,m);return y?y.message:void 0},[e,m]),g=(0,Wo.useCallback)(x=>{l(x||e.toString())},[e]),h=(0,Wo.useCallback)(x=>u4(x),[]),b=(0,Wo.useRef)(null);return w(K,{children:[w(f,{width:"100%",marginTop:22,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:[n(I,{as:"label",textStyle:"small",htmlFor:"project-link",color:"black",children:"URL"}),n(f,{marginTop:"2px",children:n(I,{as:"label",textStyle:"small",htmlFor:"project-link",title:i,color:"black",children:`${i}/`})}),n(f,{ref:b,marginBottom:"10px",children:!s&&n(Ms,{validationMessageAnchor:b.current,validationMessageContainer:document.getElementById("settings-popup-container"),textStyle:"regular",name:"project-link",id:"project-link",placeholder:e.toString(),link:t,disabled:p,marginTop:"4px",validate:d,filter:h,onDone:g})})]}),o!=="unpublished"&&n($a,{link:r,margin:"2px 0 0 0"})]})});km.displayName="LinkSettings";var Mt=T(H());G();ve();Mr();Yo();fa();Ue();Yr();Xo();Vh();Fh();$f();Pt();tt();ui();Be();ar();fn();ep();Zn();pt();Vo();var Px="https://st-p.rmcdn.net/a3d0cfe4/dist/bg-JAKY5MEK.jpg";g_();re();v();var Tx=(0,Mt.memo)(({projectNumId:e,isPublished:o,disabled:t,canUseEmailProtection:r,isClosed:i,privacySwitchState:s,privateProjectSwitchState:a,privatePagesSwitchState:l,privateEmailProjectSwitchState:m,setPrivacySwitchState:c,setPrivateProjectSwitchState:p,setPrivatePagesSwitchState:u,setPrivateEmailProjectSwitchState:d,setPrivacy:g,saveBgImage:h,password:b,passwordBackground:x})=>{let y=(0,Mt.useContext)(Te),S=(0,Mt.useContext)(ie),k=Dt("viewer.emailProtection")&&r,[P,C]=(0,Mt.useState)(!1),[B,$]=(0,Mt.useState)(!1),[A,R]=(0,Mt.useState)(()=>b),[Z,F]=(0,Mt.useState)(()=>x),[V,W]=(0,Mt.useState)(l?"pages":k&&m?"email":"project"),J=(0,Mt.useRef)(null),me=(0,Mt.useMemo)(()=>window.RM.constructorRouter.me?.get("magEmailWhitelist")||{allowedEmails:[],allowedDomains:[]},[window.RM.constructorRouter.me]),se=(0,Mt.useMemo)(()=>[...me.allowedEmails,...me.allowedDomains],[me.allowedEmails,me.allowedDomains]),ee=t&&S.isSubscriptionPaused();(0,Mt.useEffect)(()=>{if(i)return;let M=S.pages.some(z=>z.isPrivate);(V==="email"&&se.length===0||(V==="pages"||V==="project")&&!A&&!k||k&&V==="pages"&&!M)&&(c(!1),p(!1),u(!1),d(!1)),y.isPrivatePagesOpened&&y.dispatch({type:"togglePrivatePages"})},[i]),(0,Mt.useEffect)(()=>{if(y.isPrivatePagesOpened||!s)return;let M=S.pages.some(z=>z.isPrivate);V!=="email"&&(!M&&!k&&ge("project"),k&&M&&y.dispatch({type:"togglePrivatePages"}))},[y.isPrivatePagesOpened]);let ue=()=>wl(e).then(M=>Ye.facebookGraphRefresh(M)).catch(M=>console.error(M)),ke=()=>{if(t&&!s){st("project-privacy");return}if(P)return;let M=!s;c(M),y.isPrivatePagesOpened?y.dispatch({type:"togglePrivatePages"}):k&&V==="pages"&&y.dispatch({type:"togglePrivatePages"});let z={};if(M){if(p(!0),W(k?"email":"project"),A&&(z.isPrivate=!0,z.isPrivatePages=!1),k&&(z.isProjectEmailPrivate={isEnabled:!0,...me},se.length===0)){$(!0);return}}else z.isPrivate=!1,z.isPrivatePages=!1,k&&(z.isProjectEmailPrivate={isEnabled:!1,...me});Object.keys(z).length&&(C(!0),g(z).catch(()=>{c(!M)}).finally(()=>{C(!1)})),o&&ue()},ge=M=>{if(P||((M==="pages"||M==="project"&&y.isPrivatePagesOpened||M==="email"&&y.isPrivatePagesOpened)&&y.dispatch({type:"togglePrivatePages"}),V===M))return;let z=M==="project",U=M==="pages",q=M==="email";if(p(z),u(U),d(q),W(M),M==="email"&&se.length===0){$(!0);return}let De={};b&&(De.isPrivate=z,De.isPrivatePages=U),k&&(De.isProjectEmailPrivate={isEnabled:M==="email",...me}),Object.keys(De).length&&(C(!0),g(De).catch(()=>{p(!z),u(!U),d(!q)}).finally(()=>{C(!1)}),o&&ue())},we=M=>{M.keyCode===13&&(M.preventDefault(),M.currentTarget.blur())},L=()=>{if(!s){R(b);return}if(A!==b){C(!0);let M=!b;g({isPrivate:!!A&&a,isPrivatePages:!!A&&l,password:A}).finally(()=>{C(!1),M&&ue()}),A&&ae(ce.SettingsProject,{settingsType:"protect with a password"})}},{callback:j}=ql(L,500),N=M=>{R(ux(mx(M.currentTarget.value))),j()},[de,le]=(0,Mt.useState)(!1),[We,he]=(0,Mt.useState)(!1),[fe,pe]=(0,Mt.useState)(!1),ze=(0,Mt.useCallback)(async M=>{if(he(!1),M.size>oe.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(oe.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!fe){pe(!0);try{let z=await yi("password-bg",M);z&&z.picture&&z.picture.url&&(F(z.picture.url),h(z.picture.url).fail(()=>{F(x)}).always(()=>{pe(!1)}))}catch{pe(!1)}}},[fe]),Ae=M=>{M.preventDefault(),M.stopPropagation(),!fe&&(pe(!0),F(void 0),h("").fail(()=>{F(x)}).always(()=>{pe(!1)}))},Ne=S.pages.some(M=>M.isPrivate),ft=()=>{let M=[];return k?M=[n(I,{textStyle:"small",color:"white",userSelect:"none",children:"Password"},"project"),n(I,{textStyle:"small",color:"white",display:"block",userSelect:"none",children:"Email"},"email")]:M=[Ne?n(I,{textStyle:"small",color:"white",display:"block",userSelect:"none",paddingTop:"1px",children:"Pages"},"pages"):n(I,{textStyle:"small",color:"white",display:"block",userSelect:"none",children:"Selected"},"pages"),n(I,{textStyle:"small",color:"white",userSelect:"none",children:"All pages"},"project")],M};return w(K,{children:[w(f,{display:"flex",width:"100%",height:24,marginBottom:s?void 0:"4px",justifyContent:"space-between","data-testid":"password-protected-switcher",children:[n(I,{textStyle:"small",lineHeight:"24px",color:ee?Ee(.6,O.black):"black",children:k?"Protect project":"Protect with a password"}),ee?n(Co,{width:194,text:"Unpause your subscription to use password protection",boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},href:"https://help.readymag.com/hc/en-us/articles/360049959532-Protect-project-with-a-password"}):n(Ot,{backgroundChecked:"green",checked:s,onChange:ke})]}),t&&s&&n(yt,{margin:"0 0 16px",children:n(I,{textStyle:"small",color:"black",children:"Please note that if you remove the password, you won\u2019t be able to set it back again as your current subscription plan doesn\u2019t support password protection."})}),s&&n(f,{children:n(jf,{width:192,selected:V,values:k?["pages","email"]:["pages","project"],captions:ft(),activeHoverColor:k?O.black:void 0,onChange:M=>{ge(M),B&&$(!1)},margin:"8px 0"})}),s&&w(f,{width:"100%",marginTop:"4px",children:[V==="email"?n(f,{margin:"5px 0 14px",children:B?n(f,{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",padding:"14px 19px",backgroundColor:"white",borderRadius:8,children:w(I,{color:"black",textStyle:"small",children:["First, add trusted emails",n("br",{}),"in"," ",n(Re,{as:"a",color:"tomato",href:"/settings",target:"_blank",css:te`
                          &:hover {
                            opacity: 0.8;
                          }
                        `,children:"Settings"})]})}):w(f,{display:"flex",flexDirection:"column",children:[n(I,{lineHeight:"16px",color:"darkGray",textStyle:"small",children:"Trusted emails"}),se.map((M,z)=>n(I,{lineHeight:"20px",color:"black",children:M},z))]})}):w(f,{display:"flex",justifyContent:"space-between",children:[n(vt,{ref:J,name:"project-password",id:"project-password",type:"text",marginBottom:"4px",color:"black",fontSize:"16px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"Set password",value:A,onKeyDown:we,onChange:N,css:te`
                    &:focus {
                      border: none;
                    }
                    &::placeholder {
                      color: ${O.gray};
                    }
                    &:disabled {
                      color: ${O.gray};
                    }
                  `}),A&&n(f,{display:"flex",width:20,height:22,paddingLeft:"4px",justifyContent:"flex-start",alignItems:"center",children:n($l,{color:"black"})})]}),n(I,{textStyle:"small",children:"Password page background"}),n(f,{width:192,height:125,marginTop:"4px",marginBottom:"8px",position:"relative",opacity:We?.8:1,onDragEnter:()=>{We||he(!0)},onDragLeave:()=>{We&&he(!1)},onMouseEnter:()=>le(!0),onMouseLeave:()=>le(!1),children:n(Tr,{id:"privacy-bg-upload",accept:"image/*",dropFile:!0,readFileData:!1,onChange:ze,children:w(K,{children:[n(f,{width:192,height:125,backgroundColor:"darkGrey",borderRadius:"4px",position:"relative",cursor:"pointer",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:n(f,{display:"flex",width:"100%",height:"100%",borderRadius:"4px",backgroundImage:Z?`url(${Z})`:`url(${Px})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})}),(de||fe)&&!We&&w(f,{display:"flex",width:96,height:32,position:"absolute",left:0,right:0,bottom:9,margin:"auto",justifyContent:"space-around",children:[n(f,{display:"flex",width:32,height:32,justifyContent:"center",alignItems:"center",border:"1px solid rgba(128, 128, 128, 0.16)",borderRadius:"50%",backgroundColor:"white",cursor:fe?"default":"pointer",css:te`
                          &:hover {
                            & svg {
                              color: ${O.red};
                            }
                          }
                          &:active {
                            background-color: ${O.red};
                            & svg {
                              color: ${O.white};
                            }
                          }
                          animation: ${fe?"loadingindicatoranimation":"none"} 2s infinite linear;
                          @keyframes loadingindicatoranimation {
                            from {
                              transform: rotateZ(0deg);
                            }
                            to {
                              transform: rotateZ(360deg);
                            }
                          }
                        `,children:n(Ll,{color:"black"})}),Z&&!fe&&n(mt,{height:32,width:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onClick:Ae,css:te`
                            &:hover {
                              & svg {
                                color: ${O.red};
                              }
                            }
                            &:active {
                              background-color: ${O.red};
                              & svg {
                                color: ${O.white};
                              }
                            }
                          `,children:n(Ht,{color:"black"})})]})]})})})]})]})});var Jp=T(H());G();ve();Mr();v();var ym=(0,Jp.memo)(({projectHidden:e,profileUrl:o,saveProjectOptions:t})=>{let[r,i]=(0,Jp.useState)(()=>e);return n(K,{children:w(f,{display:"flex",width:"100%",minHeight:24,marginBottom:"4px",justifyContent:"space-between",alignItems:"center",children:[w(I,{textStyle:"small",color:"black",children:["Add to my"," ",n(Re,{href:o,target:"_blank",textStyle:"small",children:"Public Profile"})]}),n(Ot,{backgroundChecked:"green",checked:!r,onChange:()=>{let a=!r;i(a),t({hidden:a})}})]})})});ym.displayName="VisibilitySettings";Be();pt();v();function Mx({isActive:e}){let o=(0,Rt.useContext)(Te),t=(0,Rt.useContext)(ie),[r,i]=(0,Rt.useState)(()=>t.project.title||""),[s,a]=(0,Rt.useState)(!1),[l,m]=(0,Rt.useState)(()=>t.project.description||""),[c,p]=(0,Rt.useState)(!1);(0,Rt.useEffect)(()=>{s||i(t.project.title||"")},[t.project.title]);let u=()=>{a(!1);let W=hm(r," ").trim();i(W),t.projectSave({title:W},{patch:!0})};(0,Rt.useEffect)(()=>{c||m(t.project.description||"")},[t.project.description]);let d=()=>{p(!1);let W=l.trim();m(W),t.projectSave({description:W},{patch:!0})},g=()=>t.loadUserProjectsLinks(t.project.user._id),h=(0,Rt.useMemo)(()=>Yp(t.project),[t.project.domain,t.project.user.domain,t.project.user.uri]),b=(0,Rt.useMemo)(()=>dx(t.project.user),[t.project.user]),x=(0,Rt.useMemo)(()=>`${oe.readymag_viewer_host}/${t.project.user.uri}/${t.project.num_id}/`,[t.project.num_id,t.project.user.uri]),y=(0,Rt.useCallback)(W=>{W!==t.project.uri&&t.projectSave({uri:W},{patch:!0})},[]),[S,k]=(0,Rt.useState)(()=>t.project.is_private||t.project.isPrivatePages||!!t.project.isProjectEmailPrivate?.isEnabled),[P,C]=(0,Rt.useState)(()=>t.project.is_private),[B,$]=(0,Rt.useState)(()=>t.project.isPrivatePages),[A,R]=(0,Rt.useState)(()=>!!t.project.isProjectEmailPrivate?.isEnabled),Z=(0,Rt.useCallback)(W=>t.projectSave({pass_bg:W},{patch:!0}),[]),F=(0,Rt.useMemo)(()=>ur(t.project),[t.project.is_published,t.project.changed]),V=()=>{o.dispatch({type:"toggleExportAsTemlate"})};return w(f,{marginTop:"10px",paddingBottom:16,children:[n(I,{as:"label",textStyle:"small",htmlFor:"project-title-in-settings",children:"Title"}),n(eo,{children:({ref:W})=>n(f,{width:"100%",maxHeight:160,marginTop:"4px",ref:W,children:n(Lo,{name:"project-title-in-settings",placeholder:"Give your project name",translate:"no",spellCheck:!1,maxLength:128,rows:1,autoSize:!0,textStyle:"regular",color:"black",value:r,onChange:J=>{i(hm(String(J.currentTarget.value)))},onFocus:()=>{a(!0)},onBlur:u})})}),n(f,{marginTop:22,children:n(I,{as:"label",textStyle:"small",htmlFor:"project-description",children:"Description"})}),n(eo,{children:({ref:W})=>n(f,{width:"100%",marginTop:"4px",ref:W,children:n(Lo,{name:"project-description",placeholder:"What's it about...",translate:"no",spellCheck:!1,maxLength:6e3,rows:1,autoSize:!0,textStyle:"regular",color:"black",value:l,onChange:J=>{m(J.currentTarget.value)},onFocus:()=>{p(!0)},onBlur:d})})}),n(km,{projectNumId:t.project.num_id,publishState:F,projectUri:t.project.uri,fullProjectLink:x,urlDomainString:h,hideInput:!!t.project.domain,loadUserProjectsLinks:g,saveProjectUri:y}),w(f,{display:"flex",width:"100%",marginTop:t.project.is_published?24:"4px",flexDirection:"column",children:[n(Tx,{projectNumId:t.project.num_id,isPublished:t.project.is_published,privacySwitchState:S,privateProjectSwitchState:P,privatePagesSwitchState:B,privateEmailProjectSwitchState:A,setPrivacySwitchState:k,setPrivateProjectSwitchState:C,setPrivatePagesSwitchState:$,setPrivateEmailProjectSwitchState:R,disabled:!t.project.user?.permissions.can_make_mag_private,canUseEmailProtection:!!t.project.user?.permissions.can_make_mag_private_by_email,isClosed:!e,setPrivacy:t.setPrivacy,saveBgImage:Z,password:t.project.pass,passwordBackground:t.project.pass_bg,ownerEmail:t.project.user.email}),!S&&n(ym,{projectHidden:t.project.opts.hidden,profileUrl:b,saveProjectOptions:t.setProjectOptions})]}),t.project.user.permissions.can_export_template&&w(K,{children:[w(f,{display:"flex",width:"100%",height:24,justifyContent:"space-between",children:[n(I,{textStyle:"small",lineHeight:"24px",children:"Export as template"}),n(Ot,{backgroundChecked:"green",checked:o.exportAsTemlate,onChange:V})]}),o.exportAsTemlate&&w(f,{display:"flex",width:"100%",height:24,marginTop:4,justifyContent:"space-between",children:[n(I,{textStyle:"small",lineHeight:"24px",children:"Don't Renew Screenshots"}),n(Ot,{backgroundChecked:"green",checked:o.dontRenewScreenshots,onChange:()=>{o.dispatch({type:"toggleDontRenewScreenshots"})}})]})]})]})}var Bx=T(H());Oe();ve();G();Be();v();function Ix({showUpgradeAlert:e,onOpenCodeEditorClick:o}){let r=(0,Bx.useContext)(ie).isSubscriptionPaused();return w(f,{paddingBottom:16,children:[n(ne,{width:"100%",height:40,marginTop:"5px",marginBottom:16,variant:"bordered",textStyle:"small",onClick:o,children:"Open Code Editor"}),e&&w(yt,{children:[w(I,{textStyle:"small",color:"tomato",children:["Injected code works",n("br",{}),"for Preview only!"]}),n("br",{}),n("br",{}),r?w(I,{textStyle:"small",color:"black",children:[n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"Unpause"})," ","your subscription to have it work in Published project."]}):w(I,{textStyle:"small",color:"black",children:[n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"Upgrade"})," ","to have it work",n("br",{}),"in Published project."]})]})]})}var xo=T(H());ve();G();var oc=T(H());Yo();Oe();Ue();ve();re();tt();var $i=T(H());Be();jc();var Qp=({domainForChecking:e,isMapedDomain:o=!1,domainSource:t="other"})=>{let r=(0,$i.useContext)(ie),[i,s]=(0,$i.useState)(e),[a,l]=(0,$i.useState)(t),[m,c]=(0,$i.useState)(),[p,u]=(0,$i.useState)(!1),[d,g]=(0,$i.useState)(!1),h=(y,S,k)=>{p&&u(!1),c({errorType:y,dnsError:S,domainData:k})};return{testingDomain:i,domainError:m,domainCheckSuccess:p,isProcessingTest:d,setTestingDomain:s,setTestingDomainSource:l,checkDomain:(y,S)=>{let k=y||i,P=S||a;if(!(!k||d)){if(/:|@|\\|\//.test(k)){h("invalid");return}g(!0),r.checkDomain(k,P).then(C=>{if(!C){h("server-error"),g(!1);return}if(C.errors.notPublished){h("unpublished"),g(!1);return}if(C.errors.noValidSubscription){h("subscription-expired"),g(!1);return}if(C.errors.subscriptionPaused){h("subscription-paused"),g(!1);return}if(!o&&C.errors.badDomainName){h("invalid"),g(!1);return}if(C.errors.setupButNeedMoreTime){h("setup-but-need-more-time"),g(!1);return}if(o){if(C.errors.badDNSSettings){let B=gm(C.dnsSettings);h("domain-set-dns-error",{domainName:k,recordType:B.recordType,currentValue:B.currentValue,neededValue:B.neededValue,domain:B.domain,subdomain:B.subdomain}),g(!1);return}}else{if(C.errors.badDNSSettings||C.errors.ipv6Present||C.errors.invalidOwner){let J=gm(C.dnsSettings),me=()=>{h("test-dns-error",{domainName:k,recordType:J.recordType,currentValue:J.currentValue,neededValue:J.neededValue,badDNSSettings:!!C.errors.badDNSSettings,ipv6Present:!!C.errors.ipv6Present,invalidOwner:!!C.errors.invalidOwner,ownerKey:C.dnsSettings.ownerKey,domain:J.domain,subdomain:J.subdomain,unsetedCaaRecords:C.dnsSettings.caaRecords?C.dnsSettings.unsetedCaaRecords:[]})};gi.get(`https://${k}/api/domainmaptest`).then(se=>{se&&se.domainOk?me():h("wait-our-dns-server")}).catch(()=>me()).finally(()=>{g(!1)});return}let B=C.domain_data||{},$=B.mag||{},A=B.user||$.user||{},R=A.name||"UNKNOWN",Z="/"+(A.uri||"UNKNOWN")+"/",F=Z+($.uri||"UNKNOWN")+"/",V=$.title||F,W=(C.domain_data||{}).type;if(C.errors.domainUsed){C.errors.usedByOtherUser?h("test-other-user",void 0,{userName:R,userUrl:Z}):h("test-same-user",void 0,{magName:V,magUrl:F,entityType:B.type,userName:R,userUrl:Z,domainType:W}),g(!1);return}}if(C.errors.domainNotFound){h("notfound"),g(!1);return}g(!1),c(void 0),u(!0)}).catch(()=>{h("server-error"),g(!1)})}},showDomainError:h,hideDomainError:()=>{c(void 0)},setDomainCheckSuccess:u}};Be();Zn();Vo();ve();pt();G();re();Lh();var _m=T(H());ao();v();var f4="https://www.youtube.com/watch?v=rOisaXwqbyk",b4="https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain-to-a-project",w4=Y("ol")`
  margin: 6px 0 -8px 17px;
  list-style: decimal;
  font-size: 12px;
`,ec=Y("li")`
  padding: 4px 0;
  list-style: decimal;
`,x4=f.withComponent(Y("div")`
  position: absolute;
  right: 45px;
  opacity: 1;
  &:hover {
    svg {
      color: ${e=>e.theme.colors.darkGray};
    }
  }
  &:active {
    svg {
      color: ${e=>e.theme.colors.black};
    }
  }
`);function tc({domainError:e,m:o,showUnmap:t,mapDomain:r,unmapDomain:i}){let s=e?e.dnsError:void 0,a=e?e.domainData:void 0,[l,m]=(0,_m.useState)(!1),[c,p]=(0,_m.useState)(!1),u=s?.neededValue?.replace(/\.$/,"")??"",d=y=>{if(y)try{navigator.clipboard.writeText(y)}catch{console.error("Could not copy to clipboard.")}},g=(y,S)=>{let k=()=>{y==="domain"?(d(u),m(!0),p(!1)):(d(s?.ownerKey),p(!0),m(!1))},P=()=>{setTimeout(()=>{m(!1),p(!1)},200)};return n(dt,{enterDelay:150,text:l||c?"Copied":"Copy",indent:10,placement:"top-end",componentsProps:{tooltip:{left:5,width:40},arrow:{left:"-4px !important"}},children:n(x4,{title:"Copy","data-testid":`domain-copy-button-${y}`,children:n(Dl,{width:14,height:14,color:S?"darkGray":"gray",cursor:"pointer",onMouseLeave:P,onMouseDown:k})})})},h=()=>s?n(K,{children:w(I,{textStyle:"small",color:"black",children:["This domain\u2019s ",s.recordType?s.recordType:""," ",s.currentValue==="UNKNOWN"?"is not currently set":"is currently set to"," ",s.currentValue!=="UNKNOWN"?s.currentValue:"",". Please change your"," ",s.recordType?s.recordType:""," to"," ",n(I,{textStyle:"small",color:"darkGray",fontFamily:"monospace",children:s.neededValue?s.neededValue:""})," ","at your registrar settings."," "]})}):null,b=()=>s?w(K,{children:[n(I,{textStyle:"small",color:"black",children:"Go to your domain registrar\u2019s website. Open\xA0DNS settings and:"}),w(w4,{children:[s.badDNSSettings&&s.recordType&&w(ec,{children:[n(I,{textStyle:"small",color:"black",children:"Add an A-record:"}),n("br",{}),w(I,{textStyle:"small",color:"black",children:["Hostname = ",s.subdomain??"@"]}),n("br",{}),w(f,{display:"flex",children:[n(f,{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"125px",children:w(I,{textStyle:"small",color:"black",children:["Value ="," ",n(I,{textStyle:"small",color:"tomato","data-testid":"domain-value",children:u})]})}),g("domain",l)]})]},"dnsError"),w(K,{children:[s.invalidOwner&&w(ec,{children:[w(I,{textStyle:"small",color:"black",children:["Confirm domain ownership by adding a\xA0TXT-record:",n("br",{})]}),n(I,{textStyle:"small",color:"black",children:"Hostname = @"}),n("br",{}),w(f,{display:"flex",children:[n(f,{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"125px",children:w(I,{textStyle:"small",color:"black",children:["Value ="," ",n(I,{textStyle:"small",color:"tomato","data-testid":"domain-ownerkey",children:s.ownerKey})]})}),g("key",c)]}),n("br",{}),s.subdomain&&n(I,{textStyle:"small",color:"black",children:"This record should be added to your root domain."})]},"invalidOwner"),s.badDNSSettings&&s.unsetedCaaRecords?.length?n(ec,{children:w(I,{textStyle:"small",color:"black",children:["Looks like your DNS settings are missing some"," ",n(Re,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL",target:"_blank",textStyle:"small",color:"tomato",children:"CAA records"}),". Add these or leave it up to your techies:",n("br",{}),w(I,{textStyle:"small",color:"darkGray",fontFamily:"monospace",children:[s.unsetedCaaRecords.join(", "),"."]})]})},"dnsCaaError"):null]}),s.ipv6Present&&w(ec,{children:[w(I,{textStyle:"small",color:"black",children:["Remove the AAAA-record from your DNS settings to"," "]}),n(Re,{href:"https://help.readymag.com/hc/en-us/articles/360020588592-Domain-mapping",target:"_blank",textStyle:"small",color:"tomato",children:"disable iPv6"}),"."]},"ipv6Present")]}),n(I,{textStyle:"small",color:"black",children:"Changes may take a few minutes to 72 hours to work. We\u2019ll notify you by email when you can map your domain."})]}):null;return e?w(yt,{margin:o||"0 0 14px",padding:"16px 23px 16px 14px","data-testid":"domain-error-message",textAlign:"left",children:[(()=>{if(!e)return null;switch(e.errorType){case"server-error":return w(I,{textStyle:"small",color:"black",children:["Oops! It\u2019s not you, it\u2019s an internal server error.",n("br",{}),"Please click the \u2018Test\u2019 button again."]});case"unpublished":return w(I,{textStyle:"small",color:"black",children:["You can","'","t use custom domain mapping on unpublished project. Please, publish it first."]});case"subscription-expired":return w(K,{children:[w(I,{textStyle:"small",color:"black",children:["Please"," ",n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",color:"tomato",children:"upgrade"})," ","to access custom domain mapping."]}),n(Re,{href:`${oe.readymag_host}/pricing/`,target:"_blank",textStyle:"small",color:"tomato",children:"See the pricing"})]});case"subscription-paused":return n(K,{children:w(I,{textStyle:"small",color:"black",children:["Please"," ",n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",color:"tomato",children:"unpause"})," ","your subscription to access custom domain mapping."]})});case"invalid":return w(K,{children:[w(I,{textStyle:"small",color:"black",children:["Domain name should not contain non-alphanumeric characters. No directories are allowed.",n("br",{}),n("br",{}),"Examples:"]}),n("br",{}),w(I,{textStyle:"small",color:"gray",children:["mydomain.com",n("br",{}),"www.mydomain.com",n("br",{}),"readymag.mydomain.com"]})]});case"notfound":return n(I,{textStyle:"small",color:"black",children:"We can\u2019t find the info for this domain. Please check the name again. Note that it may take up to a few hours for a subdomain to get created."});case"setup-but-need-more-time":return n(f,{textAlign:"center",children:n(I,{textStyle:"small",color:"black",children:w(K,{children:["Your domain is being registered. It might take up to 48 hours. You","'","ll receive an email when",n("br",{}),"it","'","s ready to be connected to your Readymag project"]})})});case"wait-our-dns-server":return w(I,{textStyle:"small",color:"black",children:["Your domain settings are correct; It seems that our DNS servers haven","'","t updated yet, though.",n("br",{}),"It may take up to 72 hrs.",n("br",{}),"Please try again later."]});case"test-dns-error":return n(K,{children:b()});case"test-other-user":return w(I,{textStyle:"small",color:"black",children:["This domain is already used by"," ",n(Re,{href:a&&a.userUrl?a.userUrl:"#",target:"_blank",textStyle:"small",color:"tomato",children:a&&a.userName?a.userName:"other user"}),"."]});case"test-same-user":return w(I,{textStyle:"small",color:"black",children:["This domain is already mapped to"," ",n(Re,{href:a?a.domainType==="User"?a.userUrl:a.magUrl:"#",target:"_blank",textStyle:"small",color:"tomato",children:a?a.domainType==="User"?a.userName:a.magName:"unknown"}),".",n("br",{}),n(Re,{textStyle:"small",color:"tomato",onClick:()=>r&&r(),children:"Switch it to current project"})]});case"domain-set-dns-error":return w(K,{children:[n(I,{textStyle:"small",color:"black",children:"Seems like your DNS settings have been changed."})," ",h()]});case"domain-set-try-later":return w(I,{textStyle:"small",color:"black",children:["Seems that some of the DNS servers haven","'","t updated yet.",n("br",{}),"It may take 72 hrs.",n("br",{}),"Please try again later."]});default:return null}})(),t&&i&&w(K,{children:[n(I,{textStyle:"small",color:"black",children:"or"})," ",n(Re,{textStyle:"small",color:"tomato",onClick:()=>i(),children:"Unmap"})]}),(e.errorType==="test-dns-error"||e.errorType==="domain-set-dns-error"||e.errorType==="domain-set-try-later")&&w(f,{marginTop:"12px",display:"flex",flexDirection:"column",gap:"12px",children:[n(Re,{href:f4,target:"_blank",textStyle:"small",color:"darkGrey",children:"Short video guide"}),n(Re,{href:b4,target:"_blank",textStyle:"small",color:"darkGrey",children:"Step-by-step guide"})]})]}):null}re();Oe();G();ve();pa();tt();var La=T(H());Ig();var v4=()=>!!window?.entri;async function k4(){return new Promise((e,o)=>{if(v4())return e();let t=document.getElementsByTagName("script")[0],r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://cdn.goentri.com/entri.js",r.onload=()=>e(),r.onerror=()=>o(),t?.parentNode?.insertBefore(r,t)})}function Ex({onClose:e}={}){let[o,t]=(0,La.useState)(!1),[r,i]=(0,La.useState)(null);(0,La.useEffect)(()=>{if(!e)return;let a=({detail:l})=>e(l);return window.addEventListener("onEntriClose",a,!1),()=>{window.removeEventListener("onEntriClose",a,!1)}},[]);async function s(){try{t(!0);let[a]=await Promise.all([Bg(),k4()]);window?.entri?.purchaseDomain(a)}catch(a){i(a)}finally{t(!1)}}return{loading:o,error:r,onShow:s}}v();function Rx({onResellerDomainPurchase:e}){let{user:o,setUserMetrics:t}=Cs();function r(m){if(!m.success)return;e(m.domain);let c=o?.behavior_metrics?.entri_purchase_amount;t({entri_purchase_amount:c?c+1:1})}let{loading:i,onShow:s}=Ex({onClose:r});function a(){ae("settingsProject",{settingsType:"domain ionos integration click"}),s()}function l(){ae("settingsProject",{settingsType:"domain xyz integration click"})}return w(f,{display:"flex",flexDirection:"column",borderBottom:"2px solid",borderColor:Me("#B8B8B8",.24),justifyContent:"space-between",gap:"4rm",paddingBottom:"4rm",alignItems:"flex-start",children:[n(Ze,{textStyle:"small",width:"100%",onClick:a,disabled:i,children:n(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:i?n(Le,{textStyle:"small",color:"inherit",marginTop:"1rm",marginBottom:"1rm",children:"Loading..."}):w(K,{children:[o?.domainDiscountIsAvailable?"Buy a domain with $12 off":"Buy a domain",n(Do,{color:"gray",transform:"rotate(-90deg)"})]})})}),w(Re,{href:"https://help.readymag.com/hc/en-us/articles/4405321039259",onClick:l,target:"_blank",textStyle:"small",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",children:["Get a free .XYZ domain",n(Do,{color:"gray",transform:"rotate(-90deg)"})]})]})}v();function Ax(){let e=(0,oc.useContext)(ie),o=e.project.last_checked_domain||"",t=e.project.last_checked_domain_source,{testingDomain:r,domainError:i,domainCheckSuccess:s,isProcessingTest:a,setTestingDomain:l,setTestingDomainSource:m,checkDomain:c,showDomainError:p,hideDomainError:u,setDomainCheckSuccess:d}=Qp({domainForChecking:o,domainSource:t}),[g,h]=(0,oc.useState)(!1),b=k=>{i&&u(),s&&d(!1);let P=qp(k.currentTarget.value),B=P===o&&t?t:"other";l(P),m(B)},x=k=>{k.keyCode===13&&(k.preventDefault(),k.currentTarget.blur(),c())},y=()=>{!r||g||(h(!0),i&&u(),e.mapDomain(r).then(async()=>{wl(e.project.num_id).then(k=>Ye.facebookGraphRefresh(k)).catch(k=>console.error(k)),ae(ce.SettingsProject,{settingsType:"map domain"})}).catch(k=>{k&&k.badDomainName?p("domain-set-try-later"):p("server-error")}).finally(()=>{h(!1)}))},S=k=>{let P=qp(k);l(qp(P)),m("reseller"),u(),d(!1),c(P,"reseller"),ae("settingsProject",{settingsType:"domain name purchased",domainProvider:"ionos"})};return w(K,{children:[n(I,{as:"label",textStyle:"small",htmlFor:"project-domain",children:"Enter registered domain name"}),n(vt,{name:"project-domain",id:"project-domain",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"yourdomainname.com","data-testid":"test-domain-input",value:r,onKeyDown:x,onChange:b,css:te`
          &:focus {
            border: none;
          }
          &::placeholder {
            color: ${O.gray};
          }
          &:disabled {
            color: ${O.gray};
          }
        `}),n(ne,{width:"100%",height:40,marginTop:"2px",marginBottom:14,variant:"bordered",textStyle:"small",disabled:!r||a||g,onClick:s?y:()=>c(),"data-testid":s?"map-domain-button":"test-domain-button",children:s?g?"Connecting":"Connect":a?"Testing...":"Test"}),n(tc,{domainError:i,onHideError:u,mapDomain:y}),s&&n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"green",children:["Your domain is pointing to Readymag",n("br",{}),"and can be connected with this project \u2014 click ",n("br",{})," Connect button."]})}),n(Rx,{onResellerDomainPurchase:S})]})}var zr=T(H());G();Br();Yo();Oe();ve();re();Be();fn();v();function Dx({isVisitingDomain:e,visitError:o,showVisitError:t}){let r=(0,zr.useContext)(ie),{domainError:i,domainCheckSuccess:s,isProcessingTest:a,checkDomain:l,hideDomainError:m}=Qp({domainForChecking:r.project.domain||"",isMapedDomain:!0});(0,zr.useEffect)(()=>{l()},[]);let c=(0,zr.useMemo)(()=>!!r.project.domain&&i&&(i.errorType==="domain-set-dns-error"||i.errorType==="notfound"||i.errorType==="subscription-expired"),[r.project.domain,i]),[p,u]=(0,zr.useState)(!1),[d,g]=(0,zr.useState)(!1),[h,b]=(0,zr.useState)(!1),x=()=>{u(!0),h&&b(!1)},y=()=>{u(!1)},S=()=>{g(!0),o&&t(!1),r.unmapDomain().catch(()=>{b(!0)}).finally(()=>{g(!1)})};return n(K,{children:a?n(f,{display:"flex",justifyContent:"center",children:n(Xt,{bgColor:"transparent",color:"black"})}):i&&!s?n(tc,{domainError:i,onHideError:m,showUnmap:c,unmapDomain:S}):w(K,{children:[n(I,{as:"label",textStyle:"small",htmlFor:"project-mapped-domain",color:"black",children:"Name"}),n(vt,{id:"project-mapped-domain",type:"text",spellCheck:!1,autoCorrect:"off",defaultValue:r.project.domain,marginTop:"4px","data-testid":"mapped-domain",readOnly:!0,css:te`
              padding: 0;
              &:focus {
                border: none;
              }
            `}),p?w(f,{display:"flex",width:"100%",height:40,marginTop:12,marginBottom:16,justifyContent:"space-between",alignItems:"center",children:[n(ne,{width:90,height:38,variant:"bordered",textStyle:"small",lineHeight:"38px",background:"white",onClick:S,"data-testid":"unmap-domain",children:"Unmap"}),n(ne,{width:90,height:38,variant:"bordered",textStyle:"small",lineHeight:"38px",background:"white",onClick:y,children:"Cancel"})]}):n(ne,{width:"100%",height:40,marginTop:12,marginBottom:16,variant:"bordered",textStyle:"small",disabled:!r.project.domain||d,onClick:x,"data-testid":"open-unmap-dialog",children:d?"Unmaping":"Unmap"}),h&&n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"black",children:["Something went wrong.",n("br",{}),"Please try again later."]})}),e&&n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"black",children:[n(Re,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL",target:"_blank",textStyle:"small",isActive:!0,children:"Your SSL certificate"})," ","is being issued. It may take a few minutes, but feel free ",n("br",{}),"to keep working\u2014it","'","s a background process!"]})}),o&&n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"black",children:["Your SSL certificate hasn\u2019t been installed, but the problem is on our end.",n("br",{}),n(Re,{href:`//${r.project.domain}`,target:"_blank",textStyle:"small",isActive:!0,children:"Just open your website"})," ","so that we can try to enable the certificate again."]})}),w(f,{display:"flex",width:"100%",height:24,marginBottom:16,justifyContent:"space-between",children:[n(I,{textStyle:"small",lineHeight:"24px",color:"black",children:"SSL is enabled"}),n(Co,{href:"https://help.readymag.com/hc/en-us/articles/4403970242331-SSL"})]})]})})}var Cm=T(H());G();fn();Ue();Yo();ve();re();v();function $x({ga:e,gtm:o,canUseGtm:t,saveProjectOptions:r}){let[i,s]=(0,Cm.useState)(()=>e||""),[a,l]=(0,Cm.useState)(()=>o||""),m=d=>{s(d.currentTarget.value.trim())},c=()=>{i!==e&&r({ga_id:i})},p=d=>{t&&l(d.currentTarget.value.trim())},u=()=>{a!==o&&t&&r({gtm_id:a})};return w(K,{children:[w(f,{width:"100%",marginTop:"4px",children:[n(I,{as:"label",textStyle:"small",htmlFor:"google-analytics",children:"Google Analytics"}),w(f,{display:"flex",width:"100%",justifyContent:"space-between",css:te`
            &:hover {
              & .help-link {
                opacity: 1;
              }
            }
          `,children:[n(vt,{name:"google-analytics",id:"google-analytics",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"GA-XXXXXX",value:i,onChange:m,onBlur:c,css:te`
              &:focus {
                border: none;
              }
              &::placeholder {
                color: ${O.gray};
              }
              &:disabled {
                color: ${O.gray};
              }
            `}),n(Co,{text:"Set a Google Analytics ID to send data to your GA account",href:"https://help.readymag.com/hc/en-us/articles/360020844511-Google-Analytics",width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4}})]})]}),w(f,{width:"100%",marginTop:"4px",children:[n(I,{as:"label",textStyle:"small",htmlFor:"google-tag-manager",children:"Google Tag Manager"}),w(f,{display:"flex",width:"100%",justifyContent:"space-between",css:te`
            &:hover {
              & .help-link {
                opacity: 1;
              }
            }
          `,children:[n(vt,{name:"google-tag-manager",id:"google-tag-manager",type:"text",marginTop:"4px",spellCheck:!1,autoComplete:"off",autoCorrect:"off",placeholder:"GTM-XXXXXX",value:a,onChange:p,onBlur:u,disabled:!t,css:te`
              &:focus {
                border: none;
              }
              &::placeholder {
                color: ${O.gray};
              }
              &:disabled {
                color: ${O.gray};
              }
            `}),n(Co,{text:"Set a Google Tag\xA0Manager\xA0ID",href:"https://help.readymag.com/hc/en-us/articles/360025544812-Google-Tag-Manager",width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},whiteSpace:"nowrap"})]})]})]})}Be();Ig();pt();var rc=T(H());ve();Ue();Mr();G();tt();Pt();fn();v();function Lx({defaultValue:e,permissions:o,projectDomain:t,userDomain:r,setProjectOptions:i}){let[s,a]=(0,rc.useState)(()=>e),l=(0,rc.useMemo)(()=>!!(t||r)||o.allow_index,[o.allow_index,t,r]),m=()=>{if(!l)return;let p=!s;a(p),i({allowindex:p}),p&&ae(ce.SettingsProject,{settingsType:"make searchable"})},c=!l;return w(f,{display:"flex",width:"100%",justifyContent:"space-between",children:[n(I,{textStyle:"small",lineHeight:"24px",color:c?Ee(.6,O.black):"black",children:"Search engine indexing"}),c?n(Co,{width:194,text:"\u041Cap domain to make your project visible for search engines",boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},href:"https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain","data-testid":"map-domain-helptip"}):n(Ot,{backgroundChecked:"green",checked:s,onChange:m,disabled:c,"data-testid":"make-searchable-checkbox"})]})}var Li=T(H());G();ve();Yr();fa();Uh();Ue();re();Pt();Be();ep();pt();fn();Uc();v();function y4({domain:e}){let o=(0,Li.useContext)(ie),[t,r]=(0,Li.useState)(!1),i=(0,Li.useMemo)(()=>o.project.opts.favicon,[o.project.opts.favicon]),s=(0,Li.useCallback)(async l=>{if(l.size>oe.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(oe.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!t){r(!0);try{let m=await yi("favicon",l);m&&m.baseUrl&&(await o.setProjectOptions({favicon:m.baseUrl}),r(!1))}catch{r(!1)}}},[t]),a=async()=>{i&&await o.setProjectOptions({favicon:""})};return w(f,{display:"flex",width:"100%",height:24,marginBottom:16,marginTop:10,justifyContent:"space-between",children:[n(I,{textStyle:"small",lineHeight:"24px",color:e?"black":Ee(.6,O.black),children:"Favicon"}),!e&&n(Co,{width:194,boxPosition:{marginLeft:"-169px"},arrowPosition:{left:"auto",right:4},text:"Map domain to add favicon to your project",href:"https://help.readymag.com/hc/en-us/articles/360038720292-Adding-a-favicon"}),e&&w(K,{children:[i&&n(f,{display:"flex",width:24,height:24,borderRadius:"50%",justifyContent:"center",alignItems:"center",border:"1px solid rgba(64, 64, 64, 0.08)",cursor:"pointer",backgroundImage:`${o.project.opts.favicon?`url(${jn(o.project.opts.favicon,57)})`:"none"}`,backgroundSize:"contain",backgroundPosition:"center",css:te`
                & svg {
                  opacity: 0;
                }
                &:hover {
                  background-image: none;
                  & > div {
                    opacity: 1;
                  }
                  & svg {
                    color: ${O.red};
                    opacity: 1;
                  }
                }
              `,onClick:a,children:n(Ht,{color:"black"})}),!i&&n(Tr,{id:"favicon-upload",accept:"image/*",dropFile:!1,readFileData:!1,onChange:s,children:n(f,{display:"flex",width:24,height:24,borderRadius:"50%",justifyContent:"center",alignItems:"center",border:"1px solid rgba(64, 64, 64, 0.08)",cursor:"pointer",css:te`
                  &:hover {
                    & svg {
                      color: ${O.red};
                    }
                  }
                `,children:n(la,{color:"black"})})})]})]})}var Hx=y4;pa();v();function Ox(){let e=(0,xo.useContext)(ie),o=(0,xo.useMemo)(()=>!!e.project.domain,[e.project.domain]),t=(0,xo.useMemo)(()=>!!e.project.user.permissions.can_map_domain,[e.project.user.permissions.can_map_domain]),r=(0,xo.useMemo)(()=>e.project.is_published,[e.project.is_published]),i=(0,xo.useMemo)(()=>e.project.user.permissions.domain_limit,[e.project.user.permissions.domain_limit]),s=(0,xo.useMemo)(()=>e.me.plan?.level,[e.me.plan?.level])||"free",a=e.isSubscriptionPaused(),[l,m]=(0,xo.useState)(!1),[c,p]=(0,xo.useState)(!1),[u,d]=(0,xo.useState)(!1),g=e.project.user.projectDomains,h=!1;i&&g&&g>=i&&(h=!0);let[b,x]=(0,xo.useState)(!1),[y,S]=(0,xo.useState)(!1),k=async $=>{if(!b){x(!0);try{await Mg($)}catch(A){A&&A.statusCode!==504&&S(!0)}finally{x(!1)}}};(0,xo.useEffect)(()=>{e.project.domain&&k(e.project.domain)},[e.project.domain]);let P=()=>{c||(p(!0),e.unmapDomain().catch(()=>{d(!0)}).finally(()=>{p(!1),l&&m(!1)}))},C=()=>s==="free"?"Please upgrade your plan to access domain mapping.":s==="extra"?"Please change your subscription conditions to map another domain.":"Please upgrade your plan to map another domain.",B=()=>s==="extra"?n(Re,{href:`mailto:${oe.SUPPORT_MAIL}`,textStyle:"small",color:"tomato",children:"Contact our support team to learn more."}):n(Re,{href:`${oe.readymag_host}/pricing/}`,target:"_blank",textStyle:"small",color:"tomato",children:"Check out the pricing to learn more."});return w(f,{paddingBottom:16,children:[r?t?o?w(K,{children:[n(f,{"data-testid":"mapping-status","data-status":"mapped",display:"none"}),n(Dx,{isVisitingDomain:b,visitError:y,showVisitError:S})]}):h?w(yt,{margin:"4px 0 14px",children:[e.isOwner&&w(I,{textStyle:"small",color:"black",children:[C(),n("br",{}),B()]}),!e.isOwner&&w(I,{textStyle:"small",color:"black",children:["To access custom domain mapping project owner should upgrade.",n("br",{}),n(Re,{href:`mailto:${e.project.user.email}`,textStyle:"small",isActive:!0,children:"Contact the owner"})]})]}):w(K,{children:[n(f,{"data-testid":"mapping-status","data-status":"not-mapped",display:"none"}),n(f,{paddingBottom:"3rm",children:w(Re,{href:"https://help.readymag.com/hc/en-us/articles/4403970232091-Mapping-a-domain-to-a-project",target:"_blank",textStyle:"small",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",color:"gray",children:["Help on connecting a domain",n(Do,{marginLeft:"-1rm",transform:"rotate(-90deg)"})]})}),n(Ax,{})]}):n(yt,{margin:"0 0 14px",children:a?w(I,{textStyle:"small",color:"black",children:["You can","'","t map a custom domain.",n("br",{}),"Please"," ",n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"unpause"})," ","your subscription first."]}):e.isOwner?w(I,{textStyle:"small",color:"black",children:["Please"," ",n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"upgrade"})," ","to access custom domain mapping.",n("br",{}),n(Re,{href:`${oe.readymag_host}/pricing/`,target:"_blank",textStyle:"small",isActive:!0,children:"See the pricing"})]}):w(I,{textStyle:"small",color:"black",children:["To access custom domain mapping project owner should upgrade.",n("br",{}),n(Re,{href:`mailto:${e.project.user.email}`,textStyle:"small",isActive:!0,children:"Contact the owner"})]})}):n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"black",children:["You can","'","t map a domain to an unpublished project.",n("br",{}),"Please, publish your project first."]})}),n(Hx,{domain:e.project.domain}),n(f,{marginBottom:16,marginTop:10,children:n(Lx,{projectDomain:e.project.domain,userDomain:e.project.user.domain,setProjectOptions:e.setProjectOptions,permissions:e.project.user.permissions,defaultValue:e.project.opts.allowindex})}),t&&n($x,{ga:e.project.opts.ga_id,gtm:e.project.opts.gtm_id,canUseGtm:!!e.project.user.permissions.can_use_gtm,saveProjectOptions:e.setProjectOptions}),e.project.domain&&t&&r&&n(yt,{margin:"4px 0 14px",children:w(I,{textStyle:"small",color:"black",children:["If you don\u2019t see your project or Readymag page when you visit"," ",n(Re,{href:`//${e.project.domain}`,target:"_blank",textStyle:"small",isActive:!0,children:"your website"}),", the DNS record might need more time to update. This can take up to 72 hours."]})}),e.project.domain&&(!t||!r)&&w(K,{children:[n(yt,{margin:"4px 0 14px",children:w(I,{textStyle:"small",color:"black",children:["The name ",e.project.domain," is already being used in this project.",n("br",{}),n(Re,{textStyle:"small",isActive:!0,onClick:P,children:c?"Unmaping...":"Unmap"})]})}),u&&n(yt,{margin:"0 0 14px",children:w(I,{textStyle:"small",color:"black",children:["Something went wrong.",n("br",{}),"Please try again later."]})})]})]})}var Is=T(H());G();Be();var Ha=T(H());G();Mr();ve();wo();$f();x_();dd();G();Mf();ve();v();var Nx=16;function _4({checked:e,maxWidth:o,onChange:t,onMaxWidthChange:r,height:i,margin:s}){return w(f,{display:"flex",margin:s,maxWidth:216,cursor:"pointer",borderRadius:52,position:"relative",height:i||104,backgroundColor:e?"green":"gray",children:[n(f,{display:"flex",padding:Nx,width:"100%",height:"100%",alignItems:"center",onClick:()=>t(!e),children:n(jl,{as:"input",type:"checkbox",checked:e,onChange:()=>t(e)})}),n(f,{left:Nx,top:"calc(50% - 1px)",position:"absolute",transform:"translateY(-50%)",children:w(I,{color:"white",whiteSpace:"nowrap",textStyle:"small",userSelect:"none",children:[n(f,{as:"span",onClick:()=>t(!e),children:e?"Scale layout up to ":"Scale layout"}),e?n(f,{display:"inline-block",onClick:l=>l.stopPropagation(),children:n(hn,{min:1024,max:9999,autoWidth:!0,color:"orange",textStyle:"small",padding:0,value:o,onChange:({value:l})=>r(l)})}):null,e?n(f,{as:"span",onClick:()=>t(!e),children:"px"}):null]})})]})}var Fx=_4;w_();b_();fn();v();var S4={width:194,boxPosition:{marginLeft:"-125px"},arrowPosition:{left:"auto",right:49}},Bs=({checked:e,disabled:o,children:t,onChange:r,showSwitch:i=!0,HelptipProps:s,...a})=>{let[l,m]=(0,Ha.useState)(!1);return n(f,{...a,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[n(f,{flex:"1",children:n(I,{textStyle:"small",color:e?"green":o?void 0:"black",opacity:o||!e?.4:1,children:t})}),s&&n(Co,{...S4,marginRight:"4px",...s,opacity:l?1:0}),i?n(Ot,{backgroundChecked:"green",checked:e,disabled:o,onChange:r}):null]})})},Wx=(0,Ha.memo)(({options:e,disabled:o,exclude:t=[],setProjectOptions:r,permissionOverrides:i})=>{let[s,a]=(0,Ha.useState)(e.scalewidth),{callback:l}=ql(c=>r({scalewidth:c}),500),m=Object.keys(i).includes("arrows");return w(K,{children:[!t.includes("scalableviewer")&&n(Fx,{checked:e.scalableviewer,maxWidth:s,onChange:c=>r({scalableviewer:c}),onMaxWidthChange:c=>{a(c),l(c)},height:"52px"}),n(eb,{checked:e.viewertype==="vertical",onChange:c=>r(c?{viewertype:"vertical"}:{viewertype:"horizontal"}),margin:"12px 0 4px 0"}),n(tb,{direction:e.viewertype,arrowsOn:e.arrows,slideIn:e.slidein,slideInRequiresArrows:e.viewertype==="horizontal",excludeSlideIn:t.includes("slidein"),arrowsDisabled:o.includes("arrows"),onArrowsChange:c=>r({arrows:c}),onSlideInChange:c=>r({slidein:c}),margin:"12px 0"}),w(f,{paddingLeft:"4rm",paddingRight:"2rm",marginTop:"12px",children:[m&&n(yt,{margin:"16px 0",padding:"12px 16px",children:w(I,{textStyle:"small",children:["Please"," ",n(Re,{href:"/settings#change-plan",target:"_blank",textStyle:"small",isActive:!0,children:"upgrade"})," ","your account to\xA0manage the\xA0white\xA0label settings."]})}),w(f,{backgroundColor:"white",padding:"12px 8px 12px 16px",marginLeft:"-16px",borderRadius:"16px",children:[n(Bs,{marginBottom:"1rm",checked:e.menubutton,onChange:c=>{r(c?{menubutton:c}:{menubutton:c,projectinfo:!1})},HelptipProps:{href:"https://help.readymag.com/hc/en-us/articles/360020588752-Viewer-navigation",text:e.controlsontop?"Show the menu button in the top right corner of a page":"Show the menu button in the bottom right corner of a page"},children:"Project menu"}),n(Bs,{marginTop:"1rm",marginBottom:"1rm",checked:e.sharebutton,disabled:o.includes("sharebutton"),onChange:c=>r({sharebutton:c}),HelptipProps:{text:"Show the share button to the user"},children:"Share button"}),n(Bs,{marginTop:"1rm",marginBottom:"1rm",checked:e.pagecounter,disabled:o.includes("pagecounter"),onChange:c=>r({pagecounter:c}),HelptipProps:{text:"Show a number of a current page to the user"},children:"Page counter"}),!t.includes("controlsontop")&&n(Bs,{marginTop:"1rm",checked:e.controlsontop,disabled:o.includes("controlsontop"),onChange:c=>r({controlsontop:c}),HelptipProps:{text:"Keep Project menu, Share button, and Page counter at the top of the screen"},children:"Buttons on top"}),n(Bs,{marginTop:"1rm",checked:e.branding,disabled:o.includes("branding"),onChange:c=>r({branding:c}),showSwitch:!o.includes("branding"),HelptipProps:o.includes("branding")?{text:"Upgrade to disable branding",href:"/settings#change-plan"}:void 0,children:"Readymag branding"})]}),n(Bs,{margin:"12px 0 8px",width:192,checked:e.lqip,disabled:o.includes("lqip"),onChange:c=>r({lqip:c}),HelptipProps:{text:"Use blurred image previews while loading",href:"https://help.readymag.com/hc/en-us/articles/360019989052-Picture"},children:"Progressive images"}),!t.includes("useCustomCursor")&&n(f,{margin:"8px 0",width:192,children:n(Qf,{useCustomCursor:!!e.useCustomCursor,customCursorImage:e.customCursorImage,customHoverCursorImage:e.customHoverCursorImage,saveProjectOptions:r})}),n(f,{display:"flex",marginTop:16,marginBottom:16,children:n(Re,{href:"https://help.readymag.com/hc/en-us/articles/360020588752-Viewer-navigation",target:"_blank",textStyle:"small",color:"darkGray",children:"Need help?"})})]})]})});ot();to();v();function P4({margin:e,width:o}){let t=xl(),{viewport:r}=(0,Is.useContext)(Je),i=t.getProjectOptions(r),s=(0,Is.useCallback)(c=>{t.setProjectOptions(c,void 0,r)},[r]),{disabled:a,permissionOverrides:l}=t.getProjectPermissionsOverrides(i),m=(0,Is.useMemo)(()=>r==="tablet_portrait"||r==="phone_portrait"?["scalableviewer","slidein","projectinfo","useCustomCursor","controlsontop"]:[],[r]);return n(f,{margin:e,width:o,children:n(Wx,{options:i,disabled:a,exclude:m,permissionOverrides:l,setProjectOptions:s})})}var Ux=P4;Be();to();ot();wo();ar();v();function Gx({exclude:e=[],ButtonTextPosition:o,defaultAccordionValue:t=0,renderButtonContainer:r=s=>s,renderCollapseContainer:i=s=>s}){let s=(0,oi.useContext)(ie),{viewport:a}=(0,oi.useContext)(Je),l=s.project.user.projectDomains,m=(0,oi.useMemo)(()=>s.me.plan?.level,[s.me.plan?.level])||"free",c=s.project.user.permissions.domain_limit,p=s.project.domain,u=!1;c&&l&&l>=c&&!p&&(u=!0);let d=s.hasPermission("can_export_pdf"),g=s.hasPermission("can_map_domain"),h=s.isSubscriptionPaused(),[b,x]=(0,oi.useState)(t),y=()=>s.openCodeEditor(),S=(0,oi.useMemo)(()=>s.hasProjectCode(),[s.project.ci_head,s.project.ci_css,s.project.ci_body_top,s.project.ci_body_bottom]),k=(0,oi.useMemo)(()=>({default:"Desktop",tablet_portrait:"Tablet",phone_portrait:"Mobile"})[a]??"",[a]);return w(Zo,{transition:{mass:1,stiffness:210,damping:20},value:b,onChange:C=>{C===3&&!h?g?u?m==="business"?st("map-domain-limit-business"):st("map-domain-limit"):x(C):st("map-domain"):C===4&&!h?d?x(C):(x(t),st("export-pdf")):x(C)},children:[n(Kt,{value:0,renderButton:({isActive:C})=>r(n(Hi,{isActive:C,label:"Project settings","data-testid":"project-settings-general",TextPosition:o}),"project-settings"),children:(C,B)=>n(f,{ref:C,children:i(n(Mx,{isActive:B}),"project-settings")})}),e.includes("viewer")?null:n(Kt,{value:1,renderButton:({isActive:C})=>r(n(Hi,{divider:!0,label:`${k} Viewer`,isActive:C,TextPosition:o}),"viewer"),children:C=>n(f,{ref:C,children:i(n(Ux,{}),"viewer")})}),n(Kt,{value:2,renderButton:({isActive:C})=>r(n(Hi,{divider:!0,label:"Code",isActive:C,withDot:S,TextPosition:o}),"code"),children:C=>n(f,{ref:C,children:i(n(Ix,{hasProjectCode:S,showUpgradeAlert:!s.me.permissions.can_inject_code,onOpenCodeEditorClick:y}),"code")})}),n(Kt,{value:3,renderButton:({isActive:C})=>r(n(Hi,{divider:!0,label:"Domain",isActive:C,withDot:!!s.project.domain,TextPosition:o}),"domain"),children:C=>n(f,{ref:C,children:i(n(Ox,{}),"domain")})}),e.includes("export")?null:n(Kt,{value:4,renderButton:({isActive:C})=>r(n(Hi,{label:"Export",isActive:C,divider:!0,TextPosition:o}),"export"),children:C=>n(f,{ref:C,children:i(n(Kp,{}),"export")})})]})}function Hi({label:e,divider:o,isActive:t,withDot:r,"data-testid":i,TextPosition:s={}}){return w(f,{width:"100%",height:48,display:"flex",justifyContent:"left",alignItems:"center",cursor:"pointer","data-testid":i,userSelect:"none",position:"relative",borderTop:"2px solid",borderTopColor:o?"gray":"transparent",css:te`
        &:hover {
          & span {
            color: ${t?O.black:O.red};
          }
        }
      `,children:[n(f,{position:"relative",bottom:r?"2px":void 0,children:n(I,{color:"black",textStyle:"subheading",...s,children:e})}),r?n(f,{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"black",position:"absolute",right:24,top:21}):null]})}Be();ar();wo();v();var Vx=()=>{let[e,o]=(0,ic.useState)(0),t=(0,ic.useContext)(ie),r=t.hasPermission("can_export_pdf"),i=t.isSubscriptionPaused();return w(Zo,{dynamicHeight:!0,transition:{mass:1,stiffness:210,damping:20},value:e,onChange:s=>{s===1&&!i?r?o(s):(o(0),st("export-pdf")):o(s)},children:[n(Kt,{value:0,renderButton:({isActive:s})=>n(f,{padding:"0 16px",children:n(T4,{label:"Share",isActive:s})}),children:s=>n(f,{ref:s,padding:"0 16px",children:n(xx,{shareMode:"full"})})}),n(Kt,{value:1,renderButton:({isActive:s})=>n(f,{padding:"0 16px",children:n(Hi,{isActive:s,label:"Export",divider:!0})}),children:s=>n(f,{ref:s,padding:"0 16px 16px 16px",children:n(Kp,{})})})]})};function T4(e){return n(f,{display:"flex",justifyContent:"space-between",alignItems:"baseline",children:n(f,{children:n(Hi,{...e})})})}re();Pt();Ue();v();function Sm({children:e,button:o,...t}){let{iframeElement:r}=(0,nc.useContext)(kr),i=(0,nc.useCallback)((s,a)=>{s===r&&a()},[r]);return n(Et,{disablePortal:!0,name:"preview-share",skidding:-84,button:o,ArrowProps:{stroke:Ee(.84,O.gray)},panelPosition:{height:"auto"},onWindowBlur:i,...t,children:n(f,{width:224,color:"black",height:"100%",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),border:"2px solid rgba(184, 184, 184, 0.16)",children:n(Vx,{})})})}cf();Vc();v();function sc(e){return w(f,{"aria-label":"Preview toolbar",display:"flex",gap:"2rm",...e,children:[n(f,{position:"absolute",right:"102%",top:"0",children:n(Nl,{})}),n(gx,{width:104,textStyle:"small"}),n(fx,{children:n(is,{children:w(f,{display:"flex",width:112,height:56,backgroundColor:Me("darkGray",.96),borderRadius:40,children:[n(xm,{width:"50%",height:"100%",button:({isPanelShown:o})=>n(vm,{width:56,icon:n(Yh,{}),isActive:o,tooltipTargetSteps:["ViewerSettings"],"aria-label":"Viewer settings toggle",TooltipProps:{text:"Viewer settings",disabled:o,instance:!0,closeOnTargetClick:!0}})}),n(Sm,{width:"50%",height:"100%",button:({isPanelShown:o})=>n(vm,{width:56,icon:n(bx,{}),isActive:o,TooltipProps:{text:"Share",disabled:o,instance:!0,closeOnTargetClick:!0}})})]})})}),n(jp,{previewOnly:!0})]})}var $c=T(H());var yy=T(H());G();re();ao();Oe();var po=(e,o,t)=>t?`${(t.height-parseInt(o,10))/2}px ${(t.width-parseInt(e,10))/2}px`:void 0;v();var jx=({id:e="stackIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{viewBox:"0 -3 26 31",xmlns:"http://www.w3.org/2000/svg",id:e,width:o,height:t,style:{padding:i},children:[w("path",{d:"M13.4 2.23764L22.5768 7.68364C23.8575 8.44363 23.8643 10.295 22.5893 11.0644L13.4085 16.6048C12.7836 16.9819 12.0014 16.9826 11.3758 16.6066L2.18583 11.0828C0.908554 10.3151 0.913273 8.46198 2.19444 7.70077L11.3884 2.23816C12.0083 1.86983 12.7799 1.86963 13.4 2.23764Z",stroke:"currentColor",strokeWidth:"2",fill:"none",children:[n("animateTransform",{attributeName:"transform",type:"translate",to:"0 -2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"translate",from:"0 -2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.170953 12.017C-0.275589 13.2786 0.154473 14.7905 1.43996 15.5631L10.8527 21.2208C11.7958 21.7877 12.9751 21.7866 13.9173 21.2181L23.3205 15.5434C24.6028 14.7696 25.0309 13.2599 24.585 12C24.3683 12.6133 23.946 13.1659 23.3205 13.5434L13.9173 19.2181C12.9751 19.7866 11.7958 19.7877 10.8527 19.2208L1.43996 13.5631C0.81201 13.1857 0.388184 12.6319 0.170953 12.017Z",fill:"currentColor"}),w("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.329156 15.932C-0.117386 17.1936 0.312676 18.7055 1.59817 19.4782L11.0109 25.1358C11.954 25.7027 13.1333 25.7017 14.0755 25.1331L23.4787 19.4585C24.761 18.6847 25.1891 17.175 24.7432 15.915C24.5265 16.5284 24.1042 17.081 23.4787 17.4585L14.0755 23.1331C13.1333 23.7017 11.954 23.7027 11.0109 23.1358L1.59817 17.4782C0.970213 17.1007 0.546387 16.5469 0.329156 15.932Z",fill:"currentColor",children:[n("animateTransform",{attributeName:"transform",type:"translate",to:"0 2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"translate",from:"0 2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};_o();ct();v();var Yx=({disableTooltip:e,onClick:o,...t})=>n(ht,{targetSteps:["OpenLayersPanel","MobileMenuInLayers"],defaultText:"Layers (Q)",indent:8,disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:n(ne,{"data-widgetbar-action":"stack-panel",display:"flex",alignItems:"center",justifyContent:"center",onClick:o,variant:"unstyled",height:"100%",width:"100%",color:"white","aria-label":"Widgets","data-testid":"layer-button",...t,children:n(jx,{width:"26px",height:"34px",hoverBox:{width:56,height:56}})})});Oe();v();var qx=({id:e="plusIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("line",{x1:"5",y1:"16",x2:"27",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"31",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"27",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"16",y1:"5",x2:"16",y2:"27",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"y1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y1",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y2",to:"31",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y2",to:"27",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};rn();_o();ct();v();var Xx=({onClick:e,tooltipPosition:o,disableTooltip:t,...r})=>n(ht,{targetSteps:["PictureWidget","ButtonWidget"],eduTips:["eduTipUsePlusIcon","eduTipUseTextStylesWidget"],defaultText:"Add widget (W)",indent:8,position:o,disabled:t,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:n(ne,{"data-widgetbar-action":"add-widget",display:"flex",alignItems:"center",justifyContent:"center",color:"white",onClick:e,variant:"unstyled",height:"100%",width:"100%","aria-label":"Add widget","data-testid":"widget-button",...r,children:n(qx,{width:"32px",height:"32px",hoverBox:{width:56,height:56}})})});to();Xo();var Kx=T(H());re();Pt();Ue();G();v();var Zx=({children:e,onMouseEnter:o,onMouseLeave:t,onClick:r,...i})=>{let{user:s}=(0,Kx.useContext)(tr);return n(mt,{position:"relative","data-testid":"open-profile",height:56,width:56,as:"a",margin:"0",textDecoration:"none",border:"none",backgroundColor:"transparent",css:te`
        & > * {
          width: 56px !important;
          height: 56px !important;
          flex: none;
          background-color: transparent !important;
        }
        ${s?.pic?`& > *, & > * > * {
                  background-color: transparent !important;
                }`:""}
      `,onMouseEnter:o,onMouseLeave:t,onClick:r,...i,children:s&&w(K,{children:[n(zt,{url:s.pic,name:s.name}),n(f,{boxShadow:`0 0 0 2px inset ${Ee(.8,O.gray)}`,position:"absolute",top:"0",borderRadius:"50%",width:"100%",height:"100%"})]})})};var Bn=T(H());G();Be();var Lm=T(H());tt();var Er=T(H());fd();gn();Ue();G();Oe();var Jx=T(H());F2();G();ve();Xo();Ue();re();v();var Pm=[`inset 0 0 0 8px ${O.red}, inset 0 0 0 12px ${O.white}`,`inset 0 0 0 4px ${O.red}, inset 0 0 0 12px ${O.white}`],Qx=4,B4=16*1.25,zs=B4*2+Qx,I4=f,z4=Y(f)`
  display: flex;
  overflow: hidden;
  @media (pointer: fine) {
    &:hover {
      overflow: visible;
    }
  }
`,E4=Y(zt)`
  display: block;
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    border-radius: 50%;
    transition: box-shadow 100ms ease-out;
    ${e=>e.selected?`box-shadow: ${Pm[0]}`:"box-shadow: none"};
  }
`,R4=Y(Wh)`
  display: block;
  g {
    fill: ${O.red};
    transition: fill 100ms ease-out;
  }
`;function A4({name:e,url:o,isMultiple:t,isSelected:r,isCaptionVisible:i,isPending:s=!1,fullBox:a,projectsCount:l,showInitials:m=!0,showCaption:c=!0,className:p,email:u,overflowName:d=!0,onUnshare:g,showUnshareButton:h=!1,...b}){let x=d&&!s,[y,S]=(0,Jx.useState)(!1),k=()=>{g&&g()};return w(z4,{onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),position:"relative",flexDirection:"column",alignItems:"center",paddingBottom:a?zs:void 0,className:p,cursor:r?"auto":"pointer",children:[t?n(R4,{"data-testid":"multiple-icon",selected:r,opacity:y||r?1:.5}):w(f,{children:[h&&y&&n(mt,{position:"absolute",zIndex:1,color:"gray",hoverTextColor:"white",width:at.regular,height:at.regular,onClick:k,marginRight:0,children:"Delete"}),n(E4,{name:typeof e=="string"?e:"",url:o,showInitials:m,...b,boxShadow:y?r?Pm[0]:Pm[1]:void 0,selected:y||r})]}),c?w(I4,{position:"absolute",top:at.regular+Qx,width:"100%",color:i?"black":"tomato",opacity:y||r||i?1:0,transition:"opacity 100ms ease-out;",children:[n(Le,{as:"div",textAlign:"center",textStyle:"regular",paddingLeft:"2rm",paddingRight:"2rm",overflow:x?"hidden":void 0,whiteSpace:x?"nowrap":void 0,maskImage:x?"linear-gradient(to right, rgba(0, 0, 0, 1), rgba(0, 0, 0, 1) 65%, rgba(0, 0, 0, 0))":void 0,children:s?"Pending":typeof e=="string"?e.split(" ")[0]:e}),n(Le,{as:"div",textAlign:"center",textStyle:"regular",children:l}),u?n(Le,{as:"div",textAlign:"center",textStyle:"regular",color:"tomato",marginLeft:"50%",transform:"translateX(-50%)",display:"inline-block",whiteSpace:"nowrap",children:u}):null]}):null]})}var Oi=A4;var ev=T(xf());Pt();fd();G();ve();Oe();Ue();re();vf();v();var[D4]=hi;function $4({title:e,children:o,show:t,error:r,closeTitle:i="Cancel",bgColor:s="white",zIndex:a,dialogPosition:l,...m}){let[c]=Ul(t);return n(as,{query:`(min-width: ${D4})`,children:p=>t?w(ev.default,{initialFocus:"#rm-close-modal",titleId:"#rm-modal-title",underlayStyle:{...c,backgroundColor:Ee(.04,O.black),paddingTop:p?72:0,paddingBottom:p?72:0,boxSizing:"border-box",overflow:"hidden",...a?{zIndex:a}:{}},dialogStyle:{...c,...p?{}:{height:"100%",minHeight:250,width:"100%"},display:"inline-flex",maxHeight:"100%",position:l},...m,children:[!p&&n(f,{top:16,right:24,position:"absolute",children:n(ne,{color:"white",onClick:m.onExit,id:"rm-close-modal",children:i})}),n(f,{display:"flex",flexDirection:"column",marginTop:[78,0],marginLeft:"auto",marginRight:"auto",backgroundColor:s,borderRadius:["8px 8px 0 0","8px"],width:["100%",768],maxHeight:"100%",overflow:"hidden",children:w(f,{display:"flex",flex:1,overflowY:"auto",flexDirection:"column",children:[n(f,{paddingLeft:[24,"16rm"],paddingRight:[24,"16rm"],paddingTop:[20,40],children:e?w(f,{display:"flex",justifyContent:"space-between",alignItems:"baseline",children:[n(I,{textStyle:"subheading",as:"h2",id:"rm-modal-title",minHeight:["auto","2em"],css:te`
                          &::first-letter {
                            text-transform: uppercase;
                          }
                        `,children:e}),p?n(ne,{onClick:m.onExit,variant:"tertiary",id:"rm-close-modal",children:i}):null]}):null}),n(f,{display:"flex",paddingLeft:[24,64],paddingRight:[24,64],marginBottom:[16,r?0:40],flex:1,flexDirection:"column",children:o}),p&&r&&n(f,{height:40,backgroundColor:r?"tomato":"transparent",color:"white",paddingLeft:64,paddingRight:64,marginTop:"auto",children:r?n(I,{color:"white",lineHeight:40/16,children:r}):null}),!p&&r&&n(f,{height:60,position:"absolute",bottom:16,paddingLeft:24,paddingRight:16,width:"100%",children:n(I,{as:"div",color:"tomato",textAlign:"center",children:r})})]})})]}):null})}var Tm=$4;ve();var Es=T(H());_b();var lv=T(iv());var Po={CASE_SENSITIVE_EQUAL:7,EQUAL:6,STARTS_WITH:5,WORD_STARTS_WITH:4,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},F4=(e,o)=>String(e.rankedValue).localeCompare(String(o.rankedValue));function Mm(e,o,t){t===void 0&&(t={});let{keys:r,threshold:i=Po.MATCHES,baseSort:s=F4,sorter:a=c=>c.sort((p,u)=>V4(p,u,s))}=t,l=e.reduce(m,[]);return a(l).map(c=>{let{item:p}=c;return p});function m(c,p,u){let d=W4(p,r,o,t),{rank:g,keyThreshold:h=i}=d;return g>=h&&c.push({...d,item:p,index:u}),c}}Mm.rankings=Po;function W4(e,o,t,r){if(!o){let s=e;return{rankedValue:s,rank:nv(s,t,r),keyIndex:-1,keyThreshold:r.threshold}}return q4(e,o).reduce((s,a,l)=>{let{rank:m,rankedValue:c,keyIndex:p,keyThreshold:u}=s,{itemValue:d,attributes:g}=a,h=nv(d,t,r),b=c,{minRanking:x,maxRanking:y,threshold:S}=g;return h<x&&h>=Po.MATCHES?h=x:h>y&&(h=y),h>m&&(m=h,p=l,u=S,b=d),{rankedValue:b,rank:m,keyIndex:p,keyThreshold:u}},{rankedValue:e,rank:Po.NO_MATCH,keyIndex:-1,keyThreshold:r.threshold})}function nv(e,o,t){return e=sv(e,t),o=sv(o,t),o.length>e.length?Po.NO_MATCH:e===o?Po.CASE_SENSITIVE_EQUAL:(e=e.toLowerCase(),o=o.toLowerCase(),e===o?Po.EQUAL:e.startsWith(o)?Po.STARTS_WITH:e.includes(` ${o}`)?Po.WORD_STARTS_WITH:e.includes(o)?Po.CONTAINS:o.length===1?Po.NO_MATCH:U4(e).includes(o)?Po.ACRONYM:G4(e,o))}function U4(e){let o="";return e.split(" ").forEach(r=>{r.split("-").forEach(s=>{o+=s.substr(0,1)})}),o}function G4(e,o){let t=0,r=0;function i(m,c,p){for(let u=p,d=c.length;u<d;u++)if(c[u]===m)return t+=1,u+1;return-1}function s(m){let c=1/m,p=t/o.length;return Po.MATCHES+p*c}let a=i(o[0],e,0);if(a<0)return Po.NO_MATCH;r=a;for(let m=1,c=o.length;m<c;m++){let p=o[m];if(r=i(p,e,r),!(r>-1))return Po.NO_MATCH}let l=r-a;return s(l)}function V4(e,o,t){let{rank:s,keyIndex:a}=e,{rank:l,keyIndex:m}=o;return s===l?a===m?t(e,o):a<m?-1:1:s>l?-1:1}function sv(e,o){let{keepDiacritics:t}=o;return e=`${e}`,t||(e=(0,lv.default)(e)),e}function j4(e,o){typeof o=="object"&&(o=o.key);let t;if(typeof o=="function")t=o(e);else if(e==null)t=null;else if(Object.hasOwnProperty.call(e,o))t=e[o];else{if(o.includes("."))return Y4(o,e);t=null}return t==null?[]:Array.isArray(t)?t:[String(t)]}function Y4(e,o){let t=e.split("."),r=[o];for(let i=0,s=t.length;i<s;i++){let a=t[i],l=[];for(let m=0,c=r.length;m<c;m++){let p=r[m];if(p!=null)if(Object.hasOwnProperty.call(p,a)){let u=p[a];u!=null&&l.push(u)}else a==="*"&&(l=l.concat(p))}r=l}return Array.isArray(r[0])?[].concat(...r):r}function q4(e,o){let t=[];for(let r=0,i=o.length;r<i;r++){let s=o[r],a=X4(s),l=j4(e,s);for(let m=0,c=l.length;m<c;m++)t.push({itemValue:l[m],attributes:a})}return t}var av={maxRanking:1/0,minRanking:-1/0};function X4(e){return typeof e=="string"?av:{...av,...e}}fd();ve();G();Xo();Oe();Mf();Ue();Yr();Zf();Yo();re();v();var Bm=e=>e&&/^\S+@\S+$/.test(e);function Oa(e,o){return e||Bm(o)}var[K4]=hi,Z4=(e,{inputValue:o,...t})=>{switch(t.type){case wn.stateChangeTypes.blurInput:case wn.stateChangeTypes.itemMouseEnter:case wn.stateChangeTypes.mouseUp:return t;default:return{inputValue:o,...t}}};function J4({placeholder:e,submitText:o="Submit",suggestions:t=[],suggestionsBoxStyle:r,renderWhenSelected:i,disabled:s=!1,focusOnMount:a,onChange:l,onFocus:m,onBlur:c,selectedUser:p,showInput:u=!0,preSubmitSlot:d}){let[g,h]=(0,Es.useState)(!1),b=(0,Es.useRef)(null);return(0,Es.useEffect)(()=>{a&&b.current&&b.current.focus()},[a]),n(wn,{stateReducer:Z4,itemToString:x=>x?x.name:null,id:"rm-user-search",initialInputValue:typeof p=="string"?p:void 0,initialSelectedItem:typeof p=="object"?p:void 0,isOpen:!0,onStateChange:x=>{l&&(x.selectedItem!==void 0?l(x.selectedItem):x.inputValue!==void 0&&l(x.inputValue))},children:({getInputProps:x,getItemProps:y,getMenuProps:S,selectedItem:k,inputValue:P,clearSelection:C})=>n("div",{children:n(as,{query:`(min-width: ${K4})`,children:B=>{let $=Mm(t,P||"",{keys:["name"]}),A=P?null:!!t.length&&n(f,{display:"flex",marginRight:[0,16],marginBottom:[16,0],height:72,alignItems:"center",children:n(Le,{textStyle:B?"subheading":"regular",color:"gray",children:"Suggestions"})});return w(f,{children:[w(f,{display:"flex",paddingLeft:k||!B?0:88,flexDirection:["row-reverse","row"],children:[k?B?n(zt,{name:k.name,url:k.pic,marginRight:16}):w(f,{position:"relative",children:[n(f,{position:"absolute",top:0,left:0,zIndex:1,width:72,height:72,display:"flex",alignItems:"center",justifyContent:"center",children:n(op,{zIndex:1,inverted:!0,color:"tomato","aria-label":"Clear selection",onClick:()=>C(),icon:n(Ht,{})})}),n(zt,{name:k.name,url:k.pic,display:"block"})]}):null,w(f,{flex:1,display:["flex","block"],children:[w(f,{gap:"20px",display:"flex",justifyContent:"space-between",borderBottom:"2px solid",borderColor:g?"black":"lightGray",width:"100%",css:te`
                          ${Ze}.clear {
                            visibility: hidden;
                          }

                          &:hover ${Ze}.clear {
                            visibility: visible;
                          }
                        `,children:[k?n(f,{display:"flex",height:at.regular-2,alignItems:"center",children:n(f,{whiteSpace:B?void 0:"nowrap",width:B?void 0:"calc(100vw - 200px)",overflow:B?void 0:"hidden",textOverflow:B?void 0:"ellipsis",children:w(Le,{textStyle:B?"subheading":"regular",children:[k.name,B&&!s&&n(Ze,{className:"clear","aria-label":"Clear selection",onClick:()=>C(),marginLeft:"2rm",children:n(Ht,{"aria-hidden":!0})})]})})}):u?w(f,{as:"label",width:"100%",children:[n(jl,{as:"span",children:e}),n(vt,{ref:b,textStyle:B?"subheading":"regular",padding:"0 !important",margin:"none !important",boxSizing:"border-box",height:`${at.regular}px`,border:"none !important",...x({placeholder:e,id:"rm-user-search-input",height:at.regular,disabled:s,onFocus:()=>{m&&(h(!0),m())},onBlur:()=>{c&&(h(!1),c())}})})]}):"",Oa(k,P)&&B?w(f,{display:"flex",gap:"20px",children:[d,n(Ze,{variant:"primary",textStyle:"subheading",type:"submit",disabled:s,lineHeight:"72px",minWidth:60,whiteSpace:"nowrap",children:o})]}):null]}),!B&&P&&!Oa(k,P)&&$.length?$.slice(0,1).map((R,Z)=>n(Oi,{name:R.name||R.email,email:R.name?R.email:"",url:R.pic,projectsCount:R.projectsCount,isCaptionVisible:!1,showInitials:!1,fullBox:!1,"data-testid":R._id,...y({item:R,key:Z}),opacity:.4},Z)):null,Oa(k,P)&&!B?n(mt,{type:"submit",width:at.regular,height:at.regular,color:"tomato",disabled:s,flexShrink:0,marginRight:0,whiteSpace:"nowrap",children:o}):null,Oa(k,P)?i:null]})]}),t.length?n(f,{marginTop:[22,66],marginLeft:[0,at.regular+16],minHeight:at.regular+(B?zs:0),...r,children:Oa(k,P)?null:w(f,{display:["block","flex"],children:[B?null:A,w(f,{display:"flex",...S(),flexWrap:["nowrap","wrap"],marginLeft:[-24,0],paddingLeft:[24,0],width:["100vw",null],overflowX:"auto",css:te`
                              -webkit-overflow-scrolling: touch;
                            `,children:[B?A:null,B||!P?$.map((R,Z)=>n(f,{height:146,children:n(Oi,{name:R.name||R.email,email:R.name?R.email:"",url:R.pic,projectsCount:R.projectsCount,isCaptionVisible:!B,fullBox:!B,"data-testid":R._id,...y({item:R,key:Z})})},R._id)):null]})]})}):null]})}})})})}var Im=J4;var lc=T(H());A_();ua();G();Oe();ve();v();function Q4({showUnshare:e,onUnshare:o,onChangeRole:t,roles:r,selectedRoleName:i,disabled:s=!1}){let[a,l]=(0,lc.useState)(!1),m=(0,lc.useMemo)(()=>{let c=r.find(p=>p.name===i);return w(ne,{variant:"tertiary",textStyle:"subheading",disabled:s,children:[c?.description||i||"Select role"," ",n(I,{textStyle:"subheading",color:"gray",children:"v"})]})},[r,i,s]);return w(K,{children:[a&&n(Pr,{position:"absolute",borderRadius:["8px 8px 0 0","8px"]}),n(f,{display:"flex",alignItems:"center",whiteSpace:"nowrap",children:w(Cb,{target:m,placement:"bottom-end",onStateChange:c=>{typeof c.isOpen=="boolean"&&l(c.isOpen)},menuWrapper:c=>n(f,{textAlign:"right",children:c}),children:[r.map((c,p)=>n(yd,{description:{content:c.secondaryDescription,marginTop:"9px"},onClick:()=>t(c.name),children:c.description},p)),e&&o&&n(yd,{onClick:()=>o(),children:"Unshare"})]})})]})}var zm=Q4;ve();re();var Em=Le.withComponent(Y("input")`
  outline: none;
  height: 72px;
  width: 100%;
  padding-left: 0;
  padding-right: 0;
  border: none;

  transition: border-color 100ms ease-out;
  /* NOTE: Верхний прозрачный бордер у инпута выравнивает текст инпута вертикально по центру,
  например чтобы он был на одной линии с текстом кнопки, если она высотой с инпут */
  border-top: 2px solid transparent;
  border-bottom: 2px solid ${({theme:e})=>e.colors.lightGray};
  border-radius: 0;

  &::placeholder {
    color: ${({theme:e})=>e.colors.gray};
  }

  &:focus {
    border-bottom-color: ${({theme:e})=>e.colors.black};
  }
`);Em.defaultProps={textStyle:"subheading"};var Rs=T(H());G();Sr();re();ca();G();v();var Rm=24,Mn=Rm+2,pv=2,e3=8,t3=al`
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
`,o3=Y("div")`
  display: flex;
  justify-content: center;
  align-items: center;
  width: ${Rm}px;
  height: ${Rm}px;
  border: 1px solid transparent;
  border-radius: 50%;
  background: ${({theme:e})=>e.colors.tomato};
  background-clip: content-box;
`,r3=f.withComponent(Y("svg")`
  position: absolute;
  left: -1px;
  top: -1px;
`),i3=Y("circle")`
  stroke: ${({theme:e})=>e.colors.white};
  stroke-width: ${pv}px;
  stroke-dasharray: 37;
  fill: none;
  transform-origin: center;
  animation: ${t3} ${e3}s linear infinite;
`;function cv({className:e,spinning:o}){return w(o3,{className:e,children:[n(r3,{width:`${Mn}px`,height:`${Mn}px`,viewBox:`0 0 ${Mn} ${Mn}`,xmlns:"http://www.w3.org/2000/svg",children:o&&n(i3,{cx:Mn/2,cy:Mn/2,r:(Mn-pv)/2})}),n($o,{})]})}cv.defaultProps={spinning:!0};var dv=cv;ua();Xo();Zf();Yr();ca();re();v();var Am=1e3,n3=Y($o)`
  & > g {
    fill: ${({theme:e})=>e.colors.tomato}!important;
  }
`,s3=Y(dv)`
  position: absolute;
  left: 0;
  bottom: ${zs}px;
  top: 0;
  right: 0;
  z-index: 1;
  margin: auto;
`;function a3({teammate:e,projectCount:o,isSelected:t,showOverlay:r,showActionOnHover:i,showEllipsisIcon:s,showContextMenu:a=!0,onResend:l,onUnshare:m,onToggle:c,onAppear:p,onDisappear:u}){let[d,g]=(0,Rs.useState)(!1),[h,b]=(0,Rs.useState)(!1),[x,y]=(0,Rs.useState)(!1),S=(0,Rs.useRef)(null),k=R=>{g(R),c&&c(R),p&&p()},P=()=>{!d&&u&&setTimeout(()=>u(),100)},C=()=>{k(!1),l&&l()},B=()=>{k(!1),m&&m()},$=S.current&&S.current.getBoundingClientRect(),A=()=>!d&&(e.isPending||s?n(s3,{spinning:!s}):n(f,{position:"absolute",left:0,bottom:`${zs}px`,top:0,right:0,zIndex:1,margin:"auto",children:n(op,{icon:n(Ht,{}),color:"tomato",inverted:!0,solid:!0})}));return w(f,{position:"relative",onMouseOver:()=>b(!0),onMouseLeave:()=>b(!1),children:[d&&n(Pr,{zIndex:Am,opacity:r?void 0:0,onClick:()=>k(!1)}),w(f,{position:"relative",onClick:()=>k(!d),zIndex:d?Am:void 0,ref:S,children:[e.isPending&&(i?h&&A():A()),n(Oi,{name:e.name||"",email:e.email,isPending:e.isPending,url:e.pic,fullBox:!0,isCaptionVisible:!t&&!d,projectsCount:o,isSelected:t,showInitials:!!(i||d),showCaption:!d}),a&&d&&n(f,{position:"absolute",left:12,top:12,width:48,height:48,borderRadius:"50%",children:n(mt,{width:48,height:48,color:"lightGray",hoverColor:"lightGray",children:n(n3,{})})}),x&&n(f,{position:"absolute",left:12,top:12,backgroundColor:"black",width:48,height:48,opacity:.3,borderRadius:"50%"})]}),!e.isPending&&h&&n(f,{position:"absolute",top:-13,right:-13,onMouseOver:()=>y(!0),onMouseLeave:()=>y(!1),children:n(mt,{color:"tomato",hoverColor:"black",width:24,height:24,onClick:()=>B(),children:n(Ht,{color:"white"})})}),e.isPending&&d?w(qt.div,{initial:{opacity:0},animate:{opacity:d?1:0},onAnimationComplete:R=>{typeof R=="object"&&"opacity"in R&&R.opacity===0&&P()},style:{position:"fixed",zIndex:Am,top:`${$&&$.top+at.regular}px`,left:`${$&&$.left}px`},children:[n(mt,{as:"div",color:"black",width:at.regular,height:at.regular,onClick:()=>C(),marginRight:0,css:R=>te`
              color: ${R.colors.white};
              &:hover {
                background-color: ${R.colors.tomato};
              }
            `,children:"Resend"}),n(mt,{as:"div",color:"tomato",width:at.regular,height:at.regular,onClick:()=>B(),marginRight:0,css:R=>te`
              color: ${R.colors.white};
              &:hover {
                background-color: ${R.colors.black};
              }
            `,children:"Remove"})]}):null]})}var Dm=a3;var mv=T(H());re();Oe();ve();v();var l3=Y("div")`
  white-space: nowrap;
`;function pc({isTeammatePending:e,isSharedViaFolder:o,isResend:t,onResend:r,onUnshare:i,onMouseOut:s}){let[a,l]=(0,mv.useState)(!1);return n(K,{children:o?n(ne,{variant:"tertiary",textStyle:"subheading",disabled:!0,children:"Shared within collection"}):e?w(l3,{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[n(I,{as:"div",display:a?"none":void 0,textStyle:"subheading",lineHeight:`${at.regular}px`,children:"Pending"}),n(ne,{display:a?"inline-block":"none",variant:"tertiary",textStyle:"subheading",lineHeight:`${at.regular}px`,onClick:r,onMouseOut:s,children:t?"Sent":"Resend"}),n(ne,{display:a?"inline-block":"none",variant:"tertiary",textStyle:"subheading",lineHeight:`${at.regular}px`,marginLeft:10,onClick:i,children:"Unshare"})]}):n(ne,{variant:"tertiary",textStyle:"subheading",onClick:i,children:"Unshare"})})}re();Xg();v();var[p3]=hi,uv=568;function c3({projects:e,allProjects:o,myTeam:t,sharedTeam:r,user:i,onExit:s,show:a,zIndex:l,userRoles:m,initialRole:c,authHost:p,onTeammateAdd:u,onTeammateRemove:d,onTeammateUpdate:g,onResendInvitation:h,onUserSelect:b}){let x=(0,Er.useMemo)(()=>i&&i.plan&&i.plan.level,[i]),y=(0,Er.useMemo)(()=>!!(i&&i.stripe&&i.stripe.subscription_pause_ends_at),[i]),S=(0,Er.useMemo)(()=>{let L=jg(i)-Yg(t).length;return!y&&L>0},[i,t,y]),[k,P]=(0,Er.useState)({projects:e?.length?e:[],selectedUser:null,copy:!1,isSubmitting:!1,didError:!1,userSearchKey:1,lastInvinationTo:null,unsharedProjects:[],filteredProjects:[],selectedUserRole:c||(m?.length?m[0].name:"")}),C=(0,Er.createRef)(),B=ts(k.projects),$=Pl(k.projects),A=od(t,r),R=(0,Er.useMemo)(()=>Vg({projects:k.projects,allTeammates:A,me:i}),[k.projects,A,i,B,$]),Z=!R.length,F=e?Gg({all:t,allProjects:o,excluded:R,selectedUser:k.selectedUser,me:i}):[],V=(0,Er.useMemo)(()=>y?"You can't add collaborators. Your subscription has been paused.":x==="free"?"Please upgrade your plan to add collaborators.":["personal","freelancer","studio","business"].includes(x)||x==="extra"?"Please change your subscription conditions to add new collaborators.":`You can\u2019t ${F.length?"invite":"add"} more collaborators on your plan.`,[x,y]);function W(L){let{projects:j}=k;return j.every(N=>an(N)&&!!N.folder&&L.folderIds.includes(N.folder))}async function J(L,j=!1){let{selectedUser:N}=L?{selectedUser:L}:k,de=i;if(N){let le=typeof N=="string"?N:N.email,We=ts(o),he=ts(k.projects),fe=Pl(k.projects);if(P(pe=>({...pe,isSubmitting:!0,didError:!1,error:""})),de?.email===le)return P(pe=>({...pe,isSubmitting:!1,didError:!0,error:"You can\u2019t collaborate with yourself."}));try{let pe=od(t,r).find(Ne=>Ne.email===le),ze=pe&&t.some(Ne=>Ne.email===le),Ae={};if(pe&&ze){let Ne=pe.sharesAll?We:new Set([...pe.projectNumIds,...he]),ft=new Set([...pe.folderIds,...fe]),M=Array.prototype.concat(...[...ft].map(U=>o.filter(q=>an(q)&&q.folder===U))).map(U=>U.num_id),z=new Set([...Ne].filter(U=>!M.includes(U)));if(k.selectedUserRole){let U=Gr({items:[...z],roles:pe.projectRoles||{},newItems:he,newRole:k.selectedUserRole}),q=Gr({items:[...ft],roles:pe.folderRoles||{},newItems:fe,newRole:k.selectedUserRole});Ae=await g({email:le,sharesAll:!1,projectNumIds:U.items,projectRoles:U.roles,folderIds:q.items,folderRoles:q.roles})}}else if(k.selectedUserRole){let Ne=Gr({newItems:he,newRole:k.selectedUserRole}),ft=Gr({newItems:fe,newRole:k.selectedUserRole});Ae=await u({email:le,sharesAll:!1,projectNumIds:Ne.items,projectRoles:Ne.roles,folderIds:ft.items,folderRoles:ft.roles})}P(Ne=>({...Ne,isSubmitting:!1,didError:!1,userSearchKey:k.userSearchKey+1,updatedTeammate:Ae,...j?{}:{selectedUser:""}}))}catch(pe){P(ze=>({...ze,isSubmitting:!1,didError:!0,collaboratorInvited:!1,error:pe.error?pe.error.message?pe.error.message:pe.error.toString():"Error adding collaborator. Please try again."}))}}}async function me(L){if(L){P(j=>({...j,didError:!1,error:""}));try{await h(L.email),P(j=>({...j,lastInvinationTo:L._id}))}catch{P(j=>({...j,didError:!0,error:"Error sending invitation. Please try again."}))}}}async function se(L){if(!L)return;let j=ts(k.projects),N=Pl(k.projects),de=ts(o),le=(L.sharesAll?de:L.projectNumIds).filter(he=>!j.includes(he)),We=L.folderIds.filter(he=>!N.includes(he));P(he=>({...he,didError:!1,error:""}));try{if(L.isPending&&!le.length&&!We.length)await d(L);else{let he=Gr({items:le,roles:L.projectRoles}),fe=Gr({items:We,roles:L.folderRoles});await g({email:L.email,sharesAll:!1,projectNumIds:he.items,projectRoles:he.roles,folderIds:fe.items,folderRoles:fe.roles})}P(he=>({...he,updatedTeammate:void 0}))}catch{P(he=>({...he,didError:!0,error:"Error when unsharing. Please try again."}))}}function ee(L){return L.preventDefault(),k.selectedUser&&Bm(typeof k.selectedUser=="string"?k.selectedUser:k.selectedUser.email)}function ue(){P(L=>({...L,isInputInFocus:!1}))}function ke(L){P(j=>({...j,isInputInFocus:!0})),C.current&&!L&&window.scroll({top:C.current.offsetTop,behavior:"smooth"})}function ge(L){P(j=>({...j,selectedUser:L,selectedProject:void 0})),b&&b()}async function we(){if(k.projects.length)await J();else{let L=t.find(N=>typeof k.selectedUser=="object"?N.email===k.selectedUser?.email:N.email===k.selectedUser),j=L?o.filter(N=>an(N)&&!L.projectNumIds.includes(N.num_id)):o;P(N=>({...N,isSelectUserProjectVisible:!0,unsharedProjects:j,filteredProjects:j.slice(0,2)}))}}return n(as,{query:`(min-width: ${p3})`,children:L=>n(Tm,{closeTitle:"Close",initialFocus:L&&Z&&S?"#rm-user-search-input":"",show:a,onExit:s,error:k.error,zIndex:l,dialogPosition:"relative",title:n(f,{as:"span",paddingLeft:L?at.regular+16:0,children:e?k.projects.length?R.length?"Collaborators":"Collaborate with":"Add collaborator":w(K,{children:[k.isSelectUserProjectVisible?n(ne,{as:"a",textStyle:L?"subheading":"regular",onClick:()=>{P(j=>({...j,isSelectUserProjectVisible:!1,projects:[]}))},color:"gray",children:"Add collaborator"}):n(I,{textStyle:L?"subheading":"regular",children:"Add collaborator"}),k.isSelectUserProjectVisible||k.selectedProject?w(K,{children:[n(I,{paddingLeft:"2rm",paddingRight:"2rm",textStyle:L?"subheading":"regular",color:"gray",children:">"}),k.selectedProject&&!k.isSelectUserProjectVisible?n(ne,{as:"a",textStyle:L?"subheading":"regular",onClick:()=>{P(j=>({...j,isSelectUserProjectVisible:!0,projects:[]}))},color:"gray",children:"Select project"}):n(I,{textStyle:L?"subheading":"regular",children:"Select project"})]}):null]})}),children:n(f,{height:["auto",e?"auto":"326px"],children:k.isSelectUserProjectVisible?w(f,{display:"flex",marginBottom:[0,k.selectedProject?28:k.filteredProjects.length?"15px":40],flex:["1",void 0],paddingTop:72,paddingLeft:[0,88],flexDirection:"column",justifyContent:"flex-start",children:[n(f,{children:k.selectedProject?w(f,{display:"flex",height:at.regular,alignItems:"center",position:"relative",borderBottom:"2px solid",borderBottomColor:k.collaboratorInvited?"transparent":"black",justifyContent:"space-between",children:[w(f,{display:"flex",whiteSpace:L?void 0:"nowrap",width:L?void 0:"calc(100vw - 200px)",overflow:L?void 0:"hidden",textOverflow:L?void 0:"ellipsis",children:[n(I,{textStyle:L?"subheading":"regular",display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",maxWidth:330,verticalAlign:"bottom",lineHeight:1.25,whiteSpace:"nowrap",children:ln(k.selectedProject)?k.selectedProject.name:k.selectedProject.title}),k.collaboratorInvited?null:n(ne,{className:"clear","aria-label":"Clear selection",onClick:()=>P(j=>({...j,selectedProject:void 0,filterProjects:"",filteredProjects:k.unsharedProjects.slice(0,2)})),marginTop:"1rm",children:n(Ht,{"aria-hidden":!0})})]}),k.collaboratorInvited?k.updatedTeammate&&n(pc,{isTeammatePending:k.updatedTeammate.isPending,isResend:k.lastInvinationTo===k.updatedTeammate._id,isSharedViaFolder:!1,onResend:()=>me(k.updatedTeammate),onMouseOut:()=>P(j=>({...j,lastInvinationTo:null})),onUnshare:()=>se(k.updatedTeammate)}):n(ne,{variant:"primary",textStyle:"subheading",type:"submit",position:"absolute",right:0,lineHeight:"72px",minWidth:60,onClick:async()=>{P(j=>({...j,projects:[k.selectedProject],collaboratorInvited:!0})),await J(void 0,!0)},children:"Invite collaborator"})]}):n(Em,{textStyle:L?"subheading":"regular",paddingRight:80,placeholder:"Project name",boxSizing:"border-box",height:at.regular,onChange:j=>{let N=j.target.value,de=k.unsharedProjects.filter((le,We)=>N?((ln(le)?le.name:le.title)||"").toLowerCase().includes(N.toLowerCase()):We<2);N&&de.length===1?P(le=>({...le,filteredProjects:de,selectedProject:de[0],filterProjects:N})):P(le=>({...le,filteredProjects:de,filterProjects:N}))}})}),k.selectedProject?n(f,{width:152,paddingTop:61,children:n(f,{display:"flex","data-testid":`project-card-${k.selectedProject._id}`,paddingLeft:"2rm",paddingRight:"2rm",position:"relative",flexDirection:"column",borderRadius:"4px",aspectRatio:1.66,borderColor:"lightGray",border:"1px solid",backgroundColor:"white",backgroundPosition:"center",backgroundSize:"cover",backgroundImage:ln(k.selectedProject)?"":k.selectedProject.cover})}):w(f,{display:"flex",paddingTop:65,flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",marginRight:-20,marginBottom:-11,children:[k.filterProjects?null:n(f,{display:"flex",marginBottom:[3,0],height:72,alignItems:"center",paddingRight:[0,18],children:n(I,{textStyle:L?"subheading":"regular",color:"gray",children:"Suggestions"})}),k.filteredProjects.map(j=>n(f,{cursor:"pointer",width:152,flex:"0 0 152px",paddingBottom:20,overflow:"hidden",marginRight:20,children:n(f,{display:"flex","data-testid":`project-card-${j._id}`,paddingLeft:"2rm",paddingRight:"2rm",position:"relative",flexDirection:"column",borderRadius:"4px",aspectRatio:1.66,borderColor:"lightGray",border:"1px solid",backgroundColor:"white",backgroundPosition:"center",backgroundSize:"cover",backgroundImage:ln(j)?"":j.cover,onClick:async()=>{P(N=>({...N,selectedProject:j}))}})},j._id))]})]}):w(f,{display:"flex",marginBottom:[0,F.length?0:40],flex:["1",void 0],flexDirection:"column",justifyContent:["space-between",void 0],children:[w(f,{marginTop:[0,72],marginBottom:[80,0],children:[e&&(L?n(f,{display:"flex",flexDirection:"column",children:R.map(j=>{let N=e.map(fe=>qg({teammate:j,projectNumId:an(fe)?fe.num_id:void 0,projectFolderId:an(fe)&&fe.folder||void 0,folderId:ln(fe)?fe._id:void 0})).filter(Boolean),de=[...new Set(N)],le=de.length?de.length===1?de[0]:"Multiple roles":null,We=e.filter(an).map(fe=>fe.num_id),he=e.filter(ln).map(fe=>fe._id);return w(f,{display:"flex",justifyContent:"space-between",children:[n(f,{minWidth:0,children:w(f,{display:"flex",alignItems:"center",children:[n(f,{minWidth:72,children:n("a",{href:`${p||"https://my.readymag.com"}/team/${j.uri}`,target:"_blank",rel:"noreferrer",children:n(zt,{name:j.name||"",url:j.pic})})}),n(f,{marginLeft:16,overflow:"hidden",children:n(I,{as:"div",textStyle:"subheading",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",lineHeight:2,paddingRight:2,children:j.name||j.email})})]})}),w(f,{display:"flex",gap:"20px",minWidth:0,flexShrink:0,children:[m?.length?n(zm,{roles:m,selectedRoleName:le,onChangeRole:async fe=>{let pe=Gr({items:j.projectNumIds,roles:j.projectRoles||{},newItems:We,newRole:fe}),ze=Gr({items:j.folderIds,roles:j.folderRoles||{},newItems:he,newRole:fe}),Ae={email:j.email,sharesAll:j.sharesAll||!1,projectNumIds:pe.items,projectRoles:pe.roles,folderIds:ze.items,folderRoles:ze.roles};await g(Ae)}}):void 0,j.email!==i.email?n(pc,{isTeammatePending:j.isPending,isResend:k.lastInvinationTo===j._id,isSharedViaFolder:W(j),onResend:()=>me(j),onMouseOut:()=>P(fe=>({...fe,lastInvinationTo:null})),onUnshare:()=>se(j)}):void 0]})]},j._id||j.email)})}):n(f,{display:"flex",marginTop:40,marginLeft:-24,paddingLeft:24,width:"100vw",overflowX:"auto",css:te`
                          -webkit-overflow-scrolling: ${k.isTeammateDropdownVisible?"auto":"touch"};
                          @media (max-height: ${uv}px) {
                            margin-top: 20px;
                          }
                        `,children:R.map(j=>n(Dm,{teammate:j,projectCount:td(j,o),onToggle:N=>P(de=>({...de,isTeammateDropdownOpen:N})),onAppear:()=>P(N=>({...N,isTeammateDropdownVisible:!0})),onDisappear:()=>P(N=>({...N,isTeammateDropdownVisible:!1})),onUnshare:()=>se(j),onResend:()=>me(j)},j._id||j.email))})),!e&&k.selectedUser&&k.updatedTeammate&&(L?n(f,{display:"flex",flexDirection:"column",marginBottom:S?143:0,marginTop:"-1px",children:w(f,{display:"flex",justifyContent:"space-between",children:[w(f,{display:"flex",alignItems:"center",children:[n(zt,{name:k.updatedTeammate.name||"",url:k.updatedTeammate.pic}),n(f,{marginLeft:16,children:n(I,{as:"div",textStyle:"subheading",children:k.updatedTeammate.name||k.updatedTeammate.email})})]}),n(pc,{isTeammatePending:k.updatedTeammate.isPending,isResend:k.lastInvinationTo===k.updatedTeammate._id,isSharedViaFolder:!1,onResend:()=>me(k.updatedTeammate),onMouseOut:()=>P(j=>({...j,lastInvinationTo:null})),onUnshare:()=>se(k.updatedTeammate)})]})}):n(f,{display:"flex",marginTop:40,marginLeft:-24,paddingLeft:24,width:"100vw",overflowX:"auto",css:te`
                          -webkit-overflow-scrolling: ${k.isTeammateDropdownVisible?"auto":"touch"};
                          @media (max-height: ${uv}px) {
                            margin-top: 20px;
                          }
                        `,children:n(Dm,{teammate:k.updatedTeammate,projectCount:td(k.updatedTeammate,o),onToggle:j=>P(N=>({...N,isTeammateDropdownOpen:j})),onAppear:()=>P(j=>({...j,isTeammateDropdownVisible:!0})),onDisappear:()=>P(j=>({...j,isTeammateDropdownVisible:!1})),onUnshare:()=>se(k.updatedTeammate),onResend:()=>me(k.updatedTeammate)},k.updatedTeammate._id||k.updatedTeammate.email)})),!k.isTeammateDropdownOpen&&S&&!k.collaboratorInvited?n(f,{position:"relative",children:n(f,{as:"form",onSubmit:j=>ee(j)&&we(),marginTop:[26,0],marginBottom:[0,F.length||!S?0:80],ref:C,children:n(Im,{placeholder:"Maria or maria@example",submitText:k.projects.length?S?"Invite":"Add":"Select project",disabled:k.collaboratorInvited||k.isSubmitting,suggestions:e?!k.error&&S?F:[]:[],onChange:ge,onFocus:()=>ke(L),onBlur:()=>ue(),"data-testid":"user-search",showInput:S,selectedUser:k.selectedUser,preSubmitSlot:m?.length?n(zm,{roles:m,selectedRoleName:k.selectedUserRole,onChangeRole:j=>{P(N=>({...N,selectedUserRole:j}))}}):void 0},k.userSearchKey)})}):null,!S&&!k.selectedUser&&F.length?w(f,{paddingLeft:[0,88],marginTop:[0,24],minHeight:[60,0],textAlign:L?"left":"center",paddingBottom:10,children:[k.projects.length?n(I,{textStyle:L?"subheading":"regular",color:"gray",children:"Add collaborator"}):null,n(f,{display:"flex",marginTop:[0,12],flexWrap:"wrap",children:F.map(j=>n(f,{height:146,children:n(Oi,{name:j.name||j.email,email:j.email,url:j.pic,projectsCount:j.projectsCount,isCaptionVisible:!L,fullBox:!L,"data-testid":j._id,onClick:async()=>{k.projects.length?await J(j):P(N=>({...N,selectedUser:j}))}})},j._id||j.email))})]}):null]}),S?null:n(K,{children:w(f,{paddingLeft:[0,88],marginTop:[0,k.updatedTeammate?67:k.selectedUser?106:F.length?12:24],marginBottom:[18,56],minHeight:[60,0],textAlign:L?"left":"center",children:[n(I,{as:"p",children:V}),!y&&n(I,{as:"p",children:x==="extra"?n(Re,{as:"a",color:"gray",href:"mailto:support@readymag.com",children:"Contact our support team to learn more."}):n(Re,{as:"a",color:"gray",href:"https://my.readymag.com/settings/#change-plan",target:"_blank",children:"Upgrade your plan to add collaborators."})})]})})]})})})})}var $m=c3;Xg();bi();Be();C2();pt();v();var gv=({children:e,...o})=>{let t=(0,Lm.useContext)(Te),r=(0,Lm.useContext)(ie);function i(s){let l=[...Object.values(s.projectRoles||{}),...Object.values(s.folderRoles||{})].filter(m=>m)[0]||"member";ae(ce.SettingsProject,{settingsType:"collaborate",collaborateType:l==="member"?"design and content":"content only"})}return n($m,{projects:r.teamworkProjects,allProjects:r.allProjects,myTeam:r.team,sharedTeam:[],user:r.me,show:!0,userRoles:je.rolesList,initialRole:"member",authHost:oe.readymag_auth_host,...o,onExit:()=>{t.dispatch({type:"toggleTeamworkModal",payload:!1})},onResendInvitation:async s=>{await Ag(s)},onTeammateAdd:async s=>{let a=await zg(s);return i(s),r.updateTeam([...r.team,a],r.project.num_id),a},onTeammateRemove:async s=>{await Rg(s.email),r.updateTeam([...r.team.filter(a=>a._id!==s._id)],r.project.num_id),ae(ce.SettingsProject,{settingsType:"collaborate unshare"})},onTeammateUpdate:async s=>{let a=await Eg(s);return i(s),r.updateTeam([...r.team.map(l=>l._id===a._id?a:l)],r.project.num_id),a}})};$h();Xo();pd();re();Pt();Ue();go();ao();tt();v();var d3=10,Hm=.3,hv=({children:e,...o})=>{let{isHovered:t,...r}=Ge(!1),{isHovered:i,...s}=Ge(!1),[a,l]=(0,Bn.useState)(void 0),m=(0,Bn.useContext)(Te),c=(0,Bn.useContext)(ie),p=()=>{let x="";return c.isOwner?x=`/${c.project.user.uri}`+(c.project.folder?`/f/${c.project.folder.uri}`:""):x=`/shared/${c.project.user.uri}`,x},u=c.ownedProjectTeam.filter(x=>x.email!==c.me.email),d=()=>{m.dispatch({type:"toggleTeamworkModal",payload:!0})},g=()=>{ae(ce.EditorActions,{action:"back to profile"}),window.location.href=p()},h=(0,Bn.useMemo)(()=>u.slice(0,d3).reverse(),[u]),b=u.length-h.length;return w(f,{position:"relative",width:"56px",height:"56px",...o,children:[m.isTeamworkModalOpened&&n(gv,{zIndex:10500}),w(f,{width:"100%",height:"100%",...r,children:[w(f,{...s,children:[n(Zx,{}),i&&n(mt,{position:"absolute",top:"0px",left:"0px",width:"56px",height:"56px",color:"darkGray",hoverColor:"darkGray",activeColor:"darkGray",borderRadius:"50%",onClick:g,children:n(aa,{color:"white"})})]}),w(f,{width:"56px",height:"72px",position:"absolute",bottom:"100%",visibility:t?"visible":"hidden",opacity:t?"1":"0",transform:t?"translateY(0px)":"translateY(4px)",transition:`opacity ${Hm}s ease, transform ${Hm}s ease, visibility 0s ${t?"0s":Hm+"s"} ease`,children:[b>0&&n(f,{bottom:48*(h.length+1)+16,position:"absolute",width:"58px",height:"58px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",color:"white",backgroundColor:"darkGray",cursor:"pointer",onClick:d,children:`+${b}`}),h.map(({email:x,pic:y,name:S},k)=>w(f,{position:"absolute",width:"56px",height:"56px",bottom:48*(h.length-k)+16,zIndex:a===x?h.length+2:void 0,cursor:"pointer",onMouseEnter:()=>l(x),onMouseLeave:()=>l(void 0),onClick:d,css:te`
                & > * {
                  width: 100% !important;
                  height: 100% !important;
                }
              `,children:[n(zt,{url:y,name:S||x,type:"settingsUser"}),n(f,{boxShadow:`0 0 0 2px inset ${Ee(.6,O.gray)}`,position:"absolute",top:"0",borderRadius:"50%",width:"100%",height:"100%"})]},x)),c.isOwner?n(dt,{text:"Add collaborator",indent:8,preventOverflow:16,open:u.length>0?!1:void 0,children:n(mt,{position:"absolute",top:"0",zIndex:u.length+1,width:"56px",height:"56px",color:"darkGray",hoverColor:"black",activeColor:"black",onClick:d,children:n(un,{width:"24px",height:"24px",color:"white"})})}):null]})]})]})};ve();var In=T(H());Oe();ao();Be();G();v();var fv=({id:e="pageIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,width:o,height:t,viewBox:"0 0 27 28",xmlns:"http://www.w3.org/2000/svg",style:{padding:i},children:[w("line",{x1:"1",y1:"25.5",x2:"26",y2:"25.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animateTransform",{attributeName:"transform",type:"translate",to:"0 2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"translate",from:"0 2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"1",y1:"3.5",x2:"26",y2:"3.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animateTransform",{attributeName:"transform",type:"translate",to:"0 -2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"translate",from:"0 -2",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};v();var bv=({onClick:e,disableTooltip:o})=>{let t=(0,In.useContext)(ie),[r,i]=(0,In.useState)(""),[s,a]=(0,In.useState)("");return(0,In.useEffect)(()=>{let{currentPageId:l,pagesParams:m}=t;m[l]&&(m[l].parentId?(i(`${m[m[l].parentId].viewNum}`),a(`${m[l].viewNum}`)):(i(`${m[l].viewNum}`),s&&a("")))},[t.currentPageNum,t.currentPageId,t.pagesParams]),n(dt,{instance:!0,closeOnTargetClick:!0,text:"Pages (M)",indent:8,disabled:o,leaveDelay:100,children:w(ne,{display:"flex",alignItems:"center",justifyContent:"center",onClick:e,variant:"unstyled",height:"100%",width:"100%",position:"relative",color:"white","aria-label":"Pages","data-testid":"pages-button",children:[n(fv,{width:"26px",height:"28px",hoverBox:{width:56,height:56}}),w(f,{width:"100%",height:"100%",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",children:[n(I,{textStyle:"subheading",fontSize:"20px",color:"white",children:r}),s?w(I,{textStyle:"small",position:"relative",top:5,fontWeight:"700",color:"white",marginBottom:"4px",children:[".",s]}):null]})]})})};Oe();v();var wv=({id:e="desktopIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"4",y:"5.5",width:"26",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2",children:[n("animate",{attributeName:"x",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"1",y1:"27.5",x2:"33",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};v();var xv=({id:e="phoneIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"10",y:"1",width:"14",height:"30",rx:"3",stroke:"currentColor",strokeWidth:"2",children:[n("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"14",y1:"27.5",x2:"20",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};v();var vv=({id:e="tabletIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 34 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("rect",{x:"7",y:"1",width:"20",height:"30",rx:"3",stroke:"currentColor",strokeWidth:"2",children:[n("animate",{attributeName:"x",to:"4",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x",to:"7",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"5.5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"y",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"26",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"width",to:"20",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"18",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"height",to:"30",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"2",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"rx",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"17",y1:"27.5",x2:"17",y2:"27.5",stroke:"currentColor",strokeWidth:"2",strokeOpacity:"0",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"17",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"33",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"17",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"stroke-opacity",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"discrete"}),n("animate",{attributeName:"stroke-opacity",to:"0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"discrete"})]})]})};ot();_o();ct();v();function kv({currentViewport:e,disableTooltip:o,onClick:t,...r}){return n(ht,{targetSteps:["CreateLayout","OpenMobileLayout"],defaultText:"Devices (D)",indent:8,disabled:o,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:n(ne,{display:"flex",alignItems:"center",justifyContent:"center",onClick:t,variant:"unstyled",height:"100%",width:"100%",color:"white","aria-label":"Viewports","data-testid":"viewport-button",...r,children:e==="tablet_portrait"?n(vv,{width:"34px",height:"32px",hoverBox:{width:56,height:56}}):e==="phone_portrait"?n(xv,{width:"34px",height:"32px",hoverBox:{width:56,height:56}}):n(wv,{width:"34px",height:"32px",hoverBox:{width:56,height:56}})})})}var Xm=T(H());var En=T(H());var To=T(H());G();var vo=T(H());G();Be();bd();var no=T(H());G();pa();Fh();ve();Yo();Br();var mc=T(H());Xf();G();ca();G();Oe();v();function _v({isPageSettingsOpened:e,hideDelete:o,actionCallback:t}){return w(f,{"aria-label":"Page action menu",paddingLeft:"4rm",paddingTop:12,children:[n(f,{children:n(Ze,{"aria-label":"Duplicate page","data-testid":"duplicate-page",textStyle:"subheading",color:"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("duplicate")},children:"Duplicate"})}),n(f,{marginTop:12,children:n(Ze,{"aria-label":"Toggle page settings","data-testid":"toggle-page-settings",textStyle:"subheading",color:e?"tomato":"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("settings")},children:"Settings"})}),!o&&n(f,{marginTop:12,children:n(Ze,{"aria-label":"Delete page","data-testid":"delete-page",textStyle:"subheading",color:"white",onClick:r=>{r.preventDefault(),r.stopPropagation(),t("detele")},children:"Delete"})})]})}var cc=T(H()),Cv=T(nr());G();Pt();ao();Ue();re();v();var Sv=(0,cc.forwardRef)(({isShown:e,position:o="absolute",zIndex:t=8e3,transform:r,placement:i,placementStyles:s,rootElement:a,children:l,...m},c)=>{if(!e)return null;let p=(0,cc.useMemo)(()=>{let u="";switch(i){case"bottom":u="bottom: -8px; left: 20px;";break;case"right":u="bottom: calc(50% - 4px); right: -12px; transform: rotate(-90deg);";break;case"left":u="bottom: calc(50% - 4px); left: -12px; transform: rotate(90deg);";break;default:break}return u},[i]);return Cv.default.createPortal(w(f,{ref:c,position:o,zIndex:t,borderRadius:"4px",backgroundColor:Ee(.08,O.black),transform:r||"none",transition:"0.3s transform ease",...m,children:[l,i&&n(f,{display:"flex",height:8,width:16,position:"absolute",color:Ee(.08,O.black),css:te`
              ${s||p}
            `,children:n(Ih,{})})]}),a||document.body)});Sv.displayName="Popup";var dc=Sv;re();v();var Pv=f.withComponent(Y("button")`
  width: 32px;
  height: 32px;
  color: ${e=>e.theme.colors.black};
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  transition: opacity 0.2s ease;
  padding: 0;
  margin: 0;
  border: none;
  box-shadow: rgb(128 128 128 / 16%) 0px 0px 0px 1px;
  cursor: pointer;
  &:hover {
    color: ${e=>e.theme.colors.tomato};
  }

  ${e=>ll({light:{backgroundColor:"white"},dark:{backgroundColor:e.theme.colors.lightGray}})}

  ${e=>e.isActive&&te`
      background-color: ${e.theme.colors.tomato};
      color: white;
      &:hover {
        color: white;
      }
    `}
`);Pv.defaultProps={variant:"light"};var Om=(0,mc.memo)(({isPopupOpened:e,isCurrentPage:o,popupContainer:t,hideDelete:r,onPageActionsButtonClick:i,isPageSettingsOpened:s,pageActionsHandler:a,collaboratorName:l,collaboratorAvatar:m,keepActionButtons:c,isHovered:p,buttonVariant:u="light"})=>{let[d,g]=(0,mc.useState)({left:0,top:0}),h=Ql({watchingClick:e,callback:()=>{i(!0)}});return w(f,{display:"flex",children:[n(Pv,{marginRight:0,"data-testid":"toggle-page-actions-popup",variant:u,isActive:e||s&&o,opacity:p||c?1:0,onClick:b=>{if(b.preventDefault(),b.stopPropagation(),t){let x=b.currentTarget.getBoundingClientRect(),y=t.getBoundingClientRect();g({left:x.left-y.left+x.width+12,top:x.top-y.top-(r?28:46)}),i()}},children:n($o,{color:"currentColor"})}),t&&n(dc,{ref:h,rootElement:t,isShown:e,width:148,height:r?88:124,top:`${d.top}px`,left:`${d.left}px`,placement:"left",children:n(_v,{isPageSettingsOpened:s&&o,hideDelete:r,actionCallback:a})}),l&&n(zt,{size:"small",marginLeft:"8px",url:m,name:l})]})});Om.displayName="PageActionsSmallPanel";G();Ue();Xo();Lh();V2();Yr();re();var Tv=T(H());v();var u3=Y(f)`
  display: flex;
  width: 128px;
  height: 32px;
  justify-content: center;
  transition: opacity 0.2s ease;
  & > * {
    margin-left: 16px;
    &:first-of-type {
      margin-left: 0;
    }
  }
`,g3=Y(f)`
  display: flex;
  width: 32px;
  height: 128px;
  flex-direction: column;
  justify-content: center;
  transition: opacity 0.2s ease;
  & > * {
    margin: 3px 0;
  }
`,h3=(0,Tv.memo)(({isCurrentPage:e,isPageSettingsOpened:o,hideDelete:t,collaboratorName:r,collaboratorAvatar:i,vertical:s,pageActionsHandler:a,keepActionButtons:l,isHovered:m,...c})=>w(s?g3:u3,{"aria-label":"Page action buttons",...c,children:[n(mt,{"aria-label":"Duplicate page","data-testid":"duplicate-page",height:32,width:32,color:"white",outline:!0,marginRight:0,unstyledHover:!0,opacity:m?1:o?0:l?1:0,transition:"opacity 0.2s ease",css:te`
            &:hover {
              background-color: ${O.white};

              & svg {
                color: ${O.red};
              }
            }

            &:active {
              background-color: ${O.red};

              & svg {
                color: ${O.white};
              }
            }
          `,onClick:u=>{u.preventDefault(),u.stopPropagation(),a("duplicate")},children:n(Dl,{color:"black"})}),n(mt,{"aria-label":"Toggle page settings","data-testid":"toggle-page-settings",height:32,width:32,color:"white",outline:!0,"data-active":e&&o,marginRight:0,opacity:m||l?1:0,transition:"opacity 0.2s ease",css:te`
            &:hover {
              background-color: ${O.white};

              & svg {
                color: ${O.red};
              }
            }

            &:active {
              background-color: ${O.red};

              & svg {
                color: ${O.white};
              }
            }
          `,onClick:u=>{u.preventDefault(),e&&u.stopPropagation(),(!o||o&&!e||o&&e)&&a("settings")},children:n(qh,{color:e&&o?"white":"black"})}),t||r?null:n(mt,{"aria-label":"Delete page","data-testid":"delete-page",height:32,width:32,color:"white",outline:!0,marginRight:0,opacity:m?1:o?0:l?1:0,transition:"opacity 0.2s ease",css:te`
              &:hover {
                background-color: ${O.white};

                & svg {
                  color: ${O.red};
                }
              }

              &:active {
                background-color: ${O.red};

                & svg {
                  color: ${O.white};
                }
              }
            `,onClick:u=>{u.preventDefault(),u.stopPropagation(),a("detele")},children:n(Ht,{color:"black"})}),r&&n(zt,{size:"small",url:i,name:r,transform:m?"translateX(0)":`${s?"translateY":"translateX"} (${l?0:"-48px"})`,transition:"opacity 0.2s ease, transform 0.2s ease-in-out"})]})),Nm=f.withComponent(h3);Nm.displayName="PageActionsStandartPanel";var Ni=T(H());G();Be();v();var gc=(0,Ni.memo)(({isCurrentPage:e,pageId:o,gridSize:t,hidden:r=!1,vertical:i,viewport:s,isHovered:a,actionButtonVariant:l,...m})=>{let c=(0,Ni.useContext)(Te),p=(0,Ni.useContext)(ie),u=(0,Ni.useContext)(Fm),d=()=>{c.masterSharePidIsChanging||p.deletePage(o)},g=()=>{let P=`pending-${Date.now()}`,C=p.pages.find($=>$._id===o),B=p.pagesParams[o];if(C){let $=B.children.length&&B.collapsed;u.addPendingPage({_id:P,uri:"",screenshot:C.screenshot,title:C.title,num:B.children.length?C.num:C.num+1,parentPage:$?C._id:C.parentPage,hidden:!1,isPrivate:!1,pending:!0})}p.duplicatePage(o).then(()=>{}).catch($=>{console.warn("page dublicate",$)}).finally(()=>{u.removePendingPage(P)})},h=()=>{c.isPageSettingsOpened&&!e?window.RM.constructorRouter.showWorkspace({id:o}):!c.isPageSettingsOpened&&!e?(window.RM.constructorRouter.showWorkspace({id:o}),c.dispatch({type:"togglePageSettings"})):c.dispatch({type:"togglePageSettings"})},b=P=>{let C=!1;if(P){c.dispatch({type:"setPageActionsPopup",payload:C});return}c.isPageActionsPopupOpenedFor!==o&&(C=o),c.dispatch({type:"setPageActionsPopup",payload:C})},x=P=>{switch(P){case"duplicate":g();break;case"detele":d();break;case"settings":c.isPageActionsPopupOpenedFor&&b(!0),h();break;case"gotopage":p.changeWorkspace({id:o});break;default:break}},y=(0,Ni.useMemo)(()=>c.isPageActionsPopupOpenedFor===o,[c.isPageActionsPopupOpenedFor]),S=p.lockedPages[o],k=S&&S!==window.RM.constructorRouter.me?.get("uri")?p.collaborators.find(P=>P.uri===S):void 0;return r?null:t===0?n(f,{children:n(Nm,{isCurrentPage:e,keepActionButtons:e&&!c.addingPage,isPageSettingsOpened:c.isPageSettingsOpened,hideDelete:p.pages.length===1,collaboratorName:k&&k.name,collaboratorAvatar:k&&k.pic,vertical:i,position:"absolute",top:i?0:"auto",right:i?"auto":0,bottom:i?"auto":8,left:i?"100%":0,margin:i?"0 0 0 8px":"auto",pageActionsHandler:x,isHovered:a})}):n(f,{display:"flex",alignItems:"center",position:"absolute",top:0,bottom:0,margin:"auto",left:7,...m,children:n(Om,{isPopupOpened:y,popupContainer:document.getElementById("settings-popup-container"),hideDelete:p.pages.length===1,onPageActionsButtonClick:b,isPageSettingsOpened:c.isPageSettingsOpened,collaboratorName:k&&k.name,collaboratorAvatar:k&&k.pic,isCurrentPage:e,keepActionButtons:e&&!c.addingPage,pageActionsHandler:x,isHovered:a,buttonVariant:l})})});gc.displayName="ActionsPanelWraper";Be();to();ot();re();go();var Fi=T(H());v();var Mv=(0,Fi.createContext)({addElementPageToMap:()=>{}}),{Provider:f3}=Mv;function Bv(e){let{current:o}=(0,Fi.useRef)(new Map);(0,Fi.useEffect)(()=>{if(e.currentPageID){let r=o.get(e.currentPageID);r&&r.scrollIntoView({block:"nearest"})}},[e.currentPageID]);function t(r,i){o.has(r)||i&&o.set(r,i)}return n(f3,{value:{addElementPageToMap:t},children:e.children})}var Iv=()=>(0,Fi.useContext)(Mv);v();var Wm=(0,no.memo)(({page:e,gridSize:o,dragableRef:t,level:r=0,head:i,childIndex:s,onCollapsed:a,isPageCollapsed:l=!0,viewNum:m,selectedPageIds:c=[],isCurrent:p,isPrivatePages:u,isSortableActive:d,sortableId:g,onSortableItemId:h,selectPage:b,selectPagesRange:x,deselectPages:y,changeWorkspace:S,pageSave:k,updatePageScreenshot:P,validatePageUri:C})=>{let{isHovered:B,...$}=Ge(!1),{addElementPageToMap:A}=Iv(),R=r&&r*16,Z=z=>{z.defaultPrevented||(z.metaKey||z.ctrlKey?b(e._id):z.shiftKey?x(e._id):c.length?y():d||S({id:e._id}))},F=()=>a&&a(),[V,W]=(0,no.useState)(()=>e.title?e.title:""),[J,me]=(0,no.useState)(!1),{viewport:se}=(0,no.useContext)(Je);(0,no.useEffect)(()=>{!J&&e.title!==V&&W(e.title?e.title:"")},[e.title,V,J]);let ee=()=>{me(!1);let z=k(e._id,{title:V},{patch:!0});z&&!(z instanceof Error)&&z.done(U=>{}).fail(()=>{})},[ue,ke]=(0,no.useState)(null);(0,no.useEffect)(()=>{ke(e._id===h?"gray":c.includes(e._id)?"tomato":null)},[h,e._id,c]),(0,no.useEffect)(()=>{!e.screenshot&&P(e._id)},[e._id,e.screenshot,P]);let ge=e.pending,we=(0,no.useRef)(null),L=(0,no.useCallback)(z=>{z!==e.uri&&k(e._id,{uri:z},{patch:!0})},[e._id,e.uri,k]),j=(0,no.useCallback)(z=>C(e._id,z),[e._id,C]),N=(0,no.useCallback)(z=>z.replace(/[^A-Za-z0-9_.+-]/g,""),[]),de=e.viewport_phone_portrait?.enabled,le=e.viewport_tablet_portrait?.enabled,We=e.viewport_phone_portrait?.screenshot,he=e.viewport_tablet_portrait?.screenshot,fe=!!(se==="phone_portrait"&&We)&&de,pe=!!(se==="tablet_portrait"&&he)&&le,ze=o===0?"standard":"small",{width:Ae,height:Ne}=fe?dp.phone_portrait[ze]:pe?dp.tablet_portrait[ze]:dp[ze],ft=se==="phone_portrait",M=se==="tablet_portrait";return w(f,{width:"192px",paddingTop:"2px",paddingBottom:"2px",marginLeft:`${R}px`,position:"relative",display:o===0?"block":"flex",className:"page-list-item",ref:z=>A(e._id,z),...$,children:[u&&e.isPrivate?n(x3,{color:p?"tomato":"black",level:r,gridSize:o,page:e,position:"absolute",zIndex:1,top:o===0?64:"25px",left:o===0?r?-6:-4:"-8px",transformOrigin:"left",transform:"scale(0.75)"}):p?n(w3,{position:"absolute",top:o===0?70:"31px",left:o===0?-3:"-7px"}):void 0,i&&n(f,{width:12,height:12,position:"absolute",top:o===0?143:20,left:o===0?5:ft?41:M?56:97,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:Tn.pageItem,transform:`rotate(${l?"0deg":"-90deg"})
              translateX(${l?0?"3px":"2px":"0px"})`,transition:"transform 200ms ease",onClick:F,children:n(Do,{color:"black"})}),n(f,{"aria-label":"Page thumbnail",width:Ae+(o===0?16:8),height:Ne+(o===0?16:8),className:"page-list-item-picture",marginBottom:r?1:"0px",borderRadius:o===0?"8px":"6px",position:"relative",zIndex:Tn.pageItem,padding:o===0?"4px":"2px",cursor:"pointer",transformOrigin:"left",overflow:!fe&&!pe?"hidden":"",flex:"0 0 auto",transform:`scale(${r&&o===0?"0.92":"1"})`,css:z=>te`
            border: ${o===0?"4px":"2px"} solid
              ${ue?z.colors[ue]:"transparent"};
          `,onClick:Z,children:w(f,{className:"sortable-item-handle",height:o===0?124:"56px",position:"relative",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",borderRadius:fe||pe||o===1?"4px":"8px",backgroundColor:"white",ref:t,children:[ge&&n(f,{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",zIndex:Tn.pageItem,children:n(Xt,{bgColor:"transparent"})}),n(_i,{desktopUrl:e.screenshot,phonePortraitUrl:We,tabletPortraitUrl:he,phoneViewportEnabled:de,tabletViewportEnabled:le,opacity:e.hidden?.4:1,imageSize:ze,viewport:se}),!ge&&(o!==1||!fe)&&n(gc,{isCurrentPage:p,pageId:e._id,gridSize:o,hidden:!!d,vertical:fe||pe,viewport:se,isHovered:B})]})}),w(f,{opacity:o===0&&e._id===g&&d?0:1,children:[w(f,{width:"100%",marginLeft:`${o===0?i?24:8:i?20:4}px`,marginTop:`${o===0?i?-1:0:16}px`,children:[w(I,{textStyle:"small",float:"left",children:[m,s?`.${s}`:"",".\xA0"]}),n(vt,{type:"text",textStyle:"small",color:"black",placeholder:"Page Title",spellCheck:!1,autoComplete:"off",autoCorrect:"off",maxLength:128,value:V,disabled:ge,onChange:z=>{W(z.target.value)},onBlur:ee,onFocus:()=>{me(!0)},width:`${o===0?i||r?156:170:i||r?62:82}px`,height:"auto",padding:"0",textOverflow:"ellipsis",css:te`
                &:focus {
                  border: none;
                }
              `})]}),n(f,{width:"100%",marginLeft:`${o===0?i&&l?24:8:4}px`,marginTop:"-2px",display:"flex",justifyContent:"start",ref:we,children:n(Ms,{validationMessageAnchor:we.current,validationMessageContainer:document.getElementById("settings-popup-container"),name:"link",placeholder:"custom url",textStyle:"small",link:e.uri,disabled:ge,width:o===0?i||r?172:192:i||r?80:96,withSlash:!0,validationMessageZIndex:3,validationMessagePlacement:"right",validate:j,filter:N,onDone:L})})]}),!ge&&fe&&o===1&&n(gc,{isCurrentPage:p,pageId:e._id,gridSize:o,hidden:!!d,vertical:fe||pe,viewport:se,isHovered:B,position:"static",actionButtonVariant:"dark"})]})});Wm.displayName="PageListItem";var w3=e=>n(f,{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"tomato",zIndex:Tn.pageItem,...e});function x3({color:e,level:o,gridSize:t,page:r,...i}){let s=(0,no.useContext)(Te);return n(f,{onClick:()=>{s.dispatch({type:"togglePrivatePages",payload:r._id})},cursor:"pointer",...i,children:n($l,{color:e})})}var hc=T(H());G();Be();re();v();var Um=(0,hc.memo)(({topPageId:e,stackedPages:o,gridSize:t,level:r=0})=>{let i=(0,hc.useContext)(ie),s=r&&r*16,a=i.pagesTree.reduce((l,m)=>m.children instanceof Array?[...l,m,...m.children]:[...l,m],[]).filter(l=>o.includes(l._id));if(e){let l=a.findIndex(c=>c._id===e),[m]=a.splice(l,1);a.unshift(m)}return a=a.slice(0,4).reverse(),w(f,{width:"192px",height:t===0?"176px":"68px",paddingTop:"2px",paddingBottom:"2px",marginLeft:`${s}px`,position:"relative",display:t===0?"block":"flex",userSelect:"none",children:[a.map((l,m)=>n(f,{top:t===0?(a.length-1-m)*4:0,left:(a.length-1-m)*4,width:t===0?208:"96px",height:t===0?140:"64px",className:"page-list-item-picture",marginBottom:r?1:"0px",borderRadius:t===0?"8px":"4px",position:"absolute",zIndex:1,padding:t===0?"4px":"2px",border:`${t===0?"4px":"2px"} solid transparent`,cursor:"pointer",transformOrigin:"left",overflow:"hidden",flex:"0 0 auto",transform:`scale(${r&&t===0?"0.92":"1"})`,css:te`
            :hover {
              .page-actions-standart-panel > * {
                opacity: 1;
                display: block;
              }
              .page-actions-button {
                opacity: 1;
                display: block;
              }
            }
          `,children:n(f,{borderRadius:"4px",height:t===0?124:"56px",backgroundColor:"#FFF",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:n(_i,{desktopUrl:l.screenshot,imageSize:t===0?"standard":"small"})})},l._id)),n(f,{height:32})]})});Um.displayName="StackedPages";v();var uq=typeof window<"u"&&(window.requestAnimationFrame||window.setImmediate)||(e=>setTimeout(e,0)),v3=(e,o,t)=>e[o]?e[o].parentId?e[e[o].parentId].viewNum:e[o].viewNum:t,fc=(0,vo.memo)(({page:e,gridSize:o,level:t=0,dropableId:r,childIndex:i})=>{let s=(0,vo.useContext)(ie),a=(0,vo.useContext)(Gl),l=(0,vo.useRef)(null),m=!!(e.children&&e.children.length),c=s.pagesParams[e._id]?s.pagesParams[e._id].collapsed:!0,[p,u]=(0,vo.useState)(!1),[d,g]=(0,vo.useState)(0),h=s.setPageCollapse,b=(0,vo.useCallback)(()=>{h(e._id,!c),u(!1),c?g(setTimeout(()=>{u(!0)},800)):d&&(clearTimeout(d),g(0))},[h,e._id,c,d]),[x,y]=(0,vo.useState)(!1),[S,k]=(0,vo.useState)(!1);return(0,vo.useEffect)(()=>{if(a.isActive&&a.id){if(s.selectedPages.includes(a.id))if(a.id===e._id){y(!0),k(!1);return}else{y(!1),k(s.selectedPages.includes(e._id));return}else if(a.id===e._id&&e.children){y(!0);return}}y(!1),k(!1)},[e._id,e.children,s.selectedPages,a.id,a.isActive]),S?null:n(Sf,{draggableId:e._id,dropableId:r,children:({ref:P,mouseDownRef:C})=>n(f,{position:"relative",ref:P,children:x?n(Um,{topPageId:e._id,stackedPages:s.selectedPages.includes(e._id)?s.selectedPages:[e._id,...e.children.map(B=>B._id)],gridSize:o,level:a.id===e._id?a.parentId?1:0:t}):w(K,{children:[n(Wm,{page:e,gridSize:o,dragableRef:C,level:a.id===e._id?a.parentId?1:0:t,head:m,onCollapsed:b,isPageCollapsed:c,childIndex:i,viewNum:v3(s.pagesParams,e._id,e.num),selectedPageIds:s.selectedPages,isCurrent:e._id===s.currentPageId,isPrivatePages:s.project.isPrivatePages,sortableId:a.id,onSortableItemId:a.onItemId,isSortableActive:a.isActive,selectPage:s.selectPage,selectPagesRange:s.selectPagesRange,deselectPages:s.deselectPages,changeWorkspace:s.changeWorkspace,pageSave:s.pageSave,updatePageScreenshot:s.updatePageScreenshot,validatePageUri:s.validatePageUri}),c&&!p&&e.children&&m?n(Vl,{parentId:e._id,dropableId:e._id,children:({dropElementRef:B,dropableId:$})=>n(f,{className:"page-children-container",ref:l,"data-parent-id":e._id,style:{height:c?"auto":"0px",overflow:c?"visible":"hidden",transition:"height 200ms ease"},children:n(f,{ref:B,children:e.children.map((A,R)=>n(fc,{page:A,gridSize:o,level:t+1,dropableId:$,childIndex:R+1},A._id))})})}):null]})})})});fc.displayName="Branch";Be();bd();v();var Fm=(0,To.createContext)({removePendingPage:()=>{},addPendingPage:()=>{}}),k3=({children:e,...o})=>{let t=(0,To.useContext)(Te),r=(0,To.useContext)(ie),i=(0,To.useContext)(Gl),[s,a]=(0,To.useState)(0),[l,m]=(0,To.useState)([]),c=(0,To.useCallback)(g=>{m([...l,g])},[l]),p=(0,To.useCallback)(g=>{m(l.filter(h=>h._id!==g))},[l]);(0,To.useEffect)(()=>{if(i.isActive&&i.id&&r.selectedPages.includes(i.id)){let g=r.pagesTree.reduce((h,b)=>(Array.isArray(b.children)?h.push(b,...b.children):h.push(b),h),[]).filter(h=>r.selectedPages.includes(h._id)).findIndex(h=>h._id===i.id);a(Math.max(0,g*(t.gridSize===0?176:68)));return}a(0)},[i.isActive]);let u=(0,To.useCallback)(g=>g.sort((h,b)=>(h.pending?h.num-1:h.num)-(b.pending?b.num-1:b.num)),[]),d=l.length?u([...r.pagesTree.map(g=>{let h=l.filter(b=>b.parentPage===g._id);return h.length?{...g,children:u([...g.children?g.children:[],...h])}:g}),...l.filter(g=>!g.parentPage)]):r.pagesTree;return n(Fm.Provider,{value:{addPendingPage:c,removePendingPage:p},children:w(f,{display:"flex",id:"page-list-container",flexDirection:"column",justifyContent:"left",flexWrap:"wrap",userSelect:"none",...o,children:[i.isActive?n(f,{height:s}):null,n(Vl,{dropableId:"0",children:({dropElementRef:g,dropableId:h})=>n(f,{ref:g,children:d.map(b=>n(fc,{page:b,gridSize:t.gridSize,dropableId:h},b._id))})})]})})},Gm=k3;Be();G();ve();Y2();j2();var Bo=T(H());b2();var bc=T(Lu());Be();bd();v();var zv=({children:e})=>{let o=(0,Bo.useContext)(Te),t=(0,Bo.useContext)(ie),r=(0,Bo.useRef)(!0),i=(0,Bo.useRef)(null),s=(0,Bo.useRef)(!1),a=(0,Bo.useRef)(null),l=(0,Bo.useRef)(!1),m=(0,Bo.useRef)(null),c=(0,Bo.useRef)(null);(0,Bo.useEffect)(()=>{c.current&&(o.isPageActionsPopupOpenedFor?c.current.style.overflowY="hidden":c.current.style.overflowY="scroll")},[o.isPageActionsPopupOpenedFor]);let p=u=>{c.current=u;let d=u.scrollHeight,g=u.clientHeight,h=u.scrollTop,b=!!h,x=g<d&&g+h<d;x!==l.current&&(l.current=x,a.current&&(x?a.current.style.display="block":a.current.style.display="none")),b!==s.current&&(s.current=b,i.current&&(b?i.current.style.display="block":i.current.style.display="none"))};return(0,Bo.useEffect)(()=>{c.current&&p(c.current)},[o.gridSize,t.pagesParams]),n(Cf,{unionOn:!0,idList:Yc(t.pagesTree),isDragOff:o.isPageSettingsOpened,onAfterDragEnd:()=>{m.current&&m.current.style.removeProperty("height");let u=document.getElementsByTagName("body")[0],d=u.className;u.className=d.split(" ").filter(g=>g&&g!=="user-select-none").join(" "),r.current=!0},onBeforeDragStart:u=>{if(t.selectedPages.includes(u))return(0,bc.without)(t.selectedPages,u);let d=t.pagesTree.find(g=>g._id===u);return d&&d.children&&(t.pagesParams[d._id]?t.pagesParams[d._id].collapsed:!0)?d.children.map(h=>h._id):[]},onDragStart:()=>{let u=document.getElementsByTagName("body")[0];u.className+=" user-select-none",m.current&&(m.current.style.height=m.current.clientHeight+"px"),r.current=!1},onDragEnd:(u,d,g,h)=>{let b=Yc(t.pagesTree),x=t.pagesTree.reduce((C,B)=>(C.push(B),B.children?[...C,...B.children]:C),[]).find(C=>C._id===u),y=t.selectedPages.includes(u)?h.length?[...h,u]:[u]:d&&x&&x.children?[u,...x.children.map(C=>C._id)]:[u],S=(C,B)=>{let $=[];for(let A=0;A<C.length;A++)if(B.includes(C[A].id)&&$.push(C[A]),C[A].items){let R=S(C[A].items,B);$=[...$,...R]}for(let A=0;A<B.length;A++){let R=(0,bc.findIndex)(C,Z=>Z.id===B[A]);R!==-1&&C.splice(R,1)}return $},k=(C,B,$,A)=>{if(!A){C.splice($,0,...B);return}for(let R=0;R<C.length;R++){if(C[R].id===A){C[R].items||(C[R].items=[]),B.forEach(Z=>Z.parentId=C[R].id),k(C[R].items,B,$);return}C[R].items&&k(C[R].items,B,$,A)}},P=S(b,y);if(P.length){P.forEach(A=>A.parentId=void 0),k(b,P,g,d);let C=sg(b),B=1,$=C.map(A=>({id:A.id,num:B++,parentPage:A.parentId||null}));t.saveOrder($),setTimeout(()=>{t.updateUrl()},100)}},children:()=>e})};G();v2();Be();jr();var Io=T(H());v();function Vm({children:e,bottomLine:o,...t}){let r=(0,Io.useContext)(Te),i=(0,Io.useContext)(ie),s=(0,Io.useRef)(!0),a=(0,Io.useRef)(null),l=(0,Io.useRef)(!1),m=(0,Io.useRef)(null),c=(0,Io.useRef)(null);(0,Io.useEffect)(()=>{c.current&&(r.isPageActionsPopupOpenedFor?c.current.style.overflowY="hidden":c.current.style.overflowY="scroll")},[r.isPageActionsPopupOpenedFor]);let p=g=>{c.current=g;let h=g.scrollHeight,b=g.clientHeight,x=g.scrollTop,y=b<h&&b+x<h;y!==l.current&&(l.current=y,a.current&&(y?a.current.style.display="block":a.current.style.display="none"))},u=(0,Io.useCallback)(g=>{if(!s.current)return;let h=g.target;h&&p(h)},[s]),d=g=>{p(g)};return(0,Io.useEffect)(()=>{c.current&&p(c.current)},[r.gridSize,i.pagesParams]),n(eo,{onScroll:u,onFirstRender:d,children:({ref:g})=>w(f,{ref:mg(g,m),overflow:"hidden",...t,children:[e,o&&o(a)]})})}var zn=T(H());tt();Be();var zo=T(H());G();Oe();Xf();re();var jm=T(H());G();Br();ve();var Ev="https://st-p.rmcdn.net/a3d0cfe4/dist/rm-templates-XWWYJF2Q.png";v();function _3({onMyTemplatesClick:e,onRmTemplatesClick:o,isUserTemplatesLoading:t,userTemplatesScreenshot:r}){let[i,s]=(0,jm.useState)(!1),[a,l]=(0,jm.useState)(!1),m=p=>{p.preventDefault(),o()},c=p=>{p.preventDefault(),e()};return w(f,{display:"flex",flexDirection:"column",color:"white",paddingTop:"4rm",paddingLeft:"4rm",paddingBottom:"4rm",children:[w(f,{display:"flex","data-testid":"show-rm-templates-modal",alignItems:"center",cursor:"pointer",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:m,children:[n(f,{width:88,height:60,borderRadius:"4px",backgroundColor:"grey",backgroundImage:`url('${Ev}')`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}),n(I,{textStyle:"small",marginLeft:"4rm",color:i?"tomato":"white",children:"R/m templates"})]}),w(f,{display:"flex","data-testid":"show-user-templates-modal",alignItems:"center",marginTop:"4rm",cursor:"pointer",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onClick:p=>c(p),children:[n(f,{display:"flex",width:88,height:60,borderRadius:"4px",justifyContent:"center",alignItems:"center",backgroundColor:"grey",backgroundImage:r?`url(${r})`:"none",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",children:!r&&t&&n(Xt,{bgColor:"transparent"})}),n(I,{textStyle:"small",marginLeft:"4rm",color:a?"tomato":"white",children:"My templates"})]})]})}var Rv=_3;var wc=T(H()),Av=T(nr());G();Br();ua();v();var Dv=(0,wc.memo)(({isShown:e,width:o,height:t,isLoading:r,children:i,onClose:s})=>{let a=(0,wc.useRef)(null);function l(m){m.stopPropagation(),s&&s()}return Av.default.createPortal(n(K,{children:e?w(K,{children:[n(f,{id:"my-templates-modal",ref:a,width:`${o}px`,height:`${t}px`,position:"absolute",top:`calc(50% - ${t/2}px)`,left:`calc(50% - ${o/2}px)`,zIndex:9999,borderRadius:"12px",backgroundColor:"black",overflowY:"auto",children:r?n(f,{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",children:n(Xt,{bgColor:"transparent"})}):i}),n(Pr,{"data-testid":"my-template-modal-overlay",zIndex:7149,backgroundColor:"rgba(0, 0, 0, 0)",onClick:l})]}):null}),document.body)});Dv.displayName="MyTemplatesModal";var $v=Dv;var gr=T(H()),Nv=T(nr());Be();tg();var Xe=T(St()),Hv=T(mo()),qe=T(et());Fr();var As={"template-constructor-helpers-template-center":Ct`
	<div class="template-center">
		<div class="template-center-wrapper">

			<div class="left-panel">
				<div class="search-icon"></div>
				<div class="back-icon"></div>
			</div>

			<div class="center-panel">

				<div class="search-wrapper">
					<div class="border"></div>
					<input class="search-string" type="text" placeholder="Search..."/>
					<div class="clear invisible"></div>
				</div>


				<div class="scroll-wrapper main">
					<div class="results-wrapper">
						<div class="results">
						</div>
					</div>
					<div class="scroll"></div>
				</div>

				<div class="scroll-wrapper info">
					<div class="results-wrapper">
						<div class="results">
						</div>
					</div>
					<div class="scroll"></div>
				</div>
			</div>


			<div class="right-panel">
				<div class="template-filter">
					<div class="categories">
						<div class="caption">Categories</div>
						<div class="category-switcher">
							<div class="category-item button active">All</div>
							<div class="category-item button" data-category="microsites">Portfolio</div>
							<div class="category-item button" data-category="presentations">Presentation</div>
							<div class="category-item button" data-category="longreads">Editorial</div>
							<div class="category-item button" data-category="photo_stories">Landing page</div>
							<div class="category-item button" data-category="e_commerce">E-commerce</div>
							<div class="category-item button" data-category="sandbox">Sandbox Tutorials</div>
						</div>
					</div>
					<div class="sort">
						<div class="caption">Sort</div>
						<div class="sort-switcher">
							<div class="sort-item button" data-criteria="popular">Popular</div>
							<div class="sort-item button active" data-criteria="newest">Newest</div>
						</div>

					</div>
					<div class="rm-logo"></div>
				</div>

				<div class="template-info">
				</div>
			</div>



			<div class="overlay">
				<div class="preloader rmpreloader"><div class="arc"></div></div>
			</div>

		</div>
	</div>
`,"template-constructor-helpers-template-center-templateset":Ct`
	<div class="templateset" data-id="<%=data._id%>">
		<div class="image-wrapper">
			<img src="<%-data.screenshot%>" alt="">
		</div>
		<div class="title"><%-data.title || 'Templateset'%></div>
		<div class="num-pages"><%=data.pages + ' page' + (data.pages == 1 ? '' : 's')%></div>
	</div>
`,"template-constructor-helpers-template-center-template":Ct`
<div class="template" data-id="<%=data.page_id%>" data-thumb="<%=data.thumb%>">
	<div class="title"><%-data.idx%>. <%-data.title || 'Page ' + data.num%></div>
	<div class="template-image-wrapper">
		<img src="">
	</div>
	<div class="add-page"><div class="plus"></div><div class="checkmark"></div></div>
</div>
`,"template-constructor-helpers-template-center-templateinfo":Ct`
<div class="title"><%-data.title || 'Templateset'%></div>
<div class="author">
	<span class="label">Designed by</span>
	<% if (data.author_url) { %>
		<a href="<%-data.author_url%>" target="_blank" class="name"><%-data.author_name%></a>
	<% } else { %>
		<span class="name"><%-data.author_name || 'Unknown'%></span>
	<% } %>
</div>
<div class="desc-scroll-wrapper">
	<div class="desc-wrapper">
		<div class="desc"><%-data.description || 'No description'%></div>
	</div>
	<div class="scroll"></div>
</div>
<div class="viewports">
	<div class="caption">Viewports</div>
	<div class="devices">
		<div class="device default" title="Desktop"></div>
		<% _.each(data.viewports, function(v) { %>
			<div class="device <%=v%>" title="<%=data.VIEWPORTS[v]%>"></div>
		<% }); %>
	</div>
</div>
<div class="categories">
	<div class="caption">Categories</div>
	<div class="list"><%-data.categories_string%></div>
</div>
<a href="<%=Constants.readymag_host%>/<%=data.mag_num_id%>" class="preview button" target="blank" data-id="<%=data._id%>">Preview</a>
<div class="add-pages button" data-id="<%=data._id%>">
	<div class="message">Add <%=data.templates.length%> page<%=data.templates.length == 1 ? '' : 's'%></div>
	<div class="plus"></div>
	<div class="checkmark"></div>
</div>
`,"template-constructor-helpers-template-center-animation":Ct`
<style id="template-center-page-animation">
	.animation-page-flyout-x {
	    -webkit-animation: flyout-x .8s linear forwards;
	    animation: flyout-x 1s linear forwards;
	}

	.animation-page-flyout-y {
	    -webkit-animation: flyout-y .8s linear forwards;
	    animation: flyout-y 1s linear forwards;
	}

	@-webkit-keyframes flyout-x {
	    0% {
	    	-webkit-animation-timing-function: ease-out;
	    }
	    30% {
	        -webkit-transform: translateX(-40px);
	        -webkit-animation-timing-function: ease-in;
	        // -webkit-animation-timing-function: linear;
	        opacity: 1;
	    }
	    80% {
	    	-webkit-transform: translateX(150px);
	    	// -webkit-animation-timing-function: ease-in-out;
	    	-webkit-animation-timing-function: linear;
	    	opacity: 0.5;
	    }
	    100% {
	        -webkit-transform: translateX(304px);
	        // -webkit-animation-timing-function: ease-in;
	        -webkit-animation-timing-function: linear;
	        opacity: 0;
	    }
	}

	@-webkit-keyframes flyout-y {
	    0% {
	    	// -webkit-animation-timing-function: linear;
	    	-webkit-animation-timing-function: ease-in;
	    }
	    30% {
	        -webkit-transform: translateY(<%=top1%>px) scale(0.8);
	        -webkit-animation-timing-function: linear;
	        // -webkit-animation-timing-function: ease-in-out;
	        -webkit-animation-timing-function: ease-out;
	    }
	    80% {
	    	-webkit-transform:translateY(<%=top2%>px) scale(0.5);
	    	-webkit-animation-timing-function: ease-in-out;
	    }
	    100% {
	        -webkit-transform:translateY(<%=top3%>px)  scale(0.37);
	        -webkit-animation-timing-function: ease-in;
	    }
	}

	@keyframes flyout-x {
	    0% {
	    	animation-timing-function: ease-out;
	    }
	    30% {
	        transform: translateX(-40px);
	        animation-timing-function: ease-in;
	        // -moz-animation-timing-function: linear;
	        opacity: 1;
	    }
	    80% {
	    	transform: translateX(150px);
	    	// -moz-animation-timing-function: ease-in-out;
	    	animation-timing-function: linear;
	    	opacity: 0.5;
	    }
	    100% {
	        transform: translateX(304px);
	        // -moz-animation-timing-function: ease-in;
	        animation-timing-function: linear;
	        opacity: 0;
	    }
	}

	@keyframes flyout-y {
	    0% {
	    	// -moz-animation-timing-function: linear;
	    	animation-timing-function: ease-in;
	    }
	    30% {
	        transform: translateY(<%=top1%>px) scale(0.8);
	        animation-timing-function: linear;
	        // -moz-animation-timing-function: ease-in-out;
	        animation-timing-function: ease-out;
	    }
	    80% {
	    	transform:translateY(<%=top2%>px) scale(0.5);
	    	animation-timing-function: ease-in-out;
	    }
	    100% {
	        transform:translateY(<%=top3%>px)  scale(0.37);
	        animation-timing-function: ease-in;
	    }
	}


</style>
`};Vo();pt();rn();tt();_r();yr();Uc();rd();var C3={microsites:"portfolio",presentations:"presentation",longreads:"editorial",photo_stories:"landing page",e_commerce:"ecommerce"},Lv=e=>C3[e]||e,S3=Hv.default.View.extend({events:{"click .scroll-wrapper.main .results .templateset":"onTemplatesetClick","click .search-icon":"toggleSearch","click .back-icon":"closeInfo","input .search-wrapper .search-string":"onSearchStringChange","keypress .search-wrapper .search-string":"onSearchStringKey","keyup .search-wrapper .search-string":"onSearchStringKey","keydown .search-wrapper .search-string":"onSearchStringKey","click .search-wrapper .clear":"onClearSearchString","click .category-switcher .category-item":"filterItemClick","click .sort-switcher .sort-item":"filterItemClick","click .template:not(.added)":"onAddPageClick","click .right-panel .add-pages:not(.added)":"onAddMultimpleClick","click .right-panel .preview.button":"onPreviewButtonClick"},CATEGORIES:{microsites:"Microsites",presentations:"Presentations",photo_stories:"Photo Stories",longreads:"Longreads",e_commerce:"E-commerce",sandbox:"Sandbox"},VIEWPORTS:{tablet_portrait:"Tablet Portrait",phone_portrait:"Phone Portrait"},initialize:function(e){qe.default.bindAll(this),this.template=As["template-constructor-helpers-template-center"],this.templatesetTemplate=As["template-constructor-helpers-template-center-templateset"],this.templateTemplate=As["template-constructor-helpers-template-center-template"],this.templateTemplateInfo=As["template-constructor-helpers-template-center-templateinfo"],this.templatePageAnimation=As["template-constructor-helpers-template-center-animation"],this.router=e.router,this.showPagesAlert=e.pagesAlert,this.animateAppearance=e.animateAppearance,this.onClose=e.onClose,this.overlayDarker=e.overlayDarker?!!e.overlayDarker:!1,this.overlayTransparent=e.overlayTransparent?!!e.overlayTransparent:!1,this.showBlockLayer=typeof e.showBlockLayer<"u"?e.showBlockLayer:!0,this.analyticsZone=e.analyticsZone,this.applyFilter.__debounced=qe.default.debounce(this.applyFilter,150),RM.analytics=RM.analytics||new Cl,this.analytics=RM.analytics},render:function(){this.setElement((0,Xe.default)(this.template({})).insertAfter("#constructor")),this.setElement(this.$el),this.$el&&this.$el.length&&this.$el.on("click",()=>Fe("click")),this.$mainList=this.$(".scroll-wrapper.main .results-wrapper .results"),this.$infoList=this.$(".scroll-wrapper.info .results-wrapper .results"),this.filterCategory&&this.$('.category-switcher .category-item[data-category="'+this.filterCategory+'"]').addClass("active").siblings().removeClass("active"),this.mainScroll=(0,Xe.default)(this.$mainList.closest(".scroll-wrapper")).RMScroll({$container:this.$mainList.closest(".results-wrapper"),$content:this.$mainList,$handle:this.$mainList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll"),this.infoScroll=(0,Xe.default)(this.$infoList.closest(".scroll-wrapper")).RMScroll({$container:this.$infoList.closest(".results-wrapper"),$content:this.$infoList,$handle:this.$infoList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll");let e=(0,Xe.default)(this.$(".size-wrapper .slider"));this.sizeSlider=e.slider({min:1,max:7,value:4,orientation:"vertical",start:function(){(0,Xe.default)("body").addClass("ns-resize-cursor"),e.addClass("dragging")},stop:function(){(0,Xe.default)("body").removeClass("ns-resize-cursor"),e.removeClass("dragging")},change:this.sizeChanged,slide:this.sizeChanged}),this.loadTemplateData(),import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PKMOVP7P.js").then(({default:o})=>{o("templatecenter")}),this.rendered=!0},loadTemplateData:function(){let e=this;if(!qe.default.isEmpty(this.templatesets))return e.$(".overlay").remove(),e.renderTemplatesetList();Xe.default.ajax({type:"GET",url:"/api/rm_templatesets/",contentType:"application/json",success:o=>{e.$(".overlay").remove(),qe.default.each(o,function(t){t.templates=qe.default.sortBy(t.templates,"num")}),e.templatesets=e.filtered_templatesets=o,e.applyFilter(),e.filterCategories()},error:()=>{console.log(arguments)}})},filterCategories:function(){Object.keys(this.CATEGORIES).forEach(function(e){this.templatesets.some(function(o){return o.categories.includes(e)})||this.$('.category-switcher .category-item[data-category="'+e+'"]').remove()}.bind(this))},renderTemplatesetList:function(){let e=this.$(".scroll-wrapper.main .results");e.empty().scrollTop(0),qe.default.each(this.filtered_templatesets,function(o){e.append(this.renderTemplateset(o))},this),this.templatesetRendered=!0,qe.default.defer(function(){this.mainScroll.recalc()}.bind(this))},renderTemplateset:function(e){return e.pages=e.templates.length,e.screenshot=e.templates[0].thumb,this.templatesetTemplate({data:e})},renderTemplateList:function(e){let o=this.$(".scroll-wrapper.info .results"),t=e.templates;o.empty().scrollTop(0),qe.default.each(t,function(r,i){r.idx=i+1,r.mag_num_id=e.mag_num_id,o.append(this.renderTemplate(r))},this)},renderTemplate:function(e){let o=(0,Xe.default)(this.templateTemplate({data:e})),t=o.find("img"),r="256",i=e.thumb,s=e.fullScreenshotBaseUrl?jn(e.fullScreenshotBaseUrl,r):i;return t.one("load",function(){qe.default.defer(function(){this.infoScroll.recalc()}.bind(this))}.bind(this)),t.attr("src",s),o},renderTemplateInfo:function(e){let o=[],t;qe.default.each(e.categories,function(r){o.push(this.CATEGORIES[r])},this),e.categories_string=o.join(", "),e.VIEWPORTS=this.VIEWPORTS,this.$(".right-panel .template-info").html(this.templateTemplateInfo({data:e,Constants:oe,_:qe.default})),qe.default.defer(function(){t=(0,Xe.default)(this.$(".right-panel .desc-scroll-wrapper")),this.infoDescriptionScroll=t.RMScroll({$container:t.find(".desc-wrapper"),$content:t.find(".desc"),$handle:t.find(".scroll"),gap_start:4,gap_end:4}).data("scroll")}.bind(this))},applyFilter:function(){let e=Xe.default.trim(this.$(".search-string").val()),o=this.$(".category-switcher .category-item.active").attr("data-category"),t=this.$(".sort-switcher .sort-item.active").attr("data-criteria");qe.default.isEmpty(this.templatesets)||(e?this.filtered_templatesets=qe.default.filter(this.templatesets,function(r){return new RegExp(e,"i").test(r.title)}):this.filtered_templatesets=this.templatesets,o&&(this.filtered_templatesets=qe.default.filter(this.filtered_templatesets,function(r){return qe.default.contains(r.categories,o)})),this.filterCategory=o,qe.default.isEmpty(this.filtered_templatesets)||(this.filtered_templatesets=qe.default.sortBy(this.filtered_templatesets,function(r){return t=="popular"?-(r.usages||0):-new Date(r.created)})),this.renderTemplatesetList())},onSearchStringKey:function(e){if(e.stopPropagation(),e.keyCode==Xe.default.keycodes.esc&&e.preventDefault(),e.type=="keyup"){if(e.keyCode==Xe.default.keycodes.esc){this.$(".search-wrapper .search-string").val()!=""?this.clearSearchString():this.toggleSearch();return}e.keyCode==Xe.default.keycodes.enter&&(e.preventDefault(),this.applyFilter())}},onSearchStringChange:function(){let e=this.$(".search-wrapper .search-string").val();this.$(".search-wrapper .clear").toggleClass("invisible",e==""),this.applyFilter.__debounced()},clearSearchString:function(){this.$(".search-wrapper .search-string").blur().val("").focus(),this.onSearchStringChange()},onClearSearchString:function(){this.clearSearchString(),this.toggleSearch()},toggleSearch:function(){clearTimeout(this.searchFocusTimeout),this.$(".search-icon").toggleClass("active"),this.$(".search-wrapper").toggleClass("shift-down"),this.$(".scroll-wrapper.main").toggleClass("shift-down"),this.$(".search-icon").hasClass("active")?this.searchFocusTimeout=setTimeout(qe.default.bind(function(){this.$(".search-wrapper .search-string").focus()},this),700):(this.$(".search-wrapper .search-string").val(""),this.$(".search-wrapper .clear").addClass("invisible"),pn()),this.applyFilter()},closeInfo:function(){this.$(".template-center-wrapper").removeClass("info-mode")},onTemplatesetClick:function(e){let o=(0,Xe.default)(e.currentTarget),t=o.attr("data-id");this.openInfo(t)},openInfo:function(e){let o=qe.default.findWhere(this.templatesets,{_id:e});this.renderTemplateList(o),this.renderTemplateInfo(o),this.$(".template-center-wrapper").addClass("info-mode"),this.$(".template-center-wrapper").one("transitionend webkitTransitionEnd",function(){this.infoScroll.recalc()}.bind(this))},onBodyKey:function(e){this.$(".search-input").is(":focus")||((e.keyCode==Xe.default.keycodes.esc||e.keyCode==Xe.default.keycodes.backspace)&&(e.preventDefault(),e.stopPropagation()),e.type=="keyup"&&(e.keyCode==Xe.default.keycodes.esc&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():qe.default.isFunction(this.onClose)?this.onClose():this.hide()),e.keyCode==Xe.default.keycodes.backspace&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():qe.default.isFunction(this.onClose)?this.onClose():this.hide()),e.keyCode==Xe.default.keycodes.f&&this.toggleSearch()))},filterItemClick:function(e){(0,Xe.default)(e.currentTarget).addClass("active").siblings().removeClass("active"),this.applyFilter()},canCreatePage:function(e){let t=this.router.me.get("permissions").pages_per_mag;return t&&e+this.router.mag.pages.length>t?(Ye.isSubscriptionPaused()?this.router.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):this.showPagesAlert(),!1):!0},onAddPageClick:function(e){let o=(0,Xe.default)(e.currentTarget),t=o.closest(".template"),r=t.attr("data-id"),i=t.attr("data-thumb");this.canCreatePage(1)&&(qe.default.delay(function(){this.trigger("add-page",{template:r,specialScreenshot:i})}.bind(this),800),t.flashClass("added",2e3),this.animateAdd(t))},onPreviewButtonClick:function(e){let o=(0,Xe.default)(e.currentTarget).attr("data-id"),t=qe.default.findWhere(this.templatesets,{_id:o});ae(ce.Template,{action:"preview",zone:this.analyticsZone,templateName:t.title,templateType:t.categories.map(Lv).join(", ")})},onAddMultimpleClick:function(e){let o=(0,Xe.default)(e.currentTarget),t=(0,Xe.default)(e.currentTarget).attr("data-id"),r=qe.default.findWhere(this.templatesets,{_id:t}),i=[];!r||!this.canCreatePage(r.templates.length)||(qe.default.each(r.templates,function(s){i.push({template:s.page_id,specialScreenshot:s.thumb})}),i.length===1?this.animateAdd(this.$(".center-panel .template")):this.animateAdd(),qe.default.delay(function(){this.trigger("add-multiple",{templates:i,templateName:r.title,templateType:r.categories.map(Lv).join(", ")})}.bind(this),1500),o.flashClass("added",2e3))},onMouseWheel:function(e){e&&e.stopPropagation(),e&&e.preventDefault()},animateAdd:function(e){let o,t,r,i=(0,Xe.default)('<div class="animation-wrapper-v"></div>'),s=(0,Xe.default)('<div class="animation-wrapper-h"></div>').append(i),a=(0,Xe.default)('<div class="animation-wrapper-clip"></div>').append(s),l=this.$el.offset(),m=this.$el.height(),c=200;if(e)o=e.find(".template-image-wrapper"),t=o.clone().detach().addClass("clipped"),r=o.offset(),r.top<l.top&&(r.top=l.top+20),t.css({margin:0}),i.append(t),qe.default.defer(function(){s.css({position:"fixed"}),s.addClass("animation-page-flyout-x"),i.addClass("animation-page-flyout-y")});else{r={left:(0,Xe.default)(".center-panel .template").offset().left,top:l.top+m/2-87};let p=[];a.css({overflow:"hidden"}),qe.default.each((0,Xe.default)(".center-panel .template"),function(u){let d=(0,Xe.default)(u).find(".template-image-wrapper");t=d.clone().detach().addClass("clipped stacking"),t.css({margin:0}),i.prepend(t),Ye.applyTransform(t,"translateY("+(d.offset().top-r.top)+"px)"),p.push(t)}),qe.default.delay(function(){qe.default.each(p,function(u,d){Ye.applyTransform(u,"translateY("+d*5+"px)translateX(-"+d*5+"px)")})},100),qe.default.delay(function(){a.css({overflow:"visible"}),s.addClass("animation-page-flyout-x"),i.addClass("animation-page-flyout-y")},500+c)}(0,Xe.default)("head").append((0,Xe.default)(this.templatePageAnimation({top1:(l.top-r.top)/2,top2:l.top-r.top-130,top3:l.top-r.top-70}))),s.css({left:r.left,top:r.top}),a.css({top:l.top,height:m}),(0,Xe.default)("body").append(a),qe.default.delay(function(){a.remove(),(0,Xe.default)("#template-center-page-animation").remove()},1500)},disableMouseWheel:function(){window.document.addEventListener("mousewheel",this.onMouseWheel,{passive:!1})},enableMouseWheel:function(){window.document.removeEventListener("mousewheel",this.onMouseWheel)},show:function(){this.render(),this.disableMouseWheel(),this.showBlockLayer&&(this.$block_layer=RM.constructorRouter.showBlockLayer(qe.default.isFunction(this.onClose)?this.onClose:this.hide,{darker:this.overlayDarker,transparent:this.overlayTransparent})),this.animateAppearance?(this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(qe.default.bind(function(){this.$el.removeClass("show-in")},this),20),setTimeout(qe.default.bind(function(){this.$el.css("width","+=1")},this),300),setTimeout(qe.default.bind(function(){this.$el.css("width","-=1")},this),300)):this.$el.removeClass("show-out").css("display","block"),(0,Xe.default)("body").on("keypress keyup keydown",this.onBodyKey),this.shown=!0},hide:function(e){e&&e.stopPropagation(),this.enableMouseWheel(),this.showBlockLayer&&RM.constructorRouter.hideBlockLayer(this.$block_layer),(0,Xe.default)("body").off("keypress keyup keydown",this.onBodyKey),this.animateAppearance?(this.$el.addClass("show-out"),setTimeout(qe.default.bind(function(){this.remove()},this),200)):(this.$el.css("display","none"),this.remove()),pn(),this.$(".language-wrapper").removeClass("active"),this.shown=!1},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")}}),Ov=S3;ua();tt();v();function P3({isShown:e,addPageFromTemplate:o,onClose:t,analyticsZone:r}){let i=(0,gr.useContext)(ie),[s,a]=(0,gr.useState)(null),l=()=>{s&&s.remove();let h=new js({$parent:document.querySelector("body > .popups"),router:window.RM.constructorRouter,opts:{type:"type-more-pages",is_contributor:!window.RM.constructorRouter.isOwner,owner_email:i.project.user?i.project.user.email:""},alert_source:"page from rm template"});h.render(),a(h)},[m,c]=(0,gr.useState)(null),p=(0,gr.useRef)(!1),u=h=>{h.stopPropagation(),t&&t()},d=h=>{o(h)},g=h=>{if(!h.templates||!h.templates.length||p.current)return;ae(ce.Template,{action:"add",zone:r,templateName:h.templateName,templateType:h.templateType});let b=0,x=()=>{o(h.templates[b],i.currentPageNum+b).then(()=>{if(++b===h.templates.length){p.current=!1;return}x()}).catch(()=>{p.current=!1})};p.current=!0,x()};return(0,gr.useEffect)(()=>{let h=new Ov({router:window.RM.constructorRouter,pagesAlert:l,showBlockLayer:!1,analyticsZone:r});h.on("add-page",d),h.on("add-multiple",g),c(h)},[]),(0,gr.useEffect)(()=>{m&&(m.off("add-page"),m.off("add-multiple"),m.on("add-page",d),m.on("add-multiple",g))},[i.currentPageNum,i.pagesParams]),(0,gr.useEffect)(()=>{m&&(e?m.show():m.hide())},[e]),e?Nv.default.createPortal(n(Pr,{"data-testid":"rm-template-modal-overlay",zIndex:7149,backgroundColor:"rgba(0, 0, 0, 0)",onClick:u}),document.body):null}var Fv=P3;var hr=T(H());G();Yo();Br();Xo();jr();ve();Yr();pd();Kc();Oe();re();tt();v();var T3="Template title";function M3({templates:e,newTemplateTitle:o,createNewUserTemplate:t,addPageFromTemplate:r,deleteUserTemplate:i,hasGlobalWidgets:s,analyticsZone:a}){let[l,m]=(0,hr.useState)(!1),[c,p]=(0,hr.useState)([]),[u,d]=(0,hr.useState)(!1),[g,h]=(0,hr.useState)(!1),[b,x]=(0,hr.useState)(!1),[y,S]=(0,hr.useState)(!1),[k,P]=(0,hr.useState)(!1),C=V=>{V.preventDefault(),V.stopPropagation(),$()},B=V=>{V.preventDefault(),V.stopPropagation(),$({withGlobalWidgets:!0})},$=(V={})=>{if(l)return;ae(ce.MyTemplates,{action:"create template",zone:a});let W=`pending-${Date.now()}`;m(!0),p([{id:W,pending:!0,thumb:""},...c]),t(V).then(()=>{m(!1)}).catch(()=>{m(!1)}).finally(()=>{p(c.filter(J=>J.id!==W))})},A=(0,hr.useCallback)(V=>{V.keyCode===13&&(V.preventDefault(),V.currentTarget.blur())},[]),R=(0,hr.useCallback)((V,W)=>W&&Tg(V,W),[]),Z=(V,W)=>{V.preventDefault(),V.stopPropagation(),i(W)},F=(V,W,J)=>{V.preventDefault(),V.stopPropagation(),ae(ce.MyTemplates,{action:"add template",zone:a}),r({template:W,custom:!0,specialScreenshot:J})};return n(f,{display:"flex",width:"100%",height:"100%",borderRadius:"12px",overflowY:"auto",children:n(eo,{children:({ref:V})=>w(f,{display:"flex",ref:V,width:"100%",height:"100%",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"68px",paddingRight:"68px",flexWrap:"wrap",alignContent:"flexStart",children:[n(f,{display:"flex",flexDirection:"column","data-testid":"create-user-template",children:s()?w(K,{children:[n(f,{display:"flex",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",justifyContent:"center",alignItems:"center",backgroundColor:"darkGray",borderRadius:"4px",cursor:"pointer",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:n(K,{children:u?w(f,{textAlign:"center",children:[n(ne,{"data-testid":"create-user-template-with-global-widgets",variant:"clean",width:184,borderRadius:8,paddingLeft:"2rm",paddingRight:"2rm",paddingTop:"16px",paddingBottom:"16px",marginTop:"6px",marginBottom:"6px",color:"white",backgroundColor:g?"blue":"black",textStyle:"small",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:B,children:"Include 'On all pages'"}),n(ne,{"data-testid":"create-user-template-without-global-widgets",variant:"clean",width:184,borderRadius:8,paddingLeft:"2rm",paddingRight:"2rm",paddingTop:"16px",paddingBottom:"16px",marginTop:"6px",marginBottom:"6px",color:"white",backgroundColor:b?"blue":"black",textStyle:"small",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onClick:C,children:"Without 'On all pages'"})]}):n(un,{color:"black"})})}),n(f,{width:216,marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",textAlign:"center",color:u?"white":"darkGray",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:n(I,{textStyle:"small",color:u?"white":"darkGray",children:o})})]}):w(K,{children:[n(f,{display:"flex",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",justifyContent:"center",alignItems:"center",backgroundColor:"darkGray",borderRadius:"4px",cursor:"pointer",onClick:C,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:n(un,{color:u?"white":"black"})}),n(f,{width:216,marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",textAlign:"center",color:u?"white":"darkGray",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:n(I,{textStyle:"small",color:u?"white":"darkGray",children:o})})]})}),[...c,...e].map(W=>w(f,{display:"flex",flexDirection:"column",children:[w(f,{display:"flex","data-testid":"create-page-from-template",width:216,height:141,marginLeft:"12px",marginRight:"12px",position:"relative",backgroundColor:"darkGray",borderRadius:"4px",justifyContent:"center",alignItems:"center",cursor:"pointer",backgroundImage:W.thumb?`url(${W.thumb})`:"none",backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover",css:te`
                    &:hover {
                      .delete-template-button {
                        opacity: 1;
                      }
                    }
                  `,onClick:J=>!W.pending&&F(J,W.id,W.thumb),children:[W.pending&&n(Xt,{bgColor:"transparent"}),!W.pending&&n(mt,{height:32,width:32,className:"delete-template-button",color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,position:"absolute",top:"8px",right:"8px",opacity:0,transition:"opacity 0.15s ease",onMouseEnter:()=>S(W.id),onMouseLeave:()=>{k&&P(!1),S(!1)},onMouseDown:()=>P(W.id),onMouseUp:()=>P(!1),onClick:J=>Z(J,W.id),children:n(Ht,{color:k&&k===W.id?"white":y&&y===W.id?"tomato":"black"})})]},W.id),n(vt,{"data-testid":"custom-template-name",marginLeft:"12px",marginRight:"12px",marginBottom:"8px",marginTop:"6px",padding:"0 0 10px 0",width:"auto",type:"text",textStyle:"small",color:"white",spellCheck:!1,placeholder:T3,defaultValue:W.title,disabled:W.pending,onBlur:J=>R(W.id,J.target.value),onKeyDown:A,textAlign:"center",css:te`
                    &:focus {
                      border-bottom: none;
                    }
                  `})]},W.id))]})})})}var Wv=M3;Be();ct();ao();Gt();v();var Uv=(0,zo.memo)(({isPopupShown:e,onChangePopupVisibility:o,placementStyles:t,margin:r,bottom:i,left:s,width:a,hoverColor:l,hasDeletedPages:m,children:c,analyticsZone:p})=>{let u=(0,zo.useContext)(Te),d=(0,zo.useContext)(ie),{currentPanel:g}=(0,zo.useContext)(kt),[h,b]=(0,zo.useState)(!1),x=(0,zo.useRef)(null),y=Ql({watchingClick:e,preventDefault:!0,callback:()=>{o(!1)}}),S=$t(),k=g==="page";(0,zo.useEffect)(()=>{e&&(b(!0),d.getUserTemplates().then(()=>{b(!1)}).catch(R=>{b(!1),R&&console.warn(R.message)})),(!k||e)&&S.modalStatus==="unshowWithTooltip"&&sr("unshow")},[e,k]);let P=(0,zo.useMemo)(()=>{let R=d.pages.find(Z=>Z._id===d.currentPageId);return R&&R.title?R.title:`page ${d.currentPageNum}`},[d.currentPageNum]),C=R=>{e||(R.preventDefault(),R.stopPropagation(),o(!e))},B=()=>{o(!1),u.dispatch({type:"toggleUserTemplatesModal"})},$=()=>{o(!1),u.dispatch({type:"toggleRmTemplatesModal"})},A=(R,Z)=>d.addNewPage(Z||d.currentPageNum,R);return w(K,{children:[n(dt,{text:"Click here to choose a template",indent:8,open:S.modalStatus==="unshowWithTooltip"&&k&&!e,componentsProps:{tooltip:{backgroundColor:"blue",right:"auto"},arrow:{left:m?"auto":"0px !important",color:"blue"}},disabled:!k,closeOnTargetClick:!0,children:n(f,{position:"relative",boxSizing:"border-box",zIndex:Tn.footerButtons,ref:x,children:n(ne,{display:"block","data-testid":"toggle-templates-popup",color:e?"tomato":"black",textStyle:"small",onClick:C,boxSizing:"border-box",margin:r||0,css:te`
                &:hover {
                  color: ${l||"tomato"};
                  path {
                    fill: ${l||"tomato"};
                  }
                  svg {
                    fill: ${l||"tomato"};
                  }
                }
              `,children:c})})}),n(dc,{ref:y,width:a||224,height:168,bottom:i,left:s,isShown:e,placement:"bottom",placementStyles:t,rootElement:x.current,children:n(Rv,{onRmTemplatesClick:$,onMyTemplatesClick:B,isUserTemplatesLoading:h,userTemplatesScreenshot:d.userTemplates.length?d.userTemplates[0].thumb:void 0})}),n($v,{width:880,height:580,isShown:u.isUserTemplatesModalShown,onClose:()=>u.dispatch({type:"toggleUserTemplatesModal"}),isLoading:h,children:n(Wv,{templates:d.userTemplates,newTemplateTitle:`Create template from ${P}`,createNewUserTemplate:d.createTemplateFromCurrentPage,addPageFromTemplate:A,deleteUserTemplate:d.deleteUserTemplate,hasGlobalWidgets:d.hasGlobalWidgets,analyticsZone:p})}),n(Fv,{onClose:()=>u.dispatch({type:"toggleRmTemplatesModal"}),isShown:u.isRmTemplatesModalShown,addPageFromTemplate:A,analyticsZone:p})]})});Uv.displayName="AddFromTemplatesButton";var vc=Uv;ar();G();pd();Oe();re();re();G();v();var B3=e=>n("svg",{fill:"none",viewBox:"0 0 16 19",xmlns:"http://www.w3.org/2000/svg",...e,children:w("g",{fill:"currentColor",children:[n("path",{d:"M0 2.972a1 1 0 011-1h14a1 1 0 110 2H1a1 1 0 01-1-1z"}),n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.999.5a.5.5 0 01.5-.5H9.5a.5.5 0 010 1H6.499a.5.5 0 01-.5-.5z"}),n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.405 6.181a.8.8 0 01.912.67l1.58 10.321h6.206l1.58-10.32a.8.8 0 011.582.241l-1.58 10.321a1.6 1.6 0 01-1.582 1.358H4.897a1.6 1.6 0 01-1.581-1.358l-1.58-10.32a.8.8 0 01.67-.913z"})]})}),I3=f.withComponent(Y(B3)`
      display: block;
    `),kc=I3;ao();vi();go();rn();v();var Gv=({children:e,binIcon:o,...t})=>{let r=(0,zn.useContext)(Te),i=(0,zn.useContext)(ie),{isHovered:s,...a}=Ge(!1),l=()=>{st("more-pages")},m=S=>{S.preventDefault(),(i.project.has_deleted_pages||r.isTrashOpened)&&r.dispatch({type:"toggleTrash"})},[c,p]=(0,zn.useState)(!1),[u,d]=(0,zn.useState)(!1),g=S=>{ae(ce.EditorActions,{action:"add page"}),S.preventDefault(),p(!0),r.dispatch({type:"setAddingPage",inProgress:!0}),i.addNewPage(i.currentPageNum).finally(()=>{r.dispatch({type:"setAddingPage",inProgress:!1})}).catch(k=>{k&&k.err==="permission_denied"&&(i.isSubscriptionPaused()?window.RM.constructorRouter.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):l())})},h=()=>{p(!1),d(!0)},[b,x]=(0,zn.useState)(!1),y=!i.project.has_deleted_pages&&!r.isTrashOpened;return w(f,{width:"240px",height:95,padding:"0 24px",position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"lightGray",...t,children:[n(dt,{indent:15,text:"Add page",open:c||b?!1:void 0,children:n(f,{zIndex:"1",children:n(Vr,{permission:"PageCanAddBlank",children:n(un,{"data-testid":"add-blank-page",color:u?"tomato":"black",cursor:"pointer",onClick:g,onMouseEnter:h,onMouseLeave:()=>d(!1)})})})},"add-page"),w(f,{display:"flex",alignItems:"center",children:[n(Vr,{permission:"PageCanAddFromTemplate",children:n(vc,{isPopupShown:b,onChangePopupVisibility:x,bottom:"32px",left:"-109px",hasDeletedPages:i.project.has_deleted_pages,placementStyles:"bottom: -8px; left: 129px;",analyticsZone:rl.EditorPages,children:"Templates"})}),w(ne,{display:"flex",alignItems:"center",justifyContent:"flex-end",marginTop:"2px",marginLeft:"20px","data-testid":"toggle-pages-bin",textStyle:"small",position:"relative",onClick:y?void 0:m,variant:"unstyled",cursor:y?"auto":"pointer",color:y?"gray":s?"tomato":"black",...a,children:[n(kc,{width:"16px",height:"19px",marginBottom:"4px"}),n(z3,{blink:i.pageRecentlyDeleted,position:"absolute",top:"12px",left:"6px",width:"4px",height:"4px",backgroundColor:y?"gray":s?"tomato":"black"})]})]})]})},z3=({blink:e,backgroundColor:o,...t})=>{let r=e?te`
        animation: 1.5s blinkAnimation infinite linear;
        @keyframes blinkAnimation {
          from {
            opacity: 1;
          }
          33% {
            opacity: 1;
          }
          34% {
            opacity: 0.8;
          }
          40% {
            opacity: 0;
          }
          60% {
            opacity: 0;
          }
          66% {
            opacity: 0.8;
          }
          67% {
            opacity: 1;
          }
          to {
            opacity: 1;
          }
        }
      `:void 0;return n(f,{as:"span",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:e?"tomato":o||"black",css:r,...t})};Pt();re();Ue();G();ve();v();var E3=({pages:e,maxPages:o})=>{if(!o)return null;let t=o-e===1?"page":"pages",r=o-e>0?`${o-e} ${t} left on Free plan`:"No more pages left on Free plan";return n(f,{marginTop:"3rm",marginBottom:"10rm",children:n(I,{color:"gray",textStyle:"small",children:r})})},Vv=E3;G();re();lg();v();var R3=f.withComponent(Y("div")`
  display: flex;
  box-sizing: border-box;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  width: 16px;
  height: 16px;
  border-radius: 2.62px;
  border: 1px solid;
  border-color: rgba(162, 162, 162, 0.32);
`),A3=({direction:e})=>{let o=()=>{switch(e){case"top":return"rotate(-90deg)";case"right":return"rotate(0deg)";case"bottom":return"rotate(90deg)";case"left":return"rotate(180deg)";default:return"rotate(-90deg)"}},t=pl(()=>({transform:o(),paddingLeft:e==="left"?"0":e==="right"?"1px":0,paddingBottom:e==="left"||e==="right"?"1px":0,paddingTop:e==="left"?"2px":0}),[e]);return n(R3,{marginRight:"1rm",children:n("svg",{style:t,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n("path",{d:"M12.4165 7.99738C12.4165 8.16595 12.3399 8.32686 12.202 8.45712L9.24826 11.4032C9.11034 11.5334 8.9571 11.5947 8.79619 11.5947C8.45905 11.5947 8.19853 11.3419 8.19853 10.9971C8.19853 10.8362 8.25217 10.6753 8.3671 10.568L8.4245 10.4723L10.6082 8.51075L9.1141 8.61802H3.88093C3.5208 8.61802 3.26794 8.35751 3.26794 7.99738C3.26794 7.63725 3.5208 7.37674 3.88093 7.37674H9.1141L10.6006 7.48401L8.4245 5.52247L8.3671 5.42677C8.25217 5.3195 8.19853 5.15859 8.19853 4.99768C8.19853 4.65288 8.45905 4.40002 8.79619 4.40002C8.9571 4.40002 9.11034 4.46132 9.24826 4.59158L12.202 7.53764C12.3399 7.6679 12.4165 7.82881 12.4165 7.99738Z",fill:"#A2A2A2"})})})},Na=A3;v();var D3=(0,En.forwardRef)((e,o)=>n(f,{ref:o,width:"auto",height:"2px",position:"fixed",left:"8px",right:"8px",zIndex:"1",borderRadius:"2px",backgroundColor:"gray",display:"none",...e})),jv=({children:e,...o})=>{let t=(0,En.useContext)(Te),r=(0,En.useContext)(ie),i=()=>{t.dispatch({type:"toggleGridSize"})},{project:{opts:{viewertype:s}}}=r;return(0,En.useEffect)(()=>{r.renewLastScreenshot()},[]),w(f,{"aria-label":"Pages menu",width:"100%",height:"100%",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),boxShadow:`0 0 0 2px inset ${Ee(.84,O.gray)}`,...o,children:[n(Bv,{currentPageID:r.currentPageId,children:n(zv,{children:n(f,{id:"project-settings-body",position:"relative",width:"100%",backgroundColor:"transparent",height:"calc(100% - 56px)",zIndex:"auto",children:w(Vm,{padding:"16px 16px 0 16px",bottomLine:a=>n(D3,{ref:a,bottom:"55px",backgroundColor:Me("gray",.4)}),children:[w(f,{display:"flex",height:"16px",justifyContent:"space-between",alignItems:"center",children:[w(f,{display:"flex",alignItems:"end",marginTop:-3,marginLeft:-1,children:[n(I,{color:"black",textStyle:"subheading",children:"Pages"}),n(f,{marginLeft:"2rm",children:s==="horizontal"?w(f,{display:"flex",flexDirection:"row",children:[n(Na,{direction:"left"}),n(Na,{direction:"right"})]}):w(f,{display:"flex",flexDirection:"row",children:[n(Na,{direction:"top"}),n(Na,{direction:"bottom"})]})})]}),n(f,{position:"relative",marginTop:3,children:w(f,{display:"flex",width:28,onClick:i,cursor:"pointer",children:[n(f,{children:n(Kh,{color:t.gridSize===0?"black":"gray"})}),n(f,{marginLeft:"1rm",children:n(Xh,{color:t.gridSize===1?"black":"gray"})})]})})]}),n(Gm,{margin:t.gridSize===0?"9px 0 6px -8px":"10px 0 6px -4px"}),r.isOwner&&n(Vv,{pages:r.pages.length,maxPages:r.me.plan_limits.pages_per_mag})]})})})}),n(Gv,{backgroundColor:"transparent",position:"relative",width:"100%",height:"56px",padding:"0 20px 0 16px",zIndex:"1",borderTop:"1px solid transparent",backgroundClip:"padding-box",binIcon:n(kc,{width:"16px",height:"19px",color:"darkGray",marginBottom:"4px"})})]})};var Wa=T(H());ve();G();jr();Be();var ri=T(H());G();Be();re();v();var Yv=(0,ri.memo)(({children:e,footerHeight:o,footer:t,...r})=>{let i=(0,ri.useContext)(Te),s=(0,ri.useContext)(ie),[a,l]=(0,ri.useState)(!1);return(0,ri.useEffect)(()=>{i.isTrashOpened?((i.isPageSettingsOpened||i.isPrivatePagesOpened)&&(l(!0),setTimeout(()=>{i.dispatch({type:i.isPageSettingsOpened?"togglePageSettings":"togglePrivatePages"}),l(!1)},0)),s.updateTrash()):a&&l(!1),i.isTrashOpened?document.body.classList.add("trash-is-opened"):document.body.classList.remove("trash-is-opened")},[i.isTrashOpened]),w(f,{id:"constructor-pages-bin",width:"240px",height:"100%",paddingTop:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),zIndex:a?lo.sidebarZindex+1:lo.sidebarZindex,overflowX:"hidden",overflowY:"auto",...r,children:[n(f,{height:`calc(100% - ${o+(typeof o=="number"?"px":"")})`,overflow:"auto",children:e}),t({height:o})]})});Yv.displayName="TrashPanel";var yc=Yv;var ii=T(H());G();jr();ve();Ue();Oe();re();v();function $3({children:e,"data-testid":o,width:t,onClick:r,background:i,color:s,danger:a,dangerOnHover:l,...m}){let c=a?O.red:i||O.white,p=a?O.white:s||O.black;return n(ne,{"data-testid":o,width:t||80,height:32,lineHeight:"30px",textStyle:"small",backgroundColor:c,color:p,borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",...m,transition:"opacity 0.2s ease",css:te`
        &:hover {
          opacity: 0.96;
          background: ${l?O.red:c};
          color: ${l?O.white:p};
        }
      `,onClick:r,children:e})}var Fa=$3;Be();to();go();var Wi=T(H());G();re();ve();Ue();Oe();Be();v();var qv=(0,Wi.memo)(({isTrashOpen:e,emptyTrash:o,isOwner:t,isEmpty:r,dividerColor:i,...s})=>{let a=(0,Wi.useContext)(Te),[l,m]=(0,Wi.useState)(!1),c=()=>{t&&!r&&m(!0)},p=d=>{d===0&&t&&!r&&o(),m(!1)},u=()=>{a.isTrashOpened&&a.dispatch({type:"toggleTrash"})};return(0,Wi.useEffect)(()=>{e||m(!1)},[e]),!r||e?w(f,{height:88,paddingLeft:24,paddingRight:24,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",...s,children:[n(f,{left:"2rm",right:"2rm",height:2,position:"absolute",top:-1,borderRadius:"2px",backgroundColor:i||"gray"}),l?w(f,{width:"100%",display:"flex",justifyContent:"space-between",children:[n(f,{"data-testid":"empty-bin-cancel",width:80,height:32,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",css:te`
                &:hover {
                  opacity: 0.96;
                }
              `,onClick:()=>p(1),children:n(I,{textStyle:"small",color:"black",children:"Cancel"})}),n(f,{"data-testid":"empty-bin-confirm",width:80,height:32,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",borderRadius:"16px",cursor:"pointer",border:"1px solid rgba(128, 128, 128, 0.16)",css:te`
                &:hover {
                  background-color: ${O.red};
                  opacity: 0.96;
                  & > span {
                    color: ${O.white};
                  }
                }
              `,onClick:()=>p(0),children:n(I,{textStyle:"small",color:"black",children:"Empty"})})]}):n(L3,{isEmpty:r,isOwner:t,onClick:()=>r?u():c()})]}):null});function L3({isEmpty:e,onClick:o,isOwner:t}){return t?n(ne,{"data-testid":"empty-bin",textStyle:"small",color:"white",onClick:o,cursor:"pointer",children:e?"Close":"Empty bin"}):null}qv.displayName="TrashFooter";var _c=qv;v();var H3=(0,ii.memo)(({children:e,...o})=>{let t=(0,ii.useContext)(Te),r=(0,ii.useContext)(ie),i=a=>r.restorePage(a),s=a=>r.deletePagesFromTrash([a]);return n(yc,{footerHeight:"88px",...o,footer:({height:a})=>n(_c,{isTrashOpen:t.isTrashOpened,isOwner:r.isOwner,isEmpty:!r.trashPages.length,emptyTrash:r.emptyTrash,height:a}),children:n(eo,{children:({ref:a})=>w(f,{ref:a,paddingLeft:22,paddingRight:22,paddingTop:28,children:[n(f,{height:48,display:"flex",alignItems:"center",marginBottom:16,children:n(I,{color:"white",textStyle:"subheading",textAlign:"left",children:"Deleted pages"})}),r.trashPages.map(l=>n(Cc,{page:l,margin:"0 0 12px 2px",isOwner:r.isOwner,onRestorePage:i,onDeletePage:s},l._id))]})})})});H3.displayName="Trash";var Cc=(0,ii.memo)(({page:e,isOwner:o,onRestorePage:t,onDeletePage:r,...i})=>{let{isHovered:s,...a}=Ge(!1),[l,m]=(0,ii.useState)(!1),{viewport:c}=(0,ii.useContext)(Je),p=h=>{h.preventDefault(),t(e._id)},u=h=>{h.preventDefault(),o&&r(e._id)},d=h=>{h.preventDefault(),m(!0)},g=h=>{h.preventDefault(),m(!1)};return w(f,{"data-pageid":e._id,...i,children:[w(f,{width:192,height:124,backgroundColor:"darkGray",borderRadius:"4px",position:"relative",...a,children:[n(_i,{desktopUrl:e.screenshot,phonePortraitUrl:e.viewport_phone_portrait?.screenshot,tabletPortraitUrl:e.viewport_tablet_portrait?.screenshot,phoneViewportEnabled:e.viewport_phone_portrait?.enabled,tabletViewportEnabled:e.viewport_tablet_portrait?.enabled,viewport:c}),w(f,{width:176,height:32,display:"flex",justifyContent:o?"space-between":"center",position:"absolute",left:8,bottom:8,opacity:s?1:0,transition:"opacity 200ms ease",children:[l?n(Fa,{"data-testid":"confirm-bin-action",danger:!0,onClick:u,children:"Yes"}):n(Fa,{"data-testid":"restore-page",onClick:p,children:"Restore"}),l?n(Fa,{"data-testid":"deny-bin-action",onClick:g,children:"Cancel"}):n(K,{children:o&&n(Fa,{"data-testid":"delete-page-from-bin",dangerOnHover:!0,onClick:d,children:"Delete"})})]})]}),n(f,{marginTop:"7px",children:n(I,{textStyle:"small",color:"white",children:e.title?e.title:"Page Title"})})]})});Cc.displayName="TrashPage";v();var Xv=(0,Wa.memo)(({children:e,...o})=>{let t=(0,Wa.useContext)(ie),r=(0,Wa.useContext)(Te),i=a=>t.restorePage(a),s=a=>t.deletePagesFromTrash([a]);return n(yc,{footerHeight:"56px",borderRadius:"2rm",...o,footer:({height:a})=>n(_c,{isTrashOpen:r.isTrashOpened,isOwner:t.isOwner,isEmpty:!t.trashPages.length,emptyTrash:t.emptyTrash,dividerColor:"rgba(128, 128, 128, 0.4)",height:a}),children:n(eo,{children:({ref:a})=>w(f,{ref:a,padding:"16px 16px 0 16px",children:[n(f,{display:"flex",alignItems:"center",height:"16px",marginBottom:"16px",children:n(I,{display:"block",color:"white",textStyle:"subheading",textAlign:"left",children:"Deleted pages"})}),t.trashPages.map(l=>n(Cc,{page:l,margin:"0 0 12px 0",isOwner:t.isOwner,onRestorePage:i,onDeletePage:s},l._id))]})})})});Xv.displayName="Trash";var Kv=Xv;var Ui=T(H());G();Be();re();v();var Zv=(0,Ui.memo)(({children:e,footerHeight:o,footer:t,backgroundColor:r,...i})=>{let s=(0,Ui.useContext)(Te),[a,l]=(0,Ui.useState)(!1);return(0,Ui.useEffect)(()=>{s.isPageSettingsOpened?(s.isTrashOpened||s.isPrivatePagesOpened)&&(l(!0),setTimeout(()=>{s.dispatch({type:s.isTrashOpened?"toggleTrash":"togglePrivatePages"}),l(!1)},0)):a&&l(!1),s.isPageSettingsOpened?document.body.classList.add("page-settings-is-opened"):document.body.classList.remove("page-settings-is-opened")},[s.isPageSettingsOpened]),w(f,{id:"constructor-page-settings",height:"100%",width:240,padding:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),overflow:"hidden",zIndex:a?lo.sidebarZindex+1:lo.sidebarZindex,...i,children:[n(f,{width:"100%",height:`calc(100% - ${o+(typeof o=="number"?"px":"")})`,children:e}),t({height:o})]})});Zv.displayName="PageSettingsPanel";var Jv=Zv;var ni=T(H());ps();Xc();var Ut=T(H());G();ve();Ue();G();v();var Ds=({children:e,divider:o,dividerColor:t,"data-testid":r,onMouseEnter:i,onMouseLeave:s,onClick:a,...l})=>w(f,{position:"relative",width:"100%",display:"flex",alignItems:"center",height:48,padding:"0 16px",borderBottom:"2px solid transparent",cursor:"pointer","data-testid":r,userSelect:"none",onMouseEnter:i,onMouseLeave:s,onClick:a,...l,children:[o&&n(f,{height:"2px",position:"absolute",top:"-1px",left:"8px",right:"8px",borderRadius:"2px",backgroundColor:t||"gray"}),e]});Be();pt();v();var Qv=({isActive:e,onClick:o,children:t,...r})=>{let[i,s]=(0,Ut.useState)(!1);return n(Ds,{"data-testid":"page-main-settings",padding:"0 24px",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:o,...r,children:n(I,{textStyle:"subheading",color:!e&&i?"tomato":"white",children:"Page Settings"})})},ek=(0,Ut.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,Ut.useContext)(ie),i=(0,Ut.useMemo)(()=>r.pagesParams[e._id]?r.pagesParams[e._id].viewNum.toString():"",[e._id,r.pagesParams[e._id]]),s=(0,Ut.useRef)(null),a=(0,Ut.useRef)(null),l=(0,Ut.useCallback)(b=>{b!==e.uri&&e._id&&r.pageSave(e._id,{uri:b},{patch:!0})},[e._id]),m=(0,Ut.useCallback)(b=>e._id&&r.validatePageUri(e._id,b),[e._id]),c=(0,Ut.useCallback)(b=>{b&&(s.current=b)},[e._id]),p=(0,Ut.useCallback)(b=>b.replace(/[^A-Za-z0-9_.+-]/g,""),[]),u=(0,Ut.useMemo)(()=>`${oe.readymag_viewer_host}/${r.project.user.uri}/${r.project.uri}/`,[r.project.uri,r.project.user.uri]),d=(0,Ut.useMemo)(()=>`${u}num/${e.num_id}/`,[u,e.num_id]),g=(0,Ut.useMemo)(()=>ur(r.project),[r.project.is_published,r.project.changed]),h=(0,Ut.useMemo)(()=>Yp(r.project),[r.project.domain,r.project.user.domain,r.project.user.uri]);return w(f,{ref:t,...o,children:[w(f,{marginTop:"10px",children:[w(f,{width:"100%",color:"white",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:[n(I,{as:"label",htmlFor:"page-seo-description",textStyle:"small",children:"URL"}),n(f,{marginTop:"2px",children:n(I,{as:"label",htmlFor:"page-link",title:h,textStyle:"small",children:h})})]}),w(f,{display:"flex",flexWrap:"nowrap",marginTop:"4px",ref:a,children:[n(f,{maxWidth:"50%",color:"white",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:w(I,{fontSize:"16px",children:[r.project.domain?"":r.project.uri,e.parentPage&&r.pagesParams[e.parentPage]?`/${r.pagesParams[e.parentPage].uri}`:null]})}),n(Ms,{setInputRef:c,validationMessageAnchor:a.current,validationMessageContainer:document.body,name:"page-link",color:"white",textStyle:"regular",placeholder:i,inactiveColor:O.darkGray,link:e&&e.uri?e.uri:"",validationMessageZIndex:lo.popupZindex,validate:m,filter:p,onDone:l,maxWidth:"50%",withSlash:!0},e._id)]})]}),g!=="unpublished"&&n($a,{link:d,margin:"12px 0 0 0",color:"white",borderColor:"darkGray"})]})});ek.displayName="MainSettings";var tk=(0,Ut.memo)(ek);var jt=T(H());G();ve();tp();Ue();th();re();Oe();var $s=Y(Ze)`
  width: 100%;
  height: 40px;
  border: solid 1px ${({theme:e})=>e.colors.darkGray};
  border-radius: 8px;
`;Be();ar();re();rn();Oe();wo();Qg();Br();ui();S_();P_();U2();v();var ok=70,rk=({isActive:e,dividerColor:o,onClick:t,children:r,...i})=>{let[s,a]=(0,jt.useState)(!1);return n(Ds,{divider:!0,dividerColor:o||"darkGray","data-testid":"page-seo-settings",padding:"0 24px",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:t,...i,children:n(I,{textStyle:"subheading",color:!e&&s?"tomato":"white",children:"SEO"})})},ik=(0,jt.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,jt.useContext)(ie),[i,s]=(0,jt.useState)(e&&e._id?e._id:null),a=(0,jt.useRef)({}),l=(0,jt.useRef)(null),[m,c]=(0,jt.useState)(!1),p=()=>{st("custom-seo")},u=(0,jt.useMemo)(()=>!!window.RM.constructorRouter.me&&!!(window.RM.constructorRouter.me.get("permissions")||{}).custom_seo,[window.RM.constructorRouter.me]),d=()=>{let W=r.project.domain||r.project.user&&r.project.user.domain;return Ml.getDefaultSEO(e,r.project,{customDomain:!!W})},g=W=>{W.preventDefault(),r.isSubscriptionPaused()?window?.RM?.constructorRouter?.trigger("notice:show","unpauseSubscriptionToCustomizeSeo",{canBeClosed:!0}):p()},h=()=>{let W={title:"",description:"",keywords:""};return e.seo&&(W={...W,...e.seo}),W},b=()=>{let W=d();return{title:r.project.title||W.title||"",description:r.project.description||"What\u2019s it about\u2026",keywords:"e.g. fashion, photo"}},[x,y]=(0,jt.useState)(()=>h()),[S,k]=(0,jt.useState)(()=>b()),[P,C]=(0,jt.useState)();(0,jt.useEffect)(()=>{l.current&&l.current===document.activeElement&&l.current.blur(),Object.keys(a.current).forEach(W=>{let J=a.current[W];J&&J===document.activeElement&&J.blur&&J.blur()}),k(b()),y(h()),s(e&&e._id?e._id:null)},[e._id]),(0,jt.useEffect)(()=>{k(b())},[r.project.title,r.project.description]);let B=W=>{let J=W.target,me=J.dataset.name;me&&x[me]!==void 0&&y(se=>({...se,[me]:J.value}))},$=()=>{let W=i&&r.pageSave(i,{seo:x},{patch:!0});W&&!(W instanceof Error)&&W.done(()=>{}).fail(()=>{})};function A(){return r.projectMag.getPage(e._id).widgets.filter(ee=>ee.attributes.type==="text").map(ee=>Zg(ee)).map(ee=>`<p>${ee}</p>`).reduce((ee,ue)=>ee+ue,"")}async function R(){let W=A();if(!(W.length<ok)){c(!0);try{let J=await lb(W),{title:me,description:se,keywords:ee}=J;me&&se&&ee&&(P||C(x),y({title:me,description:se,keywords:ee}),i&&r.pageSave(i,{seo:{title:me,description:se,keywords:ee}},{patch:!0}))}catch(J){console.error("Error generating SEO tags:",J)}finally{c(!1)}}}function Z(){P&&(y(P),i&&r.pageSave(i,{seo:P},{patch:!0}),C(void 0))}let F=m,V=Dt("constructor.ai")&&A()?.length>=ok;return w(f,{ref:t,...o,children:[V&&w(f,{display:"flex",flexDirection:"row",gap:4,children:[P&&n(ne,{variant:"clean",as:"div",minWidth:34,display:"flex",alignItems:"center",justifyContent:"center",border:"1px white solid",borderRadius:8,onClick:Z,children:n(jh,{color:"white",width:24,height:24})}),n(ne,{variant:"clean",as:"div",minHeight:34,width:"100%",display:"flex",alignItems:"center",justifyContent:"center",border:"1px white solid",borderRadius:8,disabled:F,opacity:F?.7:1,onClick:R,children:m?n(Xt,{bgColor:"transparent",size:24}):w(K,{children:[n(I,{color:"white",children:"Fill with AI"}),n(ab,{color:"white"})]})})]}),w(f,{marginTop:"12px",children:[n(I,{as:"label",htmlFor:"page-seo-title",color:u?O.white:O.darkGray,textStyle:"small",children:"Title"}),n(Lo,{ref:W=>a.current["page-seo-title"]=W,name:"page-seo-title","data-name":"title",color:"white",placeholder:S.title,translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:128,rows:1,autoSize:!0,marginTop:"4px",disabled:!u,value:x.title,onChange:B,onBlur:$,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})]}),w(f,{marginTop:"22px",children:[n(I,{as:"label",htmlFor:"page-seo-description",color:u?O.white:O.darkGray,textStyle:"small",children:"Description"}),n(Lo,{ref:W=>a.current["page-seo-description"]=W,name:"page-seo-description","data-name":"description",color:"white",placeholder:S.description,translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:2048,rows:1,autoSize:!0,marginTop:"4px",disabled:!u,value:x.description,onChange:B,onBlur:$,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})]}),w(f,{marginTop:"22px",children:[n(I,{as:"label",htmlFor:"page-seo-keywords",textStyle:"small",color:u?O.white:O.darkGray,children:"Keywords"}),n(Lo,{ref:W=>a.current["page-seo-keywords"]=W,name:"page-seo-keywords","data-name":"keywords",color:"white",placeholder:S.keywords,translate:"no",spellCheck:!1,autoComplete:"off",autoCorrect:"off",rows:1,autoSize:!0,marginTop:"4px",disabled:!u,value:x.keywords,onChange:B,onBlur:$,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})]}),n($s,{textStyle:"small",color:"white",marginTop:24,display:u?"none":"block",onClick:g,children:"Customize"})]})});ik.displayName="SeoSettings";var nk=(0,jt.memo)(ik);var _t=T(H());G();ve();fa();tp();W2();Ue();Vh();Xo();Yr();Mr();th();Be();ar();ep();pt();re();rn();Uc();v();var sk=({isActive:e,dividerColor:o,onClick:t,children:r,...i})=>{let[s,a]=(0,_t.useState)(!1);return n(Ds,{divider:!0,"data-testid":"page-social-settings",dividerColor:o||"darkGray",padding:"0 24px",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:t,...i,children:n(I,{textStyle:"subheading",color:!e&&s?"tomato":"white",children:"Social sharing"})})},qm=e=>{if(e.custom_shares){let o={...e.custom_shares};if(!o.image){let t=Ju(512),r=e.screenshot?jn(e.screenshot,t):"";o.image=r}return o}return{description:"",title:"",tweet:"",image:""}},ak=(0,_t.forwardRef)(({currentPage:e,...o},t)=>{let r=(0,_t.useContext)(ie),i=(0,_t.useContext)(Te),s=()=>{st("custom-sharing")},a=(0,_t.useMemo)(()=>!!window.RM.constructorRouter.me&&!!(window.RM.constructorRouter.me.get("permissions")||{}).custom_sharing,[window.RM.constructorRouter.me]),[l,m]=(0,_t.useState)(()=>r.project.master_share_pid||null),c=()=>l?l===e._id?"custom":"inherited":e.custom_shares?"custom":"default",[p,u]=(0,_t.useState)(c()),d=(0,_t.useMemo)(()=>!a||p==="inherited",[p,a]),g=()=>{let he=r.project.domain||r.project.user&&r.project.user.domain;return Ml.getDefaultShare(e,r.project,{customDomain:!!he})},h=()=>{if(l){if(l===e._id)return qm(e);{let he=r.pages.find(fe=>fe._id===l);if(he)return qm(he)}}else if(e.custom_shares)return qm(e);return g()},[b,x]=(0,_t.useState)(()=>h());(0,_t.useEffect)(()=>(x(h()),u(c()),()=>{x(null),u("default")}),[e._id]);let y=he=>r.pageSave(e._id,{custom_shares:he||b},{patch:!0}),[S,k]=(0,_t.useState)(!1),[P,C]=(0,_t.useState)(!1),[B,$]=(0,_t.useState)(!1),A=(0,_t.useMemo)(()=>{if(b?.image){let he=Zu(b.image);return e.screenshot!==he}else return!1},[b,e.screenshot]),[R,Z]=(0,_t.useState)(!1),[F,V]=(0,_t.useState)(!1),[W,J]=(0,_t.useState)(!1),[me,se]=(0,_t.useState)(!1),ee=async he=>{if($(!1),he.size>oe.UPLOAD_IMAGE_SIZE_LIMIT){window.alert(oe.MSG_UPLOAD_IMAGE_SIZE_ERROR);return}if(!P){C(!0);try{let fe=await yi("share-upload",he);if(fe&&fe.picture&&fe.picture.url&&b){let pe={...b,image:fe.picture.url},ze=y(pe);ze&&!(ze instanceof Error)&&ze.then(()=>{x(Ae=>({...Ae,...pe})),p==="default"&&u("custom")}).always(()=>{C(!1)})}}catch{C(!1)}}},ue=async he=>{he.preventDefault();let fe=g(),pe={...b,image:fe.image},ze=y(pe);ze&&!(ze instanceof Error)&&ze.done(()=>x(Ae=>({...Ae,...pe})))},ke=he=>{let fe=he.target,pe=fe.getAttribute("name");pe&&b&&b[pe]!==void 0&&x(ze=>({...ze,[pe]:fe.value}))},ge=()=>{if(b&&!d){let he=y();he&&!(he instanceof Error)&&he.done(()=>{p==="default"&&u("custom")}).fail(()=>{})}},we=(0,_t.useMemo)(()=>!!(e&&l&&e._id===l),[e._id,l]),L=()=>(0,_t.useMemo)(()=>!l||we,[we,l]),j=he=>{if(!i.masterSharePidIsChanging)if(i.dispatch({type:"toggleMasterSharePidChanging"}),he){m(e._id);let fe=r.projectSave({master_share_pid:e._id},{patch:!0});if(fe&&fe.always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})}),!e.custom_shares){let pe=g(),ze=r.pageSave(e._id,{custom_shares:pe},{patch:!0});ze&&!(ze instanceof Error)&&ze.done(()=>{x(pe),u("custom")})}}else{m(null),r.projectUnset("master_share_pid");let fe=r.projectSave({});fe&&fe.always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})})}},N=()=>{r.pageSet(e._id,{custom_shares:null});let he=r.pageSave(e._id,{custom_shares:null},{patch:!0});he&&!(he instanceof Error)&&he.done(()=>{x(g()),u("default")}).fail(()=>{})},de=he=>{if(he.preventDefault(),!i.masterSharePidIsChanging)if(l){i.dispatch({type:"toggleMasterSharePidChanging"}),r.projectUnset("master_share_pid");let fe=r.projectSave({});fe&&!(fe instanceof Error)&&fe.done(()=>{m(null),N()}).always(()=>{i.dispatch({type:"toggleMasterSharePidChanging"})})}else N()},le=he=>{he.preventDefault();let fe=l?r.pages.find(pe=>pe._id===l):null;l&&fe&&window.RM.constructorRouter.showWorkspace({id:l})},We=he=>{he.preventDefault(),r.isSubscriptionPaused()?window?.RM?.constructorRouter?.trigger("notice:show","unpauseSubscriptionToCustomizeSharing",{canBeClosed:!0}):s()};return w(f,{ref:t,...o,paddingBottom:24,children:[w(f,{marginTop:"10px",position:"relative",children:[n(I,{color:"white",textStyle:"small",children:"OpenGraph"}),n(f,{position:"absolute",right:0,top:5,css:te`
              &:hover {
                & svg {
                  color: ${O.red};
                }
              }
            `,children:n("a",{href:"https://help.readymag.com/hc/en-us/articles/360020844431-Sharing",target:"_blank",rel:"noopener noreferrer",children:n(Gh,{color:"darkGray"})})})]}),n(f,{width:192,height:104,marginTop:"12px",position:"relative",opacity:B?.8:1,onDragEnter:()=>{B||$(!0)},onDragLeave:()=>{B&&$(!1)},onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:n(Tr,{accept:"image/*",dropFile:!0,readFileData:!1,onChange:ee,disabled:d,children:w(K,{children:[n(f,{width:192,height:104,backgroundColor:"darkGrey",borderRadius:"4px",position:"relative",cursor:a&&!d?"pointer":"default",boxShadow:"0 1px 1px rgba(64, 64, 64, 0.32)",children:n(f,{display:"flex",width:"100%",height:"100%",borderRadius:"4px",backgroundImage:b&&b.image?`url(${b.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})}),(S||P)&&!B&&n(f,{display:"flex",width:96,height:32,position:"absolute",left:0,right:0,bottom:8,margin:"auto",justifyContent:"space-around",cursor:"default",children:!d&&w(K,{children:[n(f,{display:"flex",width:32,height:32,justifyContent:"center",alignItems:"center",onMouseEnter:()=>Z(!0),onMouseLeave:()=>Z(!1),onMouseDown:()=>V(!0),onMouseUp:()=>V(!1),backgroundColor:F?"tomato":"white",borderRadius:"50%",cursor:P?"default":"pointer",boxShadow:"0 0 0 1px rgba(128, 128, 128, 0.16)",css:te`
                          animation: ${P?"loadingindicatoranimation":"none"} 2s infinite linear;
                          @keyframes loadingindicatoranimation {
                            from {
                              transform: rotateZ(0deg);
                            }
                            to {
                              transform: rotateZ(360deg);
                            }
                          }
                        `,children:n(Ll,{color:F?"white":R&&!P?"tomato":"black"})}),A&&!P&&n(mt,{height:32,width:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),onMouseDown:()=>se(!0),onMouseUp:()=>se(!1),onClick:ue,disabled:P,children:n(Ht,{color:me?"white":W?"tomato":"black"})})]})})]})})}),n(f,{marginTop:"4px",children:n(Lo,{name:"title",placeholder:"Title",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:128,rows:1,autoSize:!0,color:"white",textStyle:"regular",disabled:d,value:b?.title,onChange:ke,onBlur:ge,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})}),n(f,{children:n(Lo,{name:"description",placeholder:"Description",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:2048,autoSize:!0,rows:1,color:"white",textStyle:"small",disabled:d,value:b?.description,onChange:ke,onBlur:ge,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})}),w(f,{marginTop:"22px",children:[n(I,{as:"label",textStyle:"small",htmlFor:"share-tweet",color:"white",children:"Tweet message"}),n(Lo,{name:"tweet",translate:"no",autoComplete:"off",autoCorrect:"off",maxLength:116,rows:1,autoSize:!0,marginTop:"4px",color:"white",textStyle:"regular",disabled:d,value:b?.tweet,onChange:ke,onBlur:ge,css:te`
              &::placeholder {
                color: ${O.darkGray};
              }
              &:disabled {
                color: ${O.darkGray};
              }
            `})]}),w(f,{display:"flex",marginTop:"22px",alignItems:"center",justifyContent:"space-between",children:[n(f,{width:"128px",children:n(I,{as:"label",textStyle:"small",htmlFor:"all-pages",color:"white",children:"Use these sharing settings for all pages"})}),n(Ot,{name:"all-pages",disabled:d||!L,checked:we,onChange:j})]}),w(f,{display:"flex",marginTop:"2px",children:[n($s,{textStyle:"small",color:"white",marginTop:"24px",display:a?"none":"block",onClick:We,children:"Customize"}),n($s,{textStyle:"small",color:"white",marginTop:"24px",display:a&&p==="custom"?"block":"none",onClick:de,children:"Restore to defaults"}),n($s,{textStyle:"small",color:"white",marginTop:"24px",display:a&&p==="inherited"?"block":"none",onClick:le,children:"Go to master page"})]})]})});ak.displayName="SocialSettings";var lk=(0,_t.memo)(ak);Be();v();var O3=({padding:e,dividerColor:o})=>{let t=(0,ni.useContext)(Te),r=(0,ni.useContext)(ie),[i,s]=(0,ni.useState)(0),[a,l]=(0,ni.useState)(null);return(0,ni.useEffect)(()=>{let m=t.isPageSettingsOpened&&r.pages.find(c=>c._id===r.currentPageId)||null;return l(m),()=>{l(null)}},[t.isPageSettingsOpened,r.currentPageNum,r.currentPageId]),(0,ni.useEffect)(()=>{if(!t.isPageSettingsOpened)return;let m=r.pages.find(c=>c._id===r.currentPageId)||null;return l(m),()=>{l(null)}},[r.pages]),a?w(Zo,{transition:{ease:qs.easeInCubic},value:i,onChange:m=>s(m),children:[n(Kt,{value:0,renderButton:({isActive:m})=>n(Qv,{isActive:m,padding:e}),children:m=>n(tk,{ref:m,currentPage:a,padding:e})}),n(Kt,{value:1,renderButton:({isActive:m})=>n(rk,{isActive:m,dividerColor:o,padding:e}),children:m=>n(nk,{ref:m,currentPage:a,padding:e})}),n(Kt,{value:2,renderButton:({isActive:m})=>n(sk,{isActive:m,dividerColor:o,padding:e}),children:m=>n(lk,{ref:m,currentPage:a,padding:e})})]}):null},pk=O3;var ck=T(H());Be();G();Oe();v();var dk=({children:e,dividerColor:o,...t})=>{let r=(0,ck.useContext)(Te);return w(f,{display:"flex",position:"relative",width:"100%",height:88,justifyContent:"center",alignItems:"center",...t,children:[n(f,{height:2,position:"absolute",top:-1,left:"2rm",right:"2rm",borderRadius:"2px",backgroundColor:o||"darkGray"}),n(ne,{textStyle:"small","data-testid":"close-page-settings",onClick:()=>{r.dispatch({type:"togglePageSettings"})},color:"white",children:"Close page settings"})]})};re();v();var N3=({children:e,...o})=>n(Jv,{footerHeight:"56px",backgroundColor:Me("black",.96),backdropFilter:"blur(4px)",...o,footer:({height:t})=>n(dk,{height:t,dividerColor:"rgba(128, 128, 128, 0.4)"}),children:n(pk,{padding:"0 16px",dividerColor:"rgba(128, 128, 128, 0.4)"})}),mk=N3;Be();Gt();var uk=T(H());Sr();Ue();Pt();v();var F3=(e,o)=>({position:"absolute",boxSizing:"content-box",width:"100%",height:"100%",marginLeft:e?o==="right"?"16px":"-32px":0,transform:`translateX(${e?o==="right"?"-100%":"100%":"0px"})`,transition:`transform ${lo.moveSpeed} ease, padding 0.1s 0s ease, border-radius 0.1s 0s ease, margin 0.1s 0s ease`,zIndex:"auto",[o==="right"?"paddingRight":"paddingLeft"]:e?"16px":0,borderRadius:e?o==="right"?"8px 0 0 8px":"0 8px 8px 0":"10px",boxShadow:`0 0 0 2px inset ${Ee(.96,O.gray)}`});function Gi({isOpen:e,direction:o="left",children:t,...r}){return n(qo,{children:e?n(qt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:e?.1:.5},children:(0,uk.cloneElement)(t,{...r,...F3(e,o)})}):null})}var Rn=T(H());_r();yr();var Rr=(e,o,t=[])=>{let r=(0,Rn.useRef)(o),i=(0,Rn.useRef)(t);(0,Rn.useEffect)(()=>{r.current=o},[o]),(0,Rn.useEffect)(()=>{i.current=t},[t]),(0,Rn.useEffect)(()=>{let{activeOnLock:s,optionKeys:a}=r.current,l=()=>{i.current.includes(!0)||(r.current.handler(),["m","w"].includes(e)||Fe(`shortcut_${e}`))};return window.RM.constructorRouter.bindGlobalKeyPress({key:e,handler:l,activeOnLock:s,optionKeys:a}),()=>{window.RM.constructorRouter.unbindGlobalKeyPress(e,l)}},[e])};Pt();Ue();v();var gk=({children:e,button:o,...t})=>{let r=(0,Xm.useContext)(Te),{togglePanel:i}=(0,Xm.useContext)(kt);return Rr("m",{handler:()=>{i("page",!1)}}),w(Et,{name:"page",button:o,skidding:84,ArrowProps:{stroke:Ee(.84,O.gray),popperPadding:21},...t,children:[n(Gi,{isOpen:r.isTrashOpened,children:n(Kv,{})}),n(Gi,{isOpen:r.isPageSettingsOpened,children:n(mk,{})}),n(jv,{position:"relative",width:"100%",height:"100%",zIndex:"1"})]})};var nt=T(H());ps();G();Oe();re();tt();ct();nn();Gt();var rr=T(H());G();ao();pt();sp();nn();var Ls=T(H());Wc();pt();ve();G();v();var Km=(0,Ls.memo)(({widget:e,onSelect:o,showBorder:t,highlightedWidget:r,onMouseEnter:i,onMouseLeave:s,forceHovered:a})=>{let[l,m]=(0,Ls.useState)(!!a),{isFreePlan:c}=Cs(),p=()=>{m(!r||e.blockName===r),i&&i(e.blockName)},u=()=>{m(!1),s&&s(e.blockName)};(0,Ls.useEffect)(()=>{m(a?!r||e.blockName===r:!1)},[a,r,e.blockName]);let d=c&&l&&oe.paidWidgetsToShow.includes(e.blockName);return w(f,{"data-widget-type":e.blockName,"aria-label":e.blockName,width:64,height:92,cursor:!r||e.blockName===r?"pointer":"default",onMouseEnter:p,onMouseLeave:u,onClick:()=>{(!r||e.blockName===r)&&o(e.blockName)},position:"relative",opacity:!r||e.blockName===r?1:.2,userSelect:!r||e.blockName===r?"auto":"none",children:[n(f,{border:"1px solid rgba(255, 255, 255, 0.8)",width:64,height:64,borderRadius:"8px",position:"absolute",left:0,top:0,opacity:t?1:0,transition:"all 0.1s"}),n(f,{width:64,height:64,backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%",opacity:l&&!t?.8:1,transition:"all .05s",style:{backgroundImage:`url('${on(`./constructor/widgetbar/widget-selector/${e.thumb}.svg`)}')`}}),n(f,{opacity:l?1:.6,textAlign:"center",marginTop:"6px",children:n(I,{color:d?"tomato":"white",textStyle:"small",fontWeight:600,whiteSpace:"nowrap",children:d?"Upgrade":`${e.title}${e.titleShortcut?` (${e.titleShortcut})`:""}`})})]})});ct();wo();Gt();v();function W3({children:e,backgroundColor:o,boxShadow:t,highlightedWidget:r,disableKeyboardNavigation:i=!1,...s}){let{model:{workspace:a,onClose:l}}=(0,rr.useContext)(Yn),{panelPayload:m}=(0,rr.useContext)(kt),[c,p]=(0,rr.useState)(-1),[u,d]=(0,rr.useState)(null),{isFreePlan:g}=Cs();function h(C){if(g&&oe.paidWidgetsToShow.includes(C.toLowerCase())){window.open(`${oe.readymag_host}/pricing`,"_blank");return}C==="ecommercecart"&&a.eCommerceManager&&a.eCommerceManager.isCartWidgetExist||(Ie(["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"]),setTimeout(()=>{l(C)},50))}let b=(0,rr.useMemo)(()=>{let C=Object.keys(ho),B=[];for(let $ of C){let A=ho[$]?.prototype;if(A&&!A.excludedFromLib&&(!A.restrictions||A.restrictions(a))){let R={blockName:$,thumb:A.thumb,title:A.name,titleShortcut:A.titleShortcut,iconColor:A.icon_color,sortIndex:A.sort_index||0};typeof A.getBlockCreateParams=="function"&&(R={...R,...A.getBlockCreateParams(a)}),B.push(R)}}return B.sort(($,A)=>{if($.sortIndex!==A.sortIndex){if($.sortIndex>A.sortIndex||$.sortIndex===0)return 1;if($.sortIndex<A.sortIndex||A.sortIndex===0)return-1}return $.sortIndex-A.sortIndex})},[a]),x=(0,rr.useCallback)(C=>{if(i)return;y(C);let B=c;switch(C.key){case"ArrowLeft":B=B-1,B=Math.max(B,0);break;case"ArrowUp":B=B-3,B=Math.max(B,0);break;case"ArrowRight":B=B+1,B=Math.min(B,b.length-1);break;case"ArrowDown":B=B+3,B=Math.min(B,b.length-1);break;case"Enter":if(B>-1&&b[B])return h(b[B].blockName);break;case"Escape":return l();default:break}B>-1&&B!==c&&p(B)},[b,c,i]);function y(C){i||["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Enter","Esc"].includes(C.key)&&(C.preventDefault(),C.stopPropagation())}(0,rr.useEffect)(()=>(document.body.addEventListener("keyup",x),document.body.addEventListener("keydown",y),()=>{document.body.removeEventListener("keyup",x),document.body.removeEventListener("keydown",y)}),[x]);function S(C){d(C)}function k(){d(null)}let P=u&&oe.paidWidgetsToShow.includes(u);return c>=0&&(P=oe.paidWidgetsToShow.includes(b[c].blockName)),n(dt,{indent:16,arrow:!1,open:!!(g&&P),componentsProps:{tooltip:{backgroundColor:"blue"}},text:"Upgrade your plan to publish a project with this widget",listenReferenceResize:!0,popperOptions:{modifiers:[{name:"offset",enabled:!0,options:{offset:[0,48]}}]},children:n(f,{width:208,opacity:b.length?1:0,transition:"opacity .1s",...s,children:n(f,{paddingBottom:12,id:"widget-selector",backgroundColor:o,boxShadow:t,transition:"all 0.1s",children:n(f,{display:"flex",gap:"0px 8px",flexWrap:"wrap",children:b.map((C,B)=>C.blockName==="presets"?n(dt,{text:"Add your first one",open:m?.showPresetDemoTooltip??!1,componentsProps:{tooltip:{backgroundColor:"blue"},arrow:{color:"blue",left:"-1px !important"}},children:n(f,{as:"span",children:n(Km,{widget:C,onSelect:h,showBorder:c===B,forceHovered:c===B,highlightedWidget:r,onMouseEnter:S,onMouseLeave:k},C.blockName)})},B):n(Km,{widget:C,onSelect:h,showBorder:c===B,forceHovered:c===B,highlightedWidget:r,onMouseEnter:S,onMouseLeave:k},C.blockName))})})})})}var hk=W3;to();var it=T(H());tt();wo();ot();G();Oe();Yo();hd();jr();ve();go();gn();re();Rl();to();var Eo=T(H());Sr();var bk=T(et()),Zm=T(St());nd();gn();a_();to();ot();Pb();sp();G();wi();re();pp();Cd();na();cd();mb();C_();oa();ed();Vn();v();var U3=Y(f,{label:"workspace-scroller"})`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  // Overflow hidden prevents scroll bar from showing when we scroll the scroller on hover to demo the scroll animation.
  overflow: hidden;
`,G3=Y(f,{label:"workspace-container"})`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 7px;
  cursor: pointer;
  transition: transform 0.1s ease;
  &:active {
    transform: scale(0.99);
  }
  * {
    // It's important to disable pointer events on widgets. For example, to avoid triggering mouseleave on preset popover
    // when hovering over the blocks which are rendered with react, such as text or shots.
    pointer-events: none !important;
  }
  & > * {
    position: relative;
    width: 100%;
    height: 100%;
    flex: none;
  }
  & .block {
    position: absolute;
    flex: none;
    &.lottie .content > *:first-child {
      background: transparent;
    }
  }
  &.has-cover > * > .block,
  & .steps-lines-wrapper {
    display: none;
  }
  & .animation-steps-container {
    // It's display and not visibility or opacity, because the animation does not play when not it's not displayed and starts anew when it is.
    // Visibility or opacity would show animation from the whatever frame it is currently in.
    display: none;
    z-index: 2510;
  }
  &:hover {
    .block.animation-mode {
      display: none;
    }
    .animation-steps-container {
      display: block;
    }
  }
`,V3=Y(f,{label:"cover"})`
  position: absolute;
  width: 100%;
  height: 100%;
  background: center / contain no-repeat;
  pointer-events: none;
  ${e=>te`
      background-image: url(${e.cover});
    `}
`,j3=Y(f,{label:"preview"})`
  position: relative;
  border-radius: 8px;
  margin: 0 auto;
  overflow: hidden;
  cursor: pointer;
`,Jm=lp.extend({...Qc,tracked:!1}),Y3=Jo.extend({...Qc,tracked:!1});function q3(e,o,t,r){let i=Ao.getWorkspaceSize(t,r,o),s={width:t.opts.scalableviewer?i.width:window.innerWidth,height:window.innerHeight},a={workspaceSize:i,windowSize:s,viewport:o,zoom:1},l=e.map(p=>ns({target:new Jm({...p,_id:`preset-${cn()}-${p._id}`}),viewport:o,pageId:p.pid,disposable:!0})).filter(p=>!p.attributes.hidden),m=l.length>0&&l.every(p=>p.attributes.is_full_width&&p.attributes.is_full_height),c={fixed_position:"",is_global:!1,is_above:!1};if(m){let p=Vu[o].width;return l.forEach(u=>u.set({...c,x:0,y:0,w:p,h:p},{silent:!0})),{models:l,union:{width:p,height:p}}}else{let p=l.map(d=>{let{x:g,y:h,w:b,h:x,fixed_position:y,angle:S,is_full_width:k,is_full_height:P}=d.attributes;return{x:g,y:h,w:k?s.width:b,h:P?s.height:x,fixed_position:y,angle:S}}),u=Ao.coordinatesToClientBoundingBox(p,a);return l.forEach(d=>{let g=Ao.mapWidgetToWindow([d.attributes],a),h=xt.absoluteToRelative(g,u);d.set(Object.assign({},c,{x:h.left,y:h.top},d.attributes.is_full_width?{w:Math.max(u.width,s.width)}:{},d.attributes.is_full_height?{h:Math.max(u.height,s.height)}:{}),{silent:!0})}),{models:l,union:u}}}var X3=e=>{let o=e.map(a=>{let{x:l,y:m,w:c,h:p,angle:u=0}=a,d=Math.cos(u*Math.PI/180),g=Math.sin(u*Math.PI/180),h={left:l,top:m,width:c,height:p,cosAngle:d,sinAngle:g};return gt.calcBoundingBox(h,void 0,!0)}),{left:t,top:r,width:i,height:s}=gt.getBoundingBoxOfBoxes(o);return{left:t,top:r,width:i,height:s}};function K3({mag:e,union:o,backgroundColor:t,eCommerceManager:r,size:i,spacing:s=16,viewport:a,container:l,scroller:m}){let c=new np({page:new Y3,mag:e,$container:(0,Zm.default)(l),width:o.width,height:o.height,background:t,eCommerceManager:r,viewport:a});c.$scroller=(0,Zm.default)(m);let p=c.$el[0],u={width:i.width-s*2,height:i.height-s*2},g=xt.contain(o,u).width/o.width;return p.style.setProperty("transform",`scale(${g})`),p.style.setProperty("width",`${o.width}px`),p.style.setProperty("height",`${o.height}px`),c}function Z3(e,o){return e.map(t=>{let r=new ho[t.attributes.type](t,o);r.isStandalone=!0,r.autoRasterize=!1,r.$standaloneContainer=o.$el,bk.default.extend(r,{},db),r.render(),r.redrawPosition(t,{forceRedraw:!0});let i=r.$el[0],s=Sc(t),a=i.querySelector(".frameborder"),l=i.querySelector(".content");if(a.style.setProperty("display","none"),l.style.setProperty("z-index",t.attributes.z),s){let m=Q3(s,t,o.viewport);m.opacity!==void 0&&i.style.setProperty("opacity",m.opacity),m.transform!==void 0&&i.style.setProperty("transform",m.transform)}return r})}var fk={hover:3,load:2,scroll:1,click:0,none:0},J3=({type:e},{type:o})=>fk[o]-fk[e],Sc=(e,o=!1)=>{let t=[...e.get("animation")||[]].sort(J3),r=o?["hover","load","scroll","click"]:["hover","load","scroll"];return t.find(({type:i,steps:s})=>r.includes(i)&&s.length>0)};function Q3(e,o,t){let{steps:r,type:i}=es.getNormalizedAnimation(e,!!o.get("fixed_position"),o.get("is_full_width"),o.get("is_full_height"),1,t),s=r[0],{from_rotate:a=0,from_scale:l=100,from_opacity:m=100}=s,c={},p=Ug.getTransformString({x:0,y:0,angle:a,scale:l/100,hasRotation:Fg(r),hasScale:Wg(r),isKeyframe:i!=="scroll",force3d:!1,offsetPathEnabled:!1});return(a!==0||l!==100)&&(c.transform=p),m!==100&&(c.opacity=(m/100).toString()),c}function e5(e,o){let t=e.map(c=>c.id),i=(e[0]?.model.get("animation")?.filter(c=>c.type!=="none")||[])[0]?.UUID,s=!!i&&e.every(c=>{let p=c.model.get("animation")?.filter(u=>u.type!=="none")||[];return p.length===1&&p[0].UUID===i}),a=e.reduce((c,p)=>{let u=Sc(p.model,s);if(!u)return c;let d=u.UUID;return c[d]?c[d].push(p):c[d]=[p],c},{});if(!s&&Object.keys(a).length>0&&e.filter(c=>Sc(c.model)).length!==e.length){let c="animation-stub-"+cn(),p=[{UUID:c,type:"hover",steps:[{}]}],u=e.filter(d=>!Sc(d.model));u.forEach(d=>d.model.set("animation",p)),a[c]=u}return Object.keys(a).sort((c,p)=>{let{z:u,_id:d}=a[c][0].model.attributes,{z:g,_id:h}=a[p][0].model.attributes;return u-g||t.indexOf(d)-t.indexOf(h)}).map(c=>{let p=a[c],u=p[0].model,d=X3(p.map(b=>b.model.attributes)),g=new sb({uuid:c,blocks:p,workspace:o,static:!0,isFixed:!!u.get("fixed_position"),isFullwidth:u.get("is_full_width"),isFullheight:u.get("is_full_height"),isSticked:!!u.get("sticked"),updateIndexes:!0,zoomView:{getZoom:()=>1}}),h=g.$el[0];return h.style.setProperty("left",`${d.left}px`),h.style.setProperty("top",`${d.top}px`),h.querySelectorAll(".block").forEach(b=>{b.style.removeProperty("opacity"),b.style.removeProperty("transform")}),g})}var t5=({widgets:e,backgroundColor:o="#ffffff",boxShadow:t,width:r,height:i,cover:s,viewport:a,onClick:l,hidden:m=!1})=>{let c=(0,Eo.useRef)(null),p=(0,Eo.useRef)(null),[u,d]=(0,Eo.useState)(!0),{mag:g,page:h,eCommerceManager:b}=(0,Eo.useContext)(Je),x=(0,Eo.useRef)(),y=(0,Eo.useRef)(),S=(0,Eo.useRef)();(0,Eo.useEffect)(function(){if(!(!g||!h||m)){try{let{models:B,union:$}=q3(e,a,g.toJSON(),h.toJSON()),A=K3({viewport:a,mag:g,union:$,size:{width:r,height:i},backgroundColor:o,eCommerceManager:b,container:c.current,scroller:p.current});S.current=A,y.current=Z3(B,A)}catch(B){console.error("Error rendering preset preview",B),y.current=[]}return()=>{y.current?.map(B=>B.destroy()),x.current?.map(B=>B.destroy()),S.current?.remove(),y.current=void 0,x.current=void 0,S.current=void 0}}},[o,a,h,g,m]);function k(){x.current===void 0&&y.current&&S.current&&(x.current=e5(y.current,S.current)),!!x.current?.length&&d(!1),x.current?.map(B=>{if(B.startPreviewMode(),B.previewTimeline.type==="scroll"){let $=S.current?.$scroller[0];if(!$)return;let A=$.getBoundingClientRect().height,R=B.previewTimeline.steps.reduce((Z,F)=>Z+F.calcedDuration,B.getScrollStart(B.getAnimation()));$.firstChild?.style?.setProperty("height",`${R+A}px`),$.scrollTo({top:R,behavior:"smooth"})}})}function P(){d(!0),x.current?.map(C=>C.stopPreviewMode()),S.current?.$scroller?.[0].scrollTo({top:0,behavior:"auto"})}return n(j3,{"aria-label":"Preset preview",role:"button",width:r,height:i,boxShadow:t,backgroundColor:o,onClick:l,onMouseEnter:k,onMouseLeave:P,children:n(o5,{viewport:a,children:m?n(f,{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:o==="#000000"?"black":"gray",children:n(Hl,{fontSize:48})}):w(Eo.Fragment,{children:[n(U3,{ref:p,children:n(f,{width:"100%"})}),n(G3,{overflow:"hidden",className:s&&u?"has-cover":void 0,ref:c}),n(qo,{children:s&&u&&n(qt.div,{exit:{opacity:0},transition:{duration:.1},children:n(V3,{cover:s})})})]})})})},o5=({children:e,viewport:o})=>{let[t,r]=wh();return Df(()=>{(async()=>{await r(t.current,{opacity:.6},{duration:.2,ease:"easeOut"}),await r(t.current,{opacity:1},{duration:.2,ease:"easeIn"})})()},[o]),n("div",{ref:t,style:{width:"100%",height:"100%",opacity:1},children:e})},wk=t5;var Uo=T(H());G();Yo();ve();gn();ag();Rl();var xk=T(H());var An=(0,xk.createContext)({editable:!1,scope:2,setScope(){}});v();var Qm="collapsed-preset-folders";function r5(e,o){try{let t=JSON.parse(window.localStorage.getItem(Qm)||"{}");t[o]||(t[o]=[]);let r=t[o].indexOf(e);r!==-1?t[o].splice(r,1):t[o].push(e),window.localStorage.setItem(Qm,JSON.stringify(t))}catch{}}function i5(e,o){try{return!JSON.parse(window.localStorage.getItem(Qm)||"{}")[o]?.includes?.(e)}catch{return!0}}function vk(e){return e===1?window.RM.constructorRouter.mag.user.get("_id"):window.RM.constructorRouter.mag.get("_id")}var yk=(0,Uo.memo)(({name:e,presets:o,children:t})=>{let{scope:r,editable:i}=(0,Uo.useContext)(An),[s,a]=(0,Uo.useState)(e),[l,m]=(0,Uo.useState)(()=>i5(s,vk(r))),c=(0,Uo.useRef)(null),p=(0,Uo.useRef)(()=>d(s)),u=(0,Uo.useRef)(!1);p.current=()=>d(s),(0,Uo.useEffect)(()=>function(){u.current&&p.current()},[]);function d(S){if(!(S!==e)||!S){a(e);return}let P=o[0].type,C=o.map(B=>B._id);Mh(P,C,Ys.sanitize(S))}let g=()=>{m(S=>!S),r5(s,vk(r))},h=S=>{S.key==="Enter"&&(S.preventDefault(),c.current?.blur?.())};function b(){u.current=!0}function x(){u.current=!1,d(s)}let y=i?n(vt,{padding:0,value:s,color:"white",height:"auto",onBlur:x,border:"none!important",onKeyDown:h,onFocus:b,onChange:S=>a(S.target.value),onClick:S=>S.stopPropagation(),ref:c}):n(I,{children:s});return w(f,{width:"100%",display:"flex",gap:16,flexDirection:"column","aria-label":`${e} preset folder`,children:[w(f,{gap:6,height:20,role:"button",color:"white",display:"flex",cursor:"pointer",alignItems:"center",onClick:g,children:[n(f,{as:"span",transition:"transform 0.3s ease",transform:`rotate(${l?"0def":"-90deg"})`,children:n(Do,{"data-testid":"ToggleFolderIcon",fontSize:20})}),y]}),l?n(f,{display:"flex",gap:16,flexWrap:"wrap",marginBottom:24,children:t}):null]})});cd();T_();v();var eu=(e,o)=>{let t=new Intl.Collator(void 0,{numeric:!1});return e.sort((r,i)=>t.compare(String(r[o]),String(i[o])))},s5=(e,o)=>{if(e.length===0)return[];let t={},r=[];for(let a of e){if(!a.name.includes("/")){r.push(a);continue}let[l]=a.name.split("/");t.hasOwnProperty(l)?t[l].push(a):t[l]=[a]}let i=Object.keys(t).map(a=>{let l=t[a];return o!==2&&eu(l,"name"),{folderName:a,type:"folder",presets:l}}),s=eu(i,"folderName");return o!==2&&eu(r,"name"),[...s,...r]},a5=e=>e.replace(/\s*\/\s*/,"/").trim(),l5=e=>{let o=a5(e),[t,r]=o.split("/");return t?o:r};function p5(e){return e.replace("/"," / ")}function tu(e){let[,...o]=e.split("/");return o.length===0?e:o.join("/")}var Pc=(0,it.memo)(({presets:e,editable:o=!1,isOwner:t=!0,scope:r=2,setScope:i})=>{let s=(0,it.useMemo)(()=>({editable:o,scope:r,setScope:i||(()=>{})}),[o,r,i]),a=(0,it.useMemo)(()=>s5(e,r),[e,r]),l=a.length===0,m=null;if(l){let c=w(it.Fragment,{children:["Press",n(Eh,{marginBottom:-6,display:"inline"}),"and save ",n("br",{})," any widgets as a preset"]});r===1&&(c=w(it.Fragment,{children:["Press ",n($o,{marginBottom:3,display:"inline"})," to make ",n("br",{})," any preset global"]})),m=n(f,{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",children:t?n(I,{color:"darkGray",textAlign:"center",children:c}):w(I,{color:"darkGray",children:["No $",r===0?"project":"global"," presets saved yet"]})})}else m=n(f,{display:"flex",gap:16,flexWrap:"wrap",children:a.map(c=>c.type==="folder"?n(yk,{name:c.folderName,presets:c.presets,children:c.presets.map(p=>n(_k,{preset:p},p._id))},`${r}-${c.folderName}`):n(_k,{preset:c},c._id))});return n(An.Provider,{value:s,children:n(eo,{children:({ref:c})=>n(f,{ref:c,height:l?"100%":"auto",padding:16,children:m})})})}),_k=(0,it.memo)(({preset:e})=>{let{isHovered:o,...t}=Ge(!1),{workspace:r}=(0,it.useContext)(Je),{editable:i}=(0,it.useContext)(An),[s,a]=(0,it.useState)(r?.viewport||"default"),l=(0,it.useRef)(null),m=(0,it.useMemo)(()=>e.widgets.map(d=>{let g=new Jm({...d,_id:`preset-item-${d._id}`});return ns({viewport:s,disposable:!0,pageId:d.pid,target:g})}),[e,s]),c=(0,it.useMemo)(()=>m.every(d=>d.get("hidden")),[m]),p=o?"0 0 0 4px rgba(162, 162, 162, 0.16)":void 0;function u(){r?.pastePreset({object:"rm_pastedata",mag_num_id:void 0,blocks:e.widgets,packs:e.packs,mag_edit_params:{fonts:e.fonts,textStyles:e.textStyles,listStyles:e.listStyles,linkStyles:e.linkStyles}},{disableDeleteViewportAttributes:!0,disableDeleteGlobalAttributes:!0,customLayersName:e.name}),ae(ce.PresetAdd,{presetCategory:e.category?.name??"saved",presetName:e.name})}return(0,it.useEffect)(()=>{l.current&&pb(e,l.current)},[]),w(f,{gap:8,ref:l,width:192,display:"flex",flexDirection:"column","data-preset-id":e._id,"aria-label":`${e.name} preset`,...t,children:[n(wk,{width:192,height:192,boxShadow:p,widgets:e.widgets,onClick:u,viewport:s,cover:e.cover,hidden:c,backgroundColor:e.backgroundColor||"#ffffff"}),w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,children:[n(c5,{preset:e}),w(f,{display:"flex",gap:6,alignItems:"center",children:[i?n(m5,{preset:e}):null,n(u5,{viewport:s,setViewport:a}),i?n(d5,{preset:e}):null]})]})]})}),c5=(0,it.memo)(({preset:e})=>{let[o,t]=(0,it.useState)(()=>tu(e.name)),{editable:r}=(0,it.useContext)(An),i=(0,it.useRef)(()=>m(o)),s=(0,it.useRef)(null),a=(0,it.useRef)(!1);i.current=()=>m(o),(0,it.useEffect)(()=>function(){a.current&&i.current()},[]);function l(u){u.key==="Enter"&&(u.preventDefault(),s.current?.blur?.())}function m(u,d={}){let g=l5(u);if(!(e.name!==g)||!g){d.updateState&&t(tu(e.name));return}ad({type:e.type,id:e._id},{name:g}),d.updateState&&t(tu(g)),g.split("/")[1]&&ae(ce.PresetMisc,{action:"folder created by type in"})}function c(){a.current=!0,t(p5(e.name))}function p(){a.current=!1,m(o,{updateState:!0})}return r?n(vt,{padding:0,value:o,color:"white",height:"auto",textStyle:"small",onBlur:p,ref:s,onFocus:c,border:"none!important",onKeyDown:l,onChange:u=>t(u.target.value),textOverflow:"ellipsis"}):n(I,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"white",textStyle:"small",children:o})}),d5=(0,it.memo)(({preset:e})=>{let[o,t]=(0,it.useState)(!1),{setScope:r}=(0,it.useContext)(An),i=(0,it.useMemo)(()=>[{title:e.type==="global"?"Move to Project":"Move to Global",hidden:!window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets,closeOnClick:!0,onClick(){let s=e.type==="global"?"project":"global";Th(e._id,e.type,s);let l={project:0,global:1}[s];r(l),ae(ce.PresetMisc,{action:l===0?"saved move to project":"saved move to global"})}},{title:"Delete",closeOnClick:!0,onClick(){Ph({type:e.type,id:e._id})}}],[e]);return n("div",{onClick:s=>s.stopPropagation(),children:n(ss,{width:224,zIndex:9999,border:"none",borderRadius:8,listItems:i,popperOffset:[-85,-20],container:document.body,onToggleDropdown:t,boxShadow:"0px 2px 16px rgba(0, 0, 0, 0.16)",role:"menu",children:({toggleDropdown:s})=>n(Ck,{"aria-haspopup":!0,onClick:s,"aria-label":"preset context menu trigger","aria-expanded":o?"true":"false",children:n($o,{})})})})}),m5=(0,it.memo)(({preset:e})=>{let{isHovered:o,...t}=Ge(!1),r=e.backgroundColor||"#ffffff",i=()=>{let l=r==="#000000"?"#ffffff":"#000000";ad({type:e.type,id:e._id},{backgroundColor:l})},s="50%",a="50%";return o&&(r==="#000000"?s="100%":(s="0%",a="100%")),w(f,{width:10,height:10,role:"button",borderWidth:3,cursor:"pointer",overflow:"hidden",borderRadius:"50%",borderStyle:"solid",borderColor:"darkGray",boxSizing:"content-box",onClick:i,...t,children:[n(f,{transition:"width 0.2s ease",width:s,height:"100%",backgroundColor:"#ffffff"}),n(f,{transition:"width 0.2s ease",width:a,height:"100%",backgroundColor:"#000000"})]})}),u5=(0,it.memo)(({viewport:e,setViewport:o})=>{let{isHovered:t,...r}=Ge(!1),i=["default","phone_portrait","tablet_portrait"],s=()=>{let m=(i.indexOf(e)+1)%i.length;o(i[m])},a={default:n(Jh,{width:20}),phone_portrait:n(ef,{width:8}),tablet_portrait:n(of,{width:13})};return n(ne,{width:24,height:24,display:"flex",variant:"unstyled",justifyContent:"center",onClick:s,color:t?"white":"darkGray",...r,children:a[e]})}),Ck=Y(ne)`
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  padding: 0;
  color: ${e=>e.theme.colors.gray};

  &:hover {
    color: ${e=>e.theme.colors.white};
  }
`;Ck.defaultProps={variant:"unstyled"};var Hs=T(H());G();ve();re();go();jr();Rl();Wc();v();var ou={_id:"my-presets",isArchived:!1,name:"Saved",position:0,cover:on("./constructor/presets/my-preset.svg"),hoverCover:on("./constructor/presets/my-preset-hover.svg")},g5=(0,Hs.memo)(({onSelectCategory:e,onDeselectCategory:o,selectedCategory:t})=>{let[r]=Ch(),i=[n(Sk,{category:ou,active:ou._id===t,onMouseEnter:()=>e(ou),onMouseLeave:()=>o()})],s=null;return r.forEach(a=>{a.parent?._id!==s&&i.push(n(h5,{title:a.parent.name})),i.push(n(Sk,{category:a,active:a._id===t,onMouseEnter:()=>e(a),onMouseLeave:()=>o()})),s=a.parent._id}),n(eo,{children:({ref:a})=>n(f,{ref:a,id:"preset-panel",padding:"0 8px",children:i})})}),h5=(0,Hs.memo)(({title:e})=>n(f,{height:40,marginLeft:8,children:n(I,{textStyle:"regular",color:"white",lineHeight:"40px",cursor:"default",children:e})})),Sk=(0,Hs.memo)(({category:e,onMouseEnter:o,onMouseLeave:t,active:r,...i})=>{let{isHovered:s,onMouseEnter:a,...l}=Ge(!1),m=(0,Hs.useRef)({x:null,y:null}),c=e.cover?{backgroundImage:`url(${e.cover})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"}:{backgroundColor:"red"};(s||r)&&c.backgroundImage&&e.hoverCover&&(c.backgroundImage=`url(${e.hoverCover})`);function u(g){l.onMouseLeave(g),t&&t(g),m.current={x:null,y:null}}function d(g){let{clientX:h,clientY:b}=g,{current:x}=m;if(x.x!==null&&x.y!==null){let y=Math.abs(h-x.x),S=Math.abs(b-x.y);(y<=1||y===0&&S===0)&&(a(g),o&&o(g))}m.current={x:h,y:b}}return w(f5,{...i,...l,active:r,onMouseLeave:u,onMouseMove:d,backgroundColor:s?"black":void 0,children:[n(f,{width:48,height:48,...c}),n(I,{color:"white",textStyle:"small",children:e.name})]})}),f5=Y(f)`
  gap: 8px;
  height: 64px;
  padding: 8px;
  display: flex;
  align-items: center;
  border-radius: 8px;
  cursor: default;

  ${e=>e.active&&te`
      background-color: ${e.theme.colors.black};
    `}
`,Pk=g5;Rl();fl();cg();var Os=T(H());G();Pf();ve();ar();vi();v();var Tk=({text:e})=>n(f,{margin:"16px 16px 0 16px",borderRadius:4,padding:"8px 16px",backgroundColor:"blue",children:n(I,{color:"white",textStyle:"small",children:e})}),b5="Upgrade your plan to save presets",w5="Upgrade to the Team plan to add new global presets",Mk=({children:e,active:o})=>n(I,{textStyle:"small",color:o?"white":"gray",children:e}),Bk=(0,Os.memo)(({global:e,project:o,isOwner:t})=>{let[r,i]=(0,Os.useState)(0),{isFreePlan:s}=(0,Os.useContext)(tr),a=s&&t,l=r===0&&a,m=r===1&&!window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets,c=Cr("CanUsePresets"),p=d=>{let g=d===0?0:1,h=window.RM.constructorRouter.mag.user.get("permissions")?.can_use_global_presets;g===1&&!e.length&&!h?st("global-presets"):i(g)},u=[{title:w(Mk,{active:r===0,children:["Project"," ",n(I,{textStyle:"small",color:"darkGray",children:o.length})]})},{title:w(Mk,{active:r===1,children:["Global"," ",n(I,{textStyle:"small",color:"darkGray",children:e.length})]})}];return w(f,{paddingTop:8,height:"100%",overflow:"hidden",display:"flex",flexDirection:"column",children:[n(ba,{items:u,activeColor:"white",borderActiveColor:"white",onChange:p,activeIndex:r}),l?n(Tk,{text:b5}):null,m?n(Tk,{text:w5}):null,n(Pc,{scope:r,setScope:i,editable:t||c,presets:r===0?o:e})]})});wo();Gn();var Ik=e=>e.transient,zk=e=>!e.transient;function x5(e){return e.reduce((o,t)=>{let{textStyles:r=[],listStyles:i=[],linkStyles:s=[]}=t;return t.type==="project"?(o.textStyles.project=o.textStyles.project.concat(r),o.listStyles.project=o.listStyles.project.concat(i),o.linkStyles.project=o.linkStyles.project.concat(s)):(o.textStyles.global=o.textStyles.global.concat(r),o.listStyles.global=o.listStyles.global.concat(i),o.linkStyles.global=o.linkStyles.global.concat(s)),o},{textStyles:{global:[],project:[]},listStyles:{global:[],project:[]},linkStyles:{global:[],project:[]}})}function ru(e,o){let t=e.global.reduce((l,m)=>(l[m.name]={...m,transient:!0,scope:"global"},l),{});t=e.project.reduce((l,m)=>(l[m.name]={...m,transient:!0,scope:"project"},l),t);let r=Object.keys(t),i=o.project.map(l=>l.name).concat(o.global.map(l=>l.name)),s=Ou(r,i),a=Object.values(Nu(t,s)).map(l=>({...l,transient:!0}));return a.length>0?{project:o.project.concat(a.filter(l=>l.scope==="project")),global:o.global.concat(a.filter(l=>l.scope==="global"))}:o}function iu(e){let{global:o,project:t}=e;return o.find(Ik)||t.find(Ik)?{project:t.filter(zk),global:o.filter(zk)}:e}function Ek(e,o){let t=x5(e),{textStyles:r,listStyles:i,linkStyles:s}=o;return{textStyles:ru(t.textStyles,r),listStyles:ru(t.listStyles,i),linkStyles:ru(t.linkStyles,s)}}function Rk(e){let{textStyles:o,listStyles:t,linkStyles:r}=e;return{textStyles:iu(o),listStyles:iu(t),linkStyles:iu(r)}}Be();ao();X2();fn();v();var v5=({children:e,button:o,...t})=>{let[r,i]=(0,nt.useState)("widgets"),{currentPanel:s,closePanels:a,panelPayload:l,togglePanel:m}=(0,nt.useContext)(kt),{workspace:c,isCurrentPageLocked:p}=(0,nt.useContext)(Je),[u]=Zt(),[d]=_h(),[g,h]=(0,nt.useState)(null),b=(0,nt.useRef)(),x=(0,nt.useRef)(!1),[y,S]=(0,nt.useState)(!1),k=(0,nt.useContext)(ie),{isFreePlan:P}=(0,nt.useContext)(tr),[{step:C}]=Qn(),B=(0,nt.useRef)(),$=(0,nt.useRef)(),A=(0,nt.useRef)(),R="widget-selector",Z=s===R,F=Z&&r==="presets",V=(0,nt.useMemo)(()=>{let L=[...d.project,...d.global],j=k.isOwner&&P;return L.length===0&&j},[d,k.isOwner,P]);Rr("w",{handler:()=>{m("widget-selector",!1)}},[p,u]),(0,nt.useEffect)(()=>{Z&&l?.nestedPanel==="presets"&&(i("presets"),h("my-presets"))},[Z]),(0,nt.useEffect)(()=>{C?.name==="TextWidget"&&s!==R&&(m(R,!1),i("widgets"))},[C]),(0,nt.useEffect)(()=>{(!s||s!=="widget-selector")&&(h(null),i("widgets"))},[s]),(0,nt.useEffect)(()=>{let L=new AbortController;return Sh({signal:L.signal,projectId:k.project._id,ownerId:k.owner._id}),()=>L.abort()},[k.project._id,k.owner._id]),(0,nt.useEffect)(function(){let j=[...d.readymag,...d.global,...d.project];if(!j.length)return;let N=j.reduce((le,We)=>[...le,...We.widgets],[]),de=uo.getUsedFontsFromWidgetsModels({models:N},uo.fontsShortList);uo.appendFontsCssToDocument({fonts:de,version:"edit"})},[d]),(0,nt.useEffect)(function(){let j=[...d.readymag,...d.global,...d.project];if(j.length===0||!F)return;let N={textStyles:Ks(),listStyles:ea(),linkStyles:Js()},de=Ek(j,N);return N.textStyles!==de.textStyles&&Xs(de.textStyles),N.listStyles!==de.listStyles&&Qs(de.listStyles),N.linkStyles!==de.linkStyles&&Zs(de.linkStyles),function(){let We={textStyles:Ks(),listStyles:ea(),linkStyles:Js()},he=Rk(We);Xs(he.textStyles),Qs(he.listStyles),Zs(he.linkStyles)}},[d,F]),(0,nt.useEffect)(()=>{jo(["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],{show:!Z})},[Z]);function W(L){i(L),h(null),L==="presets"&&ae(ce.PresetClick)}let J=(0,nt.useCallback)(L=>{b.current&&(clearTimeout(b.current),b.current=void 0),!y&&h(L)},[y]),me=(0,nt.useCallback)(()=>{b.current&&(clearTimeout(b.current),b.current=void 0),b.current=setTimeout(()=>{x.current||h(null)},100)},[]),se=(0,nt.useMemo)(()=>new Backbone.Model({workspace:c,onClose:L=>{a(),c?.createWidget(L,l)}}),[a,c]),ee=(0,nt.useMemo)(()=>g==="my-presets"?[]:(d.readymag.filter(L=>L.category?._id===g)??[]).sort((L,j)=>L.position-j.position),[g,d.readymag]),ue={buttonPadding:"0 16px",onAnimationStart:()=>S(!0),onAnimationComplete:()=>{A.current?.update?.(),B.current?.update?.(),$.current?.update?.(),S(!1)}},ke=(0,nt.useMemo)(()=>g==="my-presets"&&V?!1:g!==null&&r==="presets",[g,r,V]),ge=(0,nt.useCallback)(L=>{J(L._id)},[J]),we=(0,nt.useMemo)(()=>{let L=df(C);return L.modifiers.push({name:"offset",enabled:!0,options:{offset:[0,48]}}),L},[C]);return w(Et,{name:"widget-selector",button:o,skidding:-84,panelPosition:{height:"auto"},ArrowProps:{backgroundColor:Me("black",.96)},onToggle:()=>{yl(["PictureWidget","ButtonWidget"]),Ie(["PictureWidget","ButtonWidget"])},...t,children:[n(Gi,{isOpen:ke,children:n(f,{backgroundColor:"black",onMouseEnter:()=>x.current=!0,onMouseLeave:()=>{x.current=!1,me()},children:n(f,{width:432,height:"100%",backgroundColor:"black",borderRadius:8,children:g==="my-presets"?n(Bk,{global:d.global,project:d.project,isOwner:k.isOwner}):n(Pc,{presets:ee})})})}),n(f,{zIndex:1,maxHeight:"100%",borderRadius:8,backgroundColor:"#313131",children:w(Zo,{dynamicHeight:!0,value:r,transition:{mass:1,stiffness:210,damping:20,duration:.2},onChange:W,children:[n(Kt,{value:"widgets",renderButton:()=>n(ht,{targetSteps:["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],stepContext:{isPresetPanel:r==="presets"},listenReferenceResize:!0,modifiers:[{name:"offset",enabled:!0,options:{offset:[0,24]}}],show:r==="widgets"?!1:void 0,position:"right",popperRef:B,children:n(nu,{children:"Widgets"})}),...ue,children:L=>n(f,{ref:L,paddingLeft:8,children:n(dl,{model:se,context:Yn,children:n(ht,{targetSteps:["TextWidget","PictureWidgetSelect","ButtonWidgetSelect"],indent:8,listenReferenceResize:!0,modifiers:we.modifiers,componentsProps:we.componentProps,show:r!=="widgets"?!1:void 0,popperRef:$,children:n(f,{children:n(hk,{disableKeyboardNavigation:r==="presets",highlightedWidget:C?.widgetSelectionType})})})})})}),n(Kt,{value:"presets",renderButton:()=>w(f,{position:"relative",children:[n(nu,{divider:!0,children:"Presets"}),r==="presets"?n(f,{as:"span",position:"absolute",top:12,right:0,onClick:L=>L.stopPropagation(),children:n(Co,{href:"https://help.readymag.com/hc/en-us/articles/14645512799259-Presets"})}):null]}),...ue,children:L=>n(f,{ref:L,height:"calc(100vh - 210px)",children:n(k5,{open:V&&g==="my-presets",popperRef:A,children:n(Pk,{selectedCategory:g,onSelectCategory:ge,onDeselectCategory:me})})})})]})})]})},k5=({children:e,open:o,popperRef:t})=>n(dt,{indent:8,open:o,skidding:20,placement:"right-start",listenReferenceResize:!0,componentsProps:{arrow:{marginTop:"-10px",color:"blue"},tooltip:{backgroundColor:"blue"}},text:"Upgrade your plan to save new presets",popperRef:t,children:n("span",{children:e})}),nu=Y(ne)`
  color: white;
  height: 48px;
  width: 100%;
  text-align: left;
  position: relative;
  padding-left: 0px;
  padding-right: 0px;
  box-sizing: border-box;
  position: relative;

  ${e=>e.divider&&te`
      &:before {
        content: '';
        position: absolute;
        left: 0;
        top: -1px;
        width: 100%;
        height: 2px;
        background-color: rgba(162, 162, 162, 0.24);
      }
    `}
`;nu.defaultProps={textStyle:"subheading"};var Ak=v5;var At=T(H());Gt();to();ot();G();ve();var Dk=T(H());G();Pt();Ue();ps();ve();to();ot();Xc();gn();go();v();var y5=208;function Tc({children:e,title:o,expanded:t=!1,onToggle:r,hideArrows:i=!1,...s}){let a=(0,Dk.useContext)(Je),{isHovered:l,...m}=Ge();return a.viewport!=="default"?n(f,{width:224,borderRadius:"8px",color:"black",backgroundColor:Ee(.04,O.lightGray),overflow:"hidden",backdropFilter:"blur(4px)",...s,children:n(Zo,{dynamicHeight:!0,value:t?1:0,onChange:()=>r?.(!t),transition:{duration:.2,ease:qs.easeOutQuint},children:n(Kt,{value:1,renderButton:()=>w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",height:46,width:192,padding:"13px 0",margin:"0 auto",cursor:"pointer",role:"button",...m,children:[n(Le,{children:o}),!i&&n(f,{color:l?"black":"gray",transition:".1s ease",children:t?n(Rh,{}):n(Ah,{})})]}),containerHeight:y5,children:c=>n(f,{ref:c,children:e(t)})})})}):null}var Dn=T(H()),S5=T(nr());Pt();G();ve();Ue();q2();re();var Wk=T(St());sp();wo();ot();var $k=T(et());ot();pp();var Lk=e=>{let o=`mirror-${e.id}-${Date.now()}`,t=Object.create(e,{_listenId:{value:$k.default.uniqueId("l")},_events:{value:{},writable:!0},id:{value:o},mirroredId:{value:e.id},viewport:{value:"default",writable:!0},widgets_collection:{value:void 0,writable:!0},mirror:{value:!0},attributes:{value:new Proxy(e.attributes,{get(r,i){let s=`viewport_${t.viewport}`,a=t.viewport===e.getViewport();return i==="_id"||i==="hotspots_group_id"?o:a?r[i]:t.viewport!=="default"&&i in e[s]||Pe.viewport_fields_common.includes(i)?e[s][i]:i in e.viewport_default?e.viewport_default[i]:r[i]}})},getViewport:{value(){return this.viewport}},setViewport:{value(r){this.viewport=r}},get:{value(r){return this.attributes[r]}},set:{value(){return this}},sync:{value(){}},save:{value(){}},destroy:{value(r){t.stopListening(e),this.widgets_collection?.models.forEach(i=>i.destroy()),this.destroyed=!0,e.destroy.call(this,r)}},triggerReady:{value(){}}});return e.widgets_collection&&(t.widgets_collection=new ap(e.widgets_collection.models.map(r=>Lk(r)),{parent_widget:t,page:t.collection.page})),t.listenTo(e,"all",function(r,i,s,a){/:/.test(r)&&!a?a={socketUpdate:!0}:a&&typeof a=="object"?a={...a,socketUpdate:!0}:typeof s=="object"&&(s={...s,socketUpdate:!0}),i?.id===t.mirroredId&&t.trigger(r,t,s,a)}),t},Hk=Lk;Vn();to();Pb();re();G();v();var _5=e=>n("svg",{viewBox:"0 0 20 12",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M0 11h20v1H0v-1zM4 0h12a2 2 0 012 2v8H2V2a2 2 0 012-2z",fill:"currentColor",fillRule:"nonzero"})}),C5=f.withComponent(Y(_5)`
      display: block;
    `),Ok=C5;var su=T(H());to();ot();Xc();v();Gt();v();var Ua=206,Mc=138,Nk=16,Fk=e=>{let o=gt.calcBoundingBoxForBlock(e,!0,!1),t=gt.calcBoundingBoxForBlock(e,!0,!0),r=gt.getScaleToFit(t,{width:Ua-Nk*2,height:Mc-Nk*2}),i=Math.min(r,1),s=o.left+o.width/2-(t.left+t.width/2),a=o.top+o.height/2-(t.top+t.height/2);e.$el[0].style.setProperty("transform",`scale(${i}) translate(${s}px, ${a}px)`)},P5=Y(f)`
  & > * {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
    width: ${Ua}px;
    height: ${Mc}px;
    border-radius: 7px;
  }

  & > * > * {
    // position static и нулевые поля нужны чтобы сбрасывать позицию и смещение у fixed-виджетов внутри кихола.
    position: static !important;
    z-index: 0 !important;
    flex: none;
    margin: 0 !important;
  }
`,T5=()=>{let e=(0,Dn.useRef)(null),{workspace:o,selectedBlocks:t,viewport:r,blocks:i,page:s,mag:a,eCommerceManager:l}=(0,Dn.useContext)(Je),m=(0,Dn.useContext)(kt),c=t.length===1?t[0]:void 0,p=c?.model.get("hidden"),u=c?.model.viewport_default.hidden,d=()=>{o?.trigger("viewportShortcutPressed","default"),c?.scrollTo(),u?(c?.blink(),m?.togglePanel("stackpanel")):c&&c.selectFromWidgetBar()};return(0,Dn.useEffect)(()=>{let g,h,b;if(r!=="default"&&c&&!p){let x=i.find(S=>S.model.attributes.type==="background")?.model;h=Hk(c.model),h.setViewport("default");let y=new np({page:s,mag:a,$container:(0,Wk.default)(e.current),width:h.attributes.w,height:h.attributes.h,background:Sb({...x?.viewport_default,video:x?.attributes.video},{width:Ua,height:Mc}),eCommerceManager:l,viewport:r});g=new ho[h.attributes.type](h,y),g.isStandalone=!0,g.autoRasterize=!1,g.$standaloneContainer=y.$el,g.render(),g.redrawPosition(g.model,{forceRedraw:!0}),Fk(g),g.listenTo(h,"change change:w change:h change:angle change:blocks change:shadow",S=>{let k=S.changedAttributes(),P=()=>{g.redrawPosition(g.model,{forceRedraw:!0}),Fk(g)};if(k){if(typeof k=="object"&&("h"in k||"w"in k||"angle"in k))P();else if(typeof k=="object"&&("blocks"in k||"style"in k||"entityMap"in k)){P();let C=g.model.attributes.h,B=g.model.attributes.entityMap;setTimeout(()=>{C!==g.model.attributes.h?P():g.model.attributes.type==="text"&&B!==g.model.attributes.entityMap&&g.refreshState()},1e3)}}else return}),(g.$el[0]?.querySelector(".frameborder")).style.setProperty("display","none")}return()=>{g?.stopListening(),g?.destroy(),h?.destroy(),b?.remove()}},[r,p,c,i,a,s]),w(K,{children:[c&&!p&&w(f,{position:"relative",width:Ua,height:Mc,boxShadow:"0 0 0 1px rgba(64, 64, 64, 0.08)",borderRadius:"8px",margin:"0 auto",children:[n(P5,{overflow:"hidden",ref:e}),u&&w(K,{children:[n(f,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",borderRadius:"8px",backgroundColor:Ee(.2,O.black)}),n(Hl,{position:"absolute",top:0,bottom:0,right:0,left:0,margin:"auto",color:"white"})]})]}),n(f,{boxSizing:"content-box",display:"flex",width:Ua,height:16,alignItems:"center",color:"darkGray",margin:"0 auto",padding:"12px 0 14px 0",children:c?w(K,{children:[n(Ok,{"aria-label":"Switch to desktop",cursor:"pointer",onClick:d,width:20,height:12,css:te`
                &:hover {
                  opacity: 0.8;
                }
              `}),n(Le,{textStyle:"small",margin:"0 0 0 8px",children:u?"Hidden on desktop":""})]}):null})]})};var Uk=T5;tn();var Ga=(e,o,t={},r={})=>{let i=Yt.extend(e),s=new i({propsData:t});s.$mount();for(let a of Object.keys(r))s.$on(a,r[a]);return o.appendChild(s.$el),s},si=e=>{e.$destroy(),e.$el.parentNode?.removeChild(e.$el)};__();Pt();Ue();tt();Uh();re();G();v();var M5=e=>n("svg",{viewBox:"0 0 16 2",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M.536 1.95a1 1 0 011-1h12.828a1 1 0 010 2H1.536a1 1 0 01-1-1z",fill:"currentColor",fillRule:"evenodd"})}),B5=f.withComponent(Y(M5)`
      display: block;
    `),Gk=B5;Oe();ct();gn();ot();v();function Vk({type:e}){switch(e){case"default":return n(Zh,{});case"phone_portrait":return n(Qh,{});case"tablet_portrait":return n(tf,{});default:let o=e;throw new Error(`Unknown viewport type: ${o}`)}}Be();go();_o();og();v();var jk=["phone_portrait","tablet_portrait","default"],[I5]=Wr({keyholeExpanded:sessionStorage.getItem("keyholeExpanded")==="true",autolayoutsExpanded:sessionStorage.getItem("autolayoutsExpanded")!=="false"});function Yk({viewport:e,viewportWidth:o,selectMode:t,isActive:r,isHovered:i,disableHover:s,onRemoveDevice:a,onViewportWidthClick:l,onAddDevice:m,onDeviceClick:c,onMouseEnter:p,onMouseLeave:u,dataTestid:d,disableRemoveDevice:g,disableViewportWidth:h}){let{isHovered:b,...x}=Ge();function y(S){S.stopPropagation()}return w(f,{"aria-label":Vs[e.name],position:"relative",height:48,display:"flex",alignItems:"center",justifyContent:"flex-start",transition:".1s ease-in",padding:t?"0 16px":"0 8px",backgroundColor:!s&&(t||i||r)?"#E1E1E1":"transparent",borderRadius:8,marginBottom:t?4:0,onClick:r?void 0:t?m:c,cursor:!r||t?"pointer":void 0,role:"button",userSelect:"none",onMouseEnter:p,onMouseLeave:u,"data-testid":d,children:[n(f,{width:38,children:n(Ze,{variant:"clean",textStyle:"small",color:"gray",disabled:h,onClick:S=>{y(S),typeof l<"u"&&l(),typeof u<"u"&&u()},children:o})}),n(f,{width:61,display:"inline-flex",justifyContent:"center",children:n(Vk,{type:e.name})}),n(f,{flexGrow:1,display:"inline-flex",justifyContent:"flex-end",children:t?n(ht,{targetSteps:e.name==="phone_portrait"?"CreateLayoutSelect":void 0,indent:24,children:n(f,{color:i?"black":"gray",children:n(la,{marginRight:-4})})}):e.name==="default"?n(Le,{textStyle:"small",color:"gray",children:"Primary"}):n(Ze,{color:b?"black":"gray",...x,disabled:g,variant:"unstyled","aria-label":"remove-viewport",onClick:S=>{typeof a<"u"&&(y(S),a())},children:n(Gk,{width:"16px",height:"16px"})})})]})}function au({children:e,button:o,...t}){let{viewport:r,viewports:i,setViewport:s,page:a,workspace:l,selectedBlocks:m}=(0,At.useContext)(Je),{projectMag:c,currentPageNum:p}=(0,At.useContext)(ie),{currentPanel:u,openPanel:d}=(0,At.useContext)(kt),[g,h]=(0,At.useState)(r),[b,x]=(0,At.useState)(!1),y=(0,At.useRef)(),[S,k]=(0,At.useState)(!1),[{step:P}]=Qn(),C=(0,At.useMemo)(()=>i.sort((N,de)=>jk.indexOf(N.name)-jk.indexOf(de.name)),[i]),B=C.every(N=>N.enabled),{isHovered:$,...A}=Ge(),[R,Z]=(0,At.useState)(null),F=_l(),[V]=Zt(),[W,J]=I5(),me=(0,At.useMemo)(()=>m?.length===1||!1,[m]),[se,ee]=(0,At.useState)(me);function ue(N){Z(null),(N==="default"||a?.getViewportParam(N,"enabled"))&&s(N),N==="phone_portrait"&&Ie("SwitchToMobileLayout")}function ke(N,de){Z(null),de?(a?.setViewportParam(N,"enabled",!0),s(N)):(a?.setViewportParam(N,"enabled",!1),N===r&&s("default"));let{viewport_phone_portrait:le,viewport_tablet_portrait:We}=a?.attributes||{},he=N==="tablet_portrait"?{viewport_tablet_portrait:We}:{viewport_phone_portrait:le};a?.save(he,{patch:!0}),N==="phone_portrait"&&!F?ae(ce.ViewportFeature,{featureType:"mobile viewport"}):N==="tablet_portrait"&&!F&&ae(ce.ViewportFeature,{featureType:"tablet viewport"})}let ge=N=>{J({...W,keyholeExpanded:N}),N&&ae(ce.ViewportFeature,{featureType:"desktop keyhole"})},we=N=>{J({...W,autolayoutsExpanded:N}),sessionStorage.setItem("autolayoutsExpanded",N?"true":"false")};(0,At.useEffect)(()=>{me?(ge(!0),ee(!0)):(ge(!1),ee(!1))},[me]),(0,At.useEffect)(()=>{let N=de=>{C.find(We=>We.name===de)?.enabled&&(d("viewports"),s(de))};return l?.on("viewportShortcutPressed",N),()=>{l?.off("viewportShortcutPressed",N)}},[l,C]),(0,At.useEffect)(()=>{r!==g&&h(r),r==="phone_portrait"&&Ie("CreateLayoutSelect")},[r]),(0,At.useEffect)(()=>{r!==g&&s(g)},[g]),(0,At.useEffect)(()=>{b||y.current&&si(y.current)},[b]),(0,At.useEffect)(()=>{let N=C.filter(de=>de.enabled===!0);F&&u==="viewports"&&r==="default"&&P?.name==="CreateLayout"&&b&&N.length===1&&Ie("CreateLayout"),F&&u==="viewports"&&r==="default"&&P?.name==="OpenMobileLayout"&&b&&N.length===2&&Ie("OpenMobileLayout")},[b,u,r,C]),(0,At.useEffect)(()=>{F&&r==="default"&&P?.name==="CreateLayoutSelect"&&jo("CreateLayoutSelect",{show:!b})},[b,r]);let L=r==="phone_portrait"&&(u==="viewports"||u===void 0),j=`page-${p}-${r}`;return n(Et,{name:"viewports",button:o,skidding:28,alwaysOpen:L,onToggle:N=>{x(N)},panelPosition:{height:"auto"},"data-testid":"viewport-panel",ArrowProps:{stroke:Ee(.84,O.gray)},...t,children:({popoverShown:N})=>(r==="phone_portrait"||N)&&w(K,{children:[r!=="default"&&w(K,{children:[se&&n(Tc,{title:"This widget on desktop",expanded:W.keyholeExpanded,width:"100%",marginBottom:6,hideArrows:!0,boxShadow:`0 0 0 2px inset ${Ee(.84,O.gray)}`,children:de=>de?n(Uk,{}):void 0},"collapsiblePanel"),n(Tc,{title:"Arrange widgets",expanded:W.autolayoutsExpanded,onToggle:we,width:"100%",boxShadow:`0 0 0 2px inset ${Ee(.84,O.gray)}`,children:de=>de?n(nb,{},j):void 0})]}),S?n(f,{"aria-label":"New viewport select",children:C.map(de=>de.enabled?null:n(Yk,{selectMode:!0,viewport:de,viewportWidth:c.getViewportWidth(de.name),dataTestid:`add-${de.name}-viewport-button`,onAddDevice:()=>{ke(de.name,!0),k(!1)}},Vs[de.name]))}):null,w(f,{"aria-label":"Viewport panel",backgroundColor:"lightGray",borderRadius:"2rm",boxShadow:`0 0 0 2px inset ${Ee(.84,O.gray)}`,display:N?"block":"none",marginTop:6,children:[w(f,{display:"flex",justifyContent:"space-between",padding:"11px 15px 13px 15px",children:[w(f,{display:"flex",alignItems:"baseline",children:[n(Le,{textStyle:"subheading",children:"Devices"}),n(f,{marginLeft:"1rm",children:n(Le,{color:"gray",textStyle:"small",children:"(D)"})})]}),!B&&!S&&n(ht,{targetSteps:["CreateLayoutSelect"],indent:16,children:n(Ze,{"aria-label":"Add viewport",color:$?"black":"gray",...A,variant:"unstyled",onClick:()=>k(!S),"data-testid":"add-viewport",disabled:V,children:n(la,{})})})]}),w(f,{padding:"0 8px 8px",children:[n(f,{position:"relative",top:24,children:n(ht,{position:"right",targetSteps:["SwitchToMobileLayout"],indent:16,children:n("div",{})})}),C.map(de=>{let le=r===de.name,We=R===de.name;return de.enabled?n(Yk,{isActive:le,isHovered:We,disableHover:le&&R!==null&&!We,viewport:de,viewportWidth:c.getViewportWidth(de.name),onDeviceClick:()=>ue(de.name),onRemoveDevice:()=>ke(de.name,!1),onMouseEnter:()=>Z(de.name),onMouseLeave:()=>Z(null),onViewportWidthClick:()=>d("guides"),dataTestid:`${de.name}-viewport-button`,disableRemoveDevice:V,disableViewportWidth:V},de.name):null})]})]})]})})}var ir=T(H());G();Gt();var fr=T(St()),He=T(et());tt();tn();var Tie=T(et()),qk=T(lu());Array.from||(Array.from=function(e){return[].slice.call(e)});function z5(){function e(d){d.parentElement.removeChild(d)}function o(d,g,h){let b=h===0?d.children[0]:d.children[h-1].nextSibling;d.insertBefore(g,b)}function t(d,g){return d.map(h=>h.elm).indexOf(g)}function r(d,g,h){if(!d)return[];let b=d.map(y=>y.elm),x=[...g].map(y=>b.indexOf(y));return h?x.filter(y=>y!==-1):x}function i(d,g){this.$nextTick(()=>this.$emit(d.toLowerCase(),g))}function s(d){return g=>{this.realList!==null&&this["onDrag"+d](g),i.call(this,d,g)}}let a=["Start","Add","Remove","Update","End","TouchMove"],l=["Choose","Sort","Filter","Clone"],m=["Move",...a,...l].map(d=>"on"+d);var c=null;return{name:"draggable",props:{options:Object,onList:{type:Array,required:!1,default:null},value:{type:Array,required:!1,default:null},noTransitionOnDrag:{type:Boolean,default:!1},clone:{type:Function,default:d=>d},element:{type:String,default:"div"},move:{type:Function,default:null}},data(){return{transitionMode:!1,componentMode:!1}},render(d){let g=this.$slots.default;if(g&&g.length===1){let x=g[0];x.componentOptions&&x.componentOptions.tag==="transition-group"&&(this.transitionMode=!0)}let h=g,{footer:b}=this.$slots;return b&&(h=g?[...g,...b]:[...b]),d(this.element,null,h)},mounted(){if(this.componentMode=this.element.toLowerCase()!==this.$el.nodeName.toLowerCase(),this.componentMode&&this.transitionMode)throw new Error(`Transition-group inside component is not supported. Please alter element value or remove transition-group. Current element value: ${this.element}`);var d={};a.forEach(h=>{d["on"+h]=s.call(this,h)}),l.forEach(h=>{d["on"+h]=i.bind(this,h)});let g=Object.assign({},this.options,d,{onMove:(h,b)=>this.onDragMove(h,b)});!("draggable"in g)&&(g.draggable=">*"),this._sortable=new qk.default(this.rootContainer,g),this.computeIndexes(),this.$el._draggable=this},beforeDestroy(){this._sortable.destroy()},computed:{rootContainer(){return this.transitionMode?this.$el.children[0]:this.$el},isCloning(){return!!this.options&&!!this.options.group&&this.options.group.pull==="clone"},realList(){return this.list?this.list:this.value}},watch:{options:{handler(d){for(var g in d)m.indexOf(g)===-1&&this._sortable.option(g,d[g])},deep:!0},realList(){this.computeIndexes()}},methods:{doDrop(d,g){this._sortable&&this._sortable.forceDrop(d,g)},dropIntoGroup(d){this._sortable&&this._sortable.dropIntoGroup(d)},getChildrenNodes(){if(this.componentMode)return this.$children[0].$slots.default;let d=this.$slots.default;return this.transitionMode?d[0].child.$slots.default:d},computeIndexes(){this.$nextTick(()=>{this.visibleIndexes=r(this.getChildrenNodes(),this.rootContainer.children,this.transitionMode)})},getUnderlyingVm(d){let g=t(this.getChildrenNodes()||[],d);if(g===-1)return null;let h=this.realList[g];return{index:g,element:h}},getUnderlyingPotencialDraggableComponent({__vue__:d}){return!d||!d.$options||d.$options._componentTag!=="transition-group"?d:d.$parent},emitChanges(d){this.$nextTick(()=>{this.$emit("change",d)})},alterList(d){this.list?d(this.list):(this.alteredList||(this.alteredList=[...this.value]),d(this.alteredList),this.$nextTick(()=>{this.alteredList&&(this.$emit("input",[...this.alteredList]),this.alteredList=null)}))},spliceList(){let d=g=>g.splice(...arguments);this.alterList(d)},updatePosition(d,g){let h=b=>b.splice(g,0,b.splice(d,1)[0]);this.alterList(h)},getRelatedContextFromMoveEvent({to:d,related:g}){let h=this.getUnderlyingPotencialDraggableComponent(d);if(!h)return{component:h};let b=h.realList,x={list:b,component:h};if(d!==g&&b&&h.getUnderlyingVm){let y=h.getUnderlyingVm(g);if(y)return Object.assign(y,x)}return x},getVmIndex(d){let g=this.visibleIndexes,h=g.length;return d>h-1?h:g[d]},getComponent(){return this.$slots.default[0].componentInstance},resetTransitionData(d){if(!this.noTransitionOnDrag||!this.transitionMode)return;var g=this.getChildrenNodes();g[d].data=null;let h=this.getComponent();h.children=[],h.kept=void 0},onDragTouchMove(d){d.data.draggedContext=this.getUnderlyingVm(d.data.dragEl),d.data.nextDraggedContext=this.getUnderlyingVm(d.data.next),d.data.prevDraggedContext=this.getUnderlyingVm(d.data.prev),d.data.sortable=this,this.$emit("touchMove",d,d.item)},onDragStart(d){this.context=this.getUnderlyingVm(d.item),d.item._underlying_vm_=this.clone(this.context.element),d.context=this.context,c=d.item},onDragAdd(d){let g=d.item._underlying_vm_;if(d.data&&d.data.context&&(g=d.data.context.element),g===void 0)return;e(d.item);let h=this.getVmIndex(d.newIndex);this.alteredList&&d.data&&d.data.prevContext&&(h=this.alteredList.indexOf(d.data.prevContext.element)+1),this.spliceList(h,0,g),this.computeIndexes();let b={element:g,newIndex:h};this.emitChanges({added:b})},onDragRemove(d){if(o(this.rootContainer,d.item,d.oldIndex),this.isCloning){e(d.clone);return}let g=this.context&&this.context.index;d.data&&d.data.context&&(g=this.alteredList?this.alteredList.indexOf(d.data.context.element):this.value.indexOf(d.data.context.element));let h=this.context&&this.context.element;d.data&&d.data.context&&(h=d.data.context.element),this.spliceList(g,1);let b={element:h,oldIndex:g};this.resetTransitionData(g),this.emitChanges({removed:b})},onDragUpdate(d){e(d.item),d.data.camebackTo?d.data.camebackTo.before?d.data.camebackTo.parent.insertBefore(d.item,d.data.camebackTo.before):d.data.camebackTo.parent.appendChild(d.item):o(d.from,d.item,d.oldIndex);let g=this.context.index;d.data&&d.data.context&&(g=this.alteredList?this.alteredList.indexOf(d.data.context.element):this.value.indexOf(d.data.context.element));let h=this.getVmIndex(d.newIndex);this.alteredList&&d.data&&d.data.prevContext&&(h=this.alteredList.indexOf(d.data.prevContext.element),h<g&&h++);let b=this.context.element;d.data&&d.data.context&&(b=d.data.context.element),this.updatePosition(g,h);let x={element:b,oldIndex:g,newIndex:h};this.emitChanges({moved:x})},computeFutureIndex(d,g){if(!d.element)return 0;let h=[...g.to.children].filter(S=>S.style.display!=="none"),b=h.indexOf(g.related),x=d.component.getVmIndex(b);return h.indexOf(c)!==-1||!g.willInsertAfter?x:x+1},onDragMove(d,g){let h=this.move;if(!h||!this.realList)return!0;let b=this.getRelatedContextFromMoveEvent(d),x=this.context,y=this.computeFutureIndex(b,d);return Object.assign(x,{futureIndex:y}),Object.assign(d,{relatedContext:b,draggedContext:x}),d.draggable=this,h(d,g)},onDragEnd(d){this.computeIndexes(),c=null}}}}var Ns=z5();tn();var du=T(et());sn();var pu=T(St());tn();var cu=T(et());Xl();xd();var E5={components:{PermissionController:ls},inject:["layerList"],props:["widget","group","fakeLayer","isNotVisible"],data:function(){return Object.assign({w_name:"",tmpName:"",locked:!!this.widget.model.get("is_locked"),viewportIcon:"no",noHoverButtons:!1,editable:!1,isDragOver:!1,isGlobal:!1},{hidden:this.widget.model.get("hidden")})},computed:Object.assign({selected:function(){return this.widget.selected},customName:function(){return this.widget.model.get("name")},_id:function(){return this.widget.model&&this.widget.model.get("_id")||""},stdName:function(){return this.widget.getStandardName()},icon_style:function(){return this.widget.getIconStyle()},isLoading:function(){return this.widget.isLoading},rawSvg:function(){let e="",o=this.widget.getIconData&&this.widget.getIconData()||this.iconData;return o&&o.$svg&&(e='<div class="container">'+o.$svg.clone().get(0).outerHTML+"</div>"),e}},{}),watch:Object.assign({locked:function(e){this.widget.model.get("is_locked")!=e&&this.widget.model.save("is_locked",e)}},{hidden:function(e){this.widget.workspace.save_group([{_id:this.widget.model.get("_id"),hidden:e}])}}),created:function(){Yt.set(this.widget,"iconData",this.widget.iconData||null),Yt.set(this.widget,"selected",this.widget.selected||!1),Yt.set(this.widget,"$svg",this.widget.$svg||null),Yt.set(this.widget.model.attributes,"type",this.widget.model.attributes.type||""),Yt.set(this.widget.model.attributes,"name",this.widget.model.attributes.name||""),this.layerList&&!this.fakeLayer&&(this.layerList[this.widget.model.attributes._id]=this),this.widget.model.attributes.type=="shape"&&Yt.set(this.widget.model.attributes,"tp",this.widget.model.attributes.tp||""),this.widget.model.attributes.type=="text"&&Yt.set(this.widget.model.attributes,"text",this.widget.model.attributes.text||"")},mounted:function(){this.$s=this.$refs.editable,this.$s.onkeydown=this.onkeydown,this.locked=!!this.widget.model.get("is_locked"),this.isGlobal=!!this.widget.model.get("is_global"),this.widget.model.on("change:hidden",this.onHiddenChanged),this.widget.model.on("change:is_locked",this.onLockedChanged),this.widget.model.on("change:is_global",this.onGlobalChanged),this.widget.bindUploader instanceof Function&&(this._uploader=new ki(this.widget,{fileInput:(0,pu.default)(this.$refs.fileinput),dropZone:(0,pu.default)(this.$el),unique:!0}),this._uploader.on("drop dragleave",()=>{this.isDragOver=!1}),this._uploader.on("dragover",()=>{this.isDragOver=!0}),this.widget.bindUploader(this._uploader)),this.widget.workspace.page.on("change:viewport",this.onChangeViewport),this.onChangeViewport()},destroyed:function(){this._uploader&&this._uploader.destroy(),this.widget.model.off("change:hidden",this.onHiddenChanged),this.widget.model.off("change:is_locked",this.onLockedChanged)},updated:function(){this.layerList&&!this.fakeLayer&&(this.layerList[this.widget.model.attributes._id]=this)},methods:{onChangeViewport:function(){let e=this.widget.workspace.viewport,o=this.widget.workspace.page.getViewportParam("phone_portrait","enabled");return e==="default"&&o&&!(this.widget.model.viewport_phone_portrait&&this.widget.model.viewport_phone_portrait.hidden)?this.viewportIcon="phone_portrait":e==="phone_portrait"&&!(this.widget.model.viewport_default&&this.widget.model.viewport_default.hidden)?this.viewportIcon="default":e==="tablet_portrait"&&!(this.widget.model.viewport_default&&this.widget.model.viewport_default.hidden)?this.viewportIcon="default":this.viewportIcon="no",this.viewportIcon},switchToViewport:function(e){this.viewportIcon!=="no"&&(this.widget.workspace.trigger("viewportShortcutPressed",this.viewportIcon),this.widget.selected?this.$emit("onWidgetSelect",this.widget,e):this.widget.scrollTo())},layerDblClick:function(){this.$emit("onWidgetDblClick")},layerClick:function(e){e.target==this.$refs.lock||e.target==this.$refs.hide||e.target==this.$refs.vp_icon||e.target==this.$refs.editable&&this.editable||this.$el.cooldown&&this.$el.cooldown>+new Date||this.$emit("onWidgetSelect",this.widget,e)},onHiddenChanged:function(e){this.hidden=e.get("hidden")},onLockedChanged:function(e){this.locked=e.get("is_locked")},onGlobalChanged:function(e){this.isGlobal=e.get("is_global")},rename:function(e){if(this.editable){e.preventDefault(),e.stopPropagation();return}if(RM.constructorRouter.trigger("notice:triggerMetrics","widgetRenamed"),this.$emit("changeEditState",!0),this.widget.model.get("type")=="background")return!1;this.editable=!0,cu.default.delay(()=>{this.$refs.editable.focus()},50)},onkeydown:function(e){if(e.keyCode==13)return e.preventDefault(),this.$s.blur(),!1;if(e.keyCode==27)return this.$s.innerText=this.stdName||this.customName,this.editable=!1,e.preventDefault(),!1},onblur:function(){this.widget.model.save("name",this.$refs.editable.innerText.trim()),this.editable=!1,this.$emit("changeEditState",!1)},showNotice:function(){RM.constructorRouter.trigger("notice:triggerMetrics","viewportIconHovered")},editableFocus:()=>{cu.default.defer(()=>{document.execCommand("selectAll",!1,null)})}}},R5=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"layer",class:{selected:e.widget.selected,hidden:e.hidden,locked:e.locked,"is-global":e.isGlobal,"not-visible":e.isNotVisible},attrs:{"aria-label":"Layer","data-id":e._id,"layer-id":e._id},on:{dblclick:e.layerDblClick,click:function(r){return r.stopPropagation(),e.layerClick(r)}}},[t("div",{ref:"icon",staticClass:"icon",class:{preloader:e.isLoading,replace:e.isDragOver},style:e.icon_style,domProps:{innerHTML:e._s(e.rawSvg)}}),e._v(" "),t("div",{staticClass:"w_name"},[t("span",{ref:"editable",class:{editable:e.editable},attrs:{contenteditable:e.editable},on:{focus:e.editableFocus,dblclick:e.rename,click:function(r){e.widget.selected&&e.rename(r)},blur:e.onblur}},[e._v(e._s(e.customName||e.stdName))])]),e._v(" "),t("input",{ref:"fileinput",attrs:{name:"upload",type:"file","data-url":"/api/upload/lambda/"}}),e._v(" "),t("i",{ref:"vp_icon",staticClass:"viewport_icon",class:[e.viewportIcon+"_icon",{"no-hover":e.noHoverButtons}],attrs:{"aria-label":"Viewport"},on:{click:function(r){return e.switchToViewport(r)},mouseleave:function(r){e.noHoverButtons=!1},mouseover:e.showNotice}}),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanHide"}},[t("div",{ref:"hide",staticClass:"hide",class:{active:e.hidden,"no-hover":e.noHoverButtons},attrs:{"aria-label":"Visibility toggle"},on:{click:function(r){e.noHoverButtons=!0,e.hidden=!e.hidden},mouseleave:function(r){e.noHoverButtons=!1}}})]),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanLock"}},[t("div",{ref:"lock",staticClass:"lock",class:{active:e.locked,"no-hover":e.noHoverButtons},attrs:{"aria-label":"Lock"},on:{click:function(r){e.noHoverButtons=!0,e.locked=!e.locked},mouseleave:function(r){e.noHoverButtons=!1}}})]),e._v(" "),t("div",{staticClass:"ph"})],1)},A5=[],D5=void 0,$5=void 0,L5=void 0,H5=!1;function O5(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="layer.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var N5=O5({render:R5,staticRenderFns:A5},D5,E5,$5,H5,L5,!1,void 0,void 0,void 0),Ic=N5;var F5={props:["group","expanded","noArrow"],methods:{iconstyle:function(e){return this.group[e].getIconStyle&&this.group[e].getIconStyle({small:!0})||""},toggleExpand:function(){this.$emit("click")},rawSvg:function(e){let o="",t=this.group[e].iconData||this.group[e].getIconData&&this.group[e].getIconData();return t&&t.$svg&&(o='<div class="container">'+t.$svg.clone().get(0).outerHTML+"</div>"),o}}},W5=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"groupicon",class:{"no-arrow":e.noArrow},on:{click:e.toggleExpand}},[t("div",{staticClass:"icon-wrapper"},[e.group.length==2?t("div",{staticClass:"tilegrid two"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}})]):e.group.length==3?t("div",{staticClass:"tilegrid three"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tilegrid"},[t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(2),domProps:{innerHTML:e._s(e.rawSvg(2))}})])]):e.group.length>=4?t("div",{staticClass:"tilegrid four"},[t("div",{staticClass:"tile",style:e.iconstyle(0),domProps:{innerHTML:e._s(e.rawSvg(0))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(1),domProps:{innerHTML:e._s(e.rawSvg(1))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(2),domProps:{innerHTML:e._s(e.rawSvg(2))}}),e._v(" "),t("div",{staticClass:"tile",style:e.iconstyle(3),domProps:{innerHTML:e._s(e.rawSvg(3))}})]):e._e()]),e._v(" "),e.noArrow?e._e():t("svg",{ref:"expand",staticClass:"grouptriangle",class:{expanded:e.expanded},attrs:{width:"9px",height:"6px",viewBox:"0 0 9 6",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},on:{click:function(r){e.$emit("expand",r)}}},[t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("path",{attrs:{id:"expand-icon",d:"M6.70324633,2.40243474 C7.14328123,2.73246092 7.14264107,3.2680192 6.70324633,3.59756526 L2.29675367,6.90243474 C1.85671877,7.23246092 1.5,7.0536886 1.5,6.50245535 L1.5,-0.502455354 C1.5,-1.05338405 1.85735893,-1.2319808 2.29675367,-0.902434744 L6.70324633,2.40243474 Z",fill:"#FFFFFF",transform:"translate(4.500000, 3.000000) rotate(-270.000000) translate(-4.500000, -3.000000) "}})])])])},U5=[],G5=void 0,V5=void 0,j5=void 0,Y5=!1;function q5(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="group_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var X5=q5({render:W5,staticRenderFns:U5},G5,F5,V5,Y5,j5,!1,void 0,void 0,void 0),Xk=X5;xd();ct();var Kk=(e=[])=>e.filter(o=>o.selected).length===1&&e.length>1,K5={components:{Layer:Ic,GroupIcon:Xk,Draggable:Ns,PermissionController:ls},inject:["layerList"],props:{widget:{},group:null,onTouchMove:null,onMoveGhost:null,noArrow:!1,fakeGroup:!1,noDragndrop:!1,isNotVisible:Boolean,filterPredicate:{type:Function,default:()=>!1}},data:function(){return{hidden:!1,editable:!1,draggableDisabled:!1,expanded:Kk(this.widget.widgets)}},computed:{layerClasses:function(){return{fold:!this.expanded,selected:this.selected&&!this.widget.hovered,hidden:this.hidden,expanded:this.expanded,groupHidden:this.groupHidden,groupLocked:this.groupLocked,"not-visible":this.isNotVisible}},selected:function(){let e=!0;return du.default.each(this.widget.widgets,function(o){e=e&&o.selected}),e},oneWidgetSelected(){return Kk(this.widget.widgets)},groupHidden:{get:function(){return this.widget.widgets.every(e=>e.model.get("hidden"))},set:function(){this.groupSave({hidden:!this.groupHidden})}},groupLocked:{get:function(){return this.widget.widgets.every(e=>e.model.get("is_locked"))},set:function(){this.groupSave({is_locked:!this.groupLocked})}},hasGlobalW:{get:function(){return this.widget.widgets.some(e=>e.model.get("is_global"))}},name:{get:function(){return this.group_model?this.group_model.get("name"):this.widget.groupName||"Group"},set:function(e){this.group_model||(this.group_model=new Ea({pack_id:this._id,mid:this.widget.widgets[0].workspace.mag.id})),this.group_model.save("name",e);let o=this.packs_data.find(t=>t.pack_id==this._id);o?o.name=e:this.packs_data.push(this.group_model.toJSON())}},_id:function(){return this.widget.pack_id},pack_id:function(){return"pack "+this._id},packs_data:function(){return this.widget.widgets[0].workspace.mag.attributes.packs},order:function(){return this.widget.sort(e=>-Number(e.model.get("z"))).map(e=>e.model.get("_id"))}},watch:{oneWidgetSelected(){this.expanded=!0}},created:function(){let e=this.packs_data&&this.packs_data.find(o=>o.pack_id==this._id);e&&(this.group_model=new Ea(e))},mounted:function(){this.$s=this.$refs.editable,this.$s&&(this.$s.onkeydown=this.onkeydown)},updated:function(){this.layerList&&(this.layerList[this.widget.pack_id]=this)},methods:{onMove:function(e){this.$emit("onMove",e)},onEnd:function(e){this.$emit("end",e)},layerClick:function(e){if((e.target.nearestViewportElement||e.target)!=this.$refs.groupicon.$refs.expand&&!(e.target==this.$refs.editable&&this.editable)){if(!this.selected){let t=this.widget.widgets[0].getPack();t&&t.scrollTo(),this.widget.widgets[0].selectFromWidgetBar(e,!0)}this.selected&&!this.groupHidden&&(jo("MobileMenuVisible",{show:!1}),Ie("MobileMenuVisible"))}},toggleExpand:function(){let e=JSON.parse(window.sessionStorage.getItem("groupsState")||"{}");this.expanded=!this.expanded,e[this.widget.pack_id]=this.expanded,window.sessionStorage.setItem("groupsState",window.JSON.stringify(e)),this.$emit("expandChanged")},reorder:function(){Yt.nextTick(()=>this.$emit("reorder"))},rename:function(){this.editable=!0,this.$emit("changeEditState",!0),du.default.delay(()=>{this.$s.focus()},50)},onblur:function(){this.editable=!1,this.$emit("changeEditState",!1),this.name=this.$refs.editable.innerText.trim()},onkeydown:function(e){if(e.keyCode==13)return e.preventDefault(),this.$s.blur(),!1;if(e.keyCode==27)return this.$s.innerText=this.name,this.editable=!1,e.preventDefault(),!1},ondragstart:function(e){this.$emit("start",e)},groupSave:function(e){let o=this.widget.widgets.map(t=>Object.assign({_id:t.model.get("_id")},e));this.widget.widgets[0].workspace.save_group(o)},onHideClick:function(){this.selected?Ie("MobileMenuVisible"):(yl(["MobileMenuVisible"]),jo("MobileMenuVisible",{show:!0})),this.groupHidden=!this.groupHidden}}},Z5=function(){var e=this,o=e.$createElement,t=e._self._c||o;return e.widget.widgets.length==1?t("layer",{attrs:{"fake-layer":e.fakeGroup,widget:e.widget.widgets[0]},on:{onWidgetSelect:function(r,i){e.$emit("onWidgetSelect",r,i)}}}):e.widget.widgets.length>0?t("div",{staticClass:"group_layer layer",class:e.layerClasses,attrs:{"layer-id":e.pack_id},on:{click:e.layerClick}},[e.widget.widgets.length>1?t("div",{staticClass:"head",class:{hovered:e.widget.hovered,"has-global-w":e.hasGlobalW}},[t("group-icon",{ref:"groupicon",attrs:{group:e.widget.widgets,"no-arrow":e.noArrow,expanded:e.expanded},on:{expand:e.toggleExpand}}),e._v(" "),t("div",{staticClass:"w_name group_name"},[t("span",{ref:"editable",class:{editable:e.editable},attrs:{contenteditable:e.editable,onfocus:"document.execCommand('selectAll',false,null)"},on:{dblclick:e.rename,click:function(r){e.selected&&e.rename()},blur:e.onblur}},[e._v(e._s(e.name))])]),e._v(" "),t("div",{staticClass:"icons-container"},[t("permission-controller",{attrs:{permission:"BaseWidgetCanHide"}},[t("div",{ref:"hide",staticClass:"hide",on:{click:function(r){return r.stopPropagation(),e.onHideClick(r)}}})]),e._v(" "),t("permission-controller",{attrs:{permission:"BaseWidgetCanLock"}},[t("div",{ref:"lock",staticClass:"lock",on:{click:function(r){r.stopPropagation(),e.groupLocked=!e.groupLocked}}})])],1)],1):e._e(),e._v(" "),t("div",{staticClass:"group_container",class:{active:e.expanded}},[t("draggable",{staticClass:"draggable-container in-group-draggable",attrs:{move:function(r){e.$emit("move",r)},options:{moveByBlock:!0,disabled:e.noDragndrop||e.draggableDisabled,onMoveGhost:e.onMoveGhost,relParent:"sortable_relparent",denyX:!0,forceFallback:!0,group:e.group,animation:200,delay:20,onMove:e.onMove,onEnd:e.onEnd}},on:{start:e.ondragstart,touchMove:e.onTouchMove,onEnd:e.onEnd,end:e.onEnd},model:{value:e.widget.widgets,callback:function(r){e.$set(e.widget,"widgets",r)},expression:"widget.widgets"}},[e._l(e.widget.widgets,function(r){return[r.model?t("layer",{key:r.attributes._id,staticClass:"inpack",attrs:{"fake-layer":e.fakeGroup,widget:r,"is-not-visible":!e.filterPredicate(r)},on:{onWidgetDblClick:function(i){return e.$emit("onWidgetDblClick")},changeEditState:function(i){e.draggableDisabled=i,e.$emit("changeEditState",i)},onWidgetSelect:function(i,s){e.$emit("onWidgetSelect",i,s)}}}):e._e()]})],2)],1)]):t("div")},J5=[],Q5=void 0,e8=void 0,t8=void 0,o8=!1;function r8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="layers_group.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var i8=r8({render:Z5,staticRenderFns:J5},Q5,K5,e8,o8,t8,!1,void 0,void 0,void 0),mu=i8;Vo();yb();var n8={props:["widget"],computed:{selected:function(){return this.widget.selected},w_name:function(){return Ye.capitalize(this.widget.model.get("type"))},isPack:function(){return!1},icon_style:function(){return this.widget.getIconStyle()},hasVideo:function(){return this.widget.model&&this.widget.model.get("selectedType")==="video"?!!kb(this.widget.model.attributes):!1}},mounted:function(){this.widget.on("select",this.select)},beforeDestroy:function(){this.widget.off("select",this.select)},methods:{select:function(){this.$emit("select")}}},s8=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"layer bg"},[t("div",{staticClass:"icon",class:{video:e.hasVideo},style:e.icon_style}),e._v(" "),t("div",{staticClass:"w_name"},[e._v(e._s(e.w_name))])])},a8=[],l8=void 0,p8=void 0,c8=void 0,d8=!1;function m8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var u8=m8({render:s8,staticRenderFns:a8},l8,n8,p8,d8,c8,!1,void 0,void 0,void 0),Zk=u8;var g8={},h8=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"grid_guides_layer layer",on:{click:function(r){return e.$emit("click")}}},[t("div",{staticClass:"icon"}),e._v(" "),t("div",{staticClass:"w_name"},[e._v("Grid & Guides")])])},f8=[],b8=void 0,w8=void 0,x8=void 0,v8=!1;function k8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="grid_guides_icon.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var y8=k8({render:h8,staticRenderFns:f8},b8,g8,w8,v8,x8,!1,void 0,void 0,void 0),Jk=y8;Ff();yo();xd();ct();var uu=T(cl()),ey=T(H());re();ta();hd();ve();ca();G();tt();ot();v();var _8=Y(f)`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 50%;
  background-color: transparent;
  cursor: pointer;
  color: ${e=>e.theme.colors.gray};

  ${e=>e.isActive&&te`
      background-color: ${e.theme.colors.blue};
      color: white;
    `};

  &:hover,
  &:active,
  &:focus {
    background-color: ${e=>e.theme.colors.blue};
    color: white;
  }
`,gu=(r=>(r.ALL="all",r.LINKS="links",r.CURRENT_VIEWPORT="viewport",r))(gu||{}),Qk=Y(Le)`
  &:hover {
    color: ${e=>e.theme.colors.black};
  }
`,C8=({actions:e,container:o,workspace:t,isActive:r=!1})=>{let i=o(),[s,a]=(0,ey.useState)(!1);function l(u){u.stopPropagation(),a(!1)}function m(){let d=t.blocks.filter(g=>g.model.get("type")!=="background").filter(g=>{let h=g.model;if(h.get("is_global"))return window.RM.constructorRouter.mag.pages.models.every(k=>{let P=k.get("_id"),C=h.clone({viewport:"default",pageId:P}),B=h.clone({viewport:"phone_portrait",pageId:P}),$=h.clone({viewport:"tablet_portrait",pageId:P});return C.get("hidden")&&B.get("hidden")&&$.get("hidden")});let b=h.clone({viewport:"default"}),x=h.clone({viewport:"phone_portrait"}),y=h.clone({viewport:"tablet_portrait"});return b.get("hidden")&&x.get("hidden")&&y.get("hidden")});ae(ce.SettingsLayers,{settingsType:"delete all unused"}),t.deleteBlocks(d,{forceRemove:!0})}let p={title:s?w(f,{height:"24px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"3px",children:[n(Qk,{role:"button",color:"tomato",textStyle:"small",onClick:m,children:"Remove"}),n(Qk,{role:"button",color:"darkGray",textStyle:"small",onClick:l,children:"Cancel"})]}):"Remove unused",hoverVariant:gd.danger,activeVariant:gd.danger,active:s,onClick:u=>{s||(u.stopPropagation(),a(!0))}};return n(ss,{minWidth:240,popperOffset:[-84,28],listItems:[...e,p],container:i,onToggleDropdown:u=>{u||a(!1)},children:({toggleDropdown:u})=>n(_8,{as:"button",type:"button",isActive:r,"aria-label":"Layer filter","aria-haspopup":"true",onClick:u,children:n($o,{})})})},ty=({props:e,rootElement:o})=>{let t=(0,uu.createRoot)(o);function r(s){t.render(n(vr,{withGlobalStyles:!1,children:n(C8,{...e,...s})}))}function i(s){t.unmount(),t=(0,uu.createRoot)(o),r(s)}return r(),{render:r,rerender:i}};var zc=T(mo());x2();var oy="layer-filter-value";function ry(){try{return window.sessionStorage.getItem(oy)}catch(e){console.log(e)}}function iy(e){try{window.sessionStorage.setItem(oy,e)}catch(o){console.log(o)}}function hu(e){return e instanceof zc.default.View?e.model.get("hidden"):Array.isArray(e.widgets)?e.widgets.some(o=>hu(o)):!1}function fu(e){return e instanceof zc.default.View?!e.model.get("hidden"):Array.isArray(e.widgets)?e.widgets.some(o=>fu(o)):!1}function bu(e){if(!(e instanceof zc.default.View))return Array.isArray(e.widgets)?e.widgets.some(o=>bu(o)):!1;if(e.model.attributes.clickLink)return!0;if(e.model.get("type")==="text"){let o=Object.values(e.model.get("entityMap")??{});for(let t of o)if(t.type===dg)return!0}return!1}ui();ot();var S8={filtersRoot:null,components:{Layer:Ic,BackgroundIcon:Zk,GuidesIcon:Jk,GroupLayers:mu,Draggable:Ns,RmScroll:Jl,PermissionController:ls,HelpTourTooltip:Ir},props:{workspace:Object,showGuidePanel:{type:Boolean,default:!0},dark:Boolean},data:function(){return{showCounter:25,layers:{above_all:[],fixed_top:[],regular:[],fixed_bottom:[]},lastPercent:0,draggedFixed:"",fixedOverRegular:!1,mark_draggable:"",groupDrag:!1,boundTop:"",scrollOversizeTop:0,scrollOversizeBottom:0,oversize:"",draggableDisabled:!1,_groupsData:{},draggedItems:[],indrag:!1,helpTourStep:"SelectGrids",helpTourStepBackground:"OpenBackgroundLayer",filter:ry()??"all"}},beforeCreate:function(){this.onIndexChange__debounced=He.default.debounce(()=>{this.onIndexChange()},10)},mounted:function(){this._scroll=this.$refs.rmscroll,window.addEventListener("resize",this.updateScroll),ye.on("index:changed",this.onIndexChange__debounced),this.renderReactHeaderActions()},provide:function(){return this._layerList={},{layerList:this._layerList}},destroyed:function(){ye.off("index:changed",this.onIndexChange__debounced),this.workspace.page.off("change:viewport",this.onIndexChange),this.workspace.off("select",this.onSelect),window.removeEventListener("resize",this.updateScroll)},updated:function(){this.updateScroll()},methods:{getHeightScrolledContent(){return this._scroll&&this._scroll.$refs.scrollWrapper?(0,fr.default)(this._scroll.$refs.scrollWrapper).height():"auto"},renderReactHeaderActions(){let e=this.getFilterActions(),o=this.filter!=="all",t=this.workspace;if(!this.$options.filtersRoot){let r=this.$refs.react_filters,i=()=>this.$refs.stack_panel;r&&(this.$options.filtersRoot=ty({rootElement:r,props:{container:i,actions:e,isActive:o,workspace:t}}));return}this.$options.filtersRoot.rerender({actions:e,isActive:o,workspace:t})},getFilterActions(){let e=this.filter,o;switch(this.workspace.getViewports().find(r=>r.isCurrent===!0)?.name){case"default":o="Show desktop widgets only";break;case"phone_portrait":o="Show mobile widgets only";break;case"tablet_portrait":o="Show tablet widgets only";break}return[{title:"Show all",onClick:()=>this.setFilterAndUpdateReact("all"),active:e==="all"},{title:o,onClick:()=>this.setFilterAndUpdateReact("viewport"),active:e==="viewport"},{title:"Show layers with links",onClick:()=>this.setFilterAndUpdateReact("links"),active:e==="links"}]},setFilterAndUpdateReact(e){if(e==="links"&&ae(ce.SettingsLayers,{settingsType:"show only with links"}),e==="viewport"&&ae(ce.SettingsLayers,{settingsType:"show current viewport"}),this.filter==="all"&&e!=="all"){let o=(0,fr.default)(this._scroll.$refs.scrollWrapper);o.css("min-height",o.height())}this.filter=e,this.renderReactHeaderActions(),iy(e)},onGuidesClick:function(){this.$emit("showPanel","guides"),Ie("SelectGrids")},onPanelScroll:function(e){this.showCounter>this.layersCount||e.scroll_event&&(this.showCounter+=Math.ceil(Math.abs(e.scroll_percent-this.lastPercent)*e.content_size/50)+10,this.lastPercent=e.scroll_percent)},caption:function(e){return{above_all:"Fixed on all pages",fixed_top:"Front Fixed",regular:"Widgets",fixed_bottom:"Back Fixed"}[e]},needLine:function(e){for(var o=He.default.keys(this.filteredLayers),t=o.indexOf(e),r=!1,i=t+1;i<o.length;i++)this.layers[o[i]].length&&(r=!0);return r},layer_type:function(e){return He.default.isArray(e.widgets)?"group-layers":"layer"},getBlocks:function(){return(0,He.default)(this.workspace.blocks).chain().filter(e=>e.model.get("type")!="background").sortBy(e=>-e.model.get("z")).value()},fFlatten:function(e,o=!1,t=!1){for(var r=[],i=0;i<e.length;i++)e[i].widgets&&(!o||e[i].expanded)?(t&&r.push(e[i]),r=r.concat(e[i].widgets)):r.push(e[i]);return r},onWidgetDblClick:function(){He.default.defer(()=>{this.workspace.controls.selectSettingsControl()})},onWidgetSelect:function(e,o){if(o.shiftKey&&this.lastWidget){var t=[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)),r=t.indexOf(e),i=t.indexOf(this.lastWidget),s=He.default.chain(t.slice(Math.min(r,i),Math.max(r,i)+1)).reduce((a,l)=>{var m=l.model.get("pack_id");if(!m)a.push(l);else{var c=a[a.length-1];c instanceof Array&&c[c.length-1].model.get("pack_id")==m?c.push(l):a.push([l])}return a},[]).reduce((a,l)=>{if(l instanceof Array){var m=l[0].model.get("pack_id");this._groups_processed[m].widgets.length!=l.length?a=a.concat(l):a.push(l)}else a.push(l);return a},[]).value();this.workspace.selectListBlocks(s,this.lastSelectedList),this.lastSelectedList=s}else this.lastWidget=e,this.lastSelectedList=[],e.scrollTo(),e.selectFromWidgetBar(o)},getCountBlocks:function(e){var o=0;return He.default.each(e,function(t){o+=1,t.widgets&&t.expanded&&(o+=t.widgets.length)}),o},getSelectedInGroup:function(e){var o=null;return He.default.each(this.layers,(t,r)=>{this.fInside(this.$refs[r],e)&&(o=this.$refs[r])}),o&&this.selectedList.length?He.default.filter(this.selectedList,t=>this.fInside(o,t.el)):this.selectedList},onDragStart:function(e){this.handleNextChange=!0,this.indrag=!0;var o=this.getSelectedInGroup(e.from),t=He.default.find(o,function(l){return l.el==e.item});if(e.getGhost().className=e.getGhost().className+(e.from.className.indexOf("in-group-draggable")!=-1?" fallback-in-group":" fallback-not-in-group"),(0,fr.default)(e.getGhost()).toggleClass("fallback-in-group",(0,fr.default)(e.from).hasClass("in-group-draggable")),(0,fr.default)(e.getGhost()).toggleClass("fallback-not-in-group",!(0,fr.default)(e.from).hasClass("in-group-draggable")),this.fInside(this.$refs.fixed_top,e.from)?this.draggedFixed="top":this.fInside(this.$refs.fixed_bottom,e.from)&&(this.draggedFixed="bottom"),this.draggedFixed){var r=(0,fr.default)(this._scroll.$refs.content);r.css("height",(0,fr.default)(this._scroll.$refs.content).height())}if(o.length>1&&t){this.groupDrag=!0,e.setDraggedGroup(o.slice()),e.getGhost().innerHTML="<div></div>",e.getGhost().className=e.getGhost().className.replace("layer","");var i=o.indexOf(t),s=o.length-i-1;this.oversize="both",this.scrollOversizeTop=i*56,this.scrollOversizeBottom=s*56;var a=Yt.extend(mu);this._layersGroupDrag=new a({el:e.getGhost().firstElementChild,parent:this,abstract:!0,propsData:{group:"draggable",noArrow:!0,fakeGroup:!0,onTouchMove:function(){},widget:{pack_id:"",hovered:!1,groupName:"Drag",widgets:this.selectedLayers.slice()}}}),this.draggedItems=He.default.map(o,l=>l.context.element)}else this.draggedItems=[e.context.element],e.context&&e.context.element&&e.context.element.widgets&&e.context.element.expanded&&(this.scrollOversizeBottom=e.context.element.widgets.length*56,this.scrollOversizeTop=0,this.oversize="bottom")},onDragEnd:function(e){this.indrag=!1;var o=(0,fr.default)(this._scroll.$refs.content);if(o.css("height",""),clearTimeout(this.expandTimeout),this.draggedFixed){var t=e.item.attributes["layer-id"].value;this.$nextTick(()=>{this.scrollTo(document.querySelector('[layer-id="'+t+'"]'))})}this.expandTimeout=0,this.draggedFixed="",this.boundTop=!1,this.groupDrag=!1,this.mark_draggable="",this.fixedOverRegular=!1,this.oversize="",this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null),this._layersGroupDrag&&(this._layersGroupDrag.$destroy(),this._layersGroupDrag=null)},onMove:function(e){e.related.parentNode.className.indexOf("in-group-draggable")!=-1?e.ghost.className=e.ghost.className.replace("fallback-not-in-group","fallback-in-group"):e.ghost.className=e.ghost.className.replace("fallback-in-group","fallback-not-in-group")},onMoveGhost:function(e,o,t){if(!t)return{dx:0,dy:0};var r=e.getBoundingClientRect(),i=(this.draggedFixed?this._scroll.$el:e.parentNode).getBoundingClientRect(),s=this._scroll.$el.parentNode.getBoundingClientRect(),a=0;if(this.draggedFixed&&!this.fixedOverRegular){if(this.$refs.fixed_top){let l=e.parentNode.getBoundingClientRect();r.bottom-l.bottom>25&&(this.fixedOverRegular=!0,this.mark_draggable="fixed_bottom")}this.$refs.fixed_bottom&&e.parentNode.getBoundingClientRect().top-r.top>25&&(this.fixedOverRegular=!0,this.mark_draggable="fixed_top"),this.fixedOverRegular&&(this.draggedFixed=="top"?(this.oversize="bottom",this.scrollOversizeBottom=Math.max(0,(this.getCountBlocks(this.layers.regular)-1)*56),this.scrollOversizeTop=0):(this.oversize="top",this.scrollOversizeTop=Math.max(0,(this.getCountBlocks(this.layers.regular)-1)*56),this.scrollOversizeBottom=0))}return r.top+a-Math.max(i.top,s.top)<t?{dx:0,dy:t-(r.top+a-Math.max(i.top,s.top))}:r.bottom-a-Math.min(i.bottom,s.bottom)>t?{dx:0,dy:t-(r.bottom-a-Math.min(i.bottom,s.bottom))}:{dx:0,dy:0}},onIndexChange:function(){this.handleNextChange=!1,this._unwatch&&He.default.each(this._unwatch,function(a){a()}),this._unwatch=[];let e=[{from:"aboveAll",to:"above_all"},{from:"frontFixed",to:"fixed_top"},{from:"normal",to:"regular"},{from:"backFixed",to:"fixed_bottom"}],o=JSON.parse(window.sessionStorage.getItem("groupsState")||"{}"),t=RM.constructorRouter.indexController.getOrder(this.workspace.page,this.workspace.viewport);this._groups_processed=this._groups_processed||{};let r={};He.default.each(e,a=>{r[a.to]=He.default.reduce(t[a.from],(l,m)=>{if(m instanceof Array){let c=[];l.push(c),He.default.each(m,p=>{let u=this.workspace.blocks.find(d=>d.id===p);u&&(u.model.get("pack_id")?c.push(p):l.push(p))})}else l.push(m);return l},[])});let i=He.default.flatten(He.default.map(r,a=>a)),s=!1;He.default.each(this.workspace.blocks,a=>{a.model.get("type")!=="background"&&(i.includes(a.id)||(s=!0,a.model.get("is_above")?r.above_all.push(a.id):a.model.get("fixed_position")?r.fixed_top.push(a.id):r.regular.push(a.id)))}),He.default.each(e,a=>{let l=He.default.flatten(r[a.to]).reduce((c,p)=>(c.u.includes(p)?c.d.push(p):c.u.push(p),c),{d:[],u:[]}).d,m={};s=s||l.length,r[a.to]=He.default.compact(r[a.to].map(c=>{if(c instanceof Array){let p=He.default.compact(c.map(u=>{if(l.includes(u)){if(m[u])return null;m[u]=1}return u}));return p.length?p:null}if(l.includes(c)){if(m[c])return null;m[c]=1}return c}))}),He.default.each(e,a=>{this.layers[a.to]=r[a.to].map(l=>{if(l instanceof Array){let m=He.default.compact(l.map(u=>this.workspace.blocks.find(d=>d.id===u)));if(m.length===0)return null;let c=m[0].model.get("pack_id"),p=this._groups_processed[c]?this._groups_processed[c]:{hovered:!1,pack_id:c,expanded:o[c]||!1};return p.widgets=m,this._groups_processed[c]=p,p}return this.workspace.blocks.find(m=>m.id===l)}),this.layers[a.to]=He.default.compact(this.layers[a.to])}),this._unwatch.push(this.$watch("layers.above_all",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.fixed_top",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.regular",this.watchOnLayers)),this._unwatch.push(this.$watch("layers.fixed_bottom",this.watchOnLayers)),s&&(this.handleNextChange=!0,this.watchNewZindex()),this.$nextTick(()=>{this.updateScroll()})},watchNewZindex:function(){if(!this.handleNextChange)return;this.handleNextChange=!0;var e=[].concat(this.layers.above_all,this.layers.fixed_top,this.layers.regular,this.layers.fixed_bottom),o=[],t={},r={},i=function(u,d,g){for(var h in d)if(d.hasOwnProperty(h)&&u.attributes[h]!=d[h])return g.push(d),!0;return!1},s=u=>{let d={};return u=He.default.reduce(u,(g,h)=>{if(h.widgets)g.push(h);else{let b=r[h.attributes._id];b?(d[b]||(d[b]=[],g.push({widgets:d[b]})),d[b].push(h)):g.push(h)}return g},[]),He.default.compact(u.map(g=>g.widgets?g.widgets.length===1?g.widgets[0].id:g.widgets.length===0?void 0:He.default.flatten(g.widgets.map(h=>h.widgets?h.widgets.map(b=>b.id):h.id)):g.id))},a=null;He.default.each(e,u=>{if(u.attributes&&u.attributes.pack_id&&!t[u.attributes.pack_id]){var d=u.attributes.pack_id,g=He.default.filter(e,h=>h.attributes&&h.attributes.pack_id==u.attributes.pack_id);t[u.attributes.pack_id]=1,this._groups_processed[d]&&this._groups_processed[d].widgets.length==0&&He.default.each(g,function(h){r[h.attributes._id]=h.attributes.pack_id})}});var l={aboveAll:s(this.layers.above_all),frontFixed:s(this.layers.fixed_top),normal:s(this.layers.regular),backFixed:s(this.layers.fixed_bottom)},m=!1,c;He.default.each(e,u=>{u.widgets instanceof Array?u.widgets.length==1?(c=i(u.widgets[0],{_id:u.widgets[0].attributes._id,pack_id:null},o),m=m||c):He.default.each(u.widgets,function(d){let g=d.widgets?d.widgets[0]:d;g.attributes.is_global&&g.attributes.pack_id!==u.pack_id&&(a=a||{},a.added=a.added||[],a.added.push(d.widgets?He.default.map(d.widgets,h=>h.attributes._id):d.attributes._id),a.added=He.default.flatten(a.added),a.pack=He.default.flatten(u.widgets.map(h=>h.widgets instanceof Array?He.default.map(h.widgets,b=>b.attributes._id):h.attributes._id)),a.pack_id=u.pack_id),d.widgets?He.default.each(d.widgets,function(h){c=i(h,{_id:h.attributes._id,pack_id:u.pack_id},o),m=m||c}):(c=i(d,{_id:d.attributes._id,pack_id:u.pack_id},o),m=m||c)}):(u.attributes.is_global&&u.attributes.pack_id&&(a=a||{},a.removed=a.removed||[],a.removed.push(u.attributes._id)),c=i(u,{_id:u.attributes._id,pack_id:r[u.attributes._id]||null},o),m=m||c)}),RM.constructorRouter.indexController.setOrderForPage(l,this.workspace.page,this.workspace.viewport,a),m&&(this.scrollCooldown=+new Date+300,this.workspace.save_group(o));let p=RM.constructorRouter.indexController.getPagesToSave();this.workspace.syncManager.saveGroup(p,{patch:!0,silent:!0}),this.$nextTick(()=>{this.onIndexChange()})},watchOnLayers:He.default.debounce(function(){this.watchNewZindex()},10),getLayerFromPoint:function(e,o,t){for(var r=window.document.elementFromPoint(e,o);r&&!(typeof r.className=="string"&&r.className.indexOf("layer")!==-1);)r=r.parentNode;try{if(r&&r.parentNode.sortable.options.group.name!==t)return null}catch{return null}return r},getElementByClassFromPoint:function(e,o,t,r){for(var i=window.document.elementFromPoint(e,o);i&&!(typeof i.className=="string"&&i.className.indexOf(t)!==-1);)i=i.parentNode;if(r){if(i&&i.sortable&&i.sortable.options.group.name==r)return i;for(var s=i;s&&!(typeof s.className=="string"&&s.className.indexOf("layer")!==-1);)s=s.parentNode;try{if(s&&s.parentNode.sortable.options.group.name!==r)return null}catch{return null}}return i},getEmptyContainerFromPoint:function(e,o,t){for(var r=window.document.elementFromPoint(e,o);r;){if(typeof r.className=="string"&&r.className.indexOf("draggable-container")!==-1){if(r.className.indexOf("empty-draggble")!==-1||r.childElementCount==0)break;return null}r=r.parentNode}try{if(r&&r.sortable.options.group.name!==t)return null}catch{return null}return r},fInside:function(e,o){for(e instanceof Array&&(e=He.default.flatten(e)[0]);o&&o!=e&&(o=o.parentNode););return!!o},checkCanGroup:function(e){return He.default.uniq(He.default.map(e,function(o){var t=!!(o.widgets?o.widgets[0].model.get("fixed_position"):o.model.get("fixed_position"));return t})).length>1||He.default.uniq(He.default.map(e,function(o){var t=!!(o.widgets?o.widgets[0].model.get("is_global"):o.model.get("is_global"));return t})).length>1},onTouchMove:function(e,o){var t=e.data;if(t.dy){for(var r=t.next&&t.next.className.indexOf("sortable-fallback")==-1?t.next:null,i=t.prev,s=0,a=t.ghost,l=a.getBoundingClientRect(),m=e.from.sortable.options.group.name,c,p,u,d,g=this.getLayerFromPoint((l.left+l.right)/2,l.bottom,m)||r,h=g&&g!=t.dragEl&&!this.fInside(g,t.dragEl)&&g.getBoundingClientRect(),b=this.getLayerFromPoint((l.left+l.right)/2,l.top,m)||i,x=b&&b!=t.dragEl&&!this.fInside(b,t.dragEl)&&b.getBoundingClientRect(),y=this.getElementByClassFromPoint((l.left+l.right)/2,l.top,"draggable-container",m),S=this.getElementByClassFromPoint((l.left+l.right)/2,l.bottom,"draggable-container",m),k=He.default.chain([[this.$refs.fixed_top,y],[this.$refs.fixed_bottom,y],[this.$refs.fixed_top,S],[this.$refs.fixed_bottom,S]]).reduce((me,se)=>this.fInside.apply(this,He.default.flatten(se))&&!this.fInside(He.default.flatten(se)[0],t.dragEl)?se[1]:me,null).value();r&&r.className.indexOf("selected")!=-1&&this.groupDrag&&(r=r.nextElementSibling););for(;i&&i.className.indexOf("selected")!=-1&&this.groupDrag&&(i=i.previousElementSibling););r&&r.className.indexOf("group_layer")!==-1&&r.className.indexOf("expanded")!==-1?(c=r.getBoundingClientRect(),r=r.querySelector(".in-group-draggable").firstElementChild,s=-1,u=r.parentNode):r?c=r.getBoundingClientRect():(r=this.getLayerFromPoint((l.left+l.right)/2,l.bottom,m),r==a||!r?r=null:(c=r.className.indexOf("group_layer")==-1&&r.getBoundingClientRect(),u=r.parentNode,s=-1)),i&&i.className.indexOf("group_layer")!==-1&&i.className.indexOf("expanded")!==-1?(i=i.querySelector(".in-group-draggable").lastElementChild,p=i.getBoundingClientRect(),u=i.parentNode,s=1):i?p=i&&i.getBoundingClientRect():(i=this.getLayerFromPoint((l.left+l.right)/2,l.top,m),i==a||!i?i=null:(p=i&&i.className.indexOf("group_layer")==-1&&i.getBoundingClientRect(),u=i&&i.parentNode,s=1));var P=this.getElementByClassFromPoint((l.left+l.right)/2,l.bottom,"head",m),C=P&&!this.fInside(t.dragEl,P)&&P.getBoundingClientRect(),B=this.getElementByClassFromPoint((l.left+l.right)/2,l.top,"head",m),$=B&&!this.fInside(t.dragEl,B)&&B.getBoundingClientRect(),A=34,R=15,Z=15;if(k){if(k.childElementCount==0){e.result={toEmptyGroup:k},this.fInside(this.$refs.fixed_top,k)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,k)&&(this.mark_draggable="fixed_top");return}u=k,this.fInside.apply(this,He.default.flatten([this.$refs.fixed_top,k]))?(s=1,d=k.lastElementChild):(s=-1,d=k.firstElementChild)}else C&&C.top+A<=l.bottom?(d=P.nextElementSibling.querySelector(".layer"),s=-1,u=d.parentNode):$&&$.bottom-A>=l.top?(d=B.parentNode,s=-1,u=d.parentNode):(p&&t.dragEl.parentNode.lastElementChild==t.dragEl&&t.dragEl.parentNode.className.indexOf("in-group-draggable")!==-1&&t.dragEl.parentNode.parentNode.parentNode.parentNode.lastElementChild==t.dragEl.parentNode.parentNode.parentNode&&l.top-p.bottom>=-2?(d=t.dragEl.parentNode.parentNode.parentNode,s=1):h&&(g.className.indexOf("group_layer")==-1||g.className.indexOf("expanded")==-1)&&l.bottom-h.top>=A?(d=g,s=1):h&&t.dragEl.parentNode.lastElementChild==t.dragEl&&l.bottom-h.top>=Z?(d=g,s=-1):x&&(b.className.indexOf("group_layer")==-1||b.className.indexOf("expanded")==-1)&&x.bottom-l.top>=A?(d=b,s=-1):x&&b.parentNode.lastElementChild==b&&x.bottom-l.top>=R&&(d=b,s=1),d&&d.parentNode!=t.dragEl.parentNode&&(u=d.parentNode));if(u&&d&&u.parentElement.parentElement.__vue__&&u.parentElement.parentElement.__vue__.widget){var F=u.parentElement.parentElement.__vue__.widget.widgets.concat([t.dragEl.__vue__.widget]);this.checkCanGroup(F)&&(d=null,u=null)}if(d&&d.className.indexOf("sortable-fallback")==-1)this.fInside(this.$refs.fixed_top,d)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,d)&&(this.mark_draggable="fixed_top"),e.result={target:d,direction:s,changeParent:u},this.expandTimeout&&(clearTimeout(this.expandTimeout),this.expandTimeout=0),this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null);else{var V=null;if(!1){var W;if(W&&W.element.widgets)var F}else{t.sortable.dropIntoGroup(null),this.expandTimeout&&(clearTimeout(this.expandTimeout),this.expandTimeout=0),this.lastRelatedContext&&(this.lastRelatedContext.element.hovered=!1,this.lastRelatedContext=null);var J=this.getEmptyContainerFromPoint((l.left+l.right)/2,l.top,m)||this.getEmptyContainerFromPoint((l.left+l.right)/2,l.bottom,m);J&&(this.fInside(this.$refs.fixed_top,J)?this.mark_draggable="fixed_bottom":this.fInside(this.$refs.fixed_bottom,J)&&(this.mark_draggable="fixed_top"),e.result={toEmptyGroup:J})}}}this.handleScroll(o)},handleScroll:He.default.throttle(function(e){if(e&&e.parentNode){var o=this._scroll.$el.getBoundingClientRect(),t=e.getBoundingClientRect(),r=0,i=5,s=5;this.layers.regular.length==1&&this.layers.fixed_bottom.length==0&&this.fixedOverRegular&&(s=100),o.bottom-t.bottom<s?r=4:t.top-o.top<i&&(r=-4),this._scroll.$el.children[0].scrollTop+=r,r&&this.$nextTick(()=>{this.handleScroll(e)})}},10),updateScroll:function(){this._scroll.resizableScroll.recalc()},expandChanged:function(){this.updateScroll()},scrollTo:function(e,o={}){if(!(e instanceof Element))return;let t={threshold:0};new IntersectionObserver((i,s)=>{i.forEach(a=>{if(a.intersectionRatio<1){let l=o.noAnimation?"auto":"smooth";a.target.scrollIntoView({block:"center",inline:"nearest",behavior:l})}s.unobserve(a.target),s.disconnect()})},t).observe(e)},onSelect:He.default.debounce(function(e,o){o=o||{};let t=null,r=this;if(!e||!e.length)return;e.forEach(()=>{let s=e[0].model.get("_id");if(r._layerList[s]){let a=r._layerList[s].$el;(!t||t.offsetTop>a.offsetTop)&&(t=a)}});let i=t&&(0,fr.default)(t);i&&(i.height()>0||(t=i.parents(".layer")[0]),this.scrollTo(t,{noAnimation:o.noAnimation}))},20),getElementIndex:function(e){var o=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)e.nodeName.toUpperCase()!=="TEMPLATE"&&o++;return o},onFixedPositionChanged:function(e){this.scrollCooldown&&this.scrollCooldown>+new Date||this.$nextTick(()=>{var o=e.get("_id"),t=this._layerList[o];t&&t.$props.widget.selected&&this.scrollTo(t.$el)})},emptyDraggable:function(e){return this.draggedFixed?e.length==this.draggedItems.length&&He.default.difference(e,this.draggedItems)==0:!1},filterPredicate(e){switch(this.filter){case"all":return!0;case gu.UNUSED:return hu(e);case"links":return bu(e);case"viewport":return fu(e);default:return!0}}},computed:{bg:function(){return He.default.find(this.workspace.blocks,function(e){return e.attributes.type=="background"})},needCaptions:function(){var e=0;return He.default.each(this.layers,o=>{o.length&&e++}),e>1},flattenRegular:function(){return this.fFlatten(this.layers.regular)},flattenRegularFour:function(){return this.fFlatten(this.filteredLayers.regular).slice(0,4)},scrollOversize:function(){return(this.layers.regular.length-2)*56},layersFlat:function(){return[].concat(this.fFlatten(this.filteredLayers.above_all,!0,!0),this.fFlatten(this.filteredLayers.fixed_top,!0,!0),this.fFlatten(this.filteredLayers.regular,!0,!0),this.fFlatten(this.filteredLayers.fixed_bottom,!0,!0))},countFlatLayers:function(){return[].concat(this.fFlatten(this.layers.above_all,!0),this.fFlatten(this.layers.fixed_top,!0),this.fFlatten(this.layers.regular,!0),this.fFlatten(this.layers.fixed_bottom,!0)).length},layersCount:function(){return[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)).length},selectedLayers:function(){return[].concat(this.fFlatten(this.layers.above_all),this.fFlatten(this.layers.fixed_top),this.fFlatten(this.layers.regular),this.fFlatten(this.layers.fixed_bottom)).filter(function(e){return!!e.selected})},selectedList:function(){var e=this;return[].concat(this.fFlatten(this.layers.above_all,!0),this.fFlatten(this.layers.fixed_top,!0),this.fFlatten(this.layers.regular,!0),this.fFlatten(this.layers.fixed_bottom,!0)).filter(function(o){return!!o.selected||o.widgets&&!!o.widgets[0].selected}).map(function(o){var t=o.model&&o.model.get("_id")||o.pack_id;if(!e._layerList[t])return null;var r=e._layerList[t].$el;return r?{el:r,context:e._layerList[t].$parent.getUnderlyingVm(r),oldIndex:e.getElementIndex(r),oldParent:r.parentNode}:null}).filter(function(o){return!!o})},noDragndrop:function(){return!window.RM.constructorRouter.mag.isPermissionAllowed("BaseWidgetCanChangeZindex")},filteredLayers:function(){return Object.fromEntries(Object.entries(this.layers).map(([e,o])=>[e,o.filter(this.filterPredicate)]))},isEmptyFilteredLayers:function(){let e=this.fFlatten(Object.values(this.filteredLayers).flat(1),!0,!0).length===0,o=this.layersCount>0,t=this.filter!=="all";return e&&o&&t}},watch:{workspace:{handler:function(e,o){this.onIndexChange(),o&&o.page.off("change:viewport",this.onIndexChange),e.page.on("change:viewport",this.onIndexChange),o&&o.off("select",this.onSelect),e.on("select",this.onSelect),this.onSelect(this.selectedLayers,{noAnimation:!0}),this.renderReactHeaderActions()},immediate:!0},selectedLayers:{handler:function(e){this.showCounter=Math.max(this.showCounter,this.layersFlat.indexOf(e[0])+25)},immediate:!0}}},P8=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("transition",{attrs:{name:"wb-panel"}},[t("div",{ref:"stack_panel",staticClass:"stack_panel",class:{"group-drag":e.groupDrag,dragging:e.indrag,dark:e.dark},attrs:{"aria-label":"Layer panel"}},[t("div",{staticClass:"inner fix-radius-clip",on:{click:e.updateScroll}},[t("div",{staticClass:"stack_panel-top"},[t("h2",{staticClass:"panel-top-caption"},[e._v("Layers")]),e._v(" "),t("div",{ref:"react_filters"})]),e._v(" "),t("div",{staticClass:"line last"}),e._v(" "),t("rm-scroll",{ref:"rmscroll",attrs:{"scroll-gap-start":8,"scroll-gap-end":8,"system-scroll":!0,"on-panel-scroll":e.onPanelScroll}},[t("div",{staticClass:"bound-top",class:{visible:e.boundTop=="top"}}),e._v(" "),e.isEmptyFilteredLayers?t("div",{staticClass:"empty-text-wrapper",style:{height:e.getHeightScrolledContent()+"px"}},[t("span",{staticClass:"empty-text"},[e._v("No widgets to show")])]):e._e(),e._v(" "),t("div",{staticClass:"layers"},[t("div",{staticClass:"oversize",class:{visible:e.oversize=="top"||e.oversize=="both"},style:{height:(e.scrollOversizeTop?e.mark_draggable?e.scrollOversizeTop-56:e.scrollOversizeTop:0)+"px"}}),e._v(" "),e._l(e.layers,function(r,i){return[t("div",{key:i},[(e.filteredLayers[i].length>0||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom"))&&e.needCaptions?t("div",{staticClass:"group-title"},[e._v(`
                `+e._s(e.caption(i))+`
              `)]):e._e(),e._v(" "),i=="regular"?t("div",{directives:[{name:"show",rawName:"v-show",value:e.fixedOverRegular,expression:"fixedOverRegular"}]},[t("div",{staticStyle:{"margin-top":"-4px"}},[e.flattenRegularFour.length>0?t("group-layers",{attrs:{"on-touch-move":e.onTouchMove,"no-arrow":!0,"fake-group":!0,widget:{groupName:" ",pack_id:"fake",widgets:e.flattenRegularFour}}}):e._e()],1),e._v(" "),t("div",{staticClass:"line"})]):e._e(),e._v(" "),e.filteredLayers[i].length>0||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom")?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.fixedOverRegular||e.fixedOverRegular&&(i=="fixed_top"||i=="fixed_bottom"),expression:"!fixedOverRegular || (fixedOverRegular && (idx == 'fixed_top' || idx == 'fixed_bottom'))"}],ref:i,refInFor:!0,staticClass:"sortable_relparent",class:i},[t("div",{key:e.filter,staticClass:"stack",style:{"min-height":(e.fFlatten(e.filteredLayers[i],!0).length-2)*50+"px"}},[t("draggable",{staticClass:"draggable-container",class:{"empty-draggble":r.length==0||e.emptyDraggable(r),"with-captions":e.needCaptions},attrs:{move:e.onMove,options:{denyX:!0,forceFallback:!0,onEnd:e.onDragEnd,onMoveGhost:e.onMoveGhost,disabled:e.noDragndrop||e.draggableDisabled,relParent:"sortable_relparent",group:i=="fixed_bottom"?"fixed_top":i,animation:200,delay:0,moveByBlock:!0,scroll:!0,scrollSensitivity:40}},on:{end:e.onDragEnd,start:e.onDragStart,touchMove:e.onTouchMove},model:{value:e.layers[i],callback:function(s){e.$set(e.layers,i,s)},expression:"layers[idx]"}},[r.length?[e._l(r,function(s){return[e.showCounter>e.layersFlat.indexOf(s)?t(e.layer_type(s),{key:e.workspace.page.id+(s.pack_id?s.pack_id:s.attributes._id),tag:"component",attrs:{group:i=="fixed_bottom"?"fixed_top":i,widget:s,"on-touch-move":e.onTouchMove,"on-move-ghost":e.onMoveGhost,"no-dragndrop":e.noDragndrop,"is-not-visible":!e.filterPredicate(s),"filter-predicate":e.filterPredicate},on:{expandChanged:e.expandChanged,onWidgetSelect:e.onWidgetSelect,start:e.onDragStart,move:e.onMove,onWidgetDblClick:e.onWidgetDblClick,changeEditState:function(a){e.draggableDisabled=a},end:function(a){e.watchOnLayers(),e.onDragEnd(a)}}}):e._e()]})]:e._e()],2)],1),e._v(" "),e.needLine(i)?t("div",{staticClass:"line"}):e._e()]):e._e()])]}),e._v(" "),t("div",{staticClass:"oversize",class:{visible:e.oversize=="bottom"||e.oversize=="both"},style:{height:(e.scrollOversizeBottom?e.mark_draggable?e.scrollOversizeBottom-56:e.scrollOversizeBottom:0)+"px"}})],2),e._v(" "),t("div",{staticClass:"bound-top",class:{visible:e.boundTop=="bottom"}})]),e._v(" "),e.layersCount!=0?t("div",{staticClass:"line last"}):e._e(),e._v(" "),t("div",[e.showGuidePanel?t("help-tour-tooltip",{attrs:{step:e.helpTourStep,position:"top",modifiers:[{name:"offset",options:{offset:[0,-10]}}]}}):e._e(),e._v(" "),e.showGuidePanel?t("permission-controller",{attrs:{permission:"GridsAndGuidesCanUse"}},[t("guides-icon",{on:{click:e.onGuidesClick}})],1):e._e(),e._v(" "),t("background-icon",{attrs:{widget:e.bg},nativeOn:{click:function(r){return e.$emit("showPanel","background")}}}),e._v(" "),t("div",{staticStyle:{position:"relative",top:"-32px"}},[t("help-tour-tooltip",{attrs:{step:e.helpTourStepBackground,position:"right",modifiers:[{name:"offset",options:{offset:[0,8]}}]}})],1)],1)],1)])])},T8=[],M8=void 0,B8=void 0,I8=void 0,z8=!1;function E8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="stack-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var R8=E8({render:P8,staticRenderFns:T8},M8,S8,B8,z8,I8,!1,void 0,void 0,void 0),ny=R8;var Ya=T(St()),Ar=T(et());Gn();pt();p_();yo();Xl();Lf();h2();var ko=T(St()),Va=T(et());Gn();pt();Xl();Tl();Ff();function A8(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M10 8h7a1 1 0 010 2h-7v7a1 1 0 01-2 0v-7H1a1 1 0 110-2h7V1a1 1 0 112 0v7z",fill:"#B8B8B8","fill-rule":"evenodd"}})])]}var sy={render:A8};var D8={components:{Draggable:Ns,NumericInput:xi,RmScroll:Jl,SlideshowAddBtnImg:sy},props:["slideshowData","selectedType","block"],data:function(){return{slideshowLoading:!1,slideshowDragging:!1,slideshowIsDnd:!1,highlightTimeout:null,pictureListRect:null,rectTopLine:null,rectBottomLine:null,dragTranslate:null,dragTranslateBottom:null,scrollElement:null,slideshowUpdating:{num:null,loading:!1,starting:!1},slideshowDelay:4,slideshowCrossfade:.5}},computed:{slideshowHasPictures:function(){return this.slideshowData&&!Va.default.isEmpty(this.slideshowData.pictures)}},watch:{selectedType:function(){this.onTypeChange()},slideshowData:function(){this.onSlideshowChange()}},mounted:function(){this.slideshowDelaySave._debounced=Va.default.debounce(this.slideshowDelaySave,300),this.slideshowCrossfadeSave._debounced=Va.default.debounce(this.slideshowCrossfadeSave,300),this.slideshowUploader=new ki(this,{fileTypes:"jpeg|jpg|png|gif",fileTypesErrorMessage:"We support only JPG, GIF and PNG picture formats.",uploadInputRefName:"slideshowUploadInput"}),this.slideshowUploader.on("start",this.onStartSlideshowUpload),this.slideshowUploader.on("done",this.onDoneSlideshowUpload),this.slideshowUploader.on("fail",this.onFailSlideshowUpload),this.block.workspace.on("main-dragover",this.highlightDropZone),this.defaultSlideshowUpdating={num:null,id:null,loading:!1,starting:!1},this.slideshowHasPictures&&(this.slideshowDelay=this.slideshowData.delay,this.slideshowCrossfade=this.slideshowData.crossfade,this.scrollElement=(0,ko.default)(this.$refs.rmscroll.$el).find(".resizable-content-wrapper")),this.selectedType==="slideshow"&&this.block.runSlideshow()},beforeDestroy:function(){this.block.stopSlideshow()},destroyed:function(){this.slideshowUploader.off(),this.block.workspace.off("main-dragover",this.highlightDropZone)},methods:{showSelectSlideshowFile:function(e){(0,ko.default)(e.target).hasClass("slideshowUploadInput")||this.slideshowLoading||this.slideshowHasPictures||(0,ko.default)(this.$refs.slideshowUploadInput).trigger("click","stop")},highlightDropZone:function(){this.slideshowHasPictures&&((0,ko.default)(this.$refs.dropZoneHighlighter).css({display:"block"}),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(function(){(0,ko.default)(this.$refs.dropZoneHighlighter).css({display:"none"})}.bind(this),300))},onStartSlideshowUpload:function(){this.slideshowUpdating.starting?this.slideshowUpdating.loading=!0:this.slideshowLoading=!0,this.slideshowUploader.viewport=this.block.model.getViewport()},onDoneSlideshowUpload:function(e,o){if(this.slideshowDragging=!1,this.slideshowLoading=!1,this.slideshowUpdating.loading&&(this.slideshowUpdating.loading=!1),!o||!o.result){console.error("error file upload!");return}let t={save:!0};this.slideshowUpdating.starting?(t.num=this.slideshowUpdating.num,t.id=this.slideshowUpdating.id,this.block.updateSlideshowPicture(o.result,t),this.slideshowUpdating=this.defaultSlideshowUpdating):this.block.saveSlideshowPicture(o.result,t)},onFailSlideshowUpload:function(e,o,t){console.error("An error occurred while loading the slideshow image: ",t),t!==oe.MSG_UPLOAD_IMAGE_SIZE_ERROR&&window.alert("Sorry, picture loading failed")},onSlideshowDragStart:function(){this.block.stopSlideshow(),this.slideshowIsDnd=!0,this.pictureListRect=this.$refs.picturesList.getBoundingClientRect(),this.rectTopLine=this.pictureListRect.top,this.rectBottomLine=this.pictureListRect.top+this.pictureListRect.height},onSlideshowDragEnd:function(){this.dragTranslate=null,this.dragTranslateBottom=null,this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(o){(0,ko.default)(o).removeClass("selected")});let e=this.recalcSlideshowNums();this.block.updateSlideshowPicturePosition(e),this.$emit("updatePictures",e),setTimeout(function(){this.slideshowIsDnd=!1}.bind(this),200)},onSlideshowTouchMove:function(e){this.rectTopLine&&e.data.y<=this.rectTopLine+15?(this.dragTranslate||(this.dragTranslate=(0,ko.default)(e.item).css("transform")),(0,ko.default)(e.item).css("transform",this.dragTranslate)):this.rectBottomLine&&e.data.y+16>=this.rectBottomLine&&(this.dragTranslateBottom||(this.dragTranslateBottom=(0,ko.default)(e.item).css("transform")),(0,ko.default)(e.item).css("transform",this.dragTranslateBottom)),this.rectBottomLine&&e.data.y+20>=this.rectBottomLine&&this.scrollElement.scrollTop(this.scrollElement.scrollTop()-e.data.dy*4)},slideshowDelayChange:function(e){this.slideshowDelaySave._debounced(e)},slideshowDelaySave:function(e){this.slideshowHasPictures&&(this.$emit("updateDelay",+e.toFixed(1)),this.block.updateSideshowDelay(+e.toFixed(1)))},slideshowCrossfadeChange:function(e){this.slideshowCrossfadeSave._debounced(e)},slideshowCrossfadeSave:function(e){this.slideshowHasPictures&&(this.$emit("updateCrossfade",+e.toFixed(1)),this.block.updateSideshowCrossfade(+e.toFixed(1)))},recalcSlideshowNums:function(){let e=Qt(this.slideshowData.pictures);return e.forEach(function(o,t){o.num=t+1}),e},onSlideshowChange:function(){this.slideshowDelay=this.slideshowData.delay,this.slideshowCrossfade=this.slideshowData.crossfade},onTypeChange:function(){this.selectedType!=="slideshow"&&this.slideshowHasPictures&&this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(e){(0,ko.default)(e).removeClass("selected")})},selectSlide:function(e){this.slideshowIsDnd||!e.target.dataset.id||(this.$refs.picturesList.querySelectorAll(".real-slide").forEach(function(o){(0,ko.default)(o).removeClass("selected")}),(0,ko.default)(e.target).parents(".list-item-wrap").addClass("selected"),this.block.selectSlideshowPicture(e.target.dataset.id))},onAddPictureClick:function(){this.slideshowLoading||!this.slideshowHasPictures||(0,ko.default)(this.$refs.slideshowUploadInput).trigger("click","stop")},onDeleteSlideshowPicture:function(e){if(e.stopPropagation(),this.slideshowIsDnd||!e.target.dataset.id)return;let o=this.slideshowData.pictures.findIndex(function(r){return r.uuid===e.target.dataset.id}),t=Qt(this.slideshowData.pictures);t.splice(o,1),t=Va.default.sortBy(t,"num"),this.$emit("updatePictures",t),this.block.deleteSlideshowPicture(e.target.dataset.id)},onUpdateSlideshowPicture:function(e){this.slideshowIsDnd||this.slideshowLoading||this.slideshowUpdating.starting||!e.target.dataset.id||(this.slideshowUpdating={id:e.target.dataset.id,loading:!1,starting:!0},(0,ko.default)(this.$refs.slideshowUploadInput).trigger("click","stop"))},save:function(){this.block.model.save()},getThumbnailUrl:function(e){return this.block.getThumbnailUrl(e)}}},$8=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"view slideshow"},[t("div",{ref:"slideshowDropZone",staticClass:"upload",class:{dragging:e.slideshowDragging,hasPictures:e.slideshowHasPictures},attrs:{"drag-over":"handleDragOver"},on:{dragenter:function(r){e.slideshowDragging=!0},dragend:function(r){e.slideshowDragging=!1},dragleave:function(r){e.slideshowDragging=!1},click:e.showSelectSlideshowFile}},[t("input",{ref:"slideshowUploadInput",staticClass:"slideshowUploadInput",attrs:{type:"file",name:"upload","data-url":"/api/upload/lambda/"}}),e._v(" "),e.slideshowHasPictures?e._e():t("div",{staticClass:"param-caption"},[e._v("Slideshow")]),e._v(" "),e.slideshowHasPictures?e._e():t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading,expression:"!slideshowLoading"}],staticClass:"upload-wrapper"},[t("div",{staticClass:"center-wrapper"},[t("div",{staticClass:"caption-upload-dop"},[e._v(e._s(e.slideshowDragging?"Drop here":"Drop file here"))])])]),e._v(" "),e.slideshowHasPictures?e._e():t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowLoading,expression:"slideshowLoading"}],staticClass:"first-loading"},[t("div",{staticClass:"rm-loader"})]),e._v(" "),e.slideshowHasPictures?t("div",{ref:"dropZoneHighlighter",staticClass:"upload-wrapper-if-pictures"},[t("div",{staticClass:"center-wrapper"},[e._v("Drop file here")])]):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowHasPictures,expression:"slideshowHasPictures"}],ref:"picturesList",staticClass:"pictures-list"},[t("rm-scroll",{ref:"rmscroll",attrs:{"scroll-gap-start":8,"scroll-gap-end":8,"system-scroll":!0}},[t("draggable",{ref:"draggableContainer",staticClass:"draggable-container-slideshow",class:{"draggble-running":e.slideshowIsDnd},attrs:{options:{denyX:!0,forceFallback:!0,scroll:!0,scrollSensitivity:40,animation:200,delay:0,group:"",ghostClass:"sl-ghost-item",dragClass:"sl-drag-item",chosenClass:"sl-drag-item",disabled:e.slideshowLoading}},on:{start:e.onSlideshowDragStart,end:e.onSlideshowDragEnd,touchMove:e.onSlideshowTouchMove},model:{value:e.slideshowData.pictures,callback:function(r){e.$set(e.slideshowData,"pictures",r)},expression:"slideshowData.pictures"}},[t("transition-group",{attrs:{type:"transition",name:e.slideshowIsDnd?null:"flip-list"}},e._l(e.slideshowData.pictures,function(r,i){return t("div",{key:r.uuid,staticClass:"list-item-wrap real-slide",attrs:{"data-id":r.uuid}},[t("div",{staticClass:"pic-num-item-wrap"},[t("div",{staticClass:"pic-num-item"},[e._v(e._s(i+1))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowUpdating.loading||e.slideshowUpdating.id!==r.uuid,expression:"!slideshowUpdating.loading || slideshowUpdating.id !== picture.uuid"}],staticClass:"pic-list-item",style:{backgroundImage:"url("+e.getThumbnailUrl(r)+")"},attrs:{"data-id":r.uuid},on:{click:e.selectSlide}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowUpdating.loading&&e.slideshowUpdating.id===r.uuid,expression:"slideshowUpdating.loading && slideshowUpdating.id === picture.uuid"}],staticClass:"pic-list-item-loading",attrs:{title:"Loading..."}},[t("div",{staticClass:"rm-loader"})]),e._v(" "),t("div",{staticClass:"pic-actions-item"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowUpdating.loading&&!e.slideshowLoading,expression:"!slideshowUpdating.loading && !slideshowLoading"}],staticClass:"update-image",attrs:{title:"Update","data-id":r.uuid},on:{click:e.onUpdateSlideshowPicture}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading&&!e.slideshowUpdating.loading,expression:"!slideshowLoading && !slideshowUpdating.loading"}],staticClass:"delete-image",attrs:{title:"Delete","data-id":r.uuid},on:{click:e.onDeleteSlideshowPicture}})])])}),0)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.slideshowLoading&&!e.slideshowUpdating.loading&&!e.slideshowIsDnd,expression:"!slideshowLoading && !slideshowUpdating.loading && !slideshowIsDnd"}],staticClass:"list-item-wrap"},[t("div",{staticClass:"add-picture-wrap",attrs:{title:"Add Picture"},on:{click:e.onAddPictureClick}},[t("slideshow-add-btn-img",{staticClass:"svg add-picture-icon",staticStyle:{"pointer-events":"none"}})],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.slideshowLoading&&!e.slideshowUpdating.loading,expression:"slideshowLoading && !slideshowUpdating.loading"}],staticClass:"list-item-wrap"},[t("div",{staticClass:"add-picture-loading",attrs:{title:"Loading..."}},[t("div",{staticClass:"rm-loader"})])])],1)],1)]),e._v(" "),e.slideshowHasPictures?t("div",{staticClass:"animation-options"},[t("div",{staticClass:"options-row first-row"},[t("div",{staticClass:"option-label"},[e._v("Delay")]),e._v(" "),t("numeric-input",{staticClass:"option-value",attrs:{value:e.slideshowDelay,min:e.slideshowCrossfade,max:60,step:.1,"use-float":!0},on:{change:e.slideshowDelayChange}}),e._v(" "),e._m(0)],1),e._v(" "),t("div",{staticClass:"options-row-separator"}),e._v(" "),t("div",{staticClass:"options-row second-row"},[t("div",{staticClass:"option-label"},[e._v("Crossfade")]),e._v(" "),t("numeric-input",{staticClass:"option-value",attrs:{value:e.slideshowCrossfade,min:0,max:e.slideshowDelay,step:.1,"use-float":!0},on:{change:e.slideshowCrossfadeChange}}),e._v(" "),e._m(1)],1)]):e._e()])},L8=[function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"option-value-dimension-wrap"},[t("div",{staticClass:"option-value-dimension"},[e._v("s")])])},function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"option-value-dimension-wrap"},[t("div",{staticClass:"option-value-dimension"},[e._v("s")])])}],H8=void 0,O8=void 0,N8=void 0,F8=!1;function W8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-slideshow.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var U8=W8({render:$8,staticRenderFns:L8},H8,D8,O8,F8,N8,!1,void 0,void 0,void 0),ay=U8;var py=T(nr());nn();G();fa();ve();var Vi=T(H());z_();nn();yb();e_();Mr();dd();re();Oe();pt();d_();v();function ly(){let{model:{video:e},modelSet:o,modelSave:t}=(0,Vi.useContext)(Yn),r=vb(e),i=(0,Vi.useMemo)(()=>{if(r)return wb(e)?.thumbnail},[r,e]),s=(0,Vi.useMemo)(()=>window.RM.constructorRouter.mag.get("_id"),[]),[a,l]=(0,Vi.useState)(!1),[m,c]=(0,Vi.useState)(null);async function p(h){c(null),l(!0);try{let b=xb(h);if(b)c(b);else{let x=await fb(h,s);o({video:{size:h.size,provider_name:"self",thumbnail_url:x.thumbPath,url:x.videoPath,loop:e&&typeof e.loop=="boolean"?e.loop:!0,version:oe.VIDEO_BACKGROUND_VERSION,opacity:100}}),t()}}catch{c("Could not upload file")}finally{l(!1)}}function u({value:h}){r&&o({video:{...e,opacity:h}})}function d(h){r&&o({video:{...e,loop:h}})}function g(){o({video:{}})}return r?w(f,{backgroundColor:"#f3f3f3",backgroundImage:`url('${i}')`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"relative",children:[n(f,{position:"absolute",top:0,left:0,zIndex:0,width:"100%",height:"100%",backgroundColor:"#2E2D2C",opacity:.88}),w(f,{position:"relative",zIndex:1,children:[n(f,{padding:"8px 16px 0",children:w(f,{borderBottom:"2px solid",borderColor:Me("gray",.24),paddingBottom:38,children:[n(I,{as:"div",color:"white",marginBottom:4,children:"Background video"}),w(I,{as:"div",color:"gray",textStyle:"small",children:[Wf(e.size)," total size, muted"]})]})}),w(f,{marginBottom:16,children:[n(md,{leftSlot:n(I,{textStyle:"small",color:"white",children:"Loop"}),rightSlot:n(Ot,{checked:e.loop,onChange:d})}),n(md,{showBorder:!1,leftSlot:n(I,{textStyle:"small",color:"white",children:"Opacity"}),rightSlot:n(hn,{textAlign:"right",color:"white",value:typeof e.opacity=="number"?e.opacity:100,min:0,max:100,onChange:u})})]}),n(f,{display:"flex",alignItems:"center",padding:"0px 16px",children:n(ne,{boxSizing:"border-box",width:"100%",height:40,variant:"bordered",borderColor:Me("white",.16),textStyle:"small",color:"white",lineHeight:"38px",onClick:g,children:"Delete"})})]})]}):n(Tr,{id:"rm-background-video-upload",onChange:p,accept:"video/mp4",readFileData:!1,cursor:a?"default":"pointer",dropFile:!a,children:n(f,{backgroundColor:"#f3f3f3",padding:"8px 16px",width:"100%",height:"100%",onMouseEnter:()=>{m&&setTimeout(()=>{c(null)},1e3)},children:w(f,{width:"100%",height:"100%",pointerEvents:a?"none":void 0,display:"flex",flexDirection:"column",justifyContent:"space-between",children:[n(I,{children:a?"Uploading...":"Background video"}),n(I,{textStyle:"small",cursor:"pointer",color:m?"tomato":"blue",display:"block",lineHeight:"16px",width:"100%",children:m||(a?"It might take some time":w(K,{children:["Drop an MP4 file here",n("br",{}),"Max size: 10 MB"]}))}),n(f,{children:a?null:n(Re,{href:"https://help.readymag.com/hc/en-us/articles/360021875172-Background",target:"_blank",rel:"noopener noreferrer",textStyle:"small",lineHeight:"16px",children:"Learn how to convert videos"})})]})})})}var G8={props:{widgetModel:{type:Object,default:null}},mounted:function(){qn({component:ly,domElement:this.$el,model:this.widgetModel})},beforeDestroy:function(){py.default.unmountComponentAtNode(this.$el)}},V8=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"view video video-panel"})},j8=[],Y8=void 0,q8=void 0,X8=void 0,K8=!1;function Z8(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-video.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var J8=Z8({render:V8,staticRenderFns:j8},Y8,G8,q8,K8,X8,!1,void 0,void 0,void 0),cy=J8;u_();var Q8={name:"EllipsisPlus",props:{text:String,line:{type:Number,default:2},ellipsis:{type:String,default:"..."},showButton:{type:Boolean,default:!1},expandText:{type:String,default:""},collapseText:{type:String,default:""}},data(){return{tmpTxt:"",show:!1,marginLeft:0,collapseMarginLeft:0}},created(){},mounted(){if(!this.line)return;let e=this.$refs.txt.offsetWidth;this.$refs.txt.innerHTML=this.text;let o=this.$refs.container.offsetWidth,t=0,r=0,i=this.$refs.ellipsis.offsetWidth;if(this.showButton){r=Math.ceil(parseFloat(getComputedStyle(this.$refs.more,null).width.replace("px",""))),t=r,this.$refs.ellipsis.style.display="none";let c=0,p=this.$refs.more.cloneNode();this.expandText!==this.collapseText&&(this.$refs.more.style.display="none",p.innerHTML=this.collapseText,p.style.display="inline-block",this.$refs.container.appendChild(p),r=Math.ceil(parseFloat(getComputedStyle(p,null).width.replace("px",""))),c=p.offsetLeft),p.offsetTop<=this.$refs.ellipsis.offsetTop+5?this.marginLeft=o-r-c+i:this.marginLeft=o-r-c,p.remove(),this.$refs.more.style.display="inline-block",this.$refs.ellipsis.style.display="inline-block"}let s=getComputedStyle(this.$refs.container,null),a=parseFloat(s.lineHeight.replace("px",""));if(this.$refs.txt.innerHTML=this.text,Math.floor(this.$refs.container.offsetHeight/a)<=this.line){this.tmpTxt=this.text,this.show=!0,this.showButton=!1;return}let l=Math.floor((o*this.line-t-i)/e),m=1;this.$refs.txt.innerHTML=this.text.substr(0,l),Math.round(this.$refs.container.offsetHeight/a)>this.line&&(m=-1);for(let c=l;c<this.text.length;c=c+m){if(c<0||c>this.text.length)return;if(this.$refs.txt.innerHTML=this.text.substr(0,c),m===1&&Math.round(this.$refs.container.offsetHeight/a)>this.line){if(this.tmpTxt=this.text.substr(0,c-1),this.$refs.txt.innerHTML=this.tmpTxt,this.showButton){let p=this.$refs.more.offsetLeft;this.collapseMarginLeft=o-t-p-1}break}else if(m===-1&&Math.round(this.$refs.container.offsetHeight/a)===this.line){if(this.tmpTxt=this.text.substr(0,c),this.$refs.txt.innerHTML=this.tmpTxt,this.showButton){let p=this.$refs.more.offsetLeft;this.collapseMarginLeft=o-t-p-1}break}}},methods:{handleClick(){this.show?this.collapse():this.expand()},expand(){this.show||(this.show=!0,this.$refs.txt.innerHTML=this.text)},collapse(){this.show&&(this.show=!1,this.$refs.txt.innerHTML=this.tmpTxt)}}},eP=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{ref:"container",staticClass:"ellipsis-plus"},[t("span",{ref:"txt",staticClass:"ellipsis-plus-txt"},[e._v("\u4E2D")]),e._v(" "),t("span",{ref:"ellipsis",staticClass:"ellipsis-plus-ellipsis",style:{display:e.show?"none":"inline-block"}},[e._v(`
    `+e._s(e.ellipsis)+`
  `)]),e._v(" "),e.showButton?t("button",{ref:"more",staticClass:"ellipsis-plus-button",style:{"margin-left":e.show?e.marginLeft+"px":e.collapseMarginLeft+"px"},on:{click:e.handleClick}},[e._v(`
    `+e._s(e.show?e.collapseText:e.expandText)+`
  `)]):e._e()])},tP=[],oP=void 0,rP=void 0,iP=void 0,nP=!1;function sP(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="ellipsis-plus.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var aP=sP({render:eP,staticRenderFns:tP},oP,Q8,rP,nP,iP,!1,void 0,void 0,void 0),dy=aP;Of();var ja=T(St());Vo();var lP={model:{event:"change"},props:{value:{type:Number,default:1},width:{type:Number,default:120},handleWidth:{type:Number,default:30},gradientColor:{type:String,default:"none"},gap:{type:Number,default:0}},computed:{percent:function(){return Math.round(this.value*100)},gradientLeft:function(){return Ye.getRGBA(this.gradientColor,1)},gradientRight:function(){return Ye.getRGBA(this.gradientColor,0)}},watch:{value:function(e){e!==(0,ja.default)(this.$el).data("opacity")&&(0,ja.default)(this.$el).data("rmopacitydragChange")({opacity:e})}},mounted:function(){(0,ja.default)(this.$el).rmOpacityDrag({opacity:this.value,onchange:this.onOpacityChange,onenddrag:this.onOpacityEndDrag,width:this.width,handleWidth:this.handleWidth,gap:this.gap}).data("rmopacitydrag-change")},methods:{opacityMouseEnter:function(){this.$emit("opacity-active",!0)},opacityMouseLeave:function(){this.$emit("opacity-active",!1)},onOpacityEndDrag:function(){this.$emit("opacity-active",!1)},onOpacityChange:function(e){(0,ja.default)(this.$refs.handle).hasClass("opacity-dragging")&&this.$emit("opacity-active",!0),Math.abs(this.value-e)>.001&&this.$emit("change",e)}}},pP=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"rm-opacity-slider",style:{background:"linear-gradient(to right, "+e.gradientLeft+", "+e.gradientRight+")"},on:{mouseenter:e.opacityMouseEnter,mouseleave:e.opacityMouseLeave}},[t("div",{ref:"handle",staticClass:"opacity-handle"},[e._t("default")],2)])},cP=[],dP=void 0,mP=void 0,uP=void 0,gP=!1;function hP(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="rm-opacity-drag.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var fP=hP({render:pP,staticRenderFns:cP},dP,lP,mP,gP,uP,!1,void 0,void 0,void 0),my=fP;c_();function bP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"32",height:"32",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[t("rect",{attrs:{fill:"#262626",opacity:".4",width:"32",height:"32",rx:"16"}}),t("path",{attrs:{d:"M16 13.058c.744 0 1.38.254 1.908.761.528.508.792 1.12.792 1.835 0 .715-.264 1.326-.792 1.834A2.654 2.654 0 0116 18.25c-.744 0-1.38-.254-1.908-.762s-.792-1.119-.792-1.834c0-.715.264-1.327.792-1.835A2.654 2.654 0 0116 13.058m6.6-3.75a2.36 2.36 0 011.697.676c.469.45.703.994.703 1.631v8.077c0 .637-.234 1.181-.703 1.632A2.36 2.36 0 0122.6 22H9.4a2.36 2.36 0 01-1.697-.676A2.181 2.181 0 017 19.692v-8.077c0-.637.234-1.18.703-1.631A2.36 2.36 0 019.4 9.308h2.1l.478-1.226c.119-.295.336-.549.652-.762.315-.213.639-.32.97-.32h4.8c.331 0 .655.107.97.32.316.213.533.467.652.762l.478 1.226h2.1M16 19.692c1.156 0 2.145-.395 2.967-1.185.822-.79 1.233-1.741 1.233-2.853s-.41-2.063-1.233-2.853c-.822-.79-1.81-1.186-2.967-1.186-1.156 0-2.145.396-2.967 1.186-.822.79-1.233 1.741-1.233 2.853s.41 2.063 1.233 2.853c.822.79 1.81 1.185 2.967 1.185",fill:"#FFF","fill-rule":"nonzero"}})])])]}var uy={render:bP};function wP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"46",height:"13",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"#FFF","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M10.27 6.134c-.045.995-.744 2.357-2.095 4.087-1.397 1.806-2.58 2.71-3.546 2.71-.599 0-1.106-.55-1.52-1.65l-.83-3.026c-.307-1.1-.636-1.65-.99-1.65-.076 0-.345.16-.806.48L0 6.467c.507-.443 1.007-.886 1.5-1.33.676-.582 1.184-.887 1.522-.918.8-.077 1.292.467 1.477 1.631.2 1.256.338 2.038.415 2.343.23 1.042.484 1.563.761 1.563.215 0 .538-.338.97-1.014.43-.676.66-1.19.691-1.544.062-.583-.17-.876-.692-.876-.246 0-.5.057-.76.168.505-1.646 1.47-2.445 2.894-2.4 1.056.031 1.553.713 1.493 2.045"}}),t("path",{attrs:{d:"M14.606 1.197c-.016.38-.208.746-.578 1.096a2.069 2.069 0 01-1.476.594c-.877 0-1.3-.38-1.27-1.142.016-.395.25-.776.704-1.142a2.355 2.355 0 011.512-.548c.323 0 .592.126.807.377.216.252.315.507.3.765zm2.007 8.16a7.74 7.74 0 01-1.777 2.201c-1.03.887-2.061 1.33-3.091 1.33-.478 0-.843-.153-1.097-.459-.253-.306-.373-.703-.357-1.192.015-.504.172-1.284.472-2.34.3-1.054.45-1.62.45-1.696 0-.398-.138-.597-.414-.597-.093 0-.354.161-.785.482l-.531-.62 1.477-1.33c.661-.582 1.153-.887 1.477-.918.507-.046.88.102 1.119.446.238.343.326.788.265 1.337a70.9 70.9 0 00-.646 3.543c-.016.656.223.983.715.983.215 0 .6-.226 1.154-.679a9.624 9.624 0 001.13-1.064l.439.573z"}}),t("path",{attrs:{d:"M31.022 9.357a7.739 7.739 0 01-1.777 2.201c-1.03.887-2.061 1.33-3.091 1.33-1.001 0-1.485-.55-1.454-1.651.015-.49.111-1.078.288-1.766.176-.688.273-1.223.288-1.605.016-.58-.162-.872-.532-.872-.402 0-.88.475-1.435 1.423-.587.994-.904 1.958-.95 2.891-.03.658.034 1.163.195 1.515-1.074.03-1.826-.146-2.255-.528-.384-.337-.56-.894-.529-1.675.015-.49.09-.98.227-1.469.135-.49.21-.925.226-1.308.031-.566-.177-.849-.624-.849-.385 0-.801.437-1.248 1.308a6.637 6.637 0 00-.739 2.731c-.03.857.025 1.453.166 1.79-1.056.03-1.806-.19-2.25-.664-.368-.396-.536-.999-.505-1.807.015-.397.085-.95.212-1.66.127-.709.197-1.261.212-1.658.03-.275-.039-.412-.207-.412-.093 0-.354.155-.785.464l-.554-.62c.077-.06.561-.504 1.454-1.33.646-.596 1.084-.902 1.315-.918.4-.03.723.134.969.493.246.36.37.777.37 1.251 0 .153-.016.298-.047.436.23-.352.5-.658.808-.918.707-.612 1.5-.956 2.376-1.033.754-.06 1.292.115 1.616.528.26.336.384.819.369 1.446.108-.092.223-.191.346-.299.354-.413.7-.741 1.038-.986.57-.413 1.162-.643 1.777-.689.738-.06 1.269.114 1.592.526.276.335.4.815.37 1.44-.016.427-.12 1.048-.312 1.863-.193.816-.289 1.284-.289 1.406-.015.32.016.54.092.663.077.122.261.182.554.182.215 0 .6-.226 1.154-.679a9.62 9.62 0 001.13-1.064l.439.573z"}}),t("path",{attrs:{d:"M34.436 6.938c.015-.41-.153-.617-.507-.617-.46 0-.929.316-1.405.948-.476.632-.722 1.236-.737 1.815-.009 0-.009.099 0 .297a5.195 5.195 0 001.958-1.256c.445-.487.676-.883.691-1.187zm5.238 2.396c-.446.733-1.323 1.466-2.63 2.2-1.63.931-3.285 1.397-4.96 1.397-1.247 0-2.14-.413-2.678-1.239-.384-.566-.569-1.238-.553-2.019.015-1.238.569-2.416 1.661-3.533 1.2-1.224 2.615-1.836 4.245-1.836 1.508 0 2.308.611 2.4 1.832.061.778-.37 1.579-1.292 2.403-.985.9-2.224 1.473-3.715 1.717.276.381.692.572 1.246.572 1.107 0 2.315-.28 3.623-.84.938-.394 1.676-.803 2.215-1.227l.438.573z"}}),t("path",{attrs:{d:"M43.33 7.709a2.875 2.875 0 00-.173-1.138c-.13-.345-.32-.518-.565-.518-.785 0-1.431.422-1.938 1.265a4.425 4.425 0 00-.693 2.207c-.015.383.054.72.208 1.012.169.337.407.505.716.505.691 0 1.284-.405 1.776-1.218.416-.675.638-1.38.67-2.115m2.607.086c-.062 1.406-.585 2.62-1.57 3.644-.984 1.023-2.207 1.535-3.668 1.535-1.215 0-2.138-.39-2.769-1.17-.46-.58-.715-1.305-.76-2.175-.078-1.314.398-2.521 1.43-3.62 1.107-1.223 2.499-1.833 4.176-1.833 1.076 0 1.891.359 2.445 1.076.523.658.761 1.505.716 2.543"}})])])]}var gy={render:wP};function xP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"40",height:"17",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("defs",[t("path",{attrs:{id:"a",d:"M.032 16.196h23.325V.071H.032v16.125z"}})]),t("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M14.607 13.126h-1.484v-.848c-.563.637-1.04.958-1.56.958-.456 0-.773-.212-.931-.596-.097-.233-.165-.598-.165-1.133v-6.17h1.484v6.324c.035.216.128.296.317.296.284 0 .54-.244.855-.682V5.337h1.484v7.79zM7.89 10.813c.077.77-.165 1.154-.626 1.154-.46 0-.703-.383-.624-1.154V7.728c-.079-.772.164-1.133.624-1.133.461 0 .704.361.626 1.133v3.085zm1.483-2.931c0-.833-.169-1.458-.468-1.851-.396-.533-1.016-.751-1.64-.751-.708 0-1.246.218-1.64.75-.305.394-.468 1.026-.468 1.859l-.002 2.77c0 .827.145 1.399.45 1.789.394.53 1.035.812 1.66.812.624 0 1.276-.281 1.671-.812.3-.39.437-.962.437-1.79V7.882zM3.515 8.884v4.242H1.953V8.884S.333 3.684 0 2.714h1.64l1.097 4.063 1.09-4.063h1.64l-1.952 6.17zM29.872 6.576c-.233 0-.5.121-.736.351l-.002 4.678c.237.233.505.352.738.352.408 0 .592-.296.592-1.067V7.573c0-.77-.184-.997-.592-.997M35.697 7.503c0-.713-.186-.927-.655-.927-.472 0-.673.196-.673.917v.853l1.328-.001v-.842z",fill:"#FFF"}}),t("g",{attrs:{transform:"translate(15.779 .006)"}},[t("mask",{attrs:{id:"b",fill:"#fff"}},[t("use",{attrs:{"xlink:href":"#a"}})]),t("path",{attrs:{d:"M19.276 11.95c.349 0 .551-.186.632-.56.013-.076.01-.409.01-.969h1.485v.219c0 .45-.038.768-.05.908-.048.31-.16.59-.331.836-.391.56-.972.836-1.71.836-.74 0-1.303-.263-1.712-.79-.3-.385-.493-.959-.493-1.778V7.953c0-.824.175-1.46.475-1.85.41-.528.972-.807 1.694-.807.71 0 1.273.28 1.67.807.295.39.46.992.46 1.816v1.577H18.59v1.385c-.005.711.2 1.07.685 1.07zm-3.107-1.143c0 .712-.061 1.215-.156 1.542-.189.573-.6.87-1.163.87-.503 0-1.018-.298-1.49-.875l-.003.776h-1.406V2.786h1.406l-.001 3.369c.456-.555.974-.87 1.494-.87.563 0 .941.32 1.13.898.095.31.19.809.19 1.539v3.085zm-5.39 2.313H9.296v-.848c-.562.637-1.04.958-1.56.958-.455 0-.772-.212-.93-.596-.097-.233-.165-.598-.165-1.133V5.408h1.484v6.247c.034.217.127.296.316.296.284 0 .541-.244.855-.682V5.408h1.485v7.712zm-5.624 0H3.593V4.251h-1.64V2.787l4.92-.001V4.25H5.156v8.87zm17.97-9.57s-.228-1.58-.928-2.276C21.31.361 20.316.356 19.86.304 16.596.07 11.7.07 11.7.07h-.01s-4.896 0-8.16.232c-.456.053-1.45.058-2.337.971C.493 1.97.266 3.55.266 3.55S.032 5.405.032 7.26V9c0 1.855.234 3.71.234 3.71s.227 1.58.927 2.276c.887.913 2.052.884 2.571.98 1.867.176 7.93.23 7.93.23s4.902-.007 8.166-.239c.456-.053 1.45-.058 2.337-.971.7-.696.927-2.276.927-2.276s.233-1.855.233-3.71V7.26c0-1.855-.233-3.71-.233-3.71z",fill:"#FFF",mask:"url(#b)"}})])])])]}var hy={render:xP};function vP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("circle",{attrs:{cx:"12",cy:"12",r:"12","fill-rule":"evenodd"}})])]}var fy={render:vP};function kP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"23",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M21.443 22.962l.024.039H2a2 2 0 01-1.7-3.053L8.377 6.894a2 2 0 013.414.022l5.16 8.577.344-.567a2 2 0 013.42 0l3.03 4.999a2 2 0 01-1.71 3.037h-.593zM20.01 8a4 4 0 110-8 4 4 0 010 8z",fill:"#FFF","fill-rule":"evenodd"}})])]}var by={render:kP};function yP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"24",height:"23",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("g",{attrs:{fill:"#FFF","fill-rule":"evenodd"}},[t("path",{attrs:{d:"M21.443 18.962l.024.039H2a2 2 0 01-1.7-3.053L8.377 2.894a2 2 0 013.414.022l5.16 8.577.344-.567a2 2 0 013.42 0l3.03 4.999a2 2 0 01-1.71 3.037h-.593zM20.01 8a4 4 0 110-8 4 4 0 010 8z"}}),t("rect",{attrs:{y:"22",width:"24",height:"1",rx:".5"}}),t("rect",{attrs:{y:"20",width:"24",height:"1",rx:".5"}})])])]}var wy={render:yP};function _P(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"20",height:"24",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{d:"M18.973 13.994l-16.284 9.77c-.918.55-2.034.104-2.493-.997A2.601 2.601 0 010 21.77V2.23C0 .998.832 0 1.858 0c.288 0 .573.08.831.235l16.284 9.77c.917.551 1.29 1.89.83 2.992-.18.431-.47.781-.83.997z",fill:"#FFF","fill-rule":"evenodd"}})])]}var xy={render:_P};bi();ct();var CP={components:{BackgroundSlideshow:ay,BackgroundVideo:cy,VideoSearch:Vf,EllipsisPlus:dy,RmSwitcher:Zl,RmOpacityDrag:my,ColorPicker:Nf,UnsplashImg:uy,VimeoImg:gy,YoutubeImg:hy,ColorImg:fy,PictureImg:by,SlideshowImg:wy,VideoImg:xy,HelpTourTooltip:Ir},props:["workspace","dark"],data:function(){let e=Ar.default.findWhere(this.workspace.blocks,{name:"Background"}),o=e.model.attributes.slideshow?Ar.default.extend({video:{}},Qt(e.model.attributes)):Ar.default.extend({video:{}},Qt(e.model.attributes),{slideshow:Qt(e.defaultSlideshow)});return{widget:e.model,block:e,attrs:o,state:"upload",videoState:e.model.get("video")&&e.model.get("video").video_id?"video":"select",loading:!1,dragging:!1,videoLoading:!1,picSearchText:"",videoSearchText:e.model.get("video")&&e.model.get("video").url,picOpacityActive:!1,videoOpacityActive:!1,error:null,picture:null,videoImg:{youtube:"YoutubeImg",vimeo:"VimeoImg"},tabImg:{color:"ColorImg",picture:"PictureImg",slideshow:"SlideshowImg",video:"VideoImg"},colorPickerHeight:240,helpTourStep:"ClickOnPaletteIcon"}},computed:{selectedType:function(){return this.attrs.selectedType?this.attrs.selectedType:"color"},canSelectBackgroundFromSwatches:function(){return je.isPermissionAllowed("BaseWidgetCanSelectColorFromSwatches")},canSelectBackgroundFromPalette:function(){return je.isPermissionAllowed("BaseWidgetCanSelectColorFromPalette")}},watch:{"attrs.picture":function(){this.onPictureChange()},"attrs.video":function(){this.onVideoChange()}},created:function(){this.$watch("attrs",function(e){this.widget.set(Qt(e))},{deep:!0}),this.widget.on("change",function(e,o){this.attrs=Ar.default.extend({},this.attrs,e.changed),(!o||!o.undo&&!o.redo)&&this.save._debounced()},this)},mounted:function(){import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PKMOVP7P.js").then(({default:e})=>{e("controls-video_settings")}),Ar.default.isNumber(this.widget.get("opacity"))||this.widget.set("opacity",1,{silent:!0}),this.save._debounced=Ar.default.debounce(this.save,300),this.loadPreviewImage.__once=Ar.default.once(this.loadPreviewImage),this.workspace.on("main-dragover",this.highlightDropZone,this),this.uploader=new ki(this,{fileTypes:"jpeg|jpg|png|gif",fileTypesErrorMessage:oe.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR,dropZone:(0,Ya.default)([this.$refs.backgroundSlideshowPanel,this.$refs.backgroundPicturePanel])}),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("uploadFromUrl",this.uploadFromUrl),this.block.panel=this,this.widget.get("picture")&&this.setPreviewImage(()=>{this.showPictureState()}),Ie("OpenBackgroundLayer"),ye.trigger("panel:showed","background-panel")},destroyed:function(){this.workspace.off("main-dragover",this.highlightDropZone),this.widget.off("change",null,this),this.uploader.off()},methods:{selectTab:function(e){this.widget.set("selectedType",e)},updateColor:function(e){this.widget.set("color",e)},onStartUpload:function(e){this.loading=!0,this.uploader.viewport=this.widget.getViewport();let o=e.target&&e.target.files.length&&e.target.files[0];o&&Kl(o).then(t=>{this.loading&&t.ext&&wa.allowedLambdaExt(t.ext)&&this.block.setTempPicture(t)}).catch(()=>{})},onDoneUpload:function(e,o){if(this.dragging=!1,!o||!o.result){console.error("error file upload!");return}this.uploader.viewport!==this.widget.getViewport()&&(this.loading=!1),this.block.changePicture(o.result,{viewport:this.uploader.viewport})},onFailUpload:function(){this.block.removePicture(),this.showUploadState()},onChangeSlideshowPictures:function(e){this.attrs.slideshow.pictures=e},onChangeSlideshowDelay:function(e){this.attrs.slideshow.delay=e},onChangeSlideshowCrossfade:function(e){this.attrs.slideshow.crossfade=e},showUploadState:function(){this.state="upload",delete this.uploader.viewport},showPictureState:function(){this.loading=!1,this.block.off("imagesReady",this.showPreview),this.state="picture"},showSelectFile:function(e){(0,Ya.default)(e.target).hasClass("uploadInput")||this.loading||(0,Ya.default)(this.$refs.uploadInput).trigger("click","stop")},loadPreviewImage:function(e){this.block.loadPreviewUrl({w:oe.backgroundPreviewWidth,h:oe.backgroundPreviewHeight},{viewport:this.uploader.viewport,success:()=>{delete this.uploader.viewport,this.widget.get("picture")&&this.widget.get("picture").previewUrl?this.setPreviewImage(e):console.error("No preview for background")}})},setPreviewImage:function(e){this.loading=!0;let o,t=this.widget.get("picture"),r=(0,Ya.default)("<img>").addClass("preload_image").appendTo("body");if(wa.useLambdaUrl(t))o=this.getPreviewUrl();else{if(o=t&&t.previewUrl,!o)return this.loadPreviewImage(e);r.on("error",Ar.default.bind(function(){r.off().remove(),this.loadPreviewImage.__once(e),this.loading=!1},this))}r.attr("src",o).on("load",Ar.default.bind(function(){r.off().remove(),this.block.trigger("loadimage","preview"),e&&e()},this))},getPreviewUrl:function(){let e=this.widget.get("picture");if(!e)return"";if(wa.useLambdaUrl(e)){let o={width:oe.backgroundPreviewWidth,height:oe.backgroundPreviewHeight};return wa.getLambdaUrl(e,o)}return e.previewUrl},showPicOpacity:function(e){this.picOpacityActive=e},showVideoOpacity:function(e){this.videoOpacityActive=e},uploadFromSearch:function(){this.picSearchText&&(this.isURL(this.picSearchText)?this.uploadFromUrl(this.picSearchText):RM.views.searchUnsplash&&RM.views.searchUnsplash.show(this.picSearchText,{upload:this.uploadImageFromSearch,preview:this.previewImageFromSearch,initialSize:"large"}))},uploadFromUrl:function(e){this.uploader.viewport=this.widget.getViewport(),this.uploadXHR=this.block.loadFromUrl(e,{save:!1,success:()=>{this.picSearchText="",delete this.uploadXHR},error:()=>{this.loading=!1,this.block.picUrl="",this.block.renewPic(),delete this.uploadXHR}}),this.loading=!0},uploadImageFromSearch:function(e){this.block.cancelPictureLoading(),this.loading=!0,this.uploadFromUrl(e)},previewImageFromSearch:function(e,o){this.block.previewPic(e,o)},searchUnsplash:function(){RM.views.searchUnsplash&&RM.views.searchUnsplash.show("",{upload:this.uploadImageFromSearch,preview:this.previewImageFromSearch})},onPictureChange:function(){let e=this.widget.get("picture"),o=this.widget.previous("picture")||{};e?o.url!=e.url&&(this.block.trigger("unloadimage","preview"),this.block.on("imagesReady",this.showPictureState,this),this.setPreviewImage()):this.showUploadState(),delete this.uploader.viewport},deletePicture:function(){this.widget.get("picture")&&this.widget.get("picture").url?!this.uploader.uploading&&!this.uploadXHR&&this.block.removePicture():this.showUpload(),this.loading=!1,this.uploadXHR&&this.uploadXHR.abort(),this.uploader.abort(),this.block.off("imagesReady",this.showPreview)},onVideoChange:function(){this.widget.get("selectedType")=="video"&&((!this.widget.previous("video")||this.widget.previous("video").url!=this.widget.get("video").url)&&this.block.video.render(),this.widget.get("video")&&this.widget.get("video").url?(this.videoSearchText=this.attrs.video.url,this.videoState="video",this.block.video.show()):(this.videoState="select",this.block.video.hide()))},save:function(){this.widget.save()},isURL:ju}},SP=function(){var e,o=this,t=o.$createElement,r=o._self._c||t;return r("transition",{attrs:{name:"wb-panel"}},[r("div",{staticClass:"background-panel"},[r("div",{staticClass:"background-panel-bg"},[r("div",{staticClass:"views"},[r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="color",expression:"selectedType === 'color'"}],staticStyle:{position:"absolute",width:"100%",top:"16px"}},[r("help-tour-tooltip",{attrs:{step:o.helpTourStep,position:"right",indent:8}})],1),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="color",expression:"selectedType === 'color'"}],staticClass:"view color"},[r("color-picker",{ref:"colorpicker",attrs:{color:o.attrs.color,"colorbox-type":"vertical","colorbox-width":224,"swatches-min":14,"swatches-per-line":7,"favourites-max":8,"favourites-per-line":4,"favourite-gap":11,"show-alpha":!1,"always-visible":!0,"colorbox-height":o.colorPickerHeight,"colorbox-border-radius":0,"swatches-only-mode":o.canSelectBackgroundFromSwatches&&!o.canSelectBackgroundFromPalette},on:{"update:color":o.updateColor}})],1),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="picture",expression:"selectedType === 'picture'"}],ref:"backgroundPicturePanel",staticClass:"view picture",class:{loaded:o.picture}},[r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="upload",expression:"state === 'upload'"}],staticClass:"upload",class:{dragging:o.dragging},attrs:{"drag-over":"handleDragOver"},on:{dragenter:function(i){o.dragging=!0},dragend:function(i){o.dragging=!1},dragleave:function(i){o.dragging=!1},click:o.showSelectFile}},[r("div",{staticClass:"param-caption"},[o._v("Picture")]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!o.loading,expression:"!loading"}],staticClass:"upload-wrapper"},[r("div",{staticClass:"caption-drop"},[o._v("Drop file here")])]),o._v(" "),r("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":"/api/upload/lambda/"}})]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.loading,expression:"loading"}],staticClass:"picture_preloader rmpreloader"},[r("div",{staticClass:"shadow"}),o._v(" "),r("div",{staticClass:"arc"})]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="upload"&&!o.loading,expression:"state === 'upload' && !loading"}],staticClass:"social"},[r("span",{on:{click:o.searchUnsplash}},[r("unsplash-img",{staticClass:"svg unsplash",attrs:{title:"Unsplash"}})],1),o._v(" "),r("div",{staticClass:"search"},[r("input",{directives:[{name:"model",rawName:"v-model.trim",value:o.picSearchText,expression:"picSearchText",modifiers:{trim:!0}}],class:{"has-icon":o.picSearchText!=""},attrs:{type:"text",spellcheck:"false",placeholder:"Search or paste URL",value:""},domProps:{value:o.picSearchText},on:{keyup:function(i){return!i.type.indexOf("key")&&o._k(i.keyCode,"enter",13,i.key,"Enter")?null:o.uploadFromSearch(i)},input:function(i){i.target.composing||(o.picSearchText=i.target.value.trim())},blur:function(i){return o.$forceUpdate()}}}),o._v(" "),r("div",{staticClass:"input-icon",class:{hidden:o.picSearchText==="","upload-icon":o.isURL(o.picSearchText)},on:{click:o.uploadFromSearch}})])]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.state==="picture",expression:"state === 'picture'"}],staticClass:"preview"},[r("div",{staticClass:"image",style:{backgroundImage:"url("+o.getPreviewUrl()+")"}}),o._v(" "),r("div",{staticClass:"mask"}),o._v(" "),r("div",{staticClass:"delete",attrs:{title:"Remove"},on:{click:o.deletePicture}}),o._v(" "),r("rm-opacity-drag",{ref:"opacity",staticClass:"opacity",attrs:{width:205,"handle-width":24,gap:4,"gradient-color":o.attrs.color},on:{"opacity-active":o.showPicOpacity},model:{value:o.attrs.opacity,callback:function(i){o.$set(o.attrs,"opacity",i)},expression:"attrs.opacity"}},[r("span",{directives:[{name:"show",rawName:"v-show",value:o.picOpacityActive,expression:"picOpacityActive"}],staticClass:"opacity-percents"},[o._v(o._s(Math.ceil(o.attrs.opacity*100)))])])],1)]),o._v(" "),r("background-slideshow",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="slideshow",expression:"selectedType === 'slideshow'"}],ref:"backgroundSlideshowPanel",attrs:{"slideshow-data":o.attrs.slideshow,"selected-type":o.selectedType,block:o.block},on:{updatePictures:o.onChangeSlideshowPictures,updateDelay:o.onChangeSlideshowDelay,updateCrossfade:o.onChangeSlideshowCrossfade}}),o._v(" "),r("background-video",{directives:[{name:"show",rawName:"v-show",value:o.selectedType==="video",expression:"selectedType === 'video'"}],attrs:{"widget-model":o.widget}})],1),o._v(" "),r("div",{class:(e={},e.tabs=!0,e.dark=o.dark,e)},o._l(["color","picture","slideshow","video"],function(i){var s;return r("div",{key:i,staticClass:"tab",class:(s={active:o.selectedType===i},s[i]=!0,s),style:{fill:i==="color"?"#"+o.attrs.color:""},on:{click:function(a){return o.selectTab(i)}}},[r(o.tabImg[i],{tag:"component",staticClass:"svg",staticStyle:{"pointer-events":"none"}})],1)}),0)])])])},PP=[],TP=void 0,MP="data-v-55248cec",BP=void 0,IP=!1;function zP(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="background-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var EP=zP({render:SP,staticRenderFns:PP},TP,CP,MP,IP,BP,!1,void 0,void 0,void 0),vy=EP;re();Pt();Ue();to();_o();ct();v();var ky=({children:e,button:o,...t})=>{let{togglePanel:r,openPanel:i}=(0,ir.useContext)(kt),s=(0,ir.useRef)(null),a=(0,ir.useRef)(null),{user:l}=(0,ir.useContext)(tr),[m,c]=(0,ir.useState)(!1),{selectedBlocks:p,workspace:u,page:d,viewport:g}=(0,ir.useContext)(Je),[h,b]=(0,ir.useState)(null),[x]=Zt(),y=$t();Rr("q",{handler:()=>r("stackpanel",!1)},[x]),(0,ir.useEffect)(()=>{if(m&&a.current){s.current&&si(s.current);let P={showPanel:C=>{b(C),C==="background"&&a.current&&(s.current&&si(s.current),s.current=Ga(vy,a.current,{workspace:u,dark:!0}))}};s.current=Ga(ny,a.current,{workspace:u,showGuidePanel:!1,dark:!0},P),y.step?.name==="ClickOnPaletteIcon"&&jo("ClickOnPaletteIcon",{show:!1})}else m||(b(null),s.current&&si(s.current),s.current=null,y.step?.name==="ClickOnPaletteIcon"&&jo("ClickOnPaletteIcon",{show:!0}))},[m,u,l,d,g]);let S=P=>{h!==null&&!P&&i("stackpanel"),c(P)},k=P=>P&&p.length===0||!!h;return n(Et,{id:"toolbar-popover",name:"stackpanel",skidding:-28,button:o,onToggle:S,panelPosition:{width:0,marginLeft:"-112px"},watchingClick:k,ArrowProps:{backgroundColor:"rgba(40, 40, 40, 0.96)",popperPadding:132,stroke:h!=="background"?Ee(.96,O.gray):void 0},...t,children:n(f,{height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",ref:a,css:te`
          & .stack_panel {
            max-height: 100% !important;
            width: 224px !important;
          }
          & .line.last {
            background: ${Ee(.8,O.gray)};
            opacity: 1;
          }
          & .background-panel {
            position: relative !important;
            padding: 0 !important;
            width: 224px !important;
            height: 292px !important;
            left: 0 !important;
            bottom: 0 !important;
          }
          & .stack_panel .inner {
            padding: 0;
            margin-bottom: 0;
            box-shadow: 0 0 0 2px inset ${Ee(.96,O.gray)};
          }
          & .stack_panel .layer.selected {
            background: ${Ee(.2,O.darkGray)};
          }
        `,children:n(f,{position:"relative",top:88,left:224,children:n(ht,{targetSteps:["MobileMenuVisible","BeforeAddAnimations"],position:"right",indent:8,children:n("div",{})})})})})};vi();re();G();v();var RP=Y(f)`
  position: relative;

  &::before {
    content: '';
    z-index: -1;
    width: 100%;
    height: 100%;
    position: absolute;
    backdrop-filter: ${e=>`blur(${e.blur})`};
  }
`;function Ec({children:e,blur:o="4px",...t}){return n(RP,{blur:o,...t,children:e})}_r();yr();v();var _y=()=>{let e=(0,yy.useContext)(Je),[o]=Zt();return e.page?w(f,{id:"widgetbar",display:"flex",height:56,position:"absolute",bottom:16,left:16,borderRadius:"9px 8px 8px 9px",onClick:()=>{Fe("click")},zIndex:3e3,children:[n(hv,{}),n(Ec,{display:"flex",width:224,height:56,borderRadius:"8px",margin:"0 0 0 8px",backgroundColor:Me("darkGray",.96),children:w(is,{children:[n(gk,{width:"56px",button:({isPanelShown:t})=>n(bv,{disableTooltip:t})}),n(au,{width:"56px",button:({isPanelShown:t})=>n(kv,{currentViewport:e.viewport,disableTooltip:t})}),n(mn,{disabled:o,children:n(ky,{width:"56px",button:({isPanelShown:t})=>n(Yx,{disableTooltip:t})})}),n(Vr,{permission:"BaseWidgetCanAdd",children:n(mn,{disabled:o,children:n(Ak,{width:"56px",height:"56px",button:({isPanelShown:t})=>n(Xx,{disableTooltip:t})})})})]})})]}):null};var _u=T(H());re();G();ao();vi();Gt();to();var Cy=T(H());Oe();ao();bi();go();v();function ji({isActive:e,withTransition:o}){let{isHovered:t,...r}=Ge();return w("svg",{width:"46",height:"46",viewBox:"0 0 46 46",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{position:"relative",top:-1},...o?r:{},children:[w("g",{style:{transition:"0.3s ease",transformOrigin:"center",transform:`rotate(${t?16:0}deg)`},children:[n("path",{d:"M11.4976 16.9335C10.812 14.6457 12.9447 12.513 15.2325 13.1986L29.5697 17.4949C31.7445 18.1467 32.4353 20.8846 30.8298 22.49L20.789 32.5308C19.1835 34.1363 16.4456 33.4455 15.7939 31.2707L11.4976 16.9335Z",stroke:"white",strokeWidth:"2"}),n("path",{d:"M26.1631 27.864L33.527 35.228",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]}),e?n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38 5H40H42V4C42 2.89543 41.1046 2 40 2C38.8954 2 38 2.89543 38 4V5ZM44 5C45.1046 5 46 5.89543 46 7V12C46 13.1046 45.1046 14 44 14H36C34.8954 14 34 13.1046 34 12V7C34 5.89543 34.8954 5 36 5V4C36 1.79086 37.7909 0 40 0C42.2091 0 44 1.79086 44 4V5Z",fill:"white"}):null]})}v();var ai=(0,Cy.createContext)({isEditorModeEnabled:!1,canChangeLockedLayoutMode:!1}),{Provider:AP}=ai;function Sy({children:e}){let o=je.getCurrentRole(),t=!!(o&&o==="editor"),r=window.RM.constructorRouter.canChangeLockedLayoutMode();return n(AP,{value:{isEditorModeEnabled:t,canChangeLockedLayoutMode:r},children:e})}function Py({isActive:e,...o}){let t=e?"Layout locked":"Layout unlocked";return n(dt,{placement:"right",indent:8,leaveDelay:100,text:`${t} (L)`,instance:!0,children:n(Ze,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,onClick:()=>{let r=e?"editor":"member";window.RM.constructorRouter.changeEditorMode(r,!0)},"aria-label":t,...o,children:n(ji,{isActive:e})})})}Oe();_o();v();var Ty=({id:e="guideIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 24 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[w("line",{x1:"3",y1:"1",x2:"3",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"1",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"12",y1:"1",x2:"12",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"12",y1:"1",x2:"12",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"14",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"12",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("line",{x1:"21",y1:"1",x2:"21",y2:"25",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[n("animate",{attributeName:"x1",to:"23",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x1",to:"21",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"23",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"x2",to:"21",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};ct();v();function My({disableTooltip:e,width:o="100%",...t}){return n(ht,{targetSteps:"SelectGrids",indent:8,defaultText:"Grid and Layout",disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:n(Ze,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:o,height:"100%","aria-label":"Grid and Layout","data-testid":"guides-button",...t,children:n(Ty,{width:"24px",height:"26px",hoverBox:{width:56,height:56}})})})}var li=T(H());G();var Fs=T(et());Of();Tl();ct();ot();tt();function DP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{fill:"currentColor",d:"M0 0h1v20H0zM6 0h1v20H6zM9 0h1v20H9zM15 0h1v20h-1z"}})])]}var By={render:DP};function $P(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16",height:"20",xmlns:"http://www.w3.org/2000/svg"}},e.$listeners),[t("path",{attrs:{fill:"currentColor",opacity:"0.4",d:"M0 0h1v20H0z"}}),t("path",{attrs:{fill:"currentColor",d:"M6 0h1v20H6zM9 0h1v20H9z"}}),t("path",{attrs:{fill:"currentColor",opacity:"0.4",d:"M15 0h1v20h-1z"}})])]}var Iy={render:$P};function LP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"40px",viewBox:"0 0 16 40",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Shape")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-16.000000, -169.000000)",fill:"currentColor"}},[t("path",{attrs:{d:"M17,169 L16,169 L16,209 L17,209 L17,169 Z M22,169 L21,169 L21,209 L22,209 L22,169 Z M26,169 L27,169 L27,209 L26,209 L26,169 Z M32,169 L31,169 L31,209 L32,209 L32,169 Z",id:"Shape"}})])])])]}var zy={render:LP};function HP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Shape")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-17.000000, -230.000000)",fill:"currentColor"}},[t("path",{attrs:{d:"M33,230 L17,230 L17,231 L33,231 L33,230 Z M33,233 L17,233 L17,234 L33,234 L33,233 Z M17,236 L33,236 L33,237 L17,237 L17,236 Z M33,239 L17,239 L17,240 L33,240 L33,239 Z",id:"Shape"}})])])])]}var Ey={render:HP};function OP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 2")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-49.000000, -230.000000)",fill:"currentColor","fill-rule":"nonzero"}},[t("g",{attrs:{id:"Group-2",transform:"translate(49.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",x:"0",y:"0",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",opacity:"0.4",x:"0",y:"3",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",opacity:"0.4",x:"0",y:"6",width:"16",height:"1"}}),t("rect",{attrs:{id:"Rectangle",x:"0",y:"9",width:"16",height:"1"}})])])])])]}var Ry={render:OP};function NP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 3")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-97.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-3",transform:"translate(97.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.5",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"0",y:"0",width:"1",height:"10"}})])])])])]}var Ay={render:NP};function FP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 4")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-129.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-4",transform:"translate(129.000000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.5",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"0",y:"0",width:"16",height:"1"}})])])])])]}var Dy={render:FP};function WP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 6")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-193.000000, -230.000000)"}},[t("g",{attrs:{id:"Group-6",transform:"translate(193.500000, 230.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0",y:"0.5",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","fill-rule":"nonzero",x:"14.5",y:"0",width:"1",height:"10"}})])])])])]}var $y={render:WP};function UP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"16px",height:"10px",viewBox:"0 0 16 10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 5")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Grid-and-Guides-(Guides)",transform:"translate(-161.000000, -230.000000)",stroke:"#282828"}},[t("g",{attrs:{id:"Group-5",transform:"translate(161.250000, 230.500000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",opacity:"0.4",x:"0.25",y:"0",width:"15",height:"9"}}),t("rect",{attrs:{id:"Rectangle",fill:"currentColor","stroke-width":"0.5",x:"0",y:"8.75",width:"15.5",height:"1"}})])])])])]}var Ly={render:UP};function GP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"17px",height:"17px",viewBox:"0 0 17 17",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Artboard",transform:"translate(-33.000000, -58.000000)"}},[t("g",{attrs:{id:"[-Grid-Guides-Snap-Sizes-]",transform:"translate(34.000000, 9.914060)"}},[t("g",{attrs:{id:"Group",transform:"translate(0.000000, 49.000000)"}},[t("rect",{attrs:{id:"Rectangle",stroke:"currentColor",x:"0",y:"0",width:"15",height:"15"}}),t("path",{attrs:{d:"M4.5,0.5 L3.5,0.5 L3.5,3.5 L0.5,3.5 L0.5,4.5 L3.5,4.5 L3.5,10.5 L0.5,10.5 L0.5,11.5 L3.5,11.5 L3.5,14.5 L4.5,14.5 L4.5,11.5 L10.5,11.5 L10.5,14.5 L11.5,14.5 L11.5,11.5 L14.5,11.5 L14.5,10.5 L11.5,10.5 L11.5,4.5 L14.5,4.5 L14.5,3.5 L11.5,3.5 L11.5,0.5 L10.5,0.5 L10.5,3.5 L4.5,3.5 L4.5,0.5 Z M10.5,10.5 L10.5,4.5 L4.5,4.5 L4.5,10.5 L10.5,10.5 Z",id:"Shape","fill-opacity":"0.4",fill:"currentColor",opacity:"0.4"}})])])])])])]}var Hy={render:GP};function VP(){var e=this,o=e.$createElement,t=e._self._c||o;return[t("svg",e._g({attrs:{width:"17px",height:"17px",viewBox:"0 0 17 17",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e.$listeners),[t("title",[e._v("Group 2")]),t("g",{attrs:{id:"Page-1",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{id:"Artboard",transform:"translate(-33.000000, -9.000000)"}},[t("g",{attrs:{id:"Group-2",transform:"translate(34.000000, 9.914060)"}},[t("rect",{attrs:{id:"Rectangle","stroke-opacity":"0.4",stroke:"currentColor",opacity:"0.4",x:"0",y:"0",width:"15",height:"15"}}),t("path",{attrs:{d:"M4.5,0.5 L3.5,0.5 L3.5,3.5 L0.5,3.5 L0.5,4.5 L3.5,4.5 L3.5,10.5 L0.5,10.5 L0.5,11.5 L3.5,11.5 L3.5,14.5 L4.5,14.5 L4.5,11.5 L10.5,11.5 L10.5,14.5 L11.5,14.5 L11.5,11.5 L14.5,11.5 L14.5,10.5 L11.5,10.5 L11.5,4.5 L14.5,4.5 L14.5,3.5 L11.5,3.5 L11.5,0.5 L10.5,0.5 L10.5,3.5 L4.5,3.5 L4.5,0.5 Z M10.5,10.5 L10.5,4.5 L4.5,4.5 L4.5,10.5 L10.5,10.5 Z",id:"Shape",fill:"currentColor"}})])])])])]}var Oy={render:VP};Ku();ct();Zn();_r();yr();var jP={components:{RmSwitcher:Zl,NumericInput:xi,ColumnIcon:By,GutterIcon:Iy,GuideCount:zy,BaselineCount:Ey,BaselineSize:Ry,MarginLeft:Ay,MarginRight:$y,MarginBottom:Ly,MarginTop:Dy,HelpTourTooltip:Ir,GridOuter:Hy,GridInner:Oy},props:{workspace:{type:Object,default:null}},data:function(){let e=RM.constructorRouter.workspace.viewport,o=e==="default"||e==="phone_portrait",t=this.workspace.mag.get("opts");return{noHoverButtons:!1,loadedData:!1,selectedTab:"guides",index:1,baseline_height:0,baseline_group:0,gg:null,grids:null,guides:null,guidesData:{columns:0,padding:0,columnWidth:0,baseline_height:0,baseline_group:0,margin:{top:0,left:0,right:0,bottom:0},grid_step:8,grid_count:8},editParamsData:{grid:!1,snap:!1,guides:!1,sizes:!1},initialEditParamsDataForHelpTour:{grid:!1,snap:!1,guides:!0,sizes:!1},initialEditParamsDataForHelpTourIsSet:!1,viewportWidth:void 0,scaleEnabled:!1,viewport:e,customViewportWidthEnabled:o,scaleRatio:this.getScaleRatio(e),helpTourStep:"ChangeGrids",helpTourStepSnap:"ClickOnSnapButton",helpTourStepSizes:"ClickOnSizesButton",opts:{...t}}},computed:{baseline_group_h:function(){return this.baseline_group*this.baseline_height||0},grid_count_h:function(){return this.guidesData.grid_count*this.guidesData.grid_step||0},preciseColumnWidth(){return this.getPreciseColumnWidthByViewportWidth(this.viewportWidth)},isColumnWidthFloating(){return Math.round(this.preciseColumnWidth)!==this.preciseColumnWidth},minWidth(){return Ho.prototype.getViewportSetting("width",this.viewport)},maxWidth(){return Ho.prototype.getViewportSetting("max_width",this.viewport)},minColumnWidth(){return Math.max(Math.ceil(this.getPreciseColumnWidthByViewportWidth(this.minWidth)),0)},maxColumnWidth(){return Math.floor(this.getPreciseColumnWidthByViewportWidth(this.maxWidth))},isScaleLayout(){return this.opts.scalableviewer},isDesktopLayout(){return this.viewport==="default"}},watch:{editParamsData:{handler:function(){this.gg.mag.edit_params.set(this.editParamsData),this.saveParams()},deep:!0},guidesData:{handler:function(){this.gg.guides.model.set({...this.guidesData,margin:{...this.guidesData.margin}}),this.saveParams()},deep:!0},selectedTab:{handler:function(){this.gg.guides.model.set({...this.guidesData,selectedTab:this.selectedTab}),this.saveParams()}},index:function(){if(this.index===3&&Ie("ChangeGrids"),this.loadedData){let e;try{e=JSON.parse(window.sessionStorage.getItem("RM-lastUsedGuidesSet")||"{}"),e[RM.constructorRouter.workspace.page.get("mid")]=this.index}catch{e={},e[RM.constructorRouter.workspace.page.get("mid")]=this.index}window.sessionStorage.setItem("RM-lastUsedGuidesSet",JSON.stringify(e)),this.gg.guides.models.setPage(RM.constructorRouter.workspace.page,this.index),this.editParamsData.guides=!0}},baseline_height:function(e,o){e<8&&(this.baseline_height=o>e?0:8),this.guidesData.baseline_height=this.baseline_height},baseline_group:function(e,o){e<2&&(this.baseline_group=o>e?0:2),this.guidesData.baseline_group=this.baseline_group},viewportWidth(e,o){let t=this.workspace.viewport;if(o===void 0||e===o||!this.customViewportWidthEnabled)return;let r=Math.max(this.minWidth,Math.min(this.maxWidth,e));if(e!==r)this.viewportWidth=r;else{let i={default:"desktopWidth",phone_portrait:"phoneWidth",tablet_portrait:"tabletWidth"}[t];this.gg.mag.set({[i]:e}),this.saveViewportWidth(e);let s=RM.constructorRouter.zoom.getZoom(),a=RM.constructorRouter.workspace.$container[0],l=(o*s-window.innerWidth)/2,m=(e*s-window.innerWidth)/2;a.scrollLeft=(a.scrollLeft||0)+Math.max(m,0)-Math.max(l,0)}}},mounted:function(){this.gg=RM.constructorRouter.gg,this.gg.mag.edit_params.on("change",this.updateStateFromModel),this.gg.mag.on("change:phoneWidth change:desktopWidth",this.updateStateFromModel),this.gg.created?this.loadGuides():this.gg.on("create",this.loadGuides.bind(this)),this.workspace.mag.on("change:opts",this.handleChangeOpts),this.workspace.page.on("change:viewport",this.onChangeViewport),window.addEventListener("resize",this.onWindowResize)},destroyed(){Ng("ChangeGrids"),this.workspace.mag.off("change:opts",this.handleChangeOpts),this.workspace.page.off("change:viewport",this.onChangeViewport),this.gg.mag.edit_params.off("change",this.updateStateFromModel),this.gg.mag.off("change:phoneWidth change:desktopWidth",this.updateStateFromModel),window.removeEventListener("resize",this.onWindowResize),Ie("ChangeGrids")},methods:{increaseAnalyticsClickActionCounter(){Fe("click")},setOpts(e,o){let t={...this.workspace.mag.get("opts"),[e]:o};this.workspace.mag.set("opts",t),this.opts=t,this.saveOpts(t)},saveOpts:Fs.default.debounce(function(e){kg(RM.constructorRouter.mag.get("num_id"),e)},500),handleSetGridsClick(){this.index===3&&Ie("ChangeGrids")},getPreciseColumnWidthByViewportWidth(e){return(e-(this.guidesData.margin.left||0)-(this.guidesData.margin.right||0)-this.guidesData.padding*(this.guidesData.columns-1))/this.guidesData.columns},getViewportWidthByColumnWidth(e){return e*this.guidesData.columns+this.guidesData.padding*(this.guidesData.columns-1)+this.guidesData.margin.left+this.guidesData.margin.right},getViewportWidthByGutter(e,o){return o*this.guidesData.columns+e*(this.guidesData.columns-1)+this.guidesData.margin.left+this.guidesData.margin.right},handleChangeOpts:function(e,o){this.opts={...o}},loadGuides:function(){this.guides=this.gg.guides,this.guides.created||this.gg.guides.create(!1),this.guides.model&&(this.updateStateFromModel(),this.$nextTick(()=>{this.loadedData=!0})),this.guides.on("modelLoaded",e=>{this.updateStateFromModel(e),this.$nextTick(()=>{this.loadedData=!0})})},updateBaselineGroup:function(e){e>this.baseline_group_h?this.baseline_group++:e<this.baseline_group_h&&this.baseline_group--},updateGridCount:function(e){e>this.grid_count_h?this.guidesData.grid_count++:e<this.grid_count_h&&this.guidesData.grid_count--,this.guidesData.grid_count=Math.max(this.guidesData.grid_count,2)},updateStateFromModel:function(){let e=this.guides.model,o=$t(),t=o.started,r=t&&o.step.name==="ChangeGrids";!this.initialEditParamsDataForHelpTourIsSet&&t&&r?(this.initialEditParamsDataForHelpTourIsSet=!0,this.editParamsData.snap=this.initialEditParamsDataForHelpTour.snap,this.editParamsData.grid=this.initialEditParamsDataForHelpTour.grid,this.editParamsData.guides=this.initialEditParamsDataForHelpTour.guides,this.editParamsData.sizes=this.initialEditParamsDataForHelpTour.size):(this.editParamsData.snap=this.gg.mag.edit_params.get("snap"),this.editParamsData.grid=this.gg.mag.edit_params.get("grid"),this.editParamsData.guides=this.gg.mag.edit_params.get("guides"),this.editParamsData.sizes=this.gg.mag.edit_params.get("sizes")),this.viewportWidth=this.gg.mag.getViewportWidth(this.workspace.viewport),this.editParamsData.grid&&this.editParamsData.guides&&(this.editParamsData.grid=!1),this.index=e.get("index"),this.selectedTab=e.get("selectedTab"),this.guidesData.columns=e.get("columns"),this.guidesData.padding=e.get("padding"),this.baseline_height=e.get("baseline_height"),this.baseline_group=e.get("baseline_group")||0,this.guidesData.baseline_height=this.baseline_height,this.guidesData.baseline_group=this.baseline_group,this.guidesData.grid_step=e.get("grid_step")||8,this.guidesData.grid_count=e.get("grid_count")||8,this.guidesData.margin.top=e.get("margin").top,this.guidesData.margin.left=e.get("margin").left,this.guidesData.margin.right=e.get("margin").right,this.guidesData.margin.bottom=e.get("margin").bottom},onViewportWidthChange(e){this.viewportWidth!==e&&(this.guidesData.columnWidth=0,this.viewportWidth=e)},onGutterChange(e){this.guidesData.padding!==e&&(this.guidesData.columnWidth=0,this.guidesData.padding=e)},onColumnWidthChange(e){this.guidesData.columnWidth=e,this.viewportWidth=this.getViewportWidthByColumnWidth(e)},onColumnCountChange(e){this.guidesData.columns!==e&&(this.guidesData.columnWidth=0,this.guidesData.columns=e)},onLeftMarginChange(e){this.guidesData.margin.left!==e&&(this.guidesData.columnWidth=0,this.guidesData.margin.left=e)},onRightMarginChange(e){this.guidesData.margin.right!==e&&(this.guidesData.columnWidth=0,this.guidesData.margin.right=e)},saveParams:Fs.default.debounce(function(){Fs.default.isEmpty(this.gg.mag.edit_params.changed)||this.gg.mag.edit_params.save(),Fs.default.isEmpty(this.gg.guides.model.changed)||this.gg.guides.model.save()},200),saveViewportWidth:Fs.default.debounce(function(e){let o=this.workspace.viewport,t={default:"desktopWidth",phone_portrait:"phoneWidth",tablet_portrait:"tabletWidth"}[o];this.gg.mag.save({[t]:e},{patch:!0})},200),changeTab:function(e){this.selectedTab=e},setIndex:function(e){this.index=e,this.handleSetGridsClick()},toggleEditParam:function(e,o){o==="grid"&&(this.changeTab("grid"),this.editParamsData.guides=!1),o==="guides"&&(this.changeTab("guides"),this.editParamsData.grid=!1,ae(ce.SettingsViewer,{settingsType:"guides set"})),o==="snap"&&!e[o]&&Ie("ClickOnSnapButton"),o==="sizes"&&!e[o]&&Ie("ClickOnSizesButton"),this.increaseAnalyticsClickActionCounter(),e[o]=!e[o],this.noHoverButtons=!0},onChangeViewport(){let e=this.workspace.viewport;this.viewport=e,this.viewportWidth=this.gg.mag.getViewportWidth(e),this.scaleRatio=this.getScaleRatio(e)},getScaleRatio(e){return Math.round(il.getLimitedRatio(this.workspace.mag.getViewportWidth(e),this.workspace.mag.get("opts").scalewidth,Pe.dictionary.default.min_scale_width,!1)*100)},onWindowResize(){this.scaleRatio=this.getScaleRatio(this.viewport)},toggleScaleLayout(){this.setOpts("scalableviewer",!this.opts.scalableviewer),this.noHoverButtons=!0,ae(ce.SettingsViewer,{settingsType:"scale layout from guides"})},handleChangeScaleWidth(e){this.setOpts("scalewidth",e)}}},YP=function(){var e,o=this,t=o.$createElement,r=o._self._c||t;return r("transition",{attrs:{name:"wb-panel"}},[r("div",{staticClass:"guides-panel equal-columns",class:(e={},e[o.viewport]=!0,e),on:{click:function(i){return i.stopPropagation(),o.increaseAnalyticsClickActionCounter()}}},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStep,position:"top",indent:8,modifiers:[{name:"arrow",options:{padding:{left:170}}}]}}):o._e(),o._v(" "),r("div",{staticClass:"guides-panel-bg"},[r("div",{staticClass:"guides-panel-header"},[r("div",{staticClass:"type-selector"},[r("button",{class:{active:o.selectedTab==="guides"},on:{click:function(i){i.stopPropagation(),o.changeTab("guides"),o.increaseAnalyticsClickActionCounter()}}},[o._v(`
            Guides
          `)]),o._v(" "),r("button",{class:{active:o.selectedTab==="grid"},on:{click:function(i){i.stopPropagation(),o.changeTab("grid"),o.increaseAnalyticsClickActionCounter()}}},[o._v(`
            Grid
          `)])]),o._v(" "),r("div",{staticClass:"set-selector"},o._l([{value:1,title:"Set 1"},{value:2,title:"Set 2"},{value:3,title:"Set 3"}],function(i){return r("button",{key:i.value,class:{active:i.value===o.index},attrs:{"aria-label":i.title},on:{click:function(s){s.stopPropagation(),o.setIndex(i.value),o.increaseAnalyticsClickActionCounter()}}},[r("span")])}),0)]),o._v(" "),r("div",{staticClass:"scale-layout",class:{disabled:!o.isScaleLayout}},[r("div",{staticClass:"item"},[r("span",[o._v("Scale layout")]),o._v(" "),r("rm-switcher",{attrs:{value:o.isDesktopLayout?o.isScaleLayout:!0,width:40,height:24,"color-on":"#0080FF","color-off":"#B8B8B8",callback:o.toggleScaleLayout,"is-disabled":!o.isDesktopLayout}})],1),o._v(" "),r("div",{staticClass:"item"},[r("span",{staticClass:"caption"},[r("label",{attrs:{for:"scale-layout-width"}},[o._v("Limit scale at")])]),o._v(" "),r("div",[r("numeric-input",{staticClass:"numeric-input big-numberic-input",attrs:{id:"scale-layout-width","label-selector":"<.item","get-label":function(i){return i.find(".caption")},value:o.opts.scalewidth,min:1024,max:9999,disabled:!o.isScaleLayout||!o.isDesktopLayout},on:{change:o.handleChangeScaleWidth}})],1)]),o._v(" "),r("div",{staticClass:"item"},[r("div",[r("span",{directives:[{name:"show",rawName:"v-show",value:o.scaleEnabled&&!o.customViewportWidthEnabled,expression:"scaleEnabled && !customViewportWidthEnabled"}],staticClass:"gray"},[o._v("Scale layout")]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.customViewportWidthEnabled,expression:"customViewportWidthEnabled"}]},[o._v("Width")]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.customViewportWidthEnabled,expression:"customViewportWidthEnabled"}],staticClass:"gray"},[o._v(`
              `+o._s(o.guidesData.columnWidth||!o.isScaleLayout?"Centered":"Stretched")+`
            `)]),o._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:o.isScaleLayout&&o.isDesktopLayout,expression:"isScaleLayout && isDesktopLayout"}],staticClass:"scale-ratio gray"},[o._v(o._s(o.scaleRatio)+"%")])]),o._v(" "),r("div",[r("numeric-input",{staticClass:"numeric-input big-numberic-input",attrs:{min:o.minWidth,max:o.maxWidth,value:o.viewportWidth,"label-selector":"<.item","get-label":function(i){return i.children(":first")},disabled:!o.customViewportWidthEnabled},on:{change:o.onViewportWidthChange}})],1)])]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="grid",expression:"selectedTab === 'grid'"}],staticClass:"row row-big"},[r("div",{staticClass:"block block-grid-inner"},[r("GridInner",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input grid-inner",attrs:{min:4,max:Math.floor(999/o.guidesData.grid_count),"label-selector":".icon",dir:"v"},model:{value:o.guidesData.grid_step,callback:function(i){o.$set(o.guidesData,"grid_step",i)},expression:"guidesData.grid_step"}})],1),o._v(" "),r("div",{staticClass:"block block-grid-outer"},[r("GridOuter",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input grid-outer readonly",attrs:{"mouse-only":!0,min:o.guidesData.grid_step*2,max:Math.floor(999/o.guidesData.grid_step)*o.guidesData.grid_step,"label-selector":".icon",value:o.grid_count_h,dir:"v"},on:{change:function(i){return o.updateGridCount(i)}}})],1)]),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="guides",expression:"selectedTab === 'guides'"}],staticClass:"row row-big guide-row"},[r("div",{staticClass:"block block-guide-count"},[r("GuideCount",{staticClass:"guide-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input guide-count",attrs:{value:o.guidesData.columns,"label-selector":".icon",dir:"h",min:0,max:99},on:{change:o.onColumnCountChange}})],1),o._v(" "),[r("div",{staticClass:"block block-column-width"},[r("ColumnIcon",{staticClass:"column-icon icon",class:{disabled:!o.guidesData.columns},attrs:{title:"Column width"}}),o._v(" "),r("div",{staticClass:"guide-column-input-wrapper",class:{"is-auto":!o.guidesData.columns||o.guidesData.columns&&!o.guidesData.width&&o.isColumnWidthFloating,disabled:!o.guidesData.columns}},[r("numeric-input",{staticClass:"numeric-input guides-column-width",style:o.guidesData.columns?{}:{visibility:"hidden"},attrs:{value:o.guidesData.columns?o.guidesData.columnWidth||Math.round(o.preciseColumnWidth):0,"label-selector":"< .block-column-width","get-label":function(i){return i.find(".icon")},dir:"h",min:o.minColumnWidth,max:o.maxColumnWidth,disabled:!o.guidesData.columns,autosize:""},on:{change:o.onColumnWidthChange}})],1)],1),o._v(" "),r("div",{staticClass:"block block-guide-padding"},[r("GutterIcon",{staticClass:"gutter-icon icon",class:{disabled:o.guidesData.columns<2},attrs:{title:"Gutter"}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input guides-padding",attrs:{value:o.guidesData.padding,"label-selector":"< .block-guide-padding","get-label":function(i){return i.find(".gutter-icon")},dir:"h",min:0,max:999,disabled:o.guidesData.columns<2,autosize:""},on:{change:o.onGutterChange}})],1)]],2),o._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:o.selectedTab==="guides",expression:"selectedTab === 'guides'"}],staticClass:"guides-big-row-wrapper"},[r("div",{staticClass:"row guides-big-row"},[r("div",{staticClass:"block-small baseline"},[r("div",{staticClass:"block-small baseline-count"},[r("BaselineCount",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:Math.floor(999/o.baseline_group),"debounce-keyboard":500},model:{value:o.baseline_height,callback:function(i){o.baseline_height=i},expression:"baseline_height"}})],1),o._v(" "),r("div",{staticClass:"block-small",class:{disabled:o.baseline_height==0}},[r("BaselineSize",{staticClass:"svg-icon icon"}),o._v(" "),r("numeric-input",{staticClass:"numeric-input readonly",attrs:{"mouse-only":!0,"label-selector":".icon",value:o.baseline_group_h,min:0,max:Math.floor(999/o.baseline_height)*o.baseline_height},on:{change:o.updateBaselineGroup}})],1)]),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginLeft",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{value:o.guidesData.margin.left,"label-selector":".icon",dir:"h",min:0,max:999,disabled:!o.guidesData.columns},on:{change:o.onLeftMarginChange}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginTop",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:999,disabled:!o.guidesData.columns},model:{value:o.guidesData.margin.top,callback:function(i){o.$set(o.guidesData.margin,"top",i)},expression:"guidesData.margin.top"}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginBottom",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{"label-selector":".icon",min:0,max:999,disabled:!o.guidesData.columns},model:{value:o.guidesData.margin.bottom,callback:function(i){o.$set(o.guidesData.margin,"bottom",i)},expression:"guidesData.margin.bottom"}})],1),o._v(" "),r("div",{staticClass:"block-small"},[r("MarginRight",{staticClass:"svg-icon icon",class:{disabled:!o.guidesData.columns}}),o._v(" "),r("numeric-input",{staticClass:"numeric-input",attrs:{value:o.guidesData.margin.right,"label-selector":".icon",dir:"h",min:0,max:999,disabled:!o.guidesData.columns},on:{change:o.onRightMarginChange}})],1)])])]),o._v(" "),r("div",{staticClass:"buttons-wrapper"},[r("div",{staticClass:"button",class:{active:o.editParamsData.guides,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"guides")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticClass:"caption"},[o._v("Guides")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("H")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.grid,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"grid")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticClass:"caption"},[o._v("Grid")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("G")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.snap,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"snap")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticStyle:{position:"relative",top:"24px"}},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStepSnap,position:"left",indent:26}}):o._e()],1),o._v(" "),r("div",{staticClass:"caption"},[o._v("Snap")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("S")])]),o._v(" "),r("div",{staticClass:"button",class:{active:o.editParamsData.sizes,"no-hover":o.noHoverButtons},on:{click:function(i){return i.stopPropagation(),o.toggleEditParam(o.editParamsData,"sizes")},mouseleave:function(i){o.noHoverButtons=!1}}},[r("div",{staticStyle:{position:"relative",top:"24px"}},[o.loadedData?r("help-tour-tooltip",{attrs:{step:o.helpTourStepSizes,position:"left",indent:142}}):o._e()],1),o._v(" "),r("div",{staticClass:"caption"},[o._v("Sizes")]),o._v(" "),r("div",{staticClass:"letter"},[o._v("X")])])])],1)])},qP=[],XP=void 0,KP="data-v-272d8170",ZP=void 0,JP=!1;function QP(e,o,t,r,i,s,a,l,m,c){let p=(typeof t=="function"?t.options:t)||{};return p.__file="guides-panel.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),p._scopeId=r,p}var e6=QP({render:YP,staticRenderFns:qP},XP,jP,KP,JP,ZP,!1,void 0,void 0,void 0),Ny=e6;Gt();to();v();function Fy({children:e,button:o,...t}){let[r,i]=(0,li.useState)(!1),s=(0,li.useRef)(),a=(0,li.useRef)(null),{page:l}=(0,li.useContext)(Je);(0,li.useEffect)(()=>{if(r&&a.current){s.current&&si(s.current);let p={workspace:window.RM.constructorRouter.workspace};s.current=Ga(Ny,a.current,p)}else r||s.current&&si(s.current)},[a.current,r]);let m=c=>{i(c)};return n(Et,{name:"guides",skidding:28,button:o,onToggle:m,panelPosition:{height:"auto"},withArrow:!1,...t,children:n(f,{height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",ref:a},String(l?.id))})}Oe();_o();ct();v();var Wy=({id:e="helpIcon",width:o,height:t,hoverBox:r,margin:i})=>{let s=po(o,t,r);return w("svg",{xmlns:"http://www.w3.org/2000/svg",id:e,viewBox:"0 0 18 24",fill:"none",width:o,height:t,style:{padding:s,margin:i},children:[w("path",{d:"M0.000110626 5.92295L0.000648499 5.90145C0.17284 2.58286 2.52025 0 6.5589 0C10.3314 0 12.9769 2.41067 12.9769 5.60403C12.9769 7.92078 11.8186 9.56441 9.67399 10.9419C7.62336 12.2569 7.04417 13.1491 7.04417 14.8867V16.0607H7.04125C7.04 16.6329 6.57577 17.0963 6.00329 17.0963C5.43082 17.0963 4.96659 16.6329 4.96533 16.0607H4.96222V14.5893C4.94657 12.5073 5.85449 11.1924 8.06166 9.78357C10.034 8.49996 10.7697 7.41986 10.7697 5.69795C10.7697 3.47512 9.00088 1.86279 6.48063 1.86279C3.97604 1.86279 2.23848 3.42816 2.03498 5.90145H2.0299C2.03033 5.9136 2.03055 5.92581 2.03055 5.93806C2.03055 6.49879 1.576 6.95334 1.01527 6.95334C0.454554 6.95334 0 6.49879 0 5.93806L0.000110626 5.92295Z",fill:"currentColor",transform:"rotate(0, 5, 10)",children:[n("animateTransform",{attributeName:"transform",type:"rotate",from:"0, 5, 10",to:"45, 5, 10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"rotate",to:"0, 5, 10",from:"45, 5, 10",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),w("path",{d:"M6 24C4.89543 24 4 23.1046 4 22C4 20.8954 4.89543 20 6 20C7.10457 20 8 20.8954 8 22C8 23.1046 7.10457 24 6 24Z",fill:"currentColor",children:[n("animateTransform",{attributeName:"transform",type:"translate",to:"0 -3",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animateTransform",{attributeName:"transform",type:"translate",from:"0 -3",to:"0 0",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};v();function Uy({disabledTooltip:e,width:o="100%",...t}){return n(ht,{instance:!0,closeOnTargetClick:!0,targetSteps:"HelpButton",indent:8,defaultText:"Help",disabled:e,leaveDelay:100,children:n(Ze,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:o,"aria-label":"Help","data-testid":"help-button",onClick:()=>Ie("HelpButton"),...t,children:n(Wy,{width:"20px",height:"24px",hoverBox:{width:56,height:56}})})})}ve();var xu=T(H());G();Mr();ve();re();tt();var br=T(H());tt();G();var qa=T(H());var t6={analytics:!1,webWidget:{color:{theme:"#F8A42B"}}},o6="https://static.zdassets.com/ekr/snippet.js?key=",Gy=(e,o,t)=>{let r=typeof window<"u"&&typeof window.zE<"u",[i,s]=(0,qa.useState)(r?"ready":"idle");(0,qa.useEffect)(()=>{if(!e)return;if(!r&&i!=="loading"){let c=`${o6}${e}`;s("loading"),window.zESettings=t6;let p=document.createElement("script");p.src=c,p.async=!0,o&&Object.keys(o).forEach(u=>{p.setAttribute(u,o[u])}),p.addEventListener("load",m,{once:!0}),document.body.appendChild(p)}function m(c){s(c.type==="load"?"ready":"error")}},[e,o]),(0,qa.useEffect)(()=>{i==="ready"&&!window.zECBIsSet&&(window.zE("webWidget:on","userEvent",a),window.zECBIsSet=!0)},[i]);function a({action:m,properties:c}){m&&t?.(m.toLowerCase(),c)}function l(){i==="ready"&&window.zE("webWidget","toggle")}return{toggleWidget:l,isReady:i==="ready"}};pt();vi();sf();re();G();v();var r6=e=>n("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M84 80a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80zm0-16a4 4 0 110 8H4a4 4 0 110-8h80z",fill:"#F8A42B",fillRule:"evenodd"})}),i6=f.withComponent(Y(r6)`
      display: block;
    `),Vy=i6;G();ve();re();Ue();v();function n6({text:e,children:o,href:t,onClick:r,"data-testid":i,absoluteIcon:s,marginBottom:a}){return w(f,{as:"a",width:88,href:t,cursor:"pointer",marginBottom:a??"16px",onClick:l=>{r&&l.preventDefault(),r&&r()},"data-testid":i,display:"block",textDecoration:"none",textAlign:"left",target:"_blank",position:"relative",children:[n(f,{as:"span",css:te`
          &:hover {
            display: block;
            opacity: 0.8;
          }
        `,children:o}),n(I,{textStyle:"small",marginTop:"8px",color:"black",paddingTop:s?"100%":void 0,display:"block",css:te`
          &:hover {
            color: ${O.red};
          }
        `,children:e})]})}var Dr=n6;re();G();v();var s6=e=>n("svg",{width:88,height:88,fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0a6 6 0 00-6 6v76a6 6 0 006 6h76a6 6 0 006-6V6a6 6 0 00-6-6H6zm22 48a4 4 0 100-8 4 4 0 000 8zm36-4a4 4 0 11-8 0 4 4 0 018 0zm-20 4a4 4 0 100-8 4 4 0 000 8z",fill:"#B9B9B9"})}),a6=f.withComponent(Y(s6)`
      display: block;
    `),jy=a6;re();G();v();var l6=e=>n("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M80 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM64 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM48 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM32 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM16 4a4 4 0 118 0v80a4 4 0 11-8 0V4zM0 4a4 4 0 118 0v80a4 4 0 11-8 0V4z",fill:"#0080FF",fillRule:"evenodd"})}),p6=f.withComponent(Y(l6)`
      display: block;
    `),Yy=p6;re();G();v();var c6=e=>n("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M82 0a6 6 0 016 6v76a6 6 0 01-6 6H6a6 6 0 01-6-6V6a6 6 0 016-6h76zM52 28a8 8 0 00-8 8l-.004-.25A8 8 0 1036 44a8 8 0 107.996 8.25L44 52a8 8 0 108-8l.25-.004A8 8 0 0052 28z",fill:"#282828",fillRule:"evenodd"})}),d6=f.withComponent(Y(c6)`
      display: block;
    `),qy=d6;re();G();v();var m6=e=>n("svg",{width:88,height:88,fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0a6 6 0 00-6 6v76a6 6 0 006 6h76a6 6 0 006-6V6a6 6 0 00-6-6H6zm6 16a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm16 0a4 4 0 11-8 0 4 4 0 018 0zM16 28a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM16 44a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM16 60a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm16 0a4 4 0 100-8 4 4 0 000 8zM12 80a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm12 4a4 4 0 100-8 4 4 0 000 8zm20-4a4 4 0 11-8 0 4 4 0 018 0zm16 0a4 4 0 11-8 0 4 4 0 018 0z",fill:"#089400"})}),u6=f.withComponent(Y(m6)`
      display: block;
    `),wu=u6;re();G();v();var g6=e=>n("svg",{width:88,height:88,xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{d:"M82 0a6 6 0 016 6v76a6 6 0 01-6 6H6a6 6 0 01-6-6V6a6 6 0 016-6h76zM70.828 17.172a4 4 0 00-5.656 0l-48 48-.151.159a4 4 0 005.807 5.497l48-48 .151-.159a4 4 0 00-.15-5.497z",fill:"#EC520B",fillRule:"evenodd"})}),h6=f.withComponent(Y(g6)`
      display: block;
    `),Xy=h6;re();G();v();var f6=e=>w("svg",{width:88,height:99,viewBox:"0 0 88 99",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[n("path",{d:"M24.9965 97.0113V88H36.4219L26.7036 97.7184C26.0736 98.3483 24.9965 97.9022 24.9965 97.0113Z",fill:"#F8A42B"}),n("path",{d:"M0 6C0 2.68629 2.68629 0 6 0H82C85.3137 0 88 2.68629 88 6V82C88 85.3137 85.3137 88 82 88H6C2.68629 88 0 85.3137 0 82V6Z",fill:"#F8A42B"})]}),b6=f.withComponent(Y(f6)`
      display: block;
    `),Ky=b6;re();G();v();var w6=e=>n("svg",{width:88,height:88,viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C2.68629 0 0 2.68629 0 6V82C0 85.3137 2.68629 88 6 88H82C85.3137 88 88 85.3137 88 82V6C88 2.68629 85.3137 0 82 0H6ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM24 16C26.2091 16 28 14.2091 28 12C28 9.79086 26.2091 8 24 8C21.7909 8 20 9.79086 20 12C20 14.2091 21.7909 16 24 16ZM40 12C40 14.2091 38.2091 16 36 16C33.7909 16 32 14.2091 32 12C32 9.79086 33.7909 8 36 8C38.2091 8 40 9.79086 40 12Z",fill:"#00793F"})}),x6=f.withComponent(Y(w6)`
      display: block;
    `),Zy=x6;v();var Jy=`${oe.readymag_host}/learn`,Qy=`${oe.readymag_host}/templates`,v6="https://forum.readymag.com",e1="https://help.readymag.com",k6="https://help.readymag.com/hc/en-us/articles/360020647532-Shortcuts",y6={id:"ze-snippet"},_6=(e,o)=>{let t={"web widget opened":"zendesk_widget_opened","help center search":"zendesk_search","contact form submitted":"zendesk_widget_contact_submitted","help center article viewed":"zendesk_widget_article_viewed","help center view original article clicked":"zendesk_widget_original_article_clicked"},r={"web widget opened":void 0,"help center search":{search_term:o?.term,search_source:"zendesk_widget"},"contact form submitted":void 0,"help center article viewed":{page_title:o?.name},"help center view original article clicked":{page_title:o?.name}},i=t[e],s=r[e];i&&(window.gtag("event",i,s),e==="contact form submitted"&&ae(ce.Zendesk,{action:"ticket created",zone:"editor"}))},C6=({onHelpTourClick:e})=>{let[o,t]=(0,br.useState)(!1),{toggleWidget:r}=Gy(oe.zendeskApiKey,y6,_6),i=Cr("PageCanAddFromTemplate"),s=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"quick tour"}),e?.()},[]),a=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"shortcut"}),window.open(k6,"_blank")},[]),l=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"help page"}),window.open(e1,"_blank")},[]),m=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"rm updates"}),nf(!0)},[]),c=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"templates"}),i||window.open(Qy,"_blank")},[]),p=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"learn more"}),window.open(Jy,"_blank")},[]),u=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"forum"}),window.open(v6,"_blank")},[]),d=(0,br.useCallback)(()=>{ae(ce.EditorHelp,{action:"ask support"}),r()},[r]);return w(f,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",children:[n(Dr,{text:"Product tour","data-testid":"start-quick-tour",onClick:s,children:n(Yy,{})}),n(Dr,{text:"Ask support","data-testid":"open-support",onClick:d,absoluteIcon:!0,children:n(f,{position:"absolute",top:0,left:0,right:0,bottom:0,children:n(Ky,{})})}),n(Dr,{href:e1,text:"Help page","data-testid":"open-help",onClick:l,children:n(Vy,{})}),n(Dr,{text:"Shortcuts","data-testid":"show-shortcuts",onClick:a,children:n(qy,{})}),n(Dr,{onClick:u,text:"Forum","data-testid":"open-forum",children:n(Zy,{})}),i?n(vc,{isPopupShown:o,onChangePopupVisibility:t,margin:"0 0 16px",hoverColor:"rgb(8, 148, 0)",bottom:"142px",width:"220px",left:"-116px",placementStyles:"bottom: -8px; left: 152px;",analyticsZone:rl.EditorHelp,children:n(Dr,{marginBottom:0,text:"Templates","data-testid":"open-templates",onClick:c,children:n(wu,{})})}):n(Dr,{href:Qy,text:"Templates","data-testid":"open-templates",onClick:c,children:n(wu,{})}),n(Dr,{text:"R/m updates","data-testid":"open-updates",onClick:m,children:n(Xy,{})}),n(Dr,{href:Jy,text:"Learn more","data-testid":"open-learn",onClick:p,children:n(jy,{})})]})},t1=C6;Be();ao();ct();v();function S6({HelpPanelHeader:e=null,...o}){let t=(0,xu.useContext)(Te),r=$t();return w(f,{height:"100%",display:"flex",position:"relative",flexDirection:"column",padding:"28px 24px 32px",id:"help-panel",overflowY:"auto",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),...o,children:[n(dt,{text:"Here's a vast knowledge base for your future creativity",indent:24,placement:"left",open:r.modalStatus==="unshowWithTooltip",componentsProps:{tooltip:{backgroundColor:"blue"},arrow:{color:"blue"}},children:n("div",{children:e})}),n(t1,{onHelpTourClick:()=>{t.dispatch({type:"setOnboardingType",onboardingType:"tour"})}}),n(f,{display:"flex",flexDirection:"column",marginTop:"auto",gap:"2rm",children:n(f,{children:n(P6,{})})})]})}var P6=()=>{let e=(0,xu.useContext)(Te),o=t=>{t||(window.RM.constructorRouter.trigger("notice:hide"),window.RM.constructorRouter.trigger("notice:triggerEduTipClose")),e.dispatch({type:"toggleShowTips"}),ae(ce.SettingsGeneral,{settingsType:"contextual tips",toggle:`${t?"on":"off"}`,zone:"editor"})};return w(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[n(f,{children:n(I,{textStyle:"small",children:"Contextual tips"})}),n(f,{children:n(Ot,{backgroundChecked:"tomato",checked:e.showTips,onChange:o})})]})},o1=f.withComponent(S6);Pt();Ue();v();var T6=()=>n(Le,{lineHeight:"48px",color:"black",textStyle:"subheading",children:"Help"});function r1({children:e,button:o,name:t,...r}){return n(Et,{name:t,skidding:-84,button:o,ArrowProps:{stroke:Ee(.84,O.gray)},...r,children:n(o1,{width:"100%",borderRadius:"2rm",padding:"0 16px 16px 16px",border:"2px solid rgba(184, 184, 184, 0.16)",HelpPanelHeader:n(T6,{})})})}Oe();ao();v();var i1=({id:e="settingsIcon",width:o,height:t,hoverBox:r})=>{let i=po(o,t,r);return w("svg",{id:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:o,height:t,style:{padding:i},children:[n("rect",{x:"1",y:"1",width:"22",height:"8",rx:"4",stroke:"currentColor",strokeWidth:"2"}),w("circle",{cx:"5",cy:"5",r:"2",fill:"currentColor",children:[n("animate",{attributeName:"cx",to:"19",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"cx",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]}),n("rect",{x:"1",y:"15",width:"22",height:"8",rx:"4",stroke:"currentColor",strokeWidth:"2"}),w("circle",{cx:"19",cy:"19",r:"2",fill:"currentColor",children:[n("animate",{attributeName:"cx",to:"5",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseenter`,calcMode:"spline",keySplines:"0.42 0 1 1"}),n("animate",{attributeName:"cx",to:"19",dur:"0.2s",repeatCount:"1",fill:"freeze",begin:`${e}.mouseleave`,calcMode:"spline",keySplines:"0.42 0 1 1"})]})]})};v();function n1({width:e="100%",disableTooltip:o,tooltipText:t,...r}){return n(dt,{instance:!0,text:t,indent:8,open:o?!1:void 0,leaveDelay:100,closeOnTargetClick:!0,children:n(Ze,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:e,"aria-label":t,"data-testid":"projectSettings-button",...r,children:n(i1,{width:"24px",height:"24px",hoverBox:{width:56,height:56}})})})}var Xa=T(H());G();re();Gt();var Go=T(H());G();Oe();Br();Be();bl();pt();sn();go();ol();var s1=e=>e?tl(new Date(e),"d MMMM, yyyy"):"";jc();var a1=e=>gi.post("/api/featured/submit",{url:e}),l1=e=>gi.delete("/api/featured/submit",{url:e});tt();ar();bl();ao();ve();ve();re();v();function $n({children:e,...o}){return n(ne,{variant:"unstyled",display:"block",width:"100%",height:40,lineHeight:"40px",marginBottom:8,borderRadius:8,textStyle:"small",cursor:"pointer",color:"white",transition:".1s ease-in",userSelect:"none",...o,children:e})}var M6=()=>{let{isHovered:e,...o}=Ge(!1),{project:t}=(0,Go.useContext)(ie),r=ur(t),[i,s]=(0,Go.useState)(!!t?.submitted_for_featured),a=(0,Go.useMemo)(()=>{let u=window.RM.constructorRouter.me.get("stripe")||{};return u.subscription_status==="active"||u.subscription_status==="trialing"},[]),l=async(u,d)=>{try{await u(`${oe.readymag_host}/${t.num_id}/`),s(d),ae(ce.SettingsProject,{settingsType:`submit to examples ${d?"on":"off"}`})}catch{console.warn("sendToExamples error")}},m=()=>{if(!a){st("submit-to-examples");return}i?l(l1,!1):l(a1,!0)},c=w(I,{textStyle:"small",marginTop:8,marginBottom:8,children:["The R/m design team will review ",n("br",{}),"your website and email you ",n("br",{}),"if it is selected into"," ",n(Re,{isUnderlined:!0,color:"white",target:"_blank",rel:"noopener noreferrer",href:"https://readymag.com/examples",css:te`
          &:hover {
            color: white;
            text-decoration: none;
          }
        `,children:"Examples"})]}),p=w(I,{textStyle:"small",marginTop:8,marginBottom:8,children:["Revoke your submission",n("br",{}),"to Examples if you changed your mind"]});return r!=="unpublished"?n(K,{children:n(dt,{interactive:!0,text:i?p:c,indent:4,componentsProps:{tooltip:{width:186},arrow:{marginLeft:68}},children:n(f,{children:n($n,{onClick:m,backgroundColor:e?"tomato":"gray",...o,children:i?"Revoke submission":"Submit to Examples"})})})}):null};function B6(){let{isHovered:e,...o}=Ge(!1),{isHovered:t,...r}=Ge(!1),{isHovered:i,...s}=Ge(!1),a=(0,Go.useContext)(ie),l=ur(a.project),[m,c]=(0,Go.useState)(!1);return l==="unpublishedChanges"?m?w(f,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,children:[n($n,{onClick:a.restoreToPublished,backgroundColor:t?"tomato":"gray",...r,children:"Restore"}),n($n,{onClick:()=>c(!1),backgroundColor:i?"tomato":"gray",...s,children:"Cancel"})]}):n($n,{onClick:()=>c(!0),backgroundColor:e?"tomato":"gray",...o,children:e?s1(a.project.updated):"Restore to last published"}):null}function I6(){let{isHovered:e,...o}=Ge(!1),t=(0,Go.useContext)(ie),r=ur(t.project),i=(0,Go.useContext)(Te),{showNotice:s}=kl(),l=`${oe.readymag_viewer_host}/${t.project.user.uri}/${t.project.uri}/`,m=!t.isPublishError&&!t.publishInProgress&&r==="sameAsPublished",c=(0,Go.useCallback)(async()=>{if(r!=="sameAsPublished"&&!t.publishInProgress)try{await t.publishWithNotice({alsoExport:i.exportAsTemlate,dontRenewScreenshots:i.dontRenewScreenshots})}catch(d){if(d instanceof Kn&&d.type==="warning"){await t.publishWithNotice({skipWarnings:!0,alsoExport:i.exportAsTemlate,dontRenewScreenshots:i.dontRenewScreenshots});let g=["type-widget-shots","type-code-injection","type-widget-shots","type-widget-lottie"];d.tag&&g.includes(d.tag)?st("widgets"):st("default")}else if(d instanceof Kn){let g={canBeClosed:!0,closeByTimer:!0};d.tag==="type-publish-noemail"?s(d.message,g):d.tag==="type-publish-limit"?st("publish-limit"):d.tag==="type-publish-paused-subcription"?s(d.message,g):st("default")}else throw d}},[r,t.publishInProgress,i.exportAsTemlate]),p=r==="unpublished"||r==="unpublishedChanges",u=r==="unpublishedChanges";return m?n($n,{as:"a",href:l,target:"_blank",background:"transparent",color:"tomato",marginBottom:0,height:40,...o,children:e?"Open":"Published"}):n($n,{"data-testid":"publish-button",backgroundColor:p?"tomato":"transparent",color:p?"white":"tomato",onClick:c,marginBottom:0,height:r==="unpublished"?56:40,children:t.publishInProgress?n(f,{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",children:n(Xt,{size:u?24:28,bgColor:"transparent"})}):t.isPublishError?"Error":r==="unpublished"?"Publish":"Republish"})}function z6(){let{isHovered:e,...o}=Ge(!1),t=(0,Go.useContext)(ie);return ur(t.project)!=="unpublished"?n($n,{onClick:t.unpublish,backgroundColor:e?"tomato":"gray",...o,children:"Unpublish"}):null}function p1(){return n(f,{padding:"0 16px",children:w(f,{padding:"14px 0 16px",borderTop:"2px solid",borderTopColor:"gray",children:[n(M6,{}),n(B6,{}),n(z6,{}),n(I6,{})]})})}var Yi=T(H());G();ve();jr();var c1=T(H());G();Oe();ui();re();v();var d1=(0,c1.memo)(({isSomeSelected:e,isAllSelected:o,onDoneClick:t,onSelectAllClick:r,dividerColor:i,canUseEmailProtection:s,...a})=>{let l=Dt("viewer.emailProtection")&&s;return w(f,{display:"flex",height:88,paddingLeft:l?16:24,paddingRight:l?16:24,justifyContent:"center",alignItems:"center",position:"relative",...a,children:[!l&&n(f,{height:2,position:"absolute",top:-1,left:"8px",right:"8px",borderRadius:"2px",backgroundColor:i||"gray"}),n(ne,{"data-testid":l?"private-pages-select-all":"private-pages-done",textStyle:"small",color:l?"white":e?"tomato":"white",onClick:l?r:t,cursor:"pointer",backgroundColor:l?"tomato":"unset",borderRadius:l?"8px":"unset",height:l?"40px":"auto",width:l?"100%":"auto",marginBottom:l?16:0,css:te`
            &:hover,
            &:focus,
            &:active {
              color: ${l?"white":e?"tomato":"white"};
              opacity: 1;
            }
          `,children:l?"Protect the whole project":e?"Done":"Close"})]})});d1.displayName="PrivatePagesFooter";var m1=d1;var Ws=T(H());Be();G();Ue();pa();ve();v();var vu=(0,Ws.memo)(({page:e,level:o=0,childIndex:t,onSelectPage:r,viewport:i,...s})=>{let a=(0,Ws.useContext)(ie),l=!!(e.children&&e.children.length),m=(0,Ws.useMemo)(()=>a.pagesParams[e._id]?a.pagesParams[e._id].parentId?a.pagesParams[a.pagesParams[e._id].parentId].viewNum:a.pagesParams[e._id].viewNum:e.num,[e,o,a.pagesParams]),c=p=>{p.preventDefault(),r(e)};return w(f,{"data-pageid":e._id,...s,children:[n(f,{width:200,height:132,padding:"4px",borderRadius:"4px",position:"relative",boxShadow:e.isPrivate?`0 0 0 4px ${O.red}`:void 0,onClick:c,cursor:"pointer",transformOrigin:"left",overflow:"hidden",flex:"0 0 auto",transform:`scale(${o?"0.92":"1"})`,children:n(f,{width:192,height:124,backgroundColor:"darkGray",borderRadius:"4px",position:"relative",children:n(_i,{desktopUrl:e.screenshot,phonePortraitUrl:e.viewport_phone_portrait?.screenshot,tabletPortraitUrl:e.viewport_tablet_portrait?.screenshot,phoneViewportEnabled:e.viewport_phone_portrait?.enabled,tabletViewportEnabled:e.viewport_tablet_portrait?.enabled,viewport:i})})}),w(f,{display:"flex",marginBottom:l?"4px":void 0,marginTop:o>0?"-2px":"4px",marginLeft:"4px",children:[l&&n(f,{display:"flex",width:12,height:12,alignItems:"center",justifyContent:"center",zIndex:1,marginRight:"2px",marginTop:"2px",children:n(Do,{color:"white"})}),w(I,{textStyle:"small",color:"white",children:[m,t?`.${t}`:"",".\xA0",e.title?e.title:"Page Title"]})]}),e.children&&l?n(f,{children:e.children.map((p,u)=>n(vu,{page:p,level:o+1,childIndex:u+1,onSelectPage:r,marginLeft:(o+1)*16},p._id))}):null]})});vu.displayName="PrivatePage";var u1=vu;var pi=T(H());G();re();Be();v();var g1=(0,pi.memo)(({id:e,children:o,footer:t,footerHeight:r,...i})=>{let s=(0,pi.useContext)(Te),[a,l]=(0,pi.useState)(!1);(0,pi.useEffect)(()=>{s.isPrivatePagesOpened?(s.isPageSettingsOpened||s.isTrashOpened)&&(l(!0),setTimeout(()=>{s.dispatch({type:s.isPageSettingsOpened?"togglePageSettings":"toggleTrash"}),l(!1)},0)):a&&l(!1),s.isPrivatePagesOpened?document.body.classList.add("private-pages-is-opened"):document.body.classList.remove("private-pages-is-opened")},[s.isPrivatePagesOpened]),(0,pi.useEffect)(()=>{s.privatePageSelected&&m(s.privatePageSelected)},[s.privatePageSelected]);let m=c=>{if(!s.isPrivatePagesOpened)return;let p=document.getElementById("constructor-private-pages");if(!p)return;let u=p.querySelector(`[data-pageid="${c}"]`);u&&setTimeout(()=>{u.scrollIntoView({block:"center",behavior:"smooth"})},100)};return w(f,{id:e,height:"100%",width:240,paddingTop:0,backdropFilter:"blur(4px)",backgroundColor:Me("black",.96),zIndex:a?lo.sidebarZindex+1:lo.sidebarZindex,overflowX:"hidden",overflowY:"auto",...i,children:[n(f,{height:`calc(100% - ${r+(typeof r=="number"?"px":"")})`,overflow:"auto",children:o}),t({height:r})]})});g1.displayName="PrivatePagesPanel";var h1=g1;Be();to();v();var f1=(0,Yi.memo)(({children:e,...o})=>{let t=(0,Yi.useContext)(Te),r=(0,Yi.useContext)(ie),{viewport:i}=(0,Yi.useContext)(Je),s=d=>d.every(g=>g.isPrivate&&(g.children?s(g.children):!0)),[a,l]=(0,Yi.useState)(()=>s(r.pages)),m=r.pages.some(d=>d.isPrivate),c=d=>{r.setPageIsPrivate({pageId:d._id,isPrivate:!d.isPrivate})},p=()=>{t.isPrivatePagesOpened&&t.dispatch({type:"togglePrivatePages"})},u=()=>{l(!a),r.setPageIsPrivate({isPrivate:!a,updateAll:!0})};return n(h1,{id:"constructor-private-pages",borderRadius:"2rm",footerHeight:"56px",footer:({height:d})=>n(m1,{dividerColor:"rgba(128, 128, 128, 0.4)",height:d,isSomeSelected:m,isAllSelected:a,canUseEmailProtection:!!r.project.user?.permissions.can_make_mag_private_by_email,onDoneClick:p,onSelectAllClick:u}),...o,children:n(eo,{children:({ref:d})=>w(f,{ref:d,padding:"16px 16px 0 16px",children:[n(f,{display:"flex",alignItems:"center",height:"16px",marginBottom:"16px",children:n(I,{color:"white",textStyle:"subheading",textAlign:"left",children:"Select pages"})}),r.pagesTree.map(g=>n(u1,{page:g,onSelectPage:c,viewport:i,margin:"0 0 8px -4px"},g._id))]})})})});f1.displayName="PrivatePages";var b1=f1;Be();Pt();Ue();v();function w1({children:e,button:o,...t}){let r=(0,Xa.useContext)(Te),{openPanel:i}=(0,Xa.useContext)(kt),s=window?.location?.hash==="#settings-domain",a=s?3:void 0;return(0,Xa.useEffect)(()=>{s&&i("project-settings")},[]),w(Et,{name:"project-settings",skidding:-28,button:o,ArrowProps:{stroke:Ee(.84,O.gray)},...t,children:[n(Gi,{isOpen:r.isPrivatePagesOpened,direction:"right",children:n(b1,{})}),w(f,{display:"flex",height:"100%",flexDirection:"column",borderRadius:"2rm",backdropFilter:"blur(4px)",backgroundColor:Me("lightGray",.96),border:"2px solid rgba(184, 184, 184, 0.16)",zIndex:"1",children:[n(f,{display:"flex",minHeight:"calc(100% - 280px)",flexGrow:1,children:n(Gx,{exclude:["viewer"],defaultAccordionValue:a,renderButtonContainer:l=>n(f,{padding:"0 16px",children:l}),renderCollapseContainer:l=>n(f,{padding:"0 16px",children:l})})}),n(f,{children:n(p1,{})})]})]})}var x1=T(H());re();Oe();go();G();ve();v();var Ln=({text:e,backgroundColor:o="blue",width:t})=>n(f,{height:"56px",width:t,backgroundColor:o,borderRadius:8,padding:"0 16px",children:n(Le,{textStyle:"subheading",color:"white",lineHeight:"56px",userSelect:"none",children:e})});vi();v();var v1=()=>{let{isEditorModeEnabled:e,canChangeLockedLayoutMode:o}=(0,x1.useContext)(ai),[t]=Zt(),{isHovered:r,...i}=Ge(),s=Cr("CanUseDefaultMode")||o,a;return s?a=n(ne,{onClick:()=>{window.RM.constructorRouter.toggleSelfEditorMode()},...i,children:n(Ln,{width:179,text:r?"Unlock layout":"Layout locked",backgroundColor:Me("darkGray",.96)})}):a=n(Ln,{width:179,text:"Layout locked",backgroundColor:Me("darkGray",.96)}),e&&!t?a:null};Oe();ve();go();re();var _1=T(H());Oe();var qi=T(H());pf();vi();_o();ct();v();var Xi=(0,qi.createContext)({});function k1({children:e}){let o=window.RM.constructorRouter.gg,[t,r]=(0,qi.useState)(()=>!!o.mag.edit_params.get("blocks"));function i(){Ie("TurnOnTheBlocksMode"),window.RM.constructorRouter.toggleBlocksMode()}function s(a){r(a.get("blocks"))}return(0,qi.useEffect)(()=>(o.mag.edit_params.on("change:blocks",s),()=>{o.mag.edit_params.off("change:blocks",s)}),[]),n(Xi.Provider,{value:{isBlocksEnabled:t,toggleBlocks:i},children:e})}function y1(){let{toggleBlocks:e}=(0,qi.useContext)(Xi),o=Cr("CanUseBlocksMode"),t="Blocks (B)";return n(Vr,{permission:"CanUseBlocksMode",children:n(ht,{targetSteps:["TurnOnTheBlocksMode"],position:"left",indent:8,delay:1400,leaveDelay:100,defaultText:t,instance:!0,children:n(ne,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,"aria-label":t,onClick:e,disabled:!o,children:n(Ol,{})})})})}v();function C1(){let{isHovered:e,...o}=Ge(),{isBlocksEnabled:t,toggleBlocks:r}=(0,_1.useContext)(Xi);return t?n(ne,{onClick:()=>{r()},...o,children:n(Ln,{width:138,backgroundColor:Me("darkGray",.96),text:e?"Turn Off":w(K,{children:["Blocks"," ",n(I,{as:"span",textStyle:"subheading",color:"gray",children:"On"})]})})}):null}var Ka=T(H());var Rc=T(H());G();ve();Ue();re();Be();v();var E6=al`
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
`;function ku({index:e=0}){return n(f,{display:"inline",animation:`${E6} 2.4s infinite steps(1) ${e*.4}s`,children:"."})}function R6({iAmOwner:e,name:o,avatarUrl:t}){let r=(0,Rc.useContext)(ie),[i,s]=(0,Rc.useState)(!1);return w(Vp,{onMouseEnter:()=>e&&s(!0),onMouseLeave:()=>s(!1),position:"relative",width:"auto",paddingRight:"30px",css:te`
        &:hover {
          background: ${i?O.black:O.darkGray};
        }
      `,children:[n(zt,{size:"medium",url:t,name:o,width:"54px",height:"54px",marginLeft:"1rm"}),w(f,{display:"flex",flexDirection:"column",marginLeft:"16px",children:[n(I,{color:"white",lineHeight:"1",children:o}),w(I,{color:"gray",lineHeight:"1",children:["editing now",n(ku,{index:0}),n(ku,{index:1}),n(ku,{index:2})]})]}),i&&n(f,{color:"white",backgroundColor:"black",position:"absolute",left:0,right:0,top:0,bottom:0,borderRadius:"28px",lineHeight:"56px",textAlign:"center",onClick:()=>r.takeOverCurrentPage(),children:"Take Over"})]})}var S1=R6;Be();v();function P1(){let e=(0,Ka.useContext)(ie),{user:o}=(0,Ka.useContext)(tr),[t]=Zt(),r=(0,Ka.useMemo)(()=>{let i=e.lockedPages[e.currentPageId];return i&&i!==o?.uri?e.collaborators.find(s=>s.uri===i):void 0},[e.currentPageId,e.collaborators,e.lockedPages,o?.uri]);return!r||t?null:r&&n(S1,{iAmOwner:e.isOwner,name:r.name,avatarUrl:r.pic})}var T1=T(H());_o();ct();v();var M1=()=>{let e=(0,T1.useCallback)(()=>{Hg()},[]);return n(mf,{onStop:e})};var B1=T(H());Oe();go();re();v();function I1(){let[e,o]=Zt(),{isHovered:t,onMouseEnter:r,onMouseLeave:i}=Ge(!1);return(0,B1.useEffect)(()=>{e||i({})},[e,i]),e?n(Ze,{onClick:()=>o(!1),onMouseEnter:r,onMouseLeave:i,children:n(Ln,{width:148,backgroundColor:Me("darkGray",.96),text:t?"Turn off":"Comments"})}):null}cf();var Ki=T(H());G();go();Gt();var z1=T(H());v();var Ac=(0,z1.forwardRef)((e,o)=>n("svg",{width:"26",height:"26",viewBox:"0 0 26 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:o,...e,children:n("path",{d:"M25 13C25 19.6274 19.6274 25 13 25C9.41592 25 6.57143 25 1 25C0.999999 20.7143 1 16.0433 1 13C1 6.37258 6.37258 1 13 1C19.6274 1 25 6.37258 25 13Z",stroke:"currentColor",strokeWidth:"2"})}));G();Oe();ao();v();function Dc({onClick:e,tooltipPlacement:o="top",disableTooltip:t}){let[r]=Mi();return n(dt,{placement:o,disabled:t,indent:8,leaveDelay:100,text:"Comments (C)",instance:!0,closeOnTargetClick:!0,children:n(f,{position:"relative",children:n(ne,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,"aria-label":"Comments",onClick:e,children:n(Cn,{show:!!r.totalNew,offset:[-8,0],children:n(Ac,{})})})})})}var E1=T(H());ao();Oe();vi();v();function R1(){let{canChangeLockedLayoutMode:e}=(0,E1.useContext)(ai),o=Cr("CanUseDefaultMode")||e;return n(dt,{placement:"right",indent:8,leaveDelay:100,text:"Default (V)",instance:!0,children:n(Ze,{color:"white",display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",width:56,height:56,disabled:!o,onClick:()=>{window.RM.constructorRouter.disableCurrentMode()},"aria-label":"Default",children:n(ji,{})})})}v();function A6({children:e}){let{closePanels:o}=(0,Ki.useContext)(kt),{isHovered:t,...r}=Ge();return n(f,{width:"100%",textAlign:"center",children:n(f,{display:"inline-block",width:56,height:56,marginTop:8,borderRadius:8,background:t?"#282828":"#808080",transition:".2s ease",onClick:o,...r,children:e})})}function A1({children:e,button:o,hideButton:t=!1,...r}){let{isBlocksEnabled:i}=(0,Ki.useContext)(Xi),{isEditorModeEnabled:s}=(0,Ki.useContext)(ai),[a,l]=Zt(),m=(0,Ki.useCallback)(()=>{l(!a)},[a]),c=(0,Ki.useMemo)(()=>{let p={key:"enable-blocks",children:n(y1,{})},u={key:"enable-edit-role",children:n(Py,{isActive:!0})},d={key:"default-mode",children:n(R1,{})},g={key:"comments-mode",children:n(Dc,{tooltipPlacement:"right",onClick:m})};return a?[p,d,u]:i?[d,u,g]:s?[p,d,g]:[p,u,g]},[i,s,a,m]);return n(Et,{skidding:t?28:0,name:"modes",button:t?()=>n("div",{}):o,withArrow:!1,panelPosition:{width:56,height:"auto"},...r,width:t?"0px":r.width,children:c.map(p=>n(A6,{children:p.children},p.key))})}var Za=T(H());Oe();pf();rn();_o();ct();v();function D1({isPanelShown:e}){let{isBlocksEnabled:o}=(0,Za.useContext)(Xi),{isEditorModeEnabled:t}=(0,Za.useContext)(ai),[r]=Zt(),[i]=Mi();return(0,Za.useEffect)(()=>{e&&Ie("ClickOnModesIcon")},[e]),n(ht,{eduTips:"eduTipUseBlocks",targetSteps:["ClickOnModesIcon"],defaultText:"Modes",indent:8,disabled:e,leaveDelay:100,instance:!0,closeOnTargetClick:!0,children:n(ne,{display:"flex",alignItems:"center",justifyContent:"center",variant:"unstyled",height:"100%",width:"100%",position:"relative",color:"white","aria-label":"Modes","data-testid":"modes-button",children:n(Cn,{show:!!i.totalNew&&!e,offset:[2,10],children:r?n(Ac,{}):o?n(Ol,{withTransition:!0}):t?n(ji,{withTransition:!0,isActive:!0}):n(ji,{withTransition:!0,isActive:!1})})})})}var co=T(H());Pt();G();ve();Sr();G();re();v();var D6=qt(Y(f,{excludeProps:["isAbsolute"]})`
    width: 100%;
    height: 100%;
    overflow: hidden;
    ${e=>e.isAbsolute?"position: absolute":"position: relative"};
    top: 0;
    left: 0;
  `),$6=Y("div",{excludeProps:["color","speed"]})`
  width: 100%;
  height: 100%;
  transform: translateX(-100%);
  background-image: linear-gradient(
    90deg,
    ${e=>e.color?Me(e.color,0):Me("white",0)} 0,
    ${e=>e.color?Me(e.color,.2):Me("white",.2)} 20%,
    ${e=>e.color?Me(e.color,.6):Me("white",.6)} 65%,
    ${e=>e.color?Me(e.color,0):Me("white",0)}
  );
  background-repeat: no-repeat;
  animation: shimmerLoading ${e=>e.speed?e.speed:"2s"} infinite;
  @keyframes shimmerLoading {
    to {
      transform: translateX(100%);
    }
  }
`;function L6({isVisible:e,isAbsolute:o,color:t,speed:r}){return n(qo,{children:e&&n(D6,{initial:{opacity:1},exit:{opacity:0},isAbsolute:o,children:n($6,{color:t,speed:r})})})}var yu=L6;D2();Ue();var $1=T(H());Pt();G();Ue();re();v();var L1=(0,$1.forwardRef)(({children:e,backgroundColor:o,height:t,overflow:r,zIndex:i},s)=>n(f,{ref:s,display:"flex",height:t||"100%",borderRadius:"2rm",maxHeight:"inherit",flexDirection:"column",paddingBottom:2,color:"black",backgroundColor:Me(o||"lightGray",.96),backdropFilter:"blur(4px)",zIndex:i||"auto",boxShadow:`0 0 0 2px inset ${Ee(.84,O.gray)}`,overflow:r||"auto",children:e}));G();jr();var H1=T(H());Sr();G();$2();v();var H6=qt(f),O6={open:{height:"auto"},collapsed:{height:0}};function O1({duration:e,ease:o="easeOut",variants:t=O6,isVisible:r,children:i,...s}){let a=(0,H1.useRef)(null),l=yh(a);return n(H6,{initial:r?"open":"collapsed",animate:r?"open":"collapsed",inherit:!1,variants:t,overflow:"hidden",transition:{ease:o,duration:typeof e=="number"?e:N6(l.height)/1e3},...s,children:typeof i=="function"?i(a):n("div",{ref:a,children:i})})}function N6(e){if(!e)return 0;let o=e/36;return Math.round((4+15*o**.25+o/5)*10)}v();function N1({children:e,isCollapsed:o,onScroll:t,initialScrollTop:r}){function i(s){r&&s.scrollTo({top:r})}return n(eo,{onScroll:t,onFirstRender:i,children:({ref:s})=>n(f,{ref:s,flex:1,padding:"0 8px",children:n(O1,{duration:.2,isVisible:!o,children:e})})})}Gt();Be();to();ot();v();var F6={status:"unresolved"},W6=()=>{let e=sessionStorage.getItem(Ad);return e?Number(e):(window.innerHeight||600)/3*2},U6=()=>n(f,{width:"100%",height:"100%",padding:"0 24px 0 16px",display:"flex",alignItems:"center",children:n(Le,{color:"darkGray",textStyle:"small",children:"Click anywhere on the page to leave a comment"})});function F1({children:e,button:o,...t}){let{openPanel:r,closePanels:i,currentPanel:s}=(0,co.useContext)(kt),{pages:a,me:l,owner:m,projectTeam:c,changeWorkspace:p,project:u}=(0,co.useContext)(ie),{page:d,setViewport:g}=(0,co.useContext)(Je),[h]=yw(),b=h!=="loaded"&&h!=="error",x=Cp(F6),[y]=Mi(),[S,k]=Xr(),P=(0,co.useRef)(0);(0,co.useEffect)(()=>{s===void 0&&!S?r("comments"):s==="comments"&&S&&!S.fromList&&i()},[s,S]);let C=(0,co.useCallback)((se,ee)=>{let ue=se.parentComment??se.comment;if(ee==="selected"){k(null);return}(ue.viewport==="default"||d?.getViewportParam(ue.viewport,"enabled"))&&requestAnimationFrame(()=>{g(ue.viewport)}),requestAnimationFrame(()=>{p({id:ue.pageId}),k({comment:ue,fromList:!0})})},[d,g]),B=(0,co.useCallback)(se=>{let ee=se.parentComment??se.comment;k({comment:ee,fromList:!0})},[]);function $(se){se&&S&&!S.fromList&&k({comment:S.comment,fromList:!0})}let[A,R]=(0,co.useState)(W6()),Z=(0,co.useCallback)(se=>{R(se),sessionStorage.setItem(Ad,`${se}`)},[]),F=(0,co.useRef)(null),{isResizable:V,onMouseDown:W}=kh({ref:F,min:215,max:()=>window.innerHeight-32-72,onResizeComplete:Z,initialHeight:A,direction:vh.reverse}),J=(0,co.useRef)(document.getElementById("main"));(0,co.useLayoutEffect)(()=>(V?(J.current?.classList.remove("comment-cursor"),J.current?.classList.add("resize-comment-panel")):(J.current?.classList.remove("resize-comment-panel"),J.current?.classList.add("comment-cursor")),()=>{J.current?.classList.remove("resize-comment-panel")}),[V]);function me(se){se.stopPropagation(),s==="comments"?r("modes"):s==="modes"?r("comments"):s===void 0&&(r("comments"),S&&k({comment:S.comment,fromList:!0}))}return n(Et,{skidding:82,button:o,name:"comments",isAutoHeight:!0,closeOnOutsideClick:!1,ArrowProps:{stroke:Ee(.84,O.gray)},disableInteractions:V,onToggle:$,"data-testid":"comment-panel",onButtonClick:me,...t,children:w(L1,{ref:F,height:A,zIndex:1,overflow:"hidden",children:[n(f,{width:"100%",padding:"4px 0 8px 0",display:"flex",justifyContent:"center",alignItems:"center",cursor:"row-resize",onMouseDown:W,children:n(f,{width:24,height:4,borderRadius:8,backgroundColor:"gray"})}),x.length===0?n(U6,{}):n(N1,{initialScrollTop:P.current,onScroll:se=>{P.current=se.target.scrollTop},children:n(hs,{me:l,owner:m,projectTeam:c,viewState:y,children:n(em,{children:x.map(se=>{let ee=a.find(ue=>ue._id===se.pageId);return ee?n(za,{readonly:se.isTmp,comment:se,projectNumId:u.num_id,selected:S?.comment?._id===se._id,page:ee,onClick:C,onStartEditing:B},se._id):null})})})}),n(yu,{isVisible:b,isAbsolute:!0})]})})}_r();yr();v();var W1=()=>{let{currentPanel:e}=(0,_u.useContext)(kt),o=(0,_u.useContext)(Je),[t,r]=Zt();return Rr("c",{activeOnLock:!0,handler:()=>{r(!t)}}),Rr("l",{handler:()=>{window.RM.constructorRouter.toggleSelfEditorMode()}}),Rr("b",{handler:()=>{window.RM.constructorRouter.toggleBlocksMode()}}),o.page?n(f,{right:16,height:56,bottom:16,zIndex:3020,gap:16,position:"absolute",onClick:()=>{Fe("click")},children:n(f,{display:"flex",gap:"2rm",height:56,alignItems:"flex-end",children:n(k1,{children:w(Sy,{children:[n(G6,{}),n(Ec,{width:224,height:56,display:"flex",borderRadius:"8px",backgroundColor:Me("darkGray",.96),children:w(is,{children:[n(A1,{width:"56px",height:"100%",hideButton:t,button:({isPanelShown:i})=>n(D1,{isPanelShown:i})}),t?n(F1,{width:"56px",height:"100%",button:({isPanelShown:i})=>n(Dc,{disableTooltip:i||e==="modes"})}):null,n(Vr,{permission:"GridsAndGuidesCanUse",children:n(mn,{disabled:t,children:n(Fy,{width:"56px",height:"100%",button:({isPanelShown:i})=>n(My,{width:"56px",disableTooltip:i})})})}),n(mn,{disabled:t,children:n(w1,{width:"56px",button:({isPanelShown:i})=>n(n1,{tooltipText:"Project settings",width:"56px",disableTooltip:i})})}),n(mn,{disabled:t,children:n(r1,{name:"help",width:"56px",button:({isPanelShown:i})=>n(Uy,{disabledTooltip:i,width:"56px"})})})]})}),n(f,{children:n(jp,{})})]})})})}):null},G6=()=>w(K,{children:[n(Nl,{}),n(M1,{}),n(C1,{}),n(v1,{}),n(I1,{}),n(P1,{})]});G();var $r=T(H());G();ve();Oe();Xo();N2();ld();Ue();re();v();var V6={connection:`Seems there is a connection problem. Changes may not be saved until this
  alert disappears.`,socket:"You have been disconnected from the server.",duplicate:`It seems like you\u2019ve opened this project in another tab or browser. We\u2019ve
  interrupted this session in order to avoid conflicting copies.`,none:"unknown alert"};function j6({zIndex:e=lo.popupZindex,...o}){let[t,r]=(0,$r.useState)("none"),[i,s]=(0,$r.useState)(null),[a,l]=(0,$r.useState)(null),[m,c]=(0,$r.useState)(!0),{styles:p,attributes:u,update:d}=rs(i,a,{placement:"top"}),g=(0,$r.useMemo)(()=>V6[t],[t]),h=t==="socket",b=t!=="none";(0,$r.useEffect)(()=>{let y=()=>r("connection"),S=()=>r("socket"),k=()=>r("none");return window.RM.constructorRouter.on("showConnectionAlert",y),window.RM.constructorRouter.on("showSocketConnectionAlert",S),window.RM.constructorRouter.on("hideConnectionAlert",k),window.RM.constructorRouter.on("hideSocketConnectionAlert",k),()=>{window.RM.constructorRouter.off("showConnectionAlert",y),window.RM.constructorRouter.off("showSocketConnectionAlert",S),window.RM.constructorRouter.off("hideConnectionAlert",k),window.RM.constructorRouter.off("hideSocketConnectionAlert",k)}},[]),(0,$r.useEffect)(()=>{d&&d()},[t]);let x=()=>{h||c(!m)};return b?n(K,{children:w(f,{display:"flex",zIndex:e,...o,children:[m&&w(f,{width:276,padding:16,marginBottom:18,borderRadius:"4px",textAlign:"center",backgroundColor:"white",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.08)",ref:l,style:p.popper,...u.popper,children:[n(f,{children:n(I,{display:"block",textStyle:"regular",children:g})}),h&&n(ne,{marginTop:12,width:88,height:38,borderRadius:"4px",backgroundColor:"tomato",color:"white",css:te`
                  &:hover {
                    color: ${O.white};
                    background: ${O.black};
                  }
                `,onClick:()=>window.location.reload(),children:"Reload"})]}),n(f,{ref:s,children:n(mt,{height:56,width:56,marginRight:0,color:"tomato",disabled:h,onClick:x,children:n(Nh,{color:"white"})})})]})}):null}var U1=f.withComponent(j6);_r();yr();v();function G1(){return n(f,{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",zIndex:3e3,onClick:()=>{Fe("click")},children:n(U1,{})})}Gt();sf();v();function V1(){let{currentPanel:e,isVisible:o}=(0,$c.useContext)(kt),[t,r]=rf(),i=s=>{s.stopPropagation(),r(!1)};return(0,$c.useEffect)(()=>{let s=["modes","guides","project-settings","help"],a=e!==void 0&&s.includes(e);window.RM.constructorRouter.toggleHideControls(a)},[e]),o?w(K,{children:[n(_y,{}),n(G1,{}),n(W1,{}),t?n(Up,{defaultIsOpen:!0,onClose:i}):null]}):null}dn();var ci=T(H());var Lr=T(H());re();tt();G();ve();gn();Oe();Br();o_();Ue();ct();Gt();_r();yr();Vc();Be();wo();v();var Us=Y(ne)`
  display: flex;
  justify-content: center;
  align-items: center;

  width: 244px;
  height: 56px;

  border-radius: 8px;

  color: ${({theme:e})=>e.colors.white};
`,j1=Y(ne)`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 160px;
  border-radius: 16px;
  padding: 16px;
  color: white;
  cursor: pointer;
  &:hover {
    color: white;
  }
  &:hover path {
    fill: white;
  }
  &:disabled {
    opacity: 1;
  }
`,q6=()=>n("svg",{width:"76",height:"76",viewBox:"0 0 76 76",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M33.0394 0.321083C34.6638 0.109189 36.3197 0 38 0C39.6803 0 41.3362 0.109189 42.9606 0.321084C44.0559 0.463955 44.828 1.46768 44.6851 2.56297C44.5423 3.65827 43.5385 4.43035 42.4432 4.28748C40.9899 4.09791 39.5069 4 38 4C36.4931 4 35.0101 4.09791 33.5568 4.28748C32.4615 4.43035 31.4577 3.65826 31.3149 2.56297C31.172 1.46768 31.9441 0.463955 33.0394 0.321083ZM49.9329 3.96559C50.356 2.94527 51.5261 2.46114 52.5465 2.88425C55.6369 4.16578 58.5207 5.84286 61.1349 7.85178C62.0107 8.52483 62.1751 9.78044 61.5021 10.6563C60.829 11.5321 59.5734 11.6965 58.6976 11.0235C56.3573 9.22509 53.7773 7.72493 51.0143 6.57915C49.9939 6.15604 49.5098 4.98591 49.9329 3.96559ZM26.0671 3.96559C26.4902 4.98591 26.0061 6.15604 24.9857 6.57915C22.2227 7.72493 19.6427 9.22509 17.3024 11.0235C16.4266 11.6965 15.171 11.5321 14.4979 10.6563C13.8249 9.78044 13.9893 8.52483 14.8651 7.85178C17.4793 5.84286 20.3631 4.16578 23.4535 2.88425C24.4738 2.46114 25.644 2.94527 26.0671 3.96559ZM10.6563 14.4979C11.5321 15.171 11.6965 16.4266 11.0235 17.3024C9.22509 19.6427 7.72493 22.2227 6.57915 24.9857C6.15604 26.0061 4.98591 26.4902 3.96559 26.0671C2.94527 25.644 2.46114 24.4738 2.88425 23.4535C4.16578 20.3631 5.84286 17.4793 7.85178 14.8651C8.52483 13.9893 9.78044 13.8249 10.6563 14.4979ZM65.3437 14.4979C66.2196 13.8249 67.4752 13.9893 68.1482 14.8651C70.1571 17.4793 71.8342 20.3631 73.1158 23.4535C73.5389 24.4738 73.0547 25.644 72.0344 26.0671C71.0141 26.4902 69.844 26.0061 69.4208 24.9857C68.2751 22.2227 66.7749 19.6427 64.9765 17.3024C64.3035 16.4266 64.4679 15.171 65.3437 14.4979ZM2.56297 31.3149C3.65827 31.4577 4.43035 32.4615 4.28748 33.5568C4.09791 35.0101 4 36.4931 4 38C4 39.5069 4.09791 40.9899 4.28748 42.4432C4.43035 43.5385 3.65826 44.5423 2.56297 44.6851C1.46768 44.828 0.463955 44.0559 0.321083 42.9606C0.109189 41.3362 0 39.6803 0 38C0 36.3197 0.109189 34.6638 0.321084 33.0394C0.463955 31.9441 1.46768 31.172 2.56297 31.3149ZM73.437 31.3149C74.5323 31.172 75.536 31.9441 75.6789 33.0394C75.8908 34.6638 76 36.3197 76 38C76 39.6803 75.8908 41.3362 75.6789 42.9606C75.536 44.0559 74.5323 44.828 73.437 44.6851C72.3417 44.5423 71.5696 43.5385 71.7125 42.4432C71.9021 40.9899 72 39.5069 72 38C72 36.4931 71.9021 35.0101 71.7125 33.5568C71.5696 32.4615 72.3417 31.4577 73.437 31.3149ZM3.96559 49.9329C4.98591 49.5098 6.15604 49.9939 6.57915 51.0143C7.72493 53.7773 9.22509 56.3573 11.0235 58.6976C11.6965 59.5734 11.5321 60.829 10.6563 61.5021C9.78044 62.1751 8.52483 62.0107 7.85178 61.1349C5.84286 58.5207 4.16578 55.6369 2.88425 52.5465C2.46114 51.5262 2.94527 50.356 3.96559 49.9329ZM72.0344 49.9329C73.0547 50.356 73.5389 51.5261 73.1158 52.5465C71.8342 55.6369 70.1571 58.5207 68.1482 61.1349C67.4752 62.0107 66.2196 62.1751 65.3437 61.5021C64.4679 60.829 64.3035 59.5734 64.9765 58.6976C66.7749 56.3573 68.2751 53.7773 69.4208 51.0143C69.844 49.9939 71.0141 49.5098 72.0344 49.9329ZM14.4979 65.3437C15.171 64.4679 16.4266 64.3035 17.3024 64.9765C19.6427 66.7749 22.2227 68.2751 24.9857 69.4208C26.0061 69.844 26.4902 71.0141 26.0671 72.0344C25.644 73.0547 24.4738 73.5389 23.4535 73.1158C20.3631 71.8342 17.4793 70.1571 14.8651 68.1482C13.9893 67.4752 13.8249 66.2196 14.4979 65.3437ZM61.5021 65.3437C62.1751 66.2196 62.0107 67.4752 61.1349 68.1482C58.5207 70.1571 55.6369 71.8342 52.5465 73.1158C51.5262 73.5389 50.356 73.0547 49.9329 72.0344C49.5098 71.0141 49.9939 69.844 51.0143 69.4208C53.7773 68.2751 56.3573 66.7749 58.6976 64.9765C59.5734 64.3035 60.829 64.4679 61.5021 65.3437ZM31.3149 73.437C31.4577 72.3417 32.4615 71.5696 33.5568 71.7125C35.0101 71.9021 36.4931 72 38 72C39.5069 72 40.9899 71.9021 42.4432 71.7125C43.5385 71.5696 44.5423 72.3417 44.6851 73.437C44.828 74.5323 44.0559 75.536 42.9606 75.6789C41.3362 75.8908 39.6803 76 38 76C36.3197 76 34.6638 75.8908 33.0394 75.6789C31.9441 75.536 31.172 74.5323 31.3149 73.437Z",fill:"white"})}),X6=()=>n("svg",{width:"76",height:"76",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n("path",{d:"M72 36C72 55.8823 55.8823 72 36 72C16.1177 72 0 55.8823 0 36C0 16.1177 16.1177 0 36 0C55.8823 0 72 16.1177 72 36Z",fill:"white"})}),K6=()=>n("svg",{width:"76",height:"76",viewBox:"0 0 76 76",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M56 4C57.1438 4 58.2574 4.1197 59.3298 4.34656C60.4105 4.57516 61.4718 3.88444 61.7004 2.80378C61.929 1.72313 61.2383 0.661766 60.1577 0.433161C58.8147 0.149073 57.4237 0 56 0C54.5848 0 53.2018 0.14731 51.8662 0.428123C50.7853 0.655401 50.0933 1.71592 50.3205 2.79685C50.5478 3.87778 51.6083 4.56981 52.6893 4.34253C53.7558 4.11828 54.863 4 56 4ZM20 4C21.137 4 22.2442 4.11828 23.3107 4.34253C24.3917 4.56981 25.4522 3.87779 25.6795 2.79685C25.9067 1.71592 25.2147 0.655402 24.1338 0.428123C22.7982 0.14731 21.4152 0 20 0C18.5763 0 17.1853 0.149073 15.8423 0.433161C14.7617 0.661766 14.0709 1.72313 14.2996 2.80378C14.5282 3.88444 15.5895 4.57516 16.6702 4.34656C17.7426 4.1197 18.8562 4 20 4ZM47.9261 3.78403C47.3268 2.8562 46.0887 2.58992 45.1609 3.18926C42.8227 4.69971 40.8203 6.68432 39.2892 9.00773C38.6814 9.93004 38.9364 11.1704 39.8587 11.7782C40.781 12.386 42.0214 12.1311 42.6292 11.2088C43.8552 9.3484 45.4593 7.75851 47.3313 6.54921C48.2592 5.94987 48.5255 4.71185 47.9261 3.78403ZM28.0739 3.78403C27.4745 4.71185 27.7408 5.94987 28.6687 6.54922C30.5407 7.75852 32.1448 9.3484 33.3708 11.2088C33.9786 12.1311 35.219 12.386 36.1413 11.7782C37.0636 11.1704 37.3186 9.93005 36.7108 9.00774C35.1797 6.68433 33.1773 4.69971 30.8391 3.18927C29.9113 2.58992 28.6732 2.8562 28.0739 3.78403ZM64.1282 3.81125C63.5257 4.73706 63.7879 5.97596 64.7137 6.57841C66.5924 7.80094 68.1991 9.4076 69.4216 11.2863C70.024 12.2121 71.2629 12.4743 72.1888 11.8718C73.1146 11.2694 73.3767 10.0305 72.7742 9.10464C71.2473 6.75819 69.2418 4.75265 66.8954 3.22575C65.9695 2.6233 64.7306 2.88544 64.1282 3.81125ZM11.8718 3.81125C11.2694 2.88544 10.0305 2.6233 9.10464 3.22575C6.75819 4.75265 4.75265 6.75819 3.22575 9.10464C2.6233 10.0305 2.88544 11.2694 3.81125 11.8718C4.73706 12.4743 5.97596 12.2121 6.57841 11.2863C7.80094 9.4076 9.4076 7.80094 11.2863 6.57841C12.2121 5.97596 12.4743 4.73706 11.8718 3.81125ZM38.0148 21.8353C36.9112 21.8439 36.0092 20.9569 35.9993 19.8533C35.9892 18.717 35.8608 17.611 35.6267 16.5463C35.3895 15.4675 36.0717 14.4007 37.1505 14.1634C37.4398 14.0998 37.7282 14.1023 38 14.1609C38.2718 14.1023 38.5602 14.0998 38.8495 14.1634C39.9283 14.4006 40.6105 15.4675 40.3733 16.5463C40.1392 17.611 40.0108 18.717 40.0007 19.8533C39.9909 20.9434 39.11 21.8246 38.0204 21.8352M73.1962 14.2996C72.1156 14.5282 71.4248 15.5895 71.6534 16.6702C71.8803 17.7426 72 18.8562 72 20C72 21.137 71.8817 22.2442 71.6575 23.3107C71.4302 24.3917 72.1222 25.4522 73.2031 25.6795C74.2841 25.9067 75.3446 25.2147 75.5719 24.1338C75.8527 22.7982 76 21.4152 76 20C76 18.5763 75.8509 17.1853 75.5668 15.8423C75.3382 14.7617 74.2769 14.0709 73.1962 14.2996ZM2.80379 14.2996C1.72313 14.071 0.661766 14.7617 0.433159 15.8423C0.149071 17.1853 0 18.5763 0 20C0 21.4237 0.149071 22.8147 0.433159 24.1577C0.661766 25.2383 1.72313 25.9291 2.80379 25.7004C3.88444 25.4718 4.57516 24.4105 4.34656 23.3298C4.1197 22.2574 4 21.1438 4 20C4 18.8562 4.1197 17.7426 4.34656 16.6702C4.57516 15.5895 3.88444 14.5282 2.80379 14.2996ZM38.0182 21.8353C38.0182 21.8353 38.0182 21.8353 38.0182 21.8353ZM38.0182 21.8353C38.0177 21.8353 38.0172 21.8353 38.0167 21.8353ZM38.0167 21.8353C38.0166 21.8353 38.0164 21.8353 38.0162 21.8353ZM72.216 28.0739C71.2881 27.4745 70.0501 27.7408 69.4508 28.6687C68.2415 30.5407 66.6516 32.1448 64.7912 33.3708C63.8689 33.9786 63.614 35.219 64.2218 36.1413C64.8296 37.0636 66.07 37.3186 66.9923 36.7108C69.3157 35.1797 71.3003 33.1773 72.8107 30.8391C73.4101 29.9113 73.1438 28.6732 72.216 28.0739ZM3.81125 28.1282C2.88544 28.7306 2.6233 29.9695 3.22575 30.8954C4.75266 33.2418 6.75819 35.2473 9.10464 36.7743C10.0305 37.3767 11.2694 37.1146 11.8718 36.1888C12.4743 35.2629 12.2121 34.024 11.2863 33.4216C9.4076 32.1991 7.80094 30.5924 6.57841 28.7137C5.97596 27.7879 4.73706 27.5257 3.81125 28.1282ZM61.8366 37.1505C61.5994 36.0717 60.5325 35.3895 59.4537 35.6267C58.389 35.8608 57.283 35.9892 56.1467 35.9993C55.0566 36.0091 54.1754 36.89 54.1648 37.9796C54.1647 37.9803 54.1647 37.981 54.1647 37.9818M61.8366 37.1505C61.9002 37.4398 61.8977 37.7282 61.8391 38ZM61.8391 38C61.8977 38.2718 61.9002 38.5602 61.8366 38.8495C61.5993 39.9283 60.5325 40.6105 59.4537 40.3733C58.389 40.1392 57.283 40.0108 56.1467 40.0007C55.0431 39.9908 54.1561 39.0888 54.1647 37.9852M54.1647 37.9838C54.1647 37.9833 54.1647 37.9829 54.1647 37.9824ZM21.9822 38.8386C21.883 39.0537 21.7454 39.2514 21.574 39.4213C21.195 39.7969 20.6816 40.0055 20.1481 40.0007L20.1086 40.0004C20.0971 40.0003 20.0856 40.0001 20.0741 39.9998C20.0626 40 20.051 40.0001 20.0395 40L20 40C18.8562 40 17.7426 40.1197 16.6702 40.3466C15.5895 40.5752 14.5282 39.8844 14.2996 38.8038C14.2417 38.5302 14.2427 38.2579 14.2941 38C14.2427 37.7421 14.2417 37.4698 14.2996 37.1962C14.5282 36.1156 15.5895 35.4248 16.6702 35.6534C17.7426 35.8803 18.8562 36 20 36L20.0395 36C20.051 35.9999 20.0626 36 20.0741 36.0002C20.0856 35.9999 20.0971 35.9997 20.1086 35.9996L20.1481 35.9993C20.6816 35.9945 21.195 36.2031 21.5739 36.5787C21.7373 36.7406 21.8699 36.9278 21.9679 37.1311C22.0674 37.3376 22.1312 37.5609 22.1553 37.7912C22.159 37.8272 22.1618 37.8633 22.1636 37.8995C22.165 37.9268 22.1658 37.9543 22.1661 37.9818M22.1631 38.1116C22.1488 38.3699 22.0855 38.6154 21.9822 38.8386ZM22.1631 38.1116C22.1651 38.0748 22.1661 38.0378 22.1661 38.0008C22.1661 38.0003 22.1661 37.9998 22.1661 37.9993C22.1661 37.9993 22.1661 37.9993 22.1661 37.9992C22.1661 37.9943 22.1661 37.9893 22.1661 37.9843C22.1661 37.9838 22.1661 37.9833 22.1661 37.9828C22.1661 37.9827 22.1661 37.9826 22.1661 37.9825M11.8718 39.8112C11.2694 38.8854 10.0305 38.6233 9.10464 39.2257C6.75819 40.7527 4.75266 42.7582 3.22575 45.1046C2.6233 46.0305 2.88544 47.2694 3.81125 47.8718C4.73706 48.4743 5.97596 48.2121 6.57841 47.2863C7.80094 45.4076 9.4076 43.8009 11.2863 42.5784C12.2121 41.976 12.4743 40.7371 11.8718 39.8112ZM64.2218 39.8587C63.614 40.781 63.8689 42.0214 64.7912 42.6292C66.6516 43.8552 68.2415 45.4593 69.4508 47.3313C70.0501 48.2592 71.2881 48.5254 72.216 47.9261C73.1438 47.3268 73.4101 46.0887 72.8107 45.1609C71.3003 42.8227 69.3157 40.8203 66.9923 39.2892C66.0699 38.6814 64.8296 38.9364 64.2218 39.8587ZM2.80379 50.2996C1.72313 50.0709 0.661766 50.7617 0.433159 51.8423C0.149071 53.1853 0 54.5763 0 56C0 57.4237 0.149071 58.8147 0.433159 60.1577C0.661766 61.2383 1.72313 61.9291 2.80379 61.7004C3.88444 61.4718 4.57516 60.4105 4.34656 59.3298C4.1197 58.2574 4 57.1438 4 56C4 54.8562 4.1197 53.7426 4.34656 52.6702C4.57516 51.5895 3.88444 50.5282 2.80379 50.2996ZM73.2031 50.3205C72.1222 50.5478 71.4302 51.6083 71.6575 52.6893C71.8817 53.7558 72 54.863 72 56C72 57.1438 71.8803 58.2574 71.6534 59.3298C71.4248 60.4105 72.1156 61.4718 73.1962 61.7004C74.2769 61.9291 75.3382 61.2383 75.5668 60.1577C75.8509 58.8147 76 57.4237 76 56C76 54.5848 75.8527 53.2018 75.5719 51.8662C75.3446 50.7853 74.2841 50.0933 73.2031 50.3205ZM36.5787 54.426C36.2031 54.805 35.9945 55.3184 35.9993 55.8519L35.9996 55.8914C35.9997 55.9029 35.9999 55.9144 36.0002 55.9259C36 55.9374 35.9999 55.949 36 55.9605L36 56C36 57.1438 35.8803 58.2574 35.6534 59.3298C35.4248 60.4105 36.1156 61.4718 37.1962 61.7004C37.4698 61.7583 37.7421 61.7573 38 61.7059C38.2579 61.7573 38.5302 61.7583 38.8038 61.7004C39.8844 61.4718 40.5752 60.4105 40.3466 59.3298C40.1197 58.2574 40 57.1438 40 56L40 55.9605C40.0001 55.949 40 55.9374 39.9998 55.9259C40.0001 55.9144 40.0003 55.9029 40.0004 55.8914L40.0007 55.8519C40.0055 55.3184 39.7969 54.805 39.4213 54.4261C39.2594 54.2627 39.0722 54.1301 38.8689 54.0321C38.6596 53.9313 38.4332 53.8671 38.1996 53.8438C38.1395 53.8378 38.079 53.8345 38.0182 53.8339L38.0175 53.8339M36.5787 54.426C36.7486 54.2546 36.9463 54.117 37.1614 54.0178ZM37.1614 54.0178C37.3717 53.9208 37.5986 53.8604 37.8322 53.8408C37.8875 53.8362 37.9433 53.8339 37.9992 53.8339M72.1888 64.1282C71.2629 63.5257 70.024 63.7879 69.4216 64.7137C68.1991 66.5924 66.5924 68.1991 64.7137 69.4216C63.7879 70.024 63.5257 71.2629 64.1282 72.1888C64.7306 73.1146 65.9695 73.3767 66.8954 72.7742C69.2418 71.2473 71.2473 69.2418 72.7743 66.8954C73.3767 65.9695 73.1146 64.7306 72.1888 64.1282ZM39.8112 64.1282C38.8854 64.7306 38.6233 65.9695 39.2257 66.8954C40.7527 69.2418 42.7582 71.2474 45.1046 72.7742C46.0305 73.3767 47.2694 73.1146 47.8718 72.1888C48.4743 71.2629 48.2121 70.024 47.2863 69.4216C45.4076 68.1991 43.8009 66.5924 42.5784 64.7137C41.976 63.7879 40.7371 63.5257 39.8112 64.1282ZM36.1888 64.1282C35.2629 63.5257 34.024 63.7879 33.4216 64.7137C32.1991 66.5924 30.5924 68.1991 28.7137 69.4216C27.7879 70.024 27.5257 71.2629 28.1282 72.1888C28.7306 73.1146 29.9695 73.3767 30.8954 72.7742C33.2418 71.2474 35.2473 69.2418 36.7743 66.8954C37.3767 65.9695 37.1146 64.7306 36.1888 64.1282ZM3.81125 64.1282C2.88544 64.7306 2.6233 65.9695 3.22575 66.8954C4.75265 69.2418 6.75819 71.2473 9.10464 72.7742C10.0305 73.3767 11.2694 73.1146 11.8718 72.1888C12.4743 71.2629 12.2121 70.024 11.2863 69.4216C9.4076 68.1991 7.80094 66.5924 6.57841 64.7137C5.97596 63.7879 4.73706 63.5257 3.81125 64.1282ZM61.7004 73.1962C61.4718 72.1156 60.4105 71.4248 59.3298 71.6534C58.2574 71.8803 57.1438 72 56 72C54.8562 72 53.7426 71.8803 52.6702 71.6534C51.5895 71.4248 50.5282 72.1156 50.2996 73.1962C50.071 74.2769 50.7617 75.3382 51.8423 75.5668C53.1853 75.8509 54.5763 76 56 76C57.4237 76 58.8147 75.8509 60.1577 75.5668C61.2383 75.3382 61.9291 74.2769 61.7004 73.1962ZM25.7004 73.1962C25.4718 72.1156 24.4105 71.4248 23.3298 71.6534C22.2574 71.8803 21.1438 72 20 72C18.8562 72 17.7426 71.8803 16.6702 71.6534C15.5895 71.4248 14.5282 72.1156 14.2996 73.1962C14.0709 74.2769 14.7617 75.3382 15.8423 75.5668C17.1853 75.8509 18.5763 76 20 76C21.4237 76 22.8147 75.8509 24.1577 75.5668C25.2383 75.3382 25.9291 74.2769 25.7004 73.1962Z",fill:"white"})}),Z6=()=>n("svg",{width:"76",height:"76",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M36.0007 17.8353C36.0891 7.97004 44.1138 0 54 0C63.9411 0 72 8.05887 72 18C72 27.8862 64.03 35.9109 54.1647 35.9993C54.1647 35.9998 54.1646 36.0002 54.1646 36.0007C64.03 36.0891 72 44.1138 72 54C72 63.9411 63.9411 72 54 72C44.0589 72 36 63.9411 36 54C36 63.9411 27.9411 72 18 72C8.05888 72 0 63.9411 0 54C0 44.0589 8.05888 36 18 36C8.05888 36 0 27.9411 0 18C0 8.05887 8.05888 0 18 0C27.8862 0 35.9109 7.97005 35.9993 17.8354C35.9998 17.8354 36.0002 17.8353 36.0007 17.8353ZM18.1661 35.9992C18.1108 35.9997 18.0554 36 18 36C18.0554 36 18.1108 36.0003 18.1661 36.0008C18.1661 36.0003 18.1661 35.9997 18.1661 35.9992ZM35.9992 53.8339C35.9997 53.8892 36 53.9446 36 54C36 53.9446 36.0003 53.8892 36.0008 53.8339C36.0003 53.8339 35.9997 53.8339 35.9992 53.8339Z",fill:"white"})});function Y1({modalStatus:e,onClose:o,onStart:t,onEnd:r}){let[i,s]=(0,Lr.useState)(!1),[a,l]=(0,Lr.useState)(e),{togglePanel:m}=(0,Lr.useContext)(kt),[c,p]=(0,Lr.useState)(!1),[u,d]=(0,Lr.useState)(!1),{pages:g,deletePage:h}=(0,Lr.useContext)(ie),b=$t();(0,Lr.useEffect)(()=>{l(e)},[e]);let x=a!=="unshow"&&a!=="unshowWithTooltip";if(!x)return null;let y=async(W,J="tour")=>{Fe("click"),g.length>1&&(window.RM.constructorRouter.workspace.deleteBlocks(window.RM.constructorRouter.workspace.getAllBlocks("text")),window.RM.constructorRouter.workspace.deleteBlocks(window.RM.constructorRouter.workspace.getAllBlocks("shape")),await h(g[g.length-1]._id));try{s(!0),await t(W,J)}finally{s(!1)}},S=()=>{switch(Fe("click"),a){case"closing":b.started?sr("unshow"):sr("start");break;case"start":b.step?sr("closing"):r();break;default:r()}},k=()=>{Fe("click");let W=b.tourType==="pro"?"helpTourProLeave":"helpTourLeave";ae(W,{step:b.step}),b.started?r():o()},P=()=>{r(),Fe("click")},C=()=>{Fe("click"),r(),y("pro","hidden")},B=()=>{Fe("click"),m("help",!1),r(!0)},$=n(f,{display:"flex",alignItems:"center",justifyContent:"center",width:64,height:64,borderRadius:"50%",backgroundColor:O.blue,children:n(Dh,{color:O.white,width:39,height:28})}),A=()=>{switch(a){case"start":return`Get familiar with Readymag's
 toolbox on a step-by-step
 project in 10 minutes`;case"closing":return"Leaving the tour for now?";default:return"Congratulations!"}},R=()=>{switch(a){case"start":return`You\u2019ll go through the main steps
of crafting and publishing a
web page in just 5 minutes.`;case"closing":return`If you ever wish to revisit or need
guidance on specific features, the '?'
panel in project settings is always
there to help`;default:return b.tourType==="default"?`You can finish the basic tour now
or continue grasping more features
in the advanced one`:`Now you know how to set up
a project of your own. If you have any
questions, click on the Help section
for a wide knowledge base`}},Z=()=>a==="closing"?n(f,{marginTop:24,display:"flex",flexDirection:"column",children:i?n(Xt,{bgColor:"transparent"}):w(K,{children:[n(Us,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:S,children:"Resume tour"}),n(Us,{disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:k,marginTop:"4rm",children:"Explore on my own"})]})}):n(f,{marginTop:a==="start"?24:32,display:"flex",flexDirection:"column",children:a==="start"?w(f,{display:"flex",justifyContent:"space-between",width:336,children:[w(j1,{disabled:i,backgroundColor:"#00A882",onClick:()=>{y("default")},onMouseEnter:()=>{p(!0)},onMouseLeave:()=>{p(!1)},children:[n(f,{marginBottom:16,children:c?n(X6,{}):n(q6,{})}),n(Le,{fontSize:16,marginBottom:4,children:"Just basics"}),w(Le,{fontSize:12,textAlign:"center",children:["Learn how to add ",n("br",{})," and tune essential ",n("br",{})," widgets, arrange ",n("br",{})," the layout for desktop ",n("br",{})," ","and mobile"]})]}),w(j1,{disabled:i,backgroundColor:"#0080FF",onClick:()=>{y("pro")},onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},children:[n(f,{marginBottom:16,children:u?n(Z6,{}):n(K6,{})}),n(Le,{fontSize:16,marginBottom:4,children:"A bit more"}),w(Le,{fontSize:12,textAlign:"center",children:["Go deeper into the ",n("br",{})," features: work further ",n("br",{})," with grids, add ",n("br",{})," animations and ",n("br",{})," ","navigation elements"]})]})]}):b.tourType==="pro"?w(K,{children:[n(Us,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:P,children:"Start own journey"}),n(Us,{marginTop:"4rm",disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:B,children:"Learn further with us"})]}):w(K,{children:[n(Us,{disabled:i,variant:"clean",backgroundColor:"#0A85FF",onClick:C,children:"Start advanced tour"}),n(Us,{marginTop:"4rm",disabled:i,variant:"clean",backgroundColor:"rgba(255, 255, 255, 0.1)",onClick:P,children:"Set off on my own journey"})]})}),F=!b.started&&a==="closing"?()=>null:S,V=b.started||a!=="closing";return w(kf,{showCloseButton:V,show:x,onExit:F,children:[a==="end"&&$,n(Le,{id:"help-tour-title",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:24,height:a==="end"?"auto":88,margin:a==="end"?"32px 0 12px":"auto",color:O.white,children:A()}),a!=="start"&&n(Le,{id:"help-tour-text",display:"flex",alignItems:"center",textAlign:"center",whiteSpace:"pre-wrap",fontSize:16,height:a==="end"?"auto":62,color:O.gray,children:R()}),Z()]})}ct();Vc();Be();Kc();v();var J6=e=>({template:e.page_id,specialScreenshot:e.thumb}),Lc=()=>{let e=(0,ci.useContext)(Te),o=(0,ci.useContext)(ie),[{modalStatus:t}]=Qn();(0,ci.useEffect)(()=>{e.currentOnboardingType==="tour"&&sr("start"),e.currentOnboardingType==="templates"&&Zc("templates",{headlessMode:!0})},[e.currentOnboardingType]);let r=(0,ci.useCallback)(l=>{Og(),l?sr("unshowWithTooltip"):sr("unshow"),e.dispatch({type:"setOnboardingType",onboardingType:"hidden"})},[]),i=(0,ci.useCallback)(()=>{r()},[]),s=async l=>{if(l?.templates?.length)for(let m=0;m<=l.templates.length-1;m++)await o.addNewPage(o.currentPageNum+m,J6(l.templates[m]))},a=(0,ci.useCallback)(async(l,m="tour")=>{try{let c=await Pg(l);await s(c),e.dispatch({type:"setOnboardingType",onboardingType:m}),Zc(l)}catch{sr("unshow")}},[]);return n(Y1,{modalStatus:t,onClose:i,onStart:a,onEnd:r})};var wr=T(H());Gn();G();re();Gt();to();ot();v();var Q6=Y(f,{excludeProps:["isVisible"]})`
  z-index: 3000;
  position: relative;
  transition: opacity 0.3s ease, transform 0.3s ease;
  opacity: ${e=>e.isVisible?1:0};
  transform: translateY(${e=>e.isVisible?"0":"2px"});
`;function eT(e){if(!(e.target instanceof HTMLElement))return!1;let o=e.target;return!!(o.tagName.toLowerCase()==="input"||o.dataset&&o.dataset.text||o.tagName.toLowerCase()==="textarea"&&!o.classList.contains("copyhack")||o.getAttribute("contenteditable"))}var Cu=30;function tT(e,o){return Math.abs(o.x-e.x)>=Cu||Math.abs(o.y-e.y)>=Cu}function q1({children:e,scrollGap:o}){let{viewport:t}=(0,wr.useContext)(Je),[r,i]=(0,wr.useState)(!0),[s]=af(),a=(0,wr.useRef)(0).current,l=(0,wr.useRef)(0).current,m=(0,wr.useRef)({x:0,y:0}).current,c=!!s.name;return t==="phone_portrait"&&(c=!0),(0,wr.useEffect)(()=>{c&&i(!0);let p=document.getElementById("main"),u=Fc(()=>{if(!p)return;let g=p.scrollTop;g>l||(a=g);let b=g-a;Math.abs(g-l)>50&&i(!(b>o)),l=g},200),d=Fc(g=>{let h={x:g.clientX,y:g.clientY},b=Math.sqrt(Math.pow(h.x-m.x,2)+Math.pow(h.y-m.y,2));tT(m,h)&&b>=Cu&&i(!0),m=h},100);return c||(p?.addEventListener("scroll",u,!1),document.addEventListener("mousemove",d,!1)),()=>{p?.removeEventListener("scroll",u,!1),document.removeEventListener("mousemove",d,!1)}},[c]),(0,wr.useEffect)(()=>{function p(d){r||d.key!=="Tab"||eT(d)||(d.preventDefault(),d.stopPropagation(),i(!0))}let u=document.querySelector("body");return c||u.addEventListener("keydown",p),()=>{u.removeEventListener("keydown",p)}},[r,c]),n(Q6,{isVisible:r,children:e})}ar();v();function oT({router:e,constructorMagModel:o}){let{inPreview:t}=Dg(),r=e.workspace?n(kd,{router:e,children:n(q1,{scrollGap:210,children:n(V1,{})})}):null,i=e.preview?n(dh,{constructorMagModel:o,router:e.preview,children:n(sc,{position:"fixed",bottom:16,right:16,zIndex:3e3})}):null;return t?i:r}var Su=(e,{router:o,project:t,fromPreview:r})=>{let i=new Backbone.Model({isVisible:!0});function s(){X1.default.render(n(vr,{withGlobalStyles:!1,children:n(Jn,{router:o,project:t,inPreview:r,children:n(da,{router:o,widgetbar:i,children:n(vl,{magModel:t,router:o,children:w(Gp,{userModel:o.me,children:[n(oT,{constructorMagModel:t,router:o}),n(f,{id:"settings-popup-container",position:"absolute",top:"0",left:"0",zIndex:"8000",width:"100%"}),n(Lc,{}),n(yf,{})]})})})})}),e)}return s(),{show(){i.set({isVisible:!0})},hide(){i.set({isVisible:!1})},setWorkspace(a){i.set({workspace:a})},isVisible(){return i.get("isVisible")},rerender(){s()}}};J2();k_();y_();gf();Z2();var s2=T(cl());G();ta();Be();Gt();dn();var xr=T(H());wo();Sr();G();Gc();ot();zl();dn();wi();na();M2();B2();I2();w2();Zn();var Hc=e=>{let o=e.pages.reduce((t,r)=>{let i=r.wids.filter(s=>s.is_global);return t.concat(i)},[]);return{...e,pages:e.pages.map(t=>{let r={...t,widgets:t.wids};return delete r.wids,r}),hasSummary:!0,globalWidgets:o.filter(t=>!t.is_above),aboveAllWidgets:o.filter(t=>t.is_above)}};sd();var Hr=T(H());wo();dn();nn();E2();v();var rT=e=>e.globalWidgets.find(o=>o.get("type")==="ecommercecart"),K1=({constructorProject:e,children:o})=>{let{project:t,setProject:r,page:i,postViewerAction:s}=(0,Hr.useContext)(kr),[a]=(0,Hr.useState)(()=>rT(e)),l=(0,Hr.useCallback)(c=>{if(!t||!a)return;a.save(c),a.hasChanged()&&e.set("changed",!0);let p=t.globalWidgets.map(g=>g.type==="ecommercecart"?{...g,...c}:g);r({...t,globalWidgets:p});let[u,d]=Object.entries(c)[0]||[];u==="bar-auto-open"&&s({type:"changeSetting",key:u,value:d})},[t]),[m]=(0,Hr.useState)(()=>{if(!a)return;let c=new va({numId:e.attributes.num_id,ecommerceData:e.attributes.ecommerce_data,isPublished:!1,isDownloadedSource:!1}),p=new Backbone.Model({block:{model:a,saveModelChanges:l,saveModelChangesDebounced:_.debounce(l,80),eCommerceManager:c},faded:!1,selected:!1,disabled:!1,visible:!0,select:()=>p.set({selected:!0,faded:!1}),deselect:()=>p.set({selected:!1,faded:!1}),removeFade:()=>p.set({faded:!1}),appearanceAnimation:!1,project:e,user:e.user,injectedRefs:{},workspace:null,controlsManager:null,useSharedState:()=>({}),doesUserHaveAccess:!0,isMixed:()=>!1});return p});return(0,Hr.useMemo)(function(){if(!m)return;let p=m.get("block");p.saveModelChanges=l,p.saveModelChangesDebounced=_.debounce(l,80)},[l]),(0,Hr.useMemo)(function(){if(!m||!i)return;let p=i._id,u=e.pages.find(d=>d.id===p);m.set("page",u)},[i]),m&&a?n(dl,{model:m,context:El,children:o}):o};G();A2();var di=T(H());Gc();pt();Q2();sd();z2();P2();v();var iT=({autoSize:e,...o})=>{let t=(0,di.useRef)(null),[r]=wf({ref:t,value:o.value!==void 0?o.value.toString():o.defaultValue?.toString()??"",disabled:!e});return r&&(o.width=r),n(vt,{...o,ref:t})},Z1=Y(iT)`
  box-sizing: border-box;
  height: 100%;
  max-width: 100%;
  min-width: 100%;
  padding: 1px;
  border: 1px solid rgba(0, 0, 0, 0);
  border-radius: 3px;
  font-size: inherit;
  font-family: inherit;
  color: inherit;
  &:focus {
    border-bottom: 1px solid rgba(0, 0, 0, 0);
    border-color: rgba(255, 255, 255, 0.2);
  }
  &:hover {
    border-color: rgba(255, 255, 255, 0.2);
  }
`,Pu=Y(vt)`
  box-sizing: border-box;
  height: 100%;
  padding: 1px;
  border: 1px solid rgba(0, 0, 0, 0);
  border-radius: 3px;
  font-size: inherit;
  font-family: inherit;
  color: inherit;
  &:focus {
    border-bottom: 1px solid rgba(0, 0, 0, 0);
    border-color: rgba(255, 255, 255, 0.2);
  }
  &:hover {
    border-color: rgba(255, 255, 255, 0.2);
  }
`,nT=({project:e})=>{let{model:{block:{model:o,saveModelChangesDebounced:t}}}=(0,di.useContext)(El),[r,i]=(0,di.useState)(()=>({"bar-title":o.get("bar-title")??oe.defaultSidebarTexts.title,"bar-empty\u0421artTitle":o.get("bar-empty\u0421artTitle")??oe.defaultSidebarTexts.empty\u0421artTitle,"bar-checkout":o.get("bar-checkout")??oe.defaultSidebarTexts.checkout,"bar-price":o.get("bar-price")??oe.defaultSidebarTexts.price,"bar-quantity":o.get("bar-quantity")??oe.defaultSidebarTexts.quantity})),s=(0,di.useCallback)(g=>{let h=g.target.name,b=g.target.value;i({...r,[h]:b}),t({...r,[h]:b})},[r,t]),a={translate:"no",autoComplete:"off",autoCorrect:"off",spellCheck:!1},l=w(f,{display:"flex",alignItems:"center",gap:"10px",position:"relative",zIndex:"1",children:[n(Pu,{name:"bar-title",value:r["bar-title"],placeholder:oe.defaultSidebarTexts.title,maxLength:32,width:"100%",height:"32px",fontSize:"inherit",lineHeight:"inherit",onChange:s,...a}),n(f,{position:"relative",top:"1px",children:n(Eb,{})})]}),m=n(Pu,{name:"bar-empty\u0421artTitle",value:r["bar-empty\u0421artTitle"],placeholder:oe.defaultSidebarTexts.empty\u0421artTitle,maxLength:32,textAlign:"center",width:"100%",height:"32px",fontSize:"inherit",lineHeight:"inherit",onChange:s,...a}),c=n(Pu,{name:"bar-checkout",value:r["bar-checkout"],placeholder:oe.defaultSidebarTexts.checkout,maxLength:32,height:"24px",width:"100%",textAlign:"center",onClick:g=>g.stopPropagation(),onChange:s,...a}),p=n(Z1,{name:"bar-price",value:r["bar-price"],placeholder:oe.defaultSidebarTexts.price,maxLength:32,width:"auto",height:"18px",maxWidth:"120px",minWidth:"20px",fontSize:"0.75em",lineHeight:"inherit",autoSize:!0,onChange:s,...a}),u=n(Z1,{name:"bar-quantity",value:r["bar-quantity"],placeholder:oe.defaultSidebarTexts.quantity,maxLength:32,width:"auto",height:"18px",maxWidth:"120px",minWidth:"20px",fontSize:"0.75em",autoSize:!0,onChange:s,...a}),[d]=(0,di.useState)(()=>new lh({project:e,publicPath:"",base:""}));return n(ph,{value:d,children:n(eh,{value:d.project,children:n(Db,{project:e,cartTitle:l,emptyText:m,buttonText:c,priceText:p,quantityText:u})})})},J1=nT;pt();T2();v();function Q1(e,o){let t=`/api/fonts/${e}/css`;return o(t)}function sT(e){return e.map(o=>o.css_url)}function e2({fonts:e,signLink:o}){if(!e?.length)return null;let t=e.filter(a=>a.provider==="custom"),r=e.filter(a=>a.provider==="webtype"),i=e.filter(a=>a.provider==="typetoday"),s=[r.length?Q1("webtype",o):void 0,i.length?Q1("typetoday",o):void 0,...t.length?sT(t):[]].filter(Boolean);return s.length?n(K,{children:s.map((a,l)=>n("link",{rel:"stylesheet",type:"text/css",href:a},l))}):null}lg();function aT({id:e,token:o,fontsMetaData:t}){let r=document.createElement("script");r.src="//use.typekit.net/previewkits/pk-v1.js",r.onload=function(){window.TypekitPreview.setup({auth_id:e,auth_token:o,default_subset:"all"}),window.TypekitPreview.load(t)},window.document.head.appendChild(r)}var t2=aT;v();function lT(e){let o=encodeURIComponent(e.name);if(e.variations.length===1&&e.variations[0]==="n4")return`family=${o}`;let t=[],r=[];for(let s of e.variations.sort((a,l)=>a.localeCompare(l))){let[a,l]=[s.slice(0,1),parseInt(s.slice(1))],m=l*100;a==="n"?t.push(m):a==="i"&&r.push(m)}let i=[...t.map(s=>`0,${s}`),...r.map(s=>`1,${s}`)];return`family=${o}:ital,wght@${i.join(";")}`}function o2({fonts:e}){if(!e?.length)return null;let o=e.filter(s=>s.provider==="google");if(!o.length)return null;let i=`https://fonts.googleapis.com/css2?${o.map(lT).join("&")}`;return w(K,{children:[n("link",{rel:"preconnect",href:"//fonts.googleapis.com"}),n("link",{rel:"preconnect",href:"//fonts.gstatic.com",crossOrigin:"anonymous"}),n("link",{rel:"stylesheet",type:"text/css",href:i})]})}v();function r2({fontsMetaData:e=[],typekitId:o,typekitToken:t,signLink:r=i=>i}){let i=pl(()=>e?.filter(s=>s.provider==="typekit").map(s=>({id:s.css_name,variations:s.variations})),[e]);return mp(()=>{t2({id:o,token:t,fontsMetaData:i})},i.length>0),w(K,{children:[n(o2,{fonts:e}),n(e2,{fonts:e,signLink:r})]})}v();var i2=Y(f,{label:"preview-background"})`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: white;
`,pT=qt(i2),cT=Y(f,{label:"device-box"})`
  position: absolute;
  box-sizing: content-box;
  overflow: auto;
`,dT=Y(f)`
  display: block;
`,mT=(e,o)=>{let t=new URL(`${window.origin}/preview/${e}/${o!=="1"?o+"/":""}`);return t.searchParams.set("external_link_target","parent"),t.toString()},Oc=.75;function n2({projectNumId:e,initialPathPath:o}){let t=(0,xr.useRef)(mT(e,o)).current,{project:r,setProject:i,viewport:s,setIframe:a,options:l,isFirstPage:m,isLastPage:c,goToNextPage:p,goToPreviousPage:u,constructorProject:d,isViewportEnabled:g,setViewport:h}=(0,xr.useContext)(kr),{isRenderedOnClient:b}=pg(),[x]=Bl(),y=Rb(),{deviceBox:S,iframeBox:k,deviceFrame:P,minWidth:C}=(0,xr.useMemo)(()=>{if(r){let A=Ao.getPageWidth(r,s),{width:R,height:Z}=Ao.fitToDevice(s==="tablet_portrait"?A*Oc:A,s,x),F={width:R,height:Math.min(Z,y.height)};return{deviceBox:s==="default"?{}:xt.center(F,y),iframeBox:s==="tablet_portrait"?{transformOrigin:"left top",scale:Oc,width:F.width/Oc,height:F.height/Oc}:{width:"100%",height:"100%"},deviceFrame:s==="default"?{}:{border:"1px solid #e0e0e0",borderRadius:"4px"},minWidth:Pe.dictionary[s].min_scale_width||Pe.dictionary[s].width}}else return{deviceBox:{},deviceFrame:{},minWidth:Pe.dictionary.default.min_scale_width}},[x,r,s,y]),B=(0,xr.useCallback)(A=>{a(A)},[]);oh(()=>{Fu()}),mp(function(){r&&(nh(r,{isPublished:!1}),rh(sh(r)),ih(e))},b&&!!r),(0,xr.useEffect)(()=>{r||vg(e).then(A=>{let R=Hc(A);i(R)})},[r]),(0,xr.useEffect)(()=>{function A(R){let Z=g("tablet_portrait"),F=g("phone_portrait"),V=Z&&F?{2:"tablet_portrait",3:"phone_portrait"}:Z?{2:"tablet_portrait"}:F?{2:"phone_portrait"}:{},W={1:"default",...V},J;if(R.key==="d"){let me=Object.values(W),se=me.indexOf(s);J=me[se===me.length-1?0:se+1]}else["1","2","3"].includes(R.key)&&(J=W[R.key]);J&&h(J)}return document.addEventListener("keyup",A),()=>{document.removeEventListener("keyup",A)}},[g,s,h]);let $=r?.edit_params?.fonts??[];return n(K,{children:w(qo,{children:["Transition between constructor and preview",n(pT,{minWidth:C,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:n(i2,{children:n(cT,{width:"100%",height:"100%",...P,...S,children:b?w(K,{children:[n(dT,{as:"iframe",src:t,ref:B,...k}),l.viewertype==="horizontal"&&l.arrows?n(Ab,{color:"white",isPreviousVisible:!m,isNextVisible:!c,onNextClick:p,onPreviousClick:u}):null,r?w(K,{children:[n(sc,{position:"fixed",bottom:16,right:16}),n(mh,{viewport:s})]}):null,r&&ah(r)?w(K,{children:[$.length?n(r2,{fontsMetaData:$,typekitId:oe.TYPEKIT_ID,typekitToken:oe.TYPEKIT_TOKEN}):void 0,n(K1,{constructorProject:d,children:n(J1,{project:r})})]}):null]}):null})})})]})})}v();function a2(e,{router:o,initialPageId:t,initialPathPath:r,constructorProject:i,previewProject:s,viewport:a,initialScrollTop:l,projectNumId:m}){let c=(0,s2.createRoot)(e),p=new Backbone.Model({isVisible:!0});return document.body.classList.add(Pd),c.render(n(vr,{withGlobalStyles:!1,children:n(Jn,{router:o,project:i,inPreview:!0,children:n(da,{router:o,widgetbar:p,children:n(vl,{magModel:i,router:o,children:w(Gp,{userModel:o.me,children:[n(ch,{viewport:a,project:s,constructorProject:i,initialPageId:t,initialScrollTop:l,children:n(n2,{projectNumId:m,initialPathPath:r})}),n(f,{id:"settings-popup-container",position:"absolute",top:"0",left:"0",zIndex:"8000",width:"100%"}),n(Lc,{})]})})})})})),()=>{c.unmount(),document.body.classList.remove(Pd)}}Vn();_r();yr();hh();R2();f2();pp();var Hn=Ce.default.memoize(()=>{let e=new URLSearchParams(window.location.search);return e.has("__next")?!0:e.has("__legacy")?!1:Dt("viewer.nextPreview")}),uT=Or.default.Router.extend({routes:{"edit/:mag/preview/num/:page/":"goPreviewByPageNum","edit/:mag/preview/*page/":"goPreview","edit/:mag/preview/":"goPreview","edit/:mag":"start","edit/:mag/":"start","edit/:mag/:page/":"start","edit/:mag/:page":"start","edit/:mag/:page/comment/:commentId":"start","edit/:mag/:page/comment/:commentId/":"start"},mag:null,workspaces:{},previewMode:!1,switchingModes:!1,scrollTop:0,keys:{p:80,z:90,g:71,a:65,r:82,l:76,c:67,v:86,f:68,x:88,q:81,b:66,d:68,w:87,m:77,"[":219,"]":221,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48},disabledKeysMap:{BaseWidgetCanAdd:[{key:Q.default.keycodes.w},{key:Q.default.keycodes.t}],BaseWidgetCanLock:[{key:Q.default.keycodes.l,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}],BaseWidgetCanHide:[{key:Q.default.keycodes.h,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}],BaseWidgetCanRotate:[{key:Q.default.keycodes.r}],BaseWidgetCanDelete:[{key:Q.default.keycodes.del}],BaseWidgetCanChangeGroup:[{key:Q.default.keycodes.g}],BaseWidgetCanChangeCoordinates:[{key:Q.default.keycodes.left},{key:Q.default.keycodes.right},{key:Q.default.keycodes.up},{key:Q.default.keycodes.down}],CanUseBlocksMode:[{key:Q.default.keycodes.b}],GridsAndGuidesCanUse:[{key:Q.default.keycodes.h}]},disabledKeysCommentMode:[{key:Q.default.keycodes.w},{key:Q.default.keycodes.t},{key:Q.default.keycodes.r},{key:Q.default.keycodes.del},{key:Q.default.keycodes.g},{key:Q.default.keycodes.left},{key:Q.default.keycodes.right},{key:Q.default.keycodes.up},{key:Q.default.keycodes.down},{key:Q.default.keycodes.l},{key:Q.default.keycodes.h}],workspaceTextInputSelectors:'input, textarea:not(.copyhack), [data-text="true"], .rm-code-editor, [contenteditable="true"]',keyHandlers:{},PREVIEW_DELAY:0,PING_INTERVAL:5e3,screenshotDates:[],inactivityTimesMap:{short:60*1e3,long:5*60*1e3},minimalUiClassName:"minimal-constructor-ui",hideControlsClassName:"hide-controls",viewportCounter:1,initialize:function(){Ce.default.bindAll(this),Af("constructor"),(0,Q.default)(this.onLoadInit);let e=window.ServerData.me;if(this.me=new nl(e),(l=>{let m=l.get("gacid");if(!m||m&&!m.match(/[0-9]+\.[0-9]+/)){let c=Ye.getGAcid();c&&l.save({gacid:c},{patch:!0})}})(this.me),Gu({apiKey:oe.ampId,user:this.me.attributes,config:{defaultTracking:!0}}),Gs.init({userId:e&&e._id,GA_ID:oe.GA_ID,GA4_ID:oe.GA4_ID,GOOGLE_ADS_ID:oe.GOOGLE_ADS_ID}),!Un.isDesktop()&&!Un.isTablet()){window.location.href="/"+this.me.get("uri");return}let t=this.me?.get("behavior_metrics");this.helpTourIsFinished=t?.constructor_tour_finished;let r=t?.constructor_tour_shown,i=t?.initial_onboarding_type,s=Yu("_rm_start_with_help_tour");if(!r||s){let l={...t,constructor_tour_shown:!0};this.me.save({behavior_metrics:l},{patch:!0})}if(this.currentOnboardingType="hidden",r||(this.currentOnboardingType=i||"tour"),s&&(this.currentOnboardingType="tour",qu("_rm_start_with_help_tour")),!window.location.href.match(/\/(\d+)\/?/))return this.notFound();RM.common=Ce.default.extend(RM.common||{},{mode:"constructor"}),this.settingsRendered=!1,this.previewToolbarRendered=!1,document.documentElement.classList.add("enhanced-mobile-frame"),ye.on("change:device",this.onChangeDevice,this),document.documentElement.classList.add("equal-columns"),document.documentElement.classList.add("precise-guides"),Dt("widget.anomalyMonitoring")&&document.addEventListener("click",ma.onClick)},execute(e,o,t){if(Hn()&&["goPreview","goPreviewByPageNum"].includes(t)&&this.previewMode)return!1;e&&e.apply(this,o)},onLoadInit:function(){Q.default.ajaxSetup({}),(0,Q.default)(document).ajaxError(this.onAjaxError),(0,Q.default)(document).ajaxSuccess(this.clearConnectionError)},onAjaxError:function(e,o,t){let r=["/api/authservice","/api/proxy","/screenshot","/api/fonts","/api/connect"];switch(o.status){case 403:var i=new RegExp("^\\s*(?:[a-z0-9]+:)?//","i"),s=Ce.default.any(r,function(a){return new RegExp("^"+a).test(t.url)});s=s||i.test(t.url),s||(Modernizr.sessionstorage&&window.sessionStorage.setItem("rm.loginReturnUrl",window.location.pathname),window.location.href=`/auth/login?redirect=${window.location.pathname}`);return;case 500:console.error(o.responseText);break;case 503:console.error("server error");break}},start:function(e,o,t){let r=Or.default.history.getFragment().includes("/comment/");if(this.previewMode&&(this.togglePreview(),this.trigger("previewClose")),this.started){this.showWorkspace(o);return}import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PKMOVP7P.js").then(({default:s})=>{s("constructor")}),this.started=!0,o=parseInt(o,10),o||(o=1),this.mag=this.mag||new ya({num_id:e}),Wl.setContext({sessionId:Ye.generateUUID(),projectNumId:typeof e=="string"?Number(e):e}),this.syncManager=new im(this,this.mag),this.indexController=new ka(this,this.mag),this.mag.has("num_id")&&(this.eCommerceManager=new va({numId:this.mag.get("num_id")})),Lt.initialize(this.syncManager);let i=this;this.mag.loadFull({success:Ce.default.bind(function(){rb(this.mag.get("num_id")).then(l=>{ib(l)}),this.isOwner=this.mag.get("user")?.email===this.me.get("email"),Gs.trackDailyVisit({location:"editor",role:je.getRoleForAnalytics(this.isOwner)}),this.whatsNewPopupsRoot=um(document.querySelector("#whatsnew-popups"),{lastUserSeen:this.me.get("whatsnew_last_seen"),userRegistrationDate:this.me.get("createDate")}),uf(document.querySelector("#help-tour-notice"),["TextWidgetSelect","TextWidgetDrag","PictureWidgetChoose","PictureWidgetClickOutside","AdjustSizes","PictureWidgetPlace","TurnOffGuides","ButtonWidgetAnchorLinkPosition","ButtonWidgetDrag","DeleteBlocks","EverythingInItsRightPlace","SelectBlocksAndDelete","ArrangeWidgetsInTheGrid","DisableBlocksAndGrid","DeleteNavBar","FixMenuClickOutside","HoverBetweenBlocks","DeselectAfterSetBlocksDistance"]),zf({projectId:window.ServerData.projectId,userId:this.mag.get("user")._id}),this.me.mergePermissions(this.mag.user.get("permissions")),xa.init(this.me.get("permissions")),this.mag.edit_params=new Sd(this.mag.get("edit_params"),this.mag),this.mag.unset("edit_params"),this.mag.edit_params.on("sync",function(){this.mag.set("changed",!0)},this),this.mag.edit_params.on("change",function(l,m,c){c&&c.socketUpdate&&this.mag.set("changed",!0)},this),this.zoom=new Qb(this,this.mag,(0,Q.default)("#zoom")),this.eCommerceManager?this.mag.has("ecommerce_data")&&this.eCommerceManager.updateEcommerceData(this.mag.get("ecommerce_data")):this.eCommerceManager=new va({numId:this.mag.get("num_id")}),this.eCommerceManager.setCartWidgetExistState(xg(oe.environment.constructor,this.mag.globalWidgets)),this.textStyles=new Gb(this.mag.edit_params),this.textStyles.generateCSS("paragraph","constructor",document),this.textStyles.generateCSS("link","constructor",document),this.mag.filterUnusedFonts(),this.validateFonts(this.mag.edit_params),this.fonts=new ud(this.mag.edit_params),this.fonts.appendFontsCssToDocument({version:"edit"},()=>{window.RM.constructorRouter.trigger("font-added")}),this.arrows=new aw({router:this,mag:this.mag}),this.gg=new nw({router:this,mag:this.mag}),this.mag.on("change:pids",this.checkDeletedPage),this.mag.on("change:title",function(){this.setTitle("Edit")},this),this.mag.on("change:page:screenshot",function(l,m,c){this.trigger("renewScreenshot",l,m,c),l===this.mag.pages.first().id&&this.trigger("updateCover")},this),this.pageOrder=new Wb,this.pageOrder.load(this.mag),this.pageOrder.validateAndFixPageOrder(this.mag),this.me.get("_id")&&this.mag.get("user")._id!=this.me.get("_id"),this.setTitle("Edit"),this.workspace&&this.workspace.showUsedViewport();try{this.showWorkspace(o,{isContents:Or.default.history.getFragment().indexOf("/contents/")>-1})}catch(l){console.error("router show workspace error:",l)}this.mag.get("socket_hash")&&this.workspace&&(this.sockets=new $w(this.mag.get("num_id"),this.mag.get("socket_hash"),this.me,this),this.sockets.initSocket(),this.sockets.on("lockChange",this.onLockMessage,this),this.sockets.on("client-disconnected",this.onClientDisconnected,this),this.sockets.on("takeOver",this.showUnlockPageAlert,this),this.on("redrawPage",this.mag.updateLastChanged,this.mag)),this.gg.create(),this.initScreenshotRenewer(),(0,Q.default)(window).on("dragover",function(l){RM.constructorRouter.workspace.trigger("main-dragover",l)}),(0,Q.default)(".copyhack").on("keyup",function(){(0,Q.default)(this).val("\u200C")});let s=Modernizr.mac?"meta":"ctrl",a=Modernizr.mac?["meta","shift"]:["ctrl","shift"];this.bindGlobalKeyPress([{key:"a",handler:this.onSelectAllKey,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"d",handler:this.onNumericKey.bind(this)},{key:"1",handler:this.onNumericKey.bind(this)},{key:"2",handler:this.onNumericKey.bind(this)},{key:"3",handler:this.onNumericKey.bind(this)},{key:"4",handler:this.onNumericKey.bind(this)},{key:"5",handler:this.onNumericKey.bind(this)},{key:"6",handler:this.onNumericKey.bind(this)},{key:"7",handler:this.onNumericKey.bind(this)},{key:"8",handler:this.onNumericKey.bind(this)},{key:"9",handler:this.onNumericKey.bind(this)},{key:"0",handler:this.onNumericKey.bind(this)},{key:"z",handler:this.undo,optionKeys:s,activeOnInput:!0},{key:"z",handler:this.redo,optionKeys:a,activeOnInput:!0}]),RM.analytics=RM.analytics||new Cl({router:this}),this.analytics=RM.analytics,t&&r&&(Pa(!0),ye.once("comments:init",()=>{let l=Cw(t);l&&kp({comment:l,fromList:!0})})),this.isOwner||this.trigger("notice:triggerEduTip","eduTipUseCommentsMode",{showOnce:!0})},this),error:function(s){s.status!==403&&i.notFound()}}),(0,Q.default)("html").on("keydown",this.onKeyDown),(0,Q.default)("html").on("keyup",this.onKeyUp),(0,Q.default)(window).on("keyup",this.globalKeyPress),(0,Q.default)(window).on("keydown",this.globalKeyPress),(0,Q.default)(document).on("cut",this.onCut),(0,Q.default)(document).on("copy",this.onCopy),(0,Q.default)(document).on("paste",this.onPaste),this.bindGlobalKeyPress([{key:"c",handler:this.onCopyAnimation,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]},{key:"v",handler:this.onPasteAnimation,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]},{key:"c",handler:this.onCopyTextStyles,optionKeys:Modernizr.mac?["meta","alt"]:["ctrl","alt"]},{key:"v",handler:this.onPasteTextStyles,optionKeys:Modernizr.mac?["meta","alt"]:["ctrl","alt"]}]),(0,Q.default)(window).bind("blur",this.onBrowserTabBlur),(0,Q.default)(window).bind("focus",this.onBrowserTabFocus),(0,Q.default)("#controls-portal").length&&(0,Q.default)("#controls-portal").on("click",function(){Fe("click")}),window?.sessionStorage&&window.sessionStorage.removeItem(fh.COUNT_OF_ACTIONS_IN_PROJECT),ae(ce.OpenProject),ye.on("send-actions-made-data",s=>ae(ce.ActionsMade,{actions:s})),ye.on("index:changed",(s,a)=>{a||this.trigger("update_from_server","Order",Qt(Ce.default.pick(s,this.getCurrentPageId())))})},validateFonts:function(e){if(!e)return;let o=e.get("fonts");o&&o.length&&(o.find(r=>r.css_name==="Inter"&&r.name==="Inter"&&r.provider==="google")||(e.set({fonts:[...o,{provider:"google",css_name:"Inter",name:"Inter",variations:["n1","n2","n3","n4","n5","n6","n7","n8","n9"]}]}),e.save()))},renderPreviewToolbar:function(){this.widgetbar||Su(document.querySelector(".widgetbar"),{router:this,fromPreview:!0,project:this.previewMag})},showWorkspace:function(e,o){if(this.togglePreviewMode(!1),Ce.default.isObject(e)||(e={num:parseInt(e,10)}),e.num||(e.num=this.mag.getPageNum(e.id)),e.id||(e.id=this.mag.getPageId(e.num)),!e.id&&e.num!==1)return this.showWorkspace(1,o);if(this.workspace&&this.workspace.page.id===e.id){this.workspace.renderMissedWidgets(),this.workspace.onReturnFromPreview();return}this.switchCurrentPage(e.id),this.closeCodeEditor();let t=this.workspace&&this.workspace.viewport||window.sessionStorage.getItem("constructorViewport")||"default";this.workspace&&this.workspace.hide(),this.workspace=this.getWorkspace(e.id,o?.viewportName||t),this.widgetbar=Su(document.querySelector(".widgetbar"),{router:this,project:this.mag}),this.widgetbar.setWorkspace(this.workspace),this.workspace.page.needUpdate&&!this.showed&&this.mag.pages.fetchFullPage(e.id,{success:Ce.default.bind(function(){this.showWorkspace(e,o)},this)}),(0,Q.default)(".page-content-container").css({top:this.workspace.$el.position().top}),this.workspace.show({...o,switchToViewport:o?.viewportName||t}),(!o||!o.isContents)&&this.updateUrl(),this.preloadPages(),this.trigger("pageChange",this.workspace),this.widgetbar.rerender()},getWorkspace:function(e,o="default"){let t=this.workspaces[e];return t||(t=new N0({$container:(0,Q.default)("#main"),template:Z0["template-constructor-workspace"],page_id:e,mag:this.mag,syncManager:this.syncManager,eCommerceManager:this.eCommerceManager,viewport:o}),this.workspaces[e]=t),t},removeWorkspace:function(e){this.workspaces[e]&&(this.workspaces[e].destroy&&this.workspaces[e].destroy(),delete this.workspaces[e])},triggerPageChange:function(){this.trigger("pageChange",this.workspace)},createTemplateFromCurrentPage:function(e={}){return new Promise((o,t)=>{let r=this.workspace.getTemplateJSON(e);if(!r)return t(new Error("can't create template json for current page"));e.withGlobalWidgets&&r.globalWids&&r.globalWids.length&&(r.wids=r.wids.concat(r.globalWids),delete r.globalWids),new(Or.default.Model.extend({url:"/api/template/"}))(r).save({},{success:(s,a)=>{this.mag.addCustomPageTemplate(a),o(a)},error:(s,a)=>{if(s.status===400)try{let l=JSON.parse(s.responseText);if(l&&l.err==="permission_denied")return t(new Error("permission denied"))}catch{return t(new Error(a))}t(new Error(a))}})})},preloadPages:function(){if(!this.workspace)return;let e=1,o=this.workspace.page.get("num");Ce.default.each(Ce.default.range(o-e,o+e),function(t){if(t==o)return;let r=this.mag.getPageId(t,{onlyActive:!0});r&&this.getWorkspace(r).preloadBlocks()},this)},hideWorkspaces:function(){this.workspace&&this.workspace.hide(),delete this.workspace,this.trigger("pageChange",null)},updateUrl:function(){if(!this.mag||!this.workspace)return;let e="/edit/"+this.mag.get("num_id")+"/"+this.workspace.page.get("num")+"/",o=Or.default.history.getFragment()=="/edit/"+this.mag.get("num_id")+"/"+this.workspace.page.get("num");this.navigate(e,{replace:o})},checkDeletedPage:function(){this.trigger("changePids",this.workspace),this.workspace&&(Ce.default.include(this.mag.get("pids"),this.workspace.page.id)||this.mag.get("pids")[0]||this.hideWorkspaces())},getCurrentPageNum(){return this.preview?this.preview.mag.currentPage.num:this.workspace?this.workspace.getPageNum():1},getCurrentPageId(){return this.preview?this.preview.mag.currentPage._id:this.workspace?this.workspace.getPageId():void 0},goPreviewByPageNum:function(e,o){this.goPreview(e,o,!0)},async goPreview(e,o,t){if(this.trigger("previewOpen"),this.previewMode&&this.preview)return this.preview.start(e,o);if(Modernizr.msie||Modernizr.msie11){new js({$parent:(0,Q.default)("body > .popups"),router:this,opts:{type:"type-browsers-viewer"}}).render();return}o||(o=1),this.togglePreviewMode(!0);let r=this;if(this.previewMag&&delete this.previewMag,this.previewMag=new ya({num_id:e}),this.mag||(this.mag=new ya({num_id:e})),r.preview&&(r.preview.mag?.off("pageChanged",r.onPreviewPageChanged),r.preview.destroy(),delete r.preview),Hn()){let[i,s]=this.mag?.get("_id")?[this.mag,void 0]:await new Promise((c,p)=>{let u=new ya({num_id:e});u.loadFull({success:d=>{u.edit_params=new Sd(u.get("edit_params"),u),u.filterUnusedFonts(),c([u,Hc(d)])},error:p})}),a=o.toString(),m=i.pages.find(c=>c.get("num").toString()===a||c.get("pagePath")===a)??i.pages.models[0];this.isOwner=this.isOwner??Ce.default.isEmpty(i.get("shared")),this.fonts=this.fonts??new ud(i.edit_params),this.unmountPreviewNext=a2(document.querySelector("#mags"),{initialPathPath:m.get("pagePath")||m.get("num").toString(),initialPageId:m.id,initialScrollTop:this.workspace?.getScrollTop(),router:this,constructorProject:i,previewProject:s,viewport:window.sessionStorage.getItem("constructorViewport")||"default",projectNumId:e,projectUri:`/edit/${e}/preview`,featureFlags:window.ServerData.featureFlags,serverSideConfig:window.ServerData.config})}else this.previewMag.loadFull({success:function(i){!r.previewMode||r.preview||cp(Ye.usedWidgets(i.pages)).finally(()=>{i.$constructor=(0,Q.default)("#constructor"),r.preview=new q0({...i}),r.me.mergePermissions(r.previewMag.user.get("permissions")),xa.init(r.me.get("permissions")),r.trigger("previewMag:load:success",r.preview),r.preview.setScroll((0,Q.default)("#main").scrollTop()),r.preview.go(o,{isPageNum:t}),r.setTitle("Preview"),r.isOwner=i.user?.email===r.me.get("email"),r.preview.mag.$el.scrollTop(0),r.preview.mag.on("pageChanged",r.onPreviewPageChanged),i&&r.renderPreviewToolbar(i.changed,i.is_published)})},parse:!1});this.renewScreenshot()},onPreviewPageChanged(e,o){this.trigger("previewPageChange",e,o)},async togglePreview({pageNumber:e,scrollTop:o}={}){if(this.switchingModes)return;this.switchingModes=!0,_l()||ae(ce.Preview,{preview:this.previewMode?"Out":"In"});let t=this.mag.get("num_id");if(Hn()){let r=!this.previewMode,i=r?e:parseInt(Or.default.history.getFragment().split("/")[3],10),s=r?`edit/${t}/preview/${!i||i===1?"":i+"/"}`:`edit/${t}/${i||1}/`;this.scrollTop=o,r&&await new Promise(a=>this.saveActiveBlock(a)),this.navigate(s,{trigger:!0}),(0,Q.default)("html").toggleClass("preview-mode",r),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY),r||await Gs.trackDailyVisit({location:"editor",role:je.getRoleForAnalytics(this.isOwner)})}else if(this.previewMode){if(!this.preview){this.animation=!1;return}let r="edit/"+this.mag.get("num_id")+"/"+(this.preview.mag.currentPage?this.preview.mag.currentPage.num:1)+"/";if((this.preview&&this.preview.mag.hasCodeInjection||this.mag.hasCodeInjection||Ce.default.noop)()){window.location.href="/"+r;return}else this.navigate(r,{trigger:!0});(0,Q.default)("html").removeClass("preview-mode"),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY),Gs.trackDailyVisit({location:"editor",role:je.getRoleForAnalytics(this.isOwner)})}else{let r=this.workspace?this.workspace.getPageNum():1;this.saveActiveBlock(()=>{let i="edit/"+this.mag.get("num_id")+"/preview/num/"+r+"/";if(this.mag.hasCodeInjection()){window.location.href="/"+i;return}else this.navigate(i,{trigger:!0});(0,Q.default)("html").addClass("preview-mode"),setTimeout(()=>this.switchingModes=!1,this.PREVIEW_DELAY)})}},togglePreviewMode:function(e){let o=!!e;if(o===this.previewMode)return;o&&this.renewScreenshot(),this.previewMode=o;let t=Ce.default.bind(function(){this.previewAnimating=!1,o?(0,Q.default)("#main-background").hide():(this.setTitle("Edit"),Hn()?(typeof this.unmountPreviewNext=="function"?this.unmountPreviewNext():console.error("Cannot destroy the preview"),delete this.unmountPreviewNext):(this.preview&&this.preview.mag?.off("pageChanged",this.onPreviewPageChanged),this.preview&&this.preview.destroy(),delete this.preview),this.workspace&&this.workspace.showUsedViewport(),this.workspace&&this.workspace.onResize())},this);if((0,Q.default)("body").toggleClass("preview",o),this.previewAnimating=!0,o)(0,Q.default)("#constructor").find(".navigation-arrow").fadeOut(this.PREVIEW_DELAY),(0,Q.default)("#main, #widgetbar, .controls, #float-panels, .page-size-control").addClass("goout"),Hn()?t():(0,Q.default)(".mag").fadeIn(this.PREVIEW_DELAY,t),(0,Q.default)(".page-content-container").attr("style",""),this.workspace&&this.workspace.onResize();else{let r=Hn()?this.scrollTop:this.preview?this.preview.getScroll():0;this.scrollTop=0,this.arrows.onPageChange(this.workspace),(0,Q.default)("#main, #widgetbar, .controls, #float-panels, .page-size-control").removeClass("goout"),(0,Q.default)("#main-background").show(),this.workspace&&this.workspace.onResize(),Hn()?t():(0,Q.default)(".mag").fadeOut(this.PREVIEW_DELAY,t),(0,Q.default)("#main").scrollTop(r)}this.trigger("togglePreview",o)},saveActiveBlock:function(e=Q.default.noop){let o;if(!this.workspace)return e();let t=this.workspace.getSelectedBlocks(),r=t[0];t.length!==1&&(r={model:this.workspace.syncManager.groupSave});let i=s=>{o=setTimeout(()=>{this.stopListening(r.model),e()},s)};i(200),this.listenToOnce(r.model,"request",()=>{i(3e3),this.listenToOnce(r.model,"sync",()=>{clearTimeout(o),e()})}),this.workspace.trigger("deselect")},setTitle:function(e){window.document.title=this.mag?"Readymag \u2022 "+(this.mag.get("title")||"Project")+" \u2022 "+(e||""):"Readymag \u2022 Constructor"},checkMinimalUI:function(){return(0,Q.default)("html").hasClass(this.minimalUiClassName)},toggleMinimalUI:function(e=!this.checkMinimalUI()){(0,Q.default)("html").flashClass(`${this.minimalUiClassName}-no-transition`,100),setTimeout(()=>{e?((0,Q.default)("html").addClass(this.minimalUiClassName),this.widgetbar?.hide()):((0,Q.default)("html").removeClass(this.minimalUiClassName),this.widgetbar?.show())},20)},toggleHideControls:function(e){(0,Q.default)("html").toggleClass(this.hideControlsClassName,e)},isDisabledKeysList:function(e,o){let t=e.keyCode,r=o.find(({key:s})=>s===t);if(!r)return!1;let{optionKeys:i}=r;return i?(Array.isArray(i)?i:[i]).some(a=>e[`${a}Key`]):!0},isKeyDisabledByRole:function(e){return Object.entries(this.disabledKeysMap).some(([o,t])=>this.isDisabledKeysList(e,t)&&!je.isPermissionAllowed(o))},isDisabledKeysCommentMode:function(e){if(this.workspace?.getCommentModeState?.())return this.isDisabledKeysList(e,this.disabledKeysCommentMode)},onKeyDown:function(e){if(this.isKeyDisabledByRole(e)||this.isDisabledKeysCommentMode(e)||e.target.tagName.toLowerCase()=="input"||e.target.dataset&&e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable")||this.previewMode||!Ce.default.isEmpty(RM.common.disableShortcuts))return;this.altAlonePressed=!1;let o=this.workspace&&this.workspace.getSelectedBlocks().length;e.keyCode===Q.default.keycodes.alt&&(this.altAlonePressed=!0);let t=this.workspace&&!this.isCurrentPageLocked(),r;switch(e.keyCode){case Q.default.keycodes.tab:{let i=document.activeElement;if((0,Q.default)("#controls-portal").get(0).contains(i))return;Fe(`shortcut_${e.key}`),this.toggleMinimalUI(),e.preventDefault();break}case Q.default.keycodes.esc:if(Fe(`shortcut_${e.key}`),!(0,Q.default)("html").hasClass("minimal-constructor-ui"))return;(0,Q.default)("html").flashClass("minimal-constructor-ui-no-transition",100),setTimeout(function(){(0,Q.default)("html").removeClass("minimal-constructor-ui")},20);break;case Q.default.keycodes.left:if(r=t&&this.workspace.moveSelected(e,"left"),Fe(`shortcut_${e.key}`),!r&&!o||this.isCurrentPageLocked())return this.go("prev"),!1;break;case Q.default.keycodes.right:if(r=t&&this.workspace.moveSelected(e,"right"),!r&&!o||this.isCurrentPageLocked())return this.go("next"),!1;break;case Q.default.keycodes.up:if(r=t&&this.workspace.moveSelected(e,"up"),!r&&!o||this.isCurrentPageLocked())return this.go("prev"),!1;break;case Q.default.keycodes.down:if(r=t&&this.workspace.moveSelected(e,"down"),!r&&!o||this.isCurrentPageLocked())return this.go("next"),!1;break;case Q.default.keycodes.backspace:e.preventDefault(),e.stopPropagation();case Q.default.keycodes.del:return this.isCurrentPageLocked()?!0:(this.workspace.viewport!=="default"&&RM.constructorRouter.trigger("notice:triggerMetrics","widgetDeletedOnMobile"),this.workspace&&this.workspace.deleteSelectedBlocks(),Fe(`shortcut_${e.key}`),!1);case Q.default.keycodes.w:break;case Q.default.keycodes.t:return e.ctrlKey||e.metaKey||this.isCurrentPageLocked()?!0:(this.workspace.addWidget({type:"text",version:3},{useDefaults:!0}),Fe("shortcut_t"),e.preventDefault(),e.stopPropagation(),!1);case Q.default.keycodes.g:if(e.ctrlKey||e.metaKey||this.isCurrentPageLocked())return!0;this.mag.edit_params.get("guides")&&this.mag.edit_params.toggle("guides"),this.mag.edit_params.toggle("grid"),Fe("shortcut_g");break;case Q.default.keycodes.h:if((e.ctrlKey||e.metaKey)&&!e.shiftKey||this.isCurrentPageLocked())return!0;if((e.ctrlKey||e.metaKey)&&e.shiftKey)return e.preventDefault(),this.workspace.changeVisibilityForSelectedBlocks(),Fe("shortcut_h"),!0;this.mag.edit_params.get("grid")&&this.mag.edit_params.toggle("grid"),this.mag.edit_params.toggle("guides"),Ie("TurnOffGuides"),Fe("shortcut_h");break;case Q.default.keycodes.l:if(!(e.ctrlKey||e.metaKey)||!e.shiftKey)return!0;e.preventDefault(),Fe("shortcut_l"),this.workspace.changeLockForSelectedBlocks();break;case Q.default.keycodes.s:if(this.isCurrentPageLocked())return!0;this.mag.edit_params.toggle("snap"),Fe("shortcut_s");break;case Q.default.keycodes.x:if(e.ctrlKey||e.metaKey)return!0;this.mag.edit_params.toggle("sizes"),Fe("shortcut_x");break;case Q.default.keycodes.p:break;case Q.default.keycodes.v:this.isAnyModeActive()?this.disableCurrentMode():this.workspace&&this.workspace.trigger("specialKeydown",e);break;case Q.default.keycodes.alt:case Q.default.keycodes.shift:case Q.default.keycodes.f:this.workspace&&this.workspace.trigger("specialKeydown",e);break}},navigate:function(e,o){Or.default.Router.prototype.navigate.apply(this,arguments),this.afterNavigate(e,o)},afterNavigate:function(){RM.analytics&&RM.analytics.trackPage()},onKeyUp:function(e){if(!(e.target.tagName.toLowerCase()=="input"||e.target.dataset&&e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable"))&&!this.previewMode&&Ce.default.isEmpty(RM.common.disableShortcuts))switch(e.keyCode==Q.default.keycodes.alt&&this.altAlonePressed&&e.preventDefault(),e.keyCode){case Q.default.keycodes.alt:case Q.default.keycodes.shift:case Q.default.keycodes.v:case Q.default.keycodes.f:this.workspace&&this.workspace.trigger("specialKeyup",e);break}},onBrowserTabBlur:function(){this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:Q.default.keycodes.alt,altKey:!1}),this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:Q.default.keycodes.v}),this.workspace&&this.workspace.trigger("specialKeyup",{type:"keyup",keyCode:Q.default.keycodes.f})},onBrowserTabFocus:function(){this.makeUserActive()},onSelectAllKey:function(){this.workspace&&this.workspace.trigger("selectAll")},onNumericKey:function(e){this.workspace&&this.workspace.getSelectedBlocks().length?this.workspace.changeBlocksOpacity(e.keyCode-48):e.keyCode>=49&&e.keyCode<=51?this.onViewportKey(e.key):e.keyCode===68&&this.onViewportKey(String(this.viewportCounter))},onViewportKey:function(e){if(this.previewMode||!Ce.default.isEmpty(RM.common.disableShortcuts))return;let o=this.workspace.getViewports().some(s=>s.name==="tablet_portrait"&&s.enabled),t=this.workspace.getViewports().some(s=>s.name==="phone_portrait"&&s.enabled),r=this.workspace.getViewports().filter(s=>s.enabled===!0).length;this.viewportCounter=gt.incrementCircular(this.viewportCounter,r);let i;e==="1"?i="default":e==="2"&&o?i="tablet_portrait":e==="3"&&t||e==="2"&&!o?i="phone_portrait":i=void 0,i&&this.workspace&&this.workspace.trigger("viewportShortcutPressed",i)},onChangeDevice(e){if(!this.workspace)return;let o=this.workspace.viewport,t=ia[e],r=t!==o,i=(this.workspace.page.get("viewport_"+t)||{}).enabled||t==="default";r&&i?this.workspace.setViewport(t):r?ye.trigger("togglePanel","viewports"):t==="phone_portrait"&&i&&(this.workspace.onResize(),this.workspace.updateWorkspaceViewport())},go:function(e){let o=this.workspace.findPage(e);o&&this.showWorkspace({id:o})},globalKeyPress:function(e){if(this.isKeyDisabledByRole(e)||this.isDisabledKeysCommentMode(e)||!Ce.default.isEmpty(RM.common.disableShortcuts))return;let o=e.target.tagName.toLowerCase()=="input"||e.target.dataset&&!!e.target.dataset.text||e.target.tagName.toLowerCase()==="textarea"&&!e.target.classList.contains("copyhack")||e.target.getAttribute("contenteditable"),t=this;for(let r in this.keys)this.keys[r]===e.keyCode&&Ce.default.each(this.keyHandlers[r],function(i){(!o||i.activeOnInput)&&!Ce.default.any(["ctrl","alt","shift","meta"],function(a){return e[a+"Key"]!=Ce.default.include(i.optionKeys,a)})&&e.type=="keydown"&&(!t.isCurrentPageLocked()||i.activeOnLock)&&(e.preventDefault(),i.optionKeys&&i.optionKeys.length>0&&typeof i.optionKeys[0]<"u"?e.keyCode===221?Fe("shortcut_"+["]",...i.optionKeys].join("_")):e.keyCode===219?Fe("shortcut_"+["[",...i.optionKeys].join("_")):Fe("shortcut_"+[String.fromCharCode(e.keyCode),...i.optionKeys].join("_")):e.keyCode!==81&&e.keyCode!==66&&e.keyCode!==76&&Fe(`shortcut_${String.fromCharCode(e.keyCode)}`),i(e))})},bindGlobalKeyPress:function(e){let o=Ce.default.bind(function(t){let r=t.key.toLowerCase();this.keyHandlers[r]=this.keyHandlers[r]||[],Ce.default.isArray(t.optionKeys)||(t.optionKeys=[t.optionKeys]),t.handler.optionKeys=t.optionKeys,t.handler.activeOnLock=t.activeOnLock,t.handler.activeOnInput=t.activeOnInput,this.keyHandlers[r].push(t.handler)},this);Ce.default.isArray(e)?Ce.default.each(e,function(t){o(t)},this):o(e)},unbindGlobalKeyPress:function(e,o){if(!o)delete this.keyHandlers[e];else{let t=[];Ce.default.find(this.keyHandlers[e],function(r){r!=o&&t.push(r)}),this.keyHandlers[e]=t}},initScreenshotRenewer:function(){this.on("redrawPage",this.onPageRedraw),this.screenshotDates=Ce.default.range(1,this.mag.pages.length)},onPageRedraw:function(e){this._pageChanged?this._pageChanged!=e&&(this.renewScreenshot(),this._pageChanged=e):this._pageChanged=e},async renewScreenshot(){if(!this._pageChanged)return;let e=this._pageChanged;this._pageChanged=!1;try{await this.mag.pages.findWhere({_id:e})?.updateScreenshots(this.mag.get("num_id"))}catch{console.error("Screenshoter error")}},notFound:function(){(0,Q.default)(function(){(0,Q.default)("#constructor").hide(),(0,Q.default)("#mags").hide(),Ce.default.defer(function(){new zb({type:"404",$container:(0,Q.default)("#service-pages")}).render()})})},undo:function(){if(this.previewMode)return;let e=this.workspace&&this.workspace.page;e&&Lt.undo(e.id),Dt("widget.anomalyMonitoring")&&ma.onAction("Undo")},redo:function(){if(this.previewMode)return;let e=this.workspace&&this.workspace.page;e&&Lt.redo(e.id),Dt("widget.anomalyMonitoring")&&ma.onAction("Redo")},onCut:function(e){if(this.isCurrentPageLocked()||(0,Q.default)(e.target).is(this.workspaceTextInputSelectors))return!0;this.onCopy.apply(this,[...arguments,!0]),this.workspace&&this.workspace.deleteSelectedBlocks()},onCopy:function(e,o=!1){if(this.previewMode)return;if((0,Q.default)(e.target).is(this.workspaceTextInputSelectors))return!0;o?Fe("shortcut_x_ctrl"):Fe("shortcut_c_ctrl");let t=bf.convertToClipboard({blocks:this.workspace.getSelectedBlocks(),pageId:this.workspace.page.id,magNumId:this.mag.get("num_id"),indexController:this.indexController,workspace:this.workspace});t&&(e.originalEvent.clipboardData.setData("text/plain",JSON.stringify(t)),e.preventDefault())},onPaste:function(e){if(this.isCurrentPageLocked()||!je.isPermissionAllowed("BaseWidgetCanAdd")||this.previewMode)return;if((0,Q.default)(e.target).is(this.workspaceTextInputSelectors))return!0;Fe("shortcut_v_ctrl"),this.workspace&&this.workspace.trigger("specialKeyup",{keyCode:Q.default.keycodes.v,type:"keyup"});let o=e.originalEvent.clipboardData;if(o&&o.items&&o.items.length&&/image/i.test(o.items[0].type))return!0;let t=Ce.default.reduce(o.types,function(r,i){return r+" "+i},"");if(/text/i.test(t)&&!/files/i.test(t)){let r=(e.originalEvent.clipboardData.getData("text/plain")||"").trim(),i;try{i=JSON.parse(r)}catch{}if(i&&i.object=="rm_pastedata"&&!Ce.default.isEmpty(i.blocks))return this.workspace.pasteBlocks(i),!1;if(r&&r!=="\u200C"){let s=e.originalEvent.clipboardData.getData("text/html"),a=Jg({text:r,html:s});return this.workspace.addWidget({type:"text",version:3,...a},{useDefaults:!0}),!1}}return!0},onCopyTextStyles:function(e){let o=this.workspace.getSelectedBlocks();o.length===1&&o[0].model.get("type")==="text"&&(e.preventDefault(),o[0].storeCopiedStyles(),Fe("shortcut_c_ctrl_alt"))},onPasteTextStyles:function(e){e.preventDefault();let o=this.workspace.getSelectedBlocks();o.length===1&&o[0].model.get("type")==="text"&&(o[0].applyCopiedStyles(),Fe("shortcut_v_ctrl_alt"))},onCopyAnimation:function(e){if(e.preventDefault(),delete this.animationPasteData,this.previewMode)return;if((0,Q.default)(e.target).is(this.workspaceTextInputSelectors))return!0;let o=this.workspace.getSelectedBlocks(),t=o.reduce((i,s)=>{let a=es.getUuidHash(s.model.getAnimations())||"none";return{...i,[a]:!0}},{});Fe("shortcut_c_ctrl_shift");let r=Ce.default.keys(t);!r.length||r.length>1||r[0]==="none"||o.length&&(this.animationPasteData=Qt(o[0].model.getAnimations()))},onPasteAnimation:function(e){if(e.preventDefault(),Ce.default.isEmpty(this.animationPasteData)||this.previewMode)return;if((0,Q.default)(e.target).is(this.workspaceTextInputSelectors))return!0;let o=Ce.default.map(this.workspace.getSelectedBlocks(),Ce.default.bind(function(t){let r=this.animationPasteData.find(a=>a.type==="click"),i=this.workspace.viewport!=="default",s=Qt(this.animationPasteData).map(a=>({...a,type:i&&a.type==="hover"?r?"none":"click":a.type,UUID:Ye.generateUUID()}));return{_id:t.model.get("_id"),animation:s}},this));Ce.default.isEmpty(o)||(this.workspace.save_group(o),this.workspace.trigger("paste-animation"),Fe("shortcut_v_ctrl_shift"))},forbidAccess:function(){window.location.href="/"},raiseConnectionError:function(){let e=this;this.connectionError||this.socketConnectionError||(this.connectionError=!0,this.trigger("showConnectionAlert"),clearInterval(this.pingTimer),this.pingTimer=setInterval(function(){e.pingXHR&&e.pingXHR.abort(),e.pingXHR=Q.default.get("/api/ping",function(){clearInterval(e.pingTimer),e.clearConnectionError()})},this.PING_INTERVAL))},clearConnectionError:function(){let e=[],o=0;this.connectionError&&(this.connectionError=!1,Ce.default.each(this.workspaces,function(t){Ce.default.each(t.blocks,function(r){r.model.wasNotSaved&&e.push(r.model)})}),this.syncManager?.groupSave?.wasNotSaved&&e.push(this.syncManager.groupSave),e.length===0&&this.trigger("hideConnectionAlert"),Ce.default.each(e,t=>{t.once("re-saved",()=>{o++,o===e.length&&this.trigger("hideConnectionAlert")}),t.save()}))},raiseSocketConnectionError:function(){RM.DEBUG&&console.log("Socket connection error raised"),!this.socketConnectionError&&(this.connectionError&&(clearInterval(this.pingTimer),this.connectionError=!1,this.trigger("hideConnectionAlert")),this.socketConnectionError=!0,this.trigger("showSocketConnectionAlert"))},clearSocketConnectionError:function(){RM.DEBUG&&console.log("Socket connection error cleared"),!(this.sockets.errorRaisedAt-Date.now()>60*1e3)&&this.mag.fetchLastChanged(Ce.default.bind(function(e){e.wasChanged||(this.trigger("hideSocketConnectionAlert"),delete this.sockets.errorRaisedAt,delete this.socketConnectionError)},this))},showBlockLayer:function(e,o){let t=(0,Q.default)("<div>").insertAfter("#constructor").addClass("rm-block-layer");return typeof e=="function"&&t.on("click",e),o&&(o.darker?t.addClass("darker"):o.transparent&&t.addClass("transparent")),Ce.default.delay(function(){t.addClass("fade-in")},20),t},hideBlockLayer:function(e){e&&(e.removeClass("fade-in"),Ce.default.delay(function(){e.remove()},220))},exportMagAsTemplateset:function(e){let o=new(Or.default.Model.extend({url:"/api/templateset/"})),t=[],r=[],i=this.mag.hasGlobalWidgets()?{withGlobalWidgets:!0}:{};Ce.default.each(this.mag.pages.models,function(s){let a=this.getWorkspace(s.get("_id"));if(!a)return;let l=a.getTemplateJSON(i);l&&(r=Ce.default.uniq(r.concat(l.globalWids),"_id"),delete l.globalWids,t.push(l))},this),r.length&&t.forEach(s=>{s.wids=s.wids.concat(r)}),t.length&&o.save({templates:t,mag_num_id:this.mag.get("num_id"),mag_title:this.mag.get("title")||"Project "+this.mag.get("num_id"),dontRenewScreenshots:e})},switchCurrentPage:function(e){this.inactiveUser&&this.makeUserActive(e),this.inactivityTimer&&this.startInactivityTimer(),this.sockets&&this.sockets.users_list&&this.sockets.users_list.size()>1&&this.renewScreenshot(),this.sockets&&this.sockets.lockPage(e)},onLockMessage:function(e){e.length||(e=[e]);let o=this.workspace.locked;this.lockCache=this.lockCache||{},Ce.default.each(e,Ce.default.bind(function(t){let r=t.userId,i=t.pageId;t.tp==="lock"&&(this.lockCache[i]=r,ye.trigger("page:locked",i,r)),t.tp==="unlock"&&(delete this.lockCache[i],ye.trigger("page:unlocked",i))},this)),this.workspace&&this.workspace.updateLockState(),o&&!this.workspace.locked&&this.lockCache[this.workspace.page.id]==this.me.id&&this.workspace.page.needUpdate&&this.mag.pages.fetchFullPage(this.workspace.page.id)},onClientDisconnected:function(e){this.lockCache=this.lockCache||{};for(let o in this.lockCache)this.lockCache[o]===e&&delete this.lockCache[o]},syncLockedPages:function(){this.workspace&&this.workspace.updateLockState()},isPageLocked:function(e){return this.lockCache&&this.lockCache[e]&&this.lockCache[e]!=this.me.id},isPageLockedByMe:function(e){return this.lockCache&&this.lockCache[e]&&this.lockCache[e]==this.me.id},isCurrentPageLocked:function(){return this.workspace&&this.isPageLocked(this.workspace.page.get("_id"))},getLockUserInfoByPage:function(e){let o=this.lockCache&&this.lockCache[e];return this.sockets&&this.sockets.users_list&&this.sockets.users_list.get(o)},unlockPage:function(e){this.sockets&&this.sockets.takeOver(e.get("_id")),this.closeCodeEditor()},showUnlockPageAlert:function(e){let o=e.getUserpic(128),t=e.get("name");this.workspace&&this.workspace.setViewport("default"),this.workspace&&this.workspace.trigger("deselect"),this.alertSharedUnlockPage&&this.alertSharedUnlockPage.hide(),this.alertSharedUnlockPage=this.alertSharedUnlockPage||new js({$parent:(0,Q.default)("body > .popups"),router:this.router,opts:{type:"type-shared-unlock-page",text:t+" has took control over this page.",icon:o},alert_source:"shared unlock page"}),this.alertSharedUnlockPage.render(),this.alertSharedUnlockPage.once("hide",function(){delete this.alertSharedUnlockPage},this)},updateFromSocket:function(e){let o=Ce.default.bind(function(h){let b=this.mag.pages.get(h);b&&(RM.DEBUG&&console.log(b,"needUpdate"),b.needUpdate=!0)},this),t=(h,b)=>{if(!b)return;let x=this.mag.getWidgetById(h);if(x)x.parse(Ce.default.omit(b,["_id","is_global","is_above"]),{parse:!0,socketUpdate:!0});else{let y=this.mag.getPage(b.pid);y&&(x=y.addWidget(b,{socketUpdate:!0,nosave:!0}))}x&&this.syncManager&&(this.syncManager.historyModelsList[h]={model:x,attrs:x.cloneJSON()})};RM.DEBUG&&console.log("receive socket update",e.modelName,e.data);let r=(h,b,x)=>h!==this.workspace.viewport?Ce.default.omit(x,["wids",...Pe.widgetViewportFields(b)]):Ce.default.omit(x,["wids"]);switch(this.mag.updateLastChanged(),e.modelName){case"Widget":var g=e.data.pid;o(g);var i=this.mag.pages.get(g);if(i===this.workspace.page||e.data.is_global){let h=i.widgets.get(e.data._id);if(!h)return;if(h.set(r(e.viewport,h.get("type"),e.data),{parse:!0,first:!0,socketUpdate:!0}),h.get("is_global")&&e.viewport!==this.workspace.viewport){let b=Ce.default.pick(e.data,[...Pe.widgetViewportFields(h.get("type"))]);Ce.default.isEmpty(b)||(h[`viewport_${e.viewport}`]={...h[`viewport_${e.viewport}`]||{},...b})}}else if(i&&i!==this.workspace.page&&Dt("constructor.activateWidgetCreationSyncInTeamwork")){if(i.widgets.get(e.data._id))return;let b=new lp(e.data);i.addWidget(b,{socketUpdate:!0,silent:!0,nosave:!0,updateIndex:!1})}break;case"Page":var g=e.data._id;o(g);var i=this.mag.pages.get(g);if(!i)return;if(i==this.workspace.page&&!Ce.default.isEqual(i.get("wids"),e.data.wids)){this.mag.pages.fetchFullPage(i.id);break}Dt("constructor.activateWidgetCreationSyncInTeamwork")?i.set(e.data,{parse:!0,socketUpdate:!0}):i.set(Ce.default.omit(e.data,"wids"),{parse:!0,socketUpdate:!0});break;case"Mag":if(e.data.pids){let h=Ce.default.difference(e.data.pids,this.mag.get("pids"));this.mag.set({pids:Ce.default.difference(e.data.pids,h)},{socketUpdate:!0}),Ce.default.each(h,function(b){this.mag.pages.fetchFullPage(b,{socketUpdate:!0,success:Ce.default.bind(function(){this.syncLockedPages()},this)})},this)}this.mag.set(Ce.default.omit(e.data,"pids"),{parse:!0,socketUpdate:!0});break;case"PageOrder":var s=RM.constructorRouter.mag.getPageUri(RM.constructorRouter.workspace.page.id)+"/",a=Or.default.history.getFragment().split("?")[0],l=a.indexOf(s)==a.length-s.length;this.pageOrder.set(e.data,{parse:!0,socketUpdate:!0}),this.pageOrder.orderPages(e.data.order,{socketUpdate:!0}),l&&(this.updateUrl(),this.workspace&&this.trigger("pageChange",this.workspace)),this.syncLockedPages();break;case"MagEditParams":{let h=Qt(this.mag.edit_params.toJSON());this.mag.edit_params.set(e.data,{parse:!0,socketUpdate:!0}),this.mag.triggerEditParamsRewrite(h,e.data);break}case"TextStyles":Xs({...Ks(),...e.data});break;case"LinkStyles":Zs({...Js(),...e.data});break;case"ListStyles":Qs({...ea(),...e.data});break;case"Swatches":Bf({...If(),...e.data});break;case"Guides":var m=e.data._id,c=this.gg.guides&&this.gg.guides.models;if(!c||!c.get)return;var p=c.get(m);p&&p.set(e.data,{parse:!0,socketUpdate:!0});break;case"GroupSave":var u={parse:!0,first:!0,socketUpdate:!0},d=this.workspace?.viewport;if(d&&Array.isArray(e.data.changes)){let h=[];e.data.changes.forEach(b=>{if(b.modelType!=="widget"){h.push(b);return}let x=b;b.is_global&&e.data.widgetsAttrs&&e.data.widgetsAttrs[b._id]&&t(b._id,e.data.widgetsAttrs[b._id]),e.viewport===d?d!=="default"&&(x={...Ce.default.omit(b,`viewport_${e.viewport}`),...b[`viewport_${e.viewport}`]}):e.viewport==="default"&&typeof b.is_global>"u"&&typeof b.is_above>"u"&&typeof b.is_locked>"u"&&(x={...Ce.default.pick(b,["_id","modelType"]),viewport_default:Ce.default.omit(b,["_id","modelType"])}),h.push(x)}),h.length&&(e.data.changes=h)}this.workspace.set_group(e.data.changes,u),Ce.default.each(e.data.pids,function(h){o(h)});break;case"TrashPages":{let h=e.data,b=x=>this.mag.pages.get(x)||this.mag.trashPages.get(x)||this.workspace.syncManager.historyModelsList[x]?.model;if(h.added){let x=b(h.added);x&&this.mag.trashPages.add(x,{socketUpdate:!0})}else if(h.removed){let x=b(h.removed);x&&this.mag.trashPages.remove(x,{socketUpdate:!0})}else h.emptyTrash&&this.mag.trashPages.reset();this.mag.set("has_deleted_pages",this.mag.trashPages.length>0,{socketUpdate:!0});break}case"UpdateInMobileViewport":var g=e.data;g&&o(g);break;case"Order":this.indexController.updateFromSocket(e.data);break}},startInactivityTimer:function(o){var o=o||{time:"short"};this.inactiveUser||!this.sockets||(this.stopInactivityTimer(),this.inactivityTimer=setTimeout(Ce.default.bind(function(){this.sockets.leavePage(this.workspace.page.id),this.navigate("edit/"+this.mag.get("num_id")+"/contents/",{replace:!0}),this.inactiveUser=!0},this),this.inactivityTimesMap[o.time]))},stopInactivityTimer:function(){this.sockets&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)},makeUserActive:function(e){this.sockets&&(this.stopInactivityTimer(),this.inactiveUser&&(delete this.inactiveUser,this.mag.fetchLastChanged(Ce.default.bind(function(o){o.wasChanged&&(this.workspace&&this.workspace.trigger("deselect"),Ce.default.defer(function(){window.location.reload()}))},this)),this.switchCurrentPage(e||this.workspace.page.id)))},openCodeEditor:function(e){window.RM.common.disableShortcuts["code-editor"]=!0,this.workspaceCodeEditor=new j0({router:this,mag:this.mag,model:e&&e.model}),this.workspaceCodeEditor.show(),this.widgetbar&&this.widgetbar.hide(),this.workspace&&this.listenTo(this.workspace,"panelShowed",this.closeCodeEditor),this.workspace&&this.listenTo(this.workspace,"select",this.closeCodeEditor),this.isCodeEditorVisible=!0},closeCodeEditor:function(e){!this.workspaceCodeEditor||!this.isCodeEditorVisible||(this.isCodeEditorVisible=!1,e||this.workspaceCodeEditor.saveCodes(),this.workspaceCodeEditor.hide(),this.widgetbar&&this.widgetbar.show(),this.workspace&&this.stopListening(this.workspace,"panelShowed",this.closeCodeEditor),this.workspace&&this.stopListening(this.workspace,"select",this.closeCodeEditor),delete window.RM.common.disableShortcuts["code-editor"])},reloadWorkspaces:function(){this.mag.loadFull({success:()=>{this.syncManager=new im(this,this.mag),Lt.initialize(this.syncManager),this.workspace&&this.workspace.trigger("deselect"),this.widgetbar&&this.widgetbar.rerender(),ye.trigger("closeSettings");for(let o in this.workspaces)this.removeWorkspace(o);let e=this.workspace.page.id;delete this.workspace,this.showWorkspace({id:e})},error:e=>{e.status!==403&&this.notFound()}})},isAnyModeActive:function(){let e=this.workspace?.getCommentModeState?.(),o=this.mag.edit_params.get("blocks"),t=je.getCurrentProjectRole(this.mag.get("num_id"))==="editor";return e||o||t},disableCurrentMode:function(){this.workspace?.getCommentModeState?.()&&Pa(!1),this.mag.edit_params.get("blocks")&&this.changeBlocksMode(!1,!1),this.changeEditorMode("member")},changeBlocksMode:async function(e,o=!1){this.mag.edit_params.save("blocks",e),o&&(await this.changeEditorMode("member"),Pa(!1))},toggleBlocksMode:async function(){let e=this.mag.edit_params.get("blocks");this.changeBlocksMode(!e,!0)},canChangeLockedLayoutMode:function(){return this.isOwner||this.mag.teamRole==="member"},changeEditorMode:async function(e,o=!1){if(o&&(this.mag.edit_params.save("blocks",!1),Pa(!1)),!!this.canChangeLockedLayoutMode())try{let t=this.mag.get("num_id"),r=je.getCurrentProjectRole(t);if(e===r)return;this.mag.roleName=e,je.saveProjectRole(t,e),this.reloadWorkspaces(),ye.trigger("refreshTeamworkData"),e==="editor"&&ae(ce.ContentEditMode,{eventLabel:"on"})}catch{window.RM.constructorRouter.trigger("notice:show","Oops",{canBeClosed:!0})}},toggleSelfEditorMode:async function(){let e=this.mag.get("num_id"),t=je.getCurrentProjectRole(e)==="member"?"editor":"member";await this.changeEditorMode(t,!0)},destroy(){ye.off("change:device",this.onChangeDevice,this),Dt("widget.anomalyMonitoring")&&document.removeEventListener("click",ma.onClick)}}),l2=uT;var m2=T(lu());l_();fl();pt();var Bt=T(St()),mi=T(et());var Zi=T(St()),c2=T(mo()),Ji=T(et());Vo();Fr();var p2={"template-constructor-search-panel":Ct`
	<div class="search-panel">
		<div class="search-panel-wrapper">

			<div class="search">
				<div class="search-wrapper">
					<input class="search-input"  spellcheck="false" maxlength="100" type="text" value="" data-testid="image-search-input"/>
					<div class="search-icon"></div>
					<div class="search-clear"></div>
				</div>
			</div>

			<div class="panel-title invisible"></div>
			<div class="back-button invisible"></div>

			<div class="scroll-wrapper">
				<div class="results-wrapper">
					<div class="results" data-testid="image-search-results">

						<div class="preloader-wrapper">
							<div class="rmpreloader">
								<div class="shadow"></div>
								<div class="arc"></div>
							</div>
						</div>

						<div class="message">
							<div class="top-text"></div>
							<div class="bottom-text"></div>
						</div>

					</div>
				</div>
				<div class="scroll"></div>
			</div>


			<a class="logo" href="" target="_blank"></a>


			<div class="logged-user">
				<a class="userpic" target="_blank"></a>
				<div class="logout">Logout</div>
			</div>

		</div>
	</div>
`};rd();var gT=c2.default.View.extend({initialize:function(e){this.initPanel(e)},initPanel:function(){Ji.default.bindAll(this)},render:function(){this.template=p2["template-constructor-search-panel"],this.setElement((0,Zi.default)(this.template({})).insertAfter("#constructor")),this.$el.on("click",function(e){e.stopPropagation()}),this.$el.on("click",".search-icon",this.onSearchIconClick),this.$el.on("click",".search-clear",this.onSearchClearClick),this.$el.on("click",".back-button",this.onBackButtonClick),this.$el.find(".search-input").on("input propertychange",this.onInputChanged).on("keypress keyup keydown",this.onInputKey),this.scroll=(0,Zi.default)(this.$(".scroll-wrapper")).RMScroll({$container:this.$(".scroll-wrapper .results-wrapper"),$content:this.$(".scroll-wrapper .results-wrapper .results"),$handle:this.$(".scroll-wrapper .scroll"),onScroll:this.onScroll}).data("scroll"),this.rendered=!0},onScroll:function(){},showPreloader:function(e){this.$(".results .preloader-wrapper").toggleClass("fill-content",e),this.$(".results .preloader-wrapper").removeClass("invisible"),this.$(".results .rmpreloader").css("display","block")},hidePreloader:function(e){this.$(".results .preloader-wrapper").toggleClass("invisible",e),this.$(".results .preloader-wrapper").removeClass("fill-content"),this.$(".results .rmpreloader").css("display","none")},showMessage:function(e,o){this.$(".results .message .top-text").text(e),this.$(".results .message .bottom-text").text(o),this.$(".results .message").css("display","block")},hideMessage:function(){this.$(".results .message").css("display","none")},showPanelTitle:function(e){let o=(0,Zi.default)('<span class="space">'+(e||"").split("ct").join('c</span><span class="space">t')+"</span>");this.$(".panel-title").empty().append(o),this.$(".panel-title").toggleClass("invisible",!1)},hidePanelTitle:function(){this.$(".panel-title").toggleClass("invisible",!0)},showSearch:function(){this.$(".search").toggleClass("invisible",!1)},hideSearch:function(){this.$(".search").toggleClass("invisible",!0)},showBackButton:function(){this.$(".back-button").toggleClass("invisible",!1)},hideBackButton:function(){this.$(".back-button").toggleClass("invisible",!0)},onBackButtonClick:function(){},onInputChanged:function(){Ye.setInputSize(this.$(".search-input"),550),this.$(".search-clear").toggle(this.$(".search-input").val()!=="")},onSearchClearClick:function(){this.$(".search-input").blur(),this.emptySearchInput(),this.$(".search-input").focus()},onInputKey:function(e){if(e.stopPropagation(),e.keyCode===27&&e.preventDefault(),e.type==="keyup"){if(e.keyCode===27){this.$(".search-input").val()!==""?(this.$(".search-input").blur(),this.emptySearchInput(),this.$(".search-input").focus()):this.hide();return}e.keyCode===13&&(e.preventDefault(),this.newSearch())}},newSearch:function(){this.$el.hasClass("search-on-center")&&this.$(".search-input").val()&&(this.$el.removeClass("search-on-center"),this.onInputChanged())},onBodyKey:function(e){this.$(".search-input").is(":focus")||(e.keyCode===27&&(e.preventDefault(),e.stopPropagation()),e.type==="keyup"&&e.keyCode===27&&this.bodyEscKey())},bodyEscKey:function(){this.hide()},emptySearchInput:function(){this.$(".search-input").val("").width("3px"),this.$(".search-clear").hide()},onSearchIconClick:function(e){e.stopPropagation(),this.$(".search-input").focus(),this.newSearch()},onMouseWheel:function(e){e&&e.stopPropagation(),e&&e.preventDefault()},disableMouseWheel:function(){(0,Zi.default)(document).bind("mousewheel",this.onMouseWheel)},enableMouseWheel:function(){(0,Zi.default)(document).unbind("mousewheel",this.onMouseWheel)},show:function(e,o){if(import("https://st-p.rmcdn.net/a3d0cfe4/dist/c/c-PKMOVP7P.js").then(({default:t})=>{t("searchpanel")}),this.$el.hasClass("search-on-center")&&e&&this.$el.removeClass("search-on-center"),this.settings=o,!this.rendered){this.render(),setTimeout(Ji.default.bind(function(){this.show(e,o)},this),0);return}this.disableMouseWheel(),this.$block_layer=RM.constructorRouter.showBlockLayer(this.hide),this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(Ji.default.bind(function(){this.$el.removeClass("show-in")},this),20),setTimeout(Ji.default.bind(function(){this.$el.css("width","+=1")},this),300),setTimeout(Ji.default.bind(function(){this.$el.css("width","-=1"),this.setFocusOnShow(),e&&this.newSearch()},this),300),e&&(this.emptySearchInput(),this.$(".search-input").val(e)),this.onInputChanged(),(0,Zi.default)("body").on("keypress keyup keydown",this.onBodyKey)},setFocusOnShow:function(){this.$(".search-input").focus()},hide:function(e){e&&e.stopPropagation(),this.enableMouseWheel(),RM.constructorRouter.hideBlockLayer(this.$block_layer),(0,Zi.default)("body").off("keypress keyup keydown",this.onBodyKey),this.$el.addClass("show-out"),setTimeout(Ji.default.bind(function(){this.$el.css("display","none")},this),200),setTimeout(Ji.default.bind(function(){pn()},this),200)}}),On=gT;pt();Fr();var Nc={"template-constructor-search-panel-unsplash":Ct`

    <div class="bottom-menu">
        <ul>
            <li data-item="search" class="searching active">Search</li>
            <li data-item="my-photos" class="my-photos">My&thinsp;&thinsp;Photos</li>
            <li data-item="my-collections" class="my-collections">My&thinsp;&thinsp;Collections</li>
        </ul>
        <span></span>
    </div>


    <div class="popup-image">
        <div class="image"></div>
        <div class="source-wrapper">
            <span class="copyright">© </span>
            <a class="source" target="_blank" href="">source</a>
        </div>
    </div>

`,"template-constructor-search-panel-unsplash-connect":Ct`
    <div class="connect-wrapper">
        <div class="connect-logo"></div>
        <div class="connect-button">Connect</div>
    </div>
`,"template-constructor-search-panel-unsplash-collection":Ct`
    <div class="collection" style="background-image: url('<%=collection.cover_photo.urls.thumb%>')" data-collection="<%=collection.id%>">
        <div class="greybg"></div>
        <div class="overlay">
            <div class="title"><%-collection.title%></div>
            <div class="count"><%-collection.total_photos%>&thinsp;&thinsp;photo<%-(collection.total_photos==1) ? '': 's'%></div>
        </div>
    </div>
`};var hT=On.extend({name:"searchUnsplash",params:{serviceUrl:"https://unsplash.com/",apiCredit:"?utm_source=readymag&utm_medium=referral&utm_campaign=api-credit",panelClass:"search-unsplash",PreloadDesignImagesType:"searchpanel-unsplash",per_page:30,imageHeight:98,imagePadding:7,imageMaxWidth:2,imageMinWidth:.5,maxImageSize:2880},noResultsText:{search:["Sorry, no photos found.","Try different keywords."],"my-photos":["You haven't uploaded any photos yet.",""],"my-collections":["You haven't created any collections yet.",""]},requestInAction:!1,searchParams:{query:""},curMenuItem:"search",initialize:function(e){this.initPanel(e)},render:function(){On.prototype.render.apply(this,arguments);let e=Nc["template-constructor-search-panel-unsplash"];this.connect_template=Nc["template-constructor-search-panel-unsplash-connect"];let o=e({});(0,Bt.default)(o).appendTo(this.$el.find(".search-panel-wrapper")),this.$("a.logo").attr("href",this.params.serviceUrl+this.params.apiCredit),this.$el.addClass(this.params.panelClass).addClass("search-on-center"),this.$imagePopup=this.$(".popup-image"),this.$imagePopup.on("mouseleave",this.hideImagePopup),this.$imagePopup.bind("mousewheel",this.onImagePopupScroll),this.$imagePopup.find(".image").on("mouseup",this.imagePopupClick),this.$(".bottom-menu li").on("click",this.onMenuItemClick),setTimeout(mi.default.bind(function(){this.checkAuth(!0)},this),1),this.$(".logged-user .logout").on("click",this.logout),this.$el.on("mouseup",".results",this.onResultsClick)},newSearch:function(e){On.prototype.newSearch.apply(this,arguments),this.showSearch(),this.hidePanelTitle(),this.hideBackButton();let o=this.$(".search .search-input").val().trim();this.searchParams.query===o&&!e||this.doSearch(o)},doSearch:function(e){this.searchParams={query:e,page:1},this.clearResults(),this.makeSearchRequest()},recalcImagesSizes:function(e){let o=[],t=-this.params.imagePadding,r=this.$(".results").width(),i=this,s=!0;this.$(".results .image").each(mi.default.bind(function(l,m){let c=(0,Bt.default)(m).data("width"),p=(0,Bt.default)(m).data("height"),u=this.params.imageHeight/p,d=Math.ceil(c*u);d<this.params.imageHeight*this.params.imageMinWidth&&(d=Math.floor(this.params.imageHeight*this.params.imageMinWidth)),d>this.params.imageHeight*this.params.imageMaxWidth&&(d=Math.floor(this.params.imageHeight*this.params.imageMaxWidth)),t+d+this.params.imagePadding>r&&(s=!1,a(o,t,!1),t=-this.params.imagePadding,o=[]),o.push({img:(0,Bt.default)(m),new_w:d}),t+=d+this.params.imagePadding},this)),a(o,t,!0,e);function a(l,m,c,p){if(l.length==0)return;let u=Math.floor((r-m)/l.length),d=(r-m)%l.length,g=0;c&&(u=0,d=0),mi.default.each(l,function(h){g++,h.new_w+=u,g<=d&&(h.new_w+=1),h.img.css({height:i.params.imageHeight,width:h.new_w,"margin-bottom":c?0:i.params.imagePadding,"margin-right":g==l.length?0:i.params.imagePadding,display:c&&!s&&!p?"none":"block"})})}},clearResults:function(){this.$(".results .connect-wrapper").remove(),this.$(".results .image").remove(),this.$(".results .collection").remove(),this.hidePreloader(),this.hideMessage(),this.scroll&&this.scroll.recalc()},renderImage:function(e){let o=e.urls.raw+"?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&h=200&fit=max&s=1897f83cf25fe8a8fd14ea067685731b",t=e.urls.raw;Math.max(e.width,e.height)>this.params.maxImageSize&&(e.width>e.height?t+="?ixlib=rb-0.3.5&q=90&fm=jpg&crop=entropy&cs=tinysrgb&w="+this.params.maxImageSize+"&fit=max&s=1897f83cf25fe8a8fd14ea067685731b":t+="?ixlib=rb-0.3.5&q=90&fm=jpg&crop=entropy&cs=tinysrgb&h="+this.params.maxImageSize+"&fit=max&s=1897f83cf25fe8a8fd14ea067685731b"),(0,Bt.default)("<div></div>").addClass("image").data("width",e.width).data("height",e.height).data("id",e.id).data("ownername",e.user.name).data("src",t).data("download-url",e.links.download_location).data("src-thumb",o).css({"background-image":'url("'+o+'")'}).on("mouseenter",this.onImageMouseEnter).on("mouseleave",this.onImageMouseLeave).insertBefore(this.$(".results .preloader-wrapper"))},renderCollection:function(e){let o=Nc["template-constructor-search-panel-unsplash-collection"];(0,Bt.default)(o({collection:e})).on("click",this.onCollectionClick).data("collection-name",e.title).insertBefore(this.$(".results .preloader-wrapper"))},makeSearchRequest:function(){this.showPreloader(),this.requestInAction=!0;let e=this.searchParams.type||"search",o={page:this.searchParams.page||1,per_page:this.params.per_page},t={params:o,method:e};e==="search"&&(o.query=this.searchParams.query),e==="my-collection-photos"&&(t.collectionId=this.searchParams.collectionId),Bt.default.ajax({method:"POST",url:"/api/authservice/unsplash/call",context:this,data:t,success:function(r){let i=r.results||r;if(e=="my-collections"&&this.searchParams.type=="my-collections"&&(i=i.filter(function(a){return!!a.total_photos}),this.showPanelTitle(i.length+" Collection"+(i.length!==1?"s":""))),!i||!i.length&&this.searchParams.page==1){this.clearResults(),this.showMessage.apply(this,this.noResultsText[e]),this.searchParams.text="",this.requestInAction=!1;return}this.requestInAction=!1,r.total_pages?this.searchParams.allPages=r.total_pages<=this.searchParams.page:this.searchParams.allPages=i.length<this.params.per_page,this.searchParams.page++;let s=this.searchParams.type!=="my-collections"?this.renderImage:this.renderCollection;mi.default.each(i,s.bind(this)),this.recalcImagesSizes(this.searchParams.allPages),this.hidePreloader(),this.scroll&&this.scroll.recalc()},error:function(){this.clearResults(),this.showMessage("Oops, an error occured.","Please, try again."),this.searchParams.text="",this.requestInAction=!1}})},setFocusOnShow:function(){this.curMenuItem==="search"&&On.prototype.setFocusOnShow.apply(this,arguments)},showUserImages:function(e){if(this.clearResults(),e!=="search"?this.hideSearch():this.showSearch(),e==="my-photos"?this.showPanelTitle("My Photos"):e!=="my-collection-photos"&&this.hidePanelTitle(),e!=="my-collection-photos"?this.hideBackButton():(this.$(".my-collections").addClass("my-collections-inside"),this.showBackButton()),this.authorized)this.searchParams.type=e,this.searchParams.page=1,this.makeSearchRequest();else{let o=this.connect_template({});(0,Bt.default)(o).appendTo(this.$(".results")),this.$(".connect-button").on("click",mi.default.bind(function(){this.checkAuth(!1)},this))}},onCollectionClick:function(e){let o=(0,Bt.default)(e.currentTarget);this.searchParams.collectionId=o.data("collection"),this.showPanelTitle(o.data("collection-name")),this.showUserImages("my-collection-photos")},onMenuItemClick:function(e){let o=(0,Bt.default)(e.currentTarget),t=o.data("item");if(!(o.hasClass("active")&&(t!=="my-collections"||this.searchParams.type!="my-collection-photos"))){if(this.curMenuItem=t,this.$(".bottom-menu li").removeClass("active"),this.$(".my-collections").removeClass("my-collections-inside"),o.addClass("active"),this.$(".search").toggleClass("inactive",this.curMenuItem==="my-photos"||this.curMenuItem==="my-collections"),this.clearResults(),this.curMenuItem==="search"){this.newSearch(!0),setTimeout(this.setFocusOnShow.bind(this),0);return}this.$el.hasClass("search-on-center")&&(this.$el.removeClass("search-on-center"),this.onInputChanged()),this.showUserImages(this.curMenuItem)}},onBackButtonClick:function(){this.showUserImages("my-collections")},onImageMouseEnter:function(e){clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout),this.imagePopupTimeout=setTimeout(mi.default.bind(function(){this.showImagePopup(e)},this),500),this.settings.preview&&(this.imagePreviewTimeout=setTimeout(mi.default.bind(function(){this.settings.preview((0,Bt.default)(e.currentTarget).data("src-thumb"),{success:function(){this.settings.preview((0,Bt.default)(e.currentTarget).data("src"))}.bind(this)})},this),200))},onImageMouseLeave:function(){clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout)},hideImagePopup:function(){this.$curImagePopup=null,this.$imagePopup.fadeOut(100)},onImagePopupScroll:function(e,o,t,r){this.$(".scroll-wrapper .results-wrapper").trigger(e,o,t,r),this.hideImagePopup()},showImagePopup:function(e){let o=(0,Bt.default)((0,Bt.default)(e.target).closest(".image")),t=parseInt(o.width(),10);this.$curImagePopup=o,this.$imagePopup.find(".image *").remove(),o.find(".rmpreloader").clone().appendTo(this.$imagePopup.find(".image")),o.find(".error").clone().appendTo(this.$imagePopup.find(".image")),this.$imagePopup.find(".image").css({width:t,"margin-left":0,height:o.css("height"),"background-image":o.css("background-image")});let r="https://unsplash.com/photos/"+o.data("id")+this.params.apiCredit;this.$imagePopup.find(".source").attr("href",r).text(o.data("ownername")),this.$imagePopup.fadeIn(100);let i=parseInt(this.$imagePopup.width(),10),s=Math.floor(i-t)/2,a=o.offset().left-this.$el.offset().left-s-8,l=o.offset().top-this.$el.offset().top-8;this.$imagePopup.css({left:a,top:l}),this.$imagePopup.find(".image").css({"margin-left":s})},onScroll:function(e){On.prototype.onScroll.apply(this,arguments),this.$(".results .image").length&&(e.scroll_event&&this.hideImagePopup(),e.content_size-e.container_size-e.scroll_pos<32&&(this.requestInAction||this.searchParams.allPages||this.makeSearchRequest()))},checkAuth:function(e){if(e)Bt.default.ajax({url:"/api/authservice/unsplash/check",method:"GET",success:this.showSearchTools,context:this,global:!1});else if(!this.authorized){this.unsplashAuthWindow&&this.unsplashAuthWindow.close(),(0,Bt.default)(window).on("message",this.processWindowMessage);let o=screen.width,t=screen.height,r=Math.min(1e3,o),i=Math.min(700,t-40),s=Math.ceil((o-r)/2),a=Math.ceil((t-i)/2);this.unsplashAuthWindow=window.open("/api/authservice/unsplash/authorize","_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+r,"height="+i,"top="+a,"left="+s].join())}},logout:function(){this.logoutInProgress||(this.logoutInProgress=!0,Bt.default.get("/api/authservice/unsplash/logout",mi.default.bind(function(){this.$(".logged-user").css("display","none"),this.authorized=!1,(this.curMenuItem=="my-photos"||this.curMenuItem=="my-collections")&&this.showUserImages(this.curMenuItem),this.logoutInProgress=!1},this)))},handleAuthResult:function(e){e&&!e.error&&e.profile&&this.showSearchTools()},showSearchTools:function(){this.authorized=!0,Bt.default.ajax({url:"/api/authservice/unsplash/call",method:"POST",data:{method:"my"},context:this,global:!1,success:function(e){if(!e)return;this.$(".logged-user").css("display","block"),this.$(".logged-user .userpic").css("background-image",'url("'+e.profile_image.small+'")');let o=e.name&&(e.name.first_name||""+e.name.last_name)||""||e.username;o&&this.$(".logged-user .userpic").attr("title",o).attr("href","https://unsplash.com/@"+e.username+"/likes"),this.authorized=!0,(this.curMenuItem=="my-photos"||this.curMenuItem=="my-collections")&&this.showUserImages(this.curMenuItem)}})},processWindowMessage:function(e){let o;if(e=e.originalEvent||{},e.origin==oe.readymag_auth_host){try{o=JSON.parse(decodeURIComponent(e.data))}catch{}o&&o.event=="social-auth"&&((0,Bt.default)(window).off("message",this.processWindowMessage),this.unsplashAuthWindow&&this.unsplashAuthWindow.close(),this.unsplashAuthWindow=null,this.handleAuthResult(o.message))}},imagePopupClick:function(){this.selectImage(this.$curImagePopup)},selectImage:function(e){e&&(this.selectedImage=e.data("src"),this.selectedImageDownloadUrl=e.data("download-url"),this.$lastSelectedImage=e,this.hide())},onResultsClick:function(e){let o=(0,Bt.default)(e.target);o.hasClass("image")&&this.selectImage(o)},requestUnsplashDownloadUrl:function(){Bt.default.ajax({url:"/api/authservice/unsplash/call",method:"POST",data:{method:"download",url:this.selectedImageDownloadUrl}})},hide:function(){let e=function(){On.prototype.hide.apply(this,arguments),clearTimeout(this.imagePopupTimeout),clearTimeout(this.imagePreviewTimeout),this.hideImagePopup(),typeof this.settings.upload=="function"&&this.selectedImage&&(this.requestUnsplashDownloadUrl(),this.settings.upload(this.selectedImage)),(0,Bt.default)(window).off("message",this.processWindowMessage)}.bind(this);this.settings.preview&&!this.$lastSelectedImage?this.settings.preview("",{success:e,error:e}):e()}});(0,Bt.default)(function(){RM.views.searchUnsplash=new hT});Modernizr.webkit||Modernizr.firefox||(window.location.href="/sorry");Hf.setSupportedFormats();Yt.directive("sortable",{inserted:function(e,o){e._sortable=new m2.default(e,o.value||{})},componentUpdated:function(e,o){}});(0,Tu.default)(function(){Lb(),window.Backbone=$b(d2.default),uo.preloadShortList(),uo.generateCSS("paragraph","constructor",document,window.ServerData.editParams.paragraph_styles),uo.generateCSS("link","constructor",document,window.ServerData.editParams.link_styles),window.RM.constructorRouter=new l2,window.Backbone.history.universalStart({pushState:!0}),Tu.default.ajaxPrefilter(e=>{e.url?.startsWith("/api")&&(e.headers={...e.headers,[oe.RMVersionHeader]:oe.RELEASE})})});
